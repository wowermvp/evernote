<html>
<head>
  <title>优化mysql server+mysql日志</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1550"/>
<h1>优化mysql server+mysql日志</h1>

<div>
<span><div><span style="font-size: 12pt;">优化mysql server</span></div><div><span style="font-size: 9pt;">show variables        #查看服务器静态参数值</span></div><div><span style="font-size: 9pt;">show status           #查看服务器动态运行状态</span></div><div><span style="line-height: 13.6px;">mysqld --verbose --help|more    #查看服务器某个参数的详细定义（操作系统下的命令）</span></div><div><br/></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; line-height: 13.6px;">影响MySQL性能的重要参数</span></font></div><div><font style="font-size: 12px;"><span style="font-size: 12px; line-height: 13.6px;"><span style="font-size: 12px; line-height: 13.6px; color: rgb(255, 0, 0);"><b>key_buffer_size</b></span>这个参数是用来设置索引块（index block）缓存的大小，它被所有线程共享，此参数只适用于MyISAM存储引擎。</span></font></div><div><font style="font-size: 12px;"><span style="font-size: 12px; line-height: 13.6px;"><span style="font-size: 12px; line-height: 13.6px; color: rgb(255, 0, 0);"><b>tables_cache</b></span>这个参数表示数据库用户打开表的缓存数量。每个连接进来，都至少会打开一个表缓存。因此，table_cache与max_connections有关。可以通过检查mysqld的状态变量open_tables和opened_tables确定这个参数是否过小，这两上个参数的区别是前者表示当前打开的表缓存数，如果执行FLUSH TABLES操作，则此系统会关闭一些当前没有使用的表缓存而使此状态值变小；后者表示曾经打开的表缓存数，会一址进行累加，如果执行FLUSH TABLES操作，值不会减少。</span></font></div><div><font style="font-size: 12px;"><span style="font-size: 12px; line-height: 13.6px;"><span style="font-size: 12px; line-height: 13.6px; color: rgb(255, 0, 0);"><b>innodb_buffer_pool_size</b></span>这个参数定义了innodb存储引擎的表数据和索引数据的最大内存缓冲区大小。与MyISAM存储引擎不同，MyISAM的<span style="font-size: 12px; line-height: 13.6px;">key_buffer_size只缓存索引键，而Innodb_buffer_pool_size却是同时为数据块和索引块做缓存，这个特性和oracle是一样的，这个值设置的越高，访问表中数据需要的磁盘I/O就越少。在专用的数据库服务器上可设置为机器物理内存大小的80%。</span></span></font></div><div><font style="font-size: 12px;"><span style="font-size: 12px; line-height: 13.6px;"><span style="font-size: 12px; line-height: 13.6px; color: rgb(255, 0, 0);"><b>innodb_flush_log_at_trx_commit</b></span>这个参数是用来控制缓冲区中的缓存数据写入到日志文件以及日志文件数据刷新的到磁盘的操作时机。对这个参数设置可以对数据库在性能与数据安全之间进行折中。</span></font></div><div><span style="line-height: 13.6px;">    当这个参数是0的时候，日志缓冲每秒一次地被写到日志文件，并且对日志文件做向磁盘刷新的操作，但是在一个事务提交不做任何操作。</span></div><div><span style="line-height: 13.6px;">    当这个参数是1的时候，在每个事务提交时，日志缓冲被写到日志文件，并且对日志文件做向磁盘刷新的操作。</span></div><div><span style="line-height: 13.6px;">    当这个参数是2的时候，在每个事务提交时，日志缓冲被写到日志文件，但不对日志文件做向磁盘刷新的操作，对日志文件每秒向磁盘做一次刷新操作。</span></div><div>innodb_flush_log_at_trx_commit参数的默认值是1，也是最安全的设置，即每个事务提交的时候都会从log buffer写到日志文件，而且会实际刷新磁盘，但是这样性能有一定的损失。如果可以容忍数据库在崩溃时损失一部分数据，那么设置成0或者2都会有改善。设置成0，则在数据库崩溃的时候会丢失那些没有被写入日志文件的事务，最多丢失1秒钟的事务，这种方式是最不安全的，也是效率最高的。设置成2的时候，因为没有刷新到磁盘，但是已经写入日志文件，所以只要操作系统没有崩溃，那么并没有丢失数据，比设置成0更安全些。</div><div><span style="color: rgb(255, 0, 0);"><b>innodb_additional_mem_pool_size</b></span>这个参数是innodb存储引擎用来存储数据库结构和其他内部数据结构的内存池的大小，其默认值是1MB。</div><div><span style="color: rgb(255, 0, 0);"><b>innodb_lock_wait_timeout</b></span>这个参数主要被用于出现表锁导致的死锁的时候等待指定的时间后的回滚。系统默认值是50秒，用户可以根据应用的需要进行调整。</div><div><span style="color: rgb(255, 0, 0);"><b>innodb_support_wait</b></span>通过该参数设置是否支持分布式事务，默认值是ON或者1，表示支持分布式事务。如果确认应用中不需要使用分布式事务，则可以关闭这个参数，减少磁盘刷新的次数并获得更好的性能。</div><div><span style="color: rgb(255, 0, 0);"><b>innodb_log_buffer_size</b></span>这个参数是表示日志缓存的大小，默认设置在中等度写入负载以及较短事务的情况下，一般都可以满足服务器的性能要求。默认值是1MB，通常设置为8-16MB。</div><div><span style="color: rgb(255, 0, 0);"><b>innodb_log_file_size</b></span>这个参数是一个日志组（log group）中每个日志文件的大小，此参数在写入负载尤其是大数据集的情况下很重要。这个值越大则性能越高，但是带来的负作用是，当系统灾难恢复时间会加大。系统默认值5MB。</div><div><br/></div><div><span style="font-size: 12pt;">mysql日志</span></div><div><span style="font-size: 10pt;">错误日志</span></div><div><span style="font-size: 10pt;">   </span> <span style="font-size: 9pt;">可以用<font style="color: rgb(227, 0, 0);">--</font></span><span style="font-size: 9pt; color: rgb(255, 0, 0);"><b>log-error[=file_name]</b></span><span style="font-size: 9pt;">选项来指定mysqld保存错误日志文件的位置。如果没有给定file_name值，mysqld使用错误日志名host_name.err（host_name为主机名）并默认在参数DATADIR（数据目录）指定的目录中写入日志文件。</span></div><div><span style="font-size: 10pt;">二进制日志</span></div><div>    当用<span style="color: rgb(255, 0, 0);"><b>--log-bin[=file_name]</b></span>选项启动时，mysqld将包含所有更新数据的SQL命令写入日志文件。<span style="font-size: 10pt;">如果没有给定file_name值，默认名为主机名后面跟“-bin”。并默认在参数DATADIR（数据目录）指定的目录中写入日志文件。</span></div><div>    mysqlbinlog 二进制日志名        #查看二进制日志的内容</div><div>    reset master                    #该命令删除所有binlog日志</div><div>    system ls -ltr localhost-bin*   #查看二进制日志文件 </div><div>    purge master logs to 'mysql-bin.******'    #该命令删除“******”编号之前的所有日志</div><div>    purge master logs before 'yyyy-mm-dd hh24:mi:ss'    #该命令删除日期为“yyyy-mm-dd hh24:mi:ss”之前产生的所有日志</div><div>    <span style="color: rgb(255, 0, 0);"><b>--expires_logs_days=#</b></span>，此参数的含义是设置日志的过期天数，过了指定的天数后日志将会被自动删除</div><div>    <span style="color: rgb(255, 0, 0);"><b>--binlog-do-db=db_name</b></span>，记录指定数据库db_name的更新记录到二进制日志中。其他没有显式指定的数据库更新将被忽略，不记录在日志中。</div><div>    <span style="color: rgb(255, 0, 0);"><b>--binlog-ignore-db=db_name</b></span>，指定数据库db_name，不应将更新保存到二进制日志中，其他没有显式忽略的数据库都将进行记录。</div><div><br/></div><div>查询日志</div><div>    查询日志记录了客户端的所有语句，而二进制日志不包含只查询数据的语句。</div><div>    <span style="color: rgb(255, 0, 0);"><b>--log[=file_name]</b></span>，如果没有给定file_name的值，日志将写入DATADIR（数据目录）指定路径下，默认文件名是host_name.log。查询日志以纯文本的格式记录日志。</div><div><br/></div><div>慢查询日志</div><div>    慢查询日志记录了包含所有执行时间超过参数long_query_time（单位：秒）所设置值的SQL语句的日志。获得表锁定的时间不算作执行时间。</div><div>    <span style="color: rgb(255, 0, 0);"><b>--log-slow-queries[=file_name]</b></span>，如果没有给定file_name的值，日志将写入DATADIR（数据目录）指定的路径下，默认文件名是host_name-slow.log。</div><div>    mysqldumpslow 慢查询日志        #查看慢查询日志<span style="line-height: 1.45;">    </span></div></span>
</div></body></html> 