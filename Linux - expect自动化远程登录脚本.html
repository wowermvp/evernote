<html>
<head>
  <title>Linux - expect自动化远程登录脚本</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1808"/>
<h1>Linux - expect自动化远程登录脚本</h1>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><br/><div style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><div style="background-color: rgb(255, 255, 255);"><div style="line-height: 1.5;"><div style="word-break: break-word;"><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;"><strong>简单模式：</strong></p><div style="border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0); background-color: rgb(245, 245, 245); font-family: 'Courier New'; font-size: 12px;"><div style="margin-top:5px;background-color:rgb(245, 245, 245);"><span style="padding-right:5px;line-height:1.5;font-family:'Courier New';font-size:12px;"><a style="color:navy;text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Linux - expect自动化远程登录脚本_files/copycode.gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="border:none;background-color:rgb(245, 245, 245);cursor: default;" width="20"/></a></span></div><pre style="margin-top:0px;margin-bottom:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New';font-size:12px;">
#!/usr/bin/expect -<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">f   
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> timeout <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">5</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">   
spawn ssh root@</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">192.168</span>.<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">0.1</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
expect </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*assword*</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">   
send </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">root\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">   
expect </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">#</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">   
send </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">ifconfig \r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">   
expect eof</span></pre><div style="margin-top:5px;background-color:rgb(245, 245, 245);"><span style="padding-right:5px;line-height:1.5;font-family:'Courier New';font-size:12px;"><a style="color:navy;text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Linux - expect自动化远程登录脚本_files/copycode [1].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="border:none;background-color:rgb(245, 245, 245);cursor: default;" width="20"/></a></span></div></div><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;">讲解：</p><pre style="font-size: 13px; margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word;"><code>send：用于向进程发送字符串
expect：从进程接收字符串 比如：expect &quot;*assword*&quot;<br/><img src="Linux - expect自动化远程登录脚本_files/091451586839172.jpg" type="image/jpeg" data-filename="091451586839172.jpg" height="43" style="border:0px;cursor: default;" width="322"/>
spawn：启动新的进程
interact：允许用户交互<br/></code><br/><strong>怎么使用变量：</strong></pre><div style="border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0); background-color: rgb(245, 245, 245); font-family: 'Courier New'; font-size: 12px;"><div style="margin-top:5px;background-color:rgb(245, 245, 245);"><span style="padding-right:5px;line-height:1.5;font-family:'Courier New';font-size:12px;"><a style="color:navy;text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Linux - expect自动化远程登录脚本_files/copycode [2].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="border:none;background-color:rgb(245, 245, 245);cursor: default;" width="20"/></a></span></div><pre style="margin-top:0px;margin-bottom:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New';font-size:12px;">
#!/usr/bin/expect -<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">f
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> port <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">22</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> user root
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> host <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">192.168</span>.<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">0.12</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> password root
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> timeout -<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">1</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
spawn ssh </span>-D $port $user@$host <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">ifconfig</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
expect {  
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*yes/no</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span> { send <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">yes\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">; exp_continue}  
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*assword:</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span> { send <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">$password\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> }  
}  
expect </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*#*</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">  
send </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">ifconfig &gt; /home/cfg \r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
send </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">exit\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
}</span></pre><div style="margin-top:5px;background-color:rgb(245, 245, 245);"><span style="padding-right:5px;line-height:1.5;font-family:'Courier New';font-size:12px;"><a style="color:navy;text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Linux - expect自动化远程登录脚本_files/copycode [3].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="border:none;background-color:rgb(245, 245, 245);cursor: default;" width="20"/></a></span></div></div><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;">讲解：</p><pre style="font-size: 13px; margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="line-height:1.5;">expect {  
&quot;*yes/no&quot; { send &quot;yes\r&quot;<span style="line-height:1.5;">; exp_continue}  
&quot;*assword:&quot; { send &quot;$password\r&quot;<span style="line-height:1.5;"> }  
}  </span></span></span><br/>选择模式，exp_continue表示继续。<br/><br/><strong>通过读取配置文件获取变量：</strong><br/>配置文件
</pre><div style="border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0); background-color: rgb(245, 245, 245); font-family: 'Courier New'; font-size: 12px;"><pre style="margin-top:0px;margin-bottom:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New';font-size:12px;"><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">192.168</span>.<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">0.1</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> root
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">192.168</span>.<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">0.2</span> root
</pre></div><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;">   自动化登录脚本</p><div style="border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0); background-color: rgb(245, 245, 245); font-family: 'Courier New'; font-size: 12px;"><div style="margin-top:5px;background-color:rgb(245, 245, 245);"><span style="padding-right:5px;line-height:1.5;font-family:'Courier New';font-size:12px;"><a style="color:navy;text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Linux - expect自动化远程登录脚本_files/copycode [4].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="border:none;background-color:rgb(245, 245, 245);cursor: default;" width="20"/></a></span></div><pre style="margin-top:0px;margin-bottom:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New';font-size:12px;">
#!/usr/bin/expect -<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">f
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> f [open ./<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">ip r]  
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">while</span> { [gets $f line ]&gt;=<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">0</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> } {       
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> ip [lindex $line <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">0</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">]     
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> pwd [lindex $line <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">1</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">]
spawn ssh $ip
expect  </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*password:</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span> { send <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">$pwd\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> }
expect </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">#</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
send </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">ifconfig \r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
send </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">exit\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
interact
}</span></pre><div style="margin-top:5px;background-color:rgb(245, 245, 245);"><span style="padding-right:5px;line-height:1.5;font-family:'Courier New';font-size:12px;"><a style="color:navy;text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Linux - expect自动化远程登录脚本_files/copycode [5].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="border:none;background-color:rgb(245, 245, 245);cursor: default;" width="20"/></a></span></div></div><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;">讲解：</p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;"><span style="line-height:1.5;color:#ff0000;"><strong>可以多台服务器循环执行，是个非常使用的方式！</strong></span></p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;"><strong>自动化远程拷贝文件：</strong></p><div style="border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0); background-color: rgb(245, 245, 245); font-family: 'Courier New'; font-size: 12px;"><div style="margin-top:5px;background-color:rgb(245, 245, 245);"><span style="padding-right:5px;line-height:1.5;font-family:'Courier New';font-size:12px;"><a style="color:navy;text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Linux - expect自动化远程登录脚本_files/copycode [6].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="border:none;background-color:rgb(245, 245, 245);cursor: default;" width="20"/></a></span></div><pre style="margin-top:0px;margin-bottom:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New';font-size:12px;">
#!/usr/bin/expect -<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">f
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> port <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">22</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> user root
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> host <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">192.168</span>.<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">28.30</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> password root
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> timeout -<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">1</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
spawn scp $host:</span>/home/cfg ./<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
expect {
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*yes/no</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span> { send <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">yes\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">; exp_continue}
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*assword:</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span> { send <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">$password\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> }
}
expect eof</span></pre><div style="margin-top:5px;background-color:rgb(245, 245, 245);"><span style="padding-right:5px;line-height:1.5;font-family:'Courier New';font-size:12px;"><a style="color:navy;text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Linux - expect自动化远程登录脚本_files/copycode [7].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="border:none;background-color:rgb(245, 245, 245);cursor: default;" width="20"/></a></span></div></div><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;">讲解：</p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;">原理和ssh一样</p><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;"><strong>远程执行命令后写入文件，再通过scp到本机服务器：</strong></p><div style="border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; color: rgb(0, 0, 0); background-color: rgb(245, 245, 245); font-family: 'Courier New'; font-size: 12px;"><div style="margin-top:5px;background-color:rgb(245, 245, 245);"><span style="padding-right:5px;line-height:1.5;font-family:'Courier New';font-size:12px;"><a style="color:navy;text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Linux - expect自动化远程登录脚本_files/copycode [8].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="border:none;background-color:rgb(245, 245, 245);cursor: default;" width="20"/></a></span></div><pre style="margin-top:0px;margin-bottom:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New';font-size:12px;">
#!/usr/bin/expect -<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">f

</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> port <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">22</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> user root
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> host <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">192.168</span>.<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">28.30</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> password root
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#0000ff;">set</span> timeout -<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800080;">1</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
spawn ssh </span>-D $port $user@$host <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">ifconfig</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
expect {
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*yes/no</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span> { send <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">yes\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">; exp_continue}
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*assword:</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span> { send <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">$password\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> }
}
expect </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*#*</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
send </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">ifconfig &gt; /home/cfg \r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
send </span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">exit\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
interact
spawn scp $host:</span>/home/cfg ./<span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">
expect {
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*yes/no</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span> { send <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">yes\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;">; exp_continue}
</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">*assword:</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span> { send <span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">$password\r</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#800000;">&quot;</span><span style="line-height:1.5;font-family:'Courier New';font-size:12px;color:#000000;"> }
}
expect eof</span></pre><div style="margin-top:5px;background-color:rgb(245, 245, 245);"><span style="padding-right:5px;line-height:1.5;font-family:'Courier New';font-size:12px;"><a style="color:navy;text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Linux - expect自动化远程登录脚本_files/copycode [9].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="border:none;background-color:rgb(245, 245, 245);cursor: default;" width="20"/></a></span></div></div><p style="font-size: 13px; line-height: 1.5; margin: 10px auto; text-indent: 0px;">讲解：<a href="http://www.cnblogs.com/Javame/p/4272440.html" style="line-height: 200%; text-decoration: none; color: rgb(0, 0, 0);"><font size="3">自动化运维，远程交互从服务器A上ssh到服务器B上，然后执行服务器B上的命令。</font></a></p></div></div></div></div><br/></span>
</div></body></html> 