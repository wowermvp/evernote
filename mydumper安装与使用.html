<html>
<head>
  <title>mydumper安装与使用</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="602"/>
<h1>mydumper安装与使用</h1>

<div>
<span><div><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Mydumper是一个针对MySQL和Drizzle的高性能多线程备份和恢复工具。开发人员主要来自MySQL,Facebook,SkySQL公司。目前已经在一些线上使用了Mydumper。</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Mydumper主要特性：</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">1.轻量级C语言写的</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">2.执行速度比mysqldump快10倍</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">3.事务性和非事务性表一致的快照(适用于0.2.2以上版本)</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">4.快速的文件压缩</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">5.支持导出binlog</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">6.多线程恢复(适用于0.2.1以上版本)</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">7.以守护进程的工作方式，定时快照和连续二进制日志(适用于0.5.0以上版本)</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">8.开源 (GNU GPLv3)</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Mydumper安装使用</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">wget <a href="http://launchpad.net/mydumper/0.5/0.5.1/+download/mydumper-0.5.1.tar.gz" style="padding: 0px; margin: 0px; color: rgb(92, 101, 13); text-decoration: none;">http://launchpad.net/mydumper/0.5/0.5.1/+download/mydumper-0.5.1.tar.gz</a></p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">yum install glib2-devel.x86_64 zlib-devel.x86_64 pcre-devel.x86_64 cmake gcc gcc-c++<br style="padding: 0px; margin: 0px;"/>
#tar zxvf mydumper-0.5.1.tar.gz <br style="padding: 0px; margin: 0px;"/>
#cd mydumper-0.5.1<br style="padding: 0px; margin: 0px;"/>
# /usr/bin/cmake .<br style="padding: 0px; margin: 0px;"/>
#make &amp;&amp; make install<br style="padding: 0px; margin: 0px;"/>
安装完成：<br style="padding: 0px; margin: 0px;"/>
Install the project...<br style="padding: 0px; margin: 0px;"/>
-- Install configuration: &quot;&quot;<br style="padding: 0px; margin: 0px;"/>
-- Installing: /usr/local/bin/mydumper<br style="padding: 0px; margin: 0px;"/>
-- Removed runtime path from &quot;/usr/local/bin/mydumper&quot;<br style="padding: 0px; margin: 0px;"/>
-- Installing: /usr/local/bin/myloader<br style="padding: 0px; margin: 0px;"/>
-- Removed runtime path from &quot;/usr/local/bin/myloader&quot;</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">安装过程如果提示出错:<br style="padding: 0px; margin: 0px;"/>
-- The CXX compiler identification is unknown<br style="padding: 0px; margin: 0px;"/>
CMake Error: your CXX compiler: &quot;CMAKE_CXX_COMPILER-NOTFOUND&quot; was not found.   Please set CMAKE_CXX_COMPILER to a valid compiler path or name.<br style="padding: 0px; margin: 0px;"/>
WARNINGUnable to find Sphinx documentation generator<br style="padding: 0px; margin: 0px;"/>
WARNINGMissing python-sphinx documentation tools, docs will not be built<br style="padding: 0px; margin: 0px;"/>
没有安装gcc gcc-c++<br style="padding: 0px; margin: 0px;"/>
yum install gcc gcc-c++</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="padding: 0px; margin: 0px;"/>
mydumper -h 192.168.1.11 -uuser1 -p123456 -B testdb -o /data/mysqltest <br style="padding: 0px; margin: 0px;"/>
提示option parsing failed: Error parsing option -s, try --help<br style="padding: 0px; margin: 0px;"/>
不持用户名/密码选项与值连起来写格式</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">参数说明:<br style="padding: 0px; margin: 0px;"/>
mydumper参数介绍：<br style="padding: 0px; margin: 0px;"/>
-B, –database 需要备份的库<br style="padding: 0px; margin: 0px;"/>
-T, –tables-list 需要备份的表，用，分隔<br style="padding: 0px; margin: 0px;"/>
-o, –outputdir 输出目录<br style="padding: 0px; margin: 0px;"/>
-s, –statement-size Attempted size of INSERT statement in bytes, default 1000000<br style="padding: 0px; margin: 0px;"/>
-r, –rows 试图分裂成很多行块表<br style="padding: 0px; margin: 0px;"/>
-c, –compress 压缩输出文件<br style="padding: 0px; margin: 0px;"/>
-e, –build-empty-files 即使表没有数据，还是产生一个空文件<br style="padding: 0px; margin: 0px;"/>
-x, –regex 支持正则表达式<br style="padding: 0px; margin: 0px;"/>
-i, –ignore-engines 忽略的存储引擎，用，分隔<br style="padding: 0px; margin: 0px;"/>
-m, –no-schemas 不导出表结构<br style="padding: 0px; margin: 0px;"/>
-k, –no-locks 不执行临时共享读锁 警告：这将导致不一致的备份<br style="padding: 0px; margin: 0px;"/>
-l, –long-query-guard 长查询，默认60s<br style="padding: 0px; margin: 0px;"/>
–kill-long-queries kill掉长时间执行的查询(instead of aborting)<br style="padding: 0px; margin: 0px;"/>
-b, –binlogs 导出binlog<br style="padding: 0px; margin: 0px;"/>
-D, –daemon 启用守护进程模式<br style="padding: 0px; margin: 0px;"/>
-I, –snapshot-interval dump快照间隔时间，默认60s，需要在daemon模式下<br style="padding: 0px; margin: 0px;"/>
-L, –logfile 日志文件<br style="padding: 0px; margin: 0px;"/>
-h, –host<br style="padding: 0px; margin: 0px;"/>
-u, –user<br style="padding: 0px; margin: 0px;"/>
-p, –password<br style="padding: 0px; margin: 0px;"/>
-P, –port<br style="padding: 0px; margin: 0px;"/>
-S, –socket<br style="padding: 0px; margin: 0px;"/>
-t, –threads 使用的线程数，默认4<br style="padding: 0px; margin: 0px;"/>
-C, –compress-protocol 在mysql连接上使用压缩<br style="padding: 0px; margin: 0px;"/>
-V, –version<br style="padding: 0px; margin: 0px;"/>
-v, –verbose 更多输出, 0 = silent, 1 = errors, 2 = warnings, 3 = info, default 2</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">myloader参数介绍：<br style="padding: 0px; margin: 0px;"/>
-d, –directory 导入备份目录<br style="padding: 0px; margin: 0px;"/>
-q, –queries-per-transaction 每次执行的查询数量, 默认1000<br style="padding: 0px; margin: 0px;"/>
-o, –overwrite-tables 如果表存在删除表<br style="padding: 0px; margin: 0px;"/>
-B, –database 需要还原的库<br style="padding: 0px; margin: 0px;"/>
-e, –enable-binlog 启用二进制恢复数据<br style="padding: 0px; margin: 0px;"/>
-h, –host<br style="padding: 0px; margin: 0px;"/>
-u, –user<br style="padding: 0px; margin: 0px;"/>
-p, –password<br style="padding: 0px; margin: 0px;"/>
-P, –port<br style="padding: 0px; margin: 0px;"/>
-S, –socket<br style="padding: 0px; margin: 0px;"/>
-t, –threads 使用的线程数量，默认4<br style="padding: 0px; margin: 0px;"/>
-C, –compress-protocol 连接上使用压缩<br style="padding: 0px; margin: 0px;"/>
-V, –version<br style="padding: 0px; margin: 0px;"/>
-v, –verbose 更多输出, 0 = silent, 1 = errors, 2 = warnings, 3 = info, default 2</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br style="padding: 0px; margin: 0px;"/>
mydumper输出文件：</p><div style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(85, 85, 85);"><span style="font-size: 14px;">metadata:元数据 记录备份开始和结束时间，以及binlog日志文件位置。<br style="padding: 0px; margin: 0px;"/>
table data:每个表一个文件<br style="padding: 0px; margin: 0px;"/>
table schemas:表结构文件<br style="padding: 0px; margin: 0px;"/>
binary logs: 启用–binlogs选项后，二进制文件存放在binlog_snapshot目录下<br style="padding: 0px; margin: 0px;"/>
daemon mode:</span></span><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 14px;">在这个模式下，有五个目录0，1，binlogs，binlog_snapshot，last_dump。备份目录是0和1，间隔备份，如果mydumper因某种原因失败而仍然有一个好的快照，当快照完成后，last_dump指向该备份。</span></span></div><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 14px;"><br/></span></span></div><div><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">实例：<br style="padding: 0px; margin: 0px;"/><span style="color: rgb(255, 0, 0);"># mydumper -h 192.168.1.11 -u user1 -p 123456 -B testdb -o /tmp/test0620</span></p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 0, 0);"># myloader -h 192.168.1.11 -u user1 -p 123456 -d /tmp/test0620 -o -B testdb</span></p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">默认开启4个线程，如果提示：<br style="padding: 0px; margin: 0px;"/>
** (myloader:22583): CRITICAL **: the specified directory is not a mydumper backup<br style="padding: 0px; margin: 0px;"/>
导出的目录必须唯一指定不可移动复制到其它地方，否则不认</p><p style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </p><div style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; color: rgb(85, 85, 85); font-family: 宋体, 'Arial Narrow', arial, serif; font-size: 14px; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>已经线上使用，用mydumper来替代mysqldumper备份方式，经过校验测试（目录级恢复与mysqldumper恢复)的结果完全一致。</div></div><div style="padding: 0px; margin: 0px; clear: both; height: auto; overflow: hidden; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div><span style="color: rgb(85, 85, 85);"><span style="font-size: 14px;">mydumper开启多线程导入导出速度相比m</span></span><span style="color: rgb(85, 85, 85); font-family: 宋体, &quot;Arial Narrow&quot;, arial, serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;">ysqldumper提升近十倍，但如果系统资源有限，线程数不可开启太多，否则不但带来不了速度提升，反而会更慢.</span></div></div></div></div></div></span>
</div></body></html> 