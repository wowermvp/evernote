<html>
<head>
  <title>mysql数据库</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1358"/>
<h1>mysql数据库</h1>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><font color="#DE5700">一、数据库简介</font></div><div>     数据库，指的是以一定的方式储存在一起、能为多个用户共享、具有尽可能小的冗余度的特点、是与应用程序彼此独立的数据的集合。</div><div> 1、数据库的组成部分：</div><div>     （1）数据库：存储数据</div><div>     （2）数据库管理系统：用户管理数据库的程序、维护数据库的安全、完整、可靠性</div><div>     （3）数据库应用程序：满足用户对数据管理的更高要求，或者使过程更加直观友好</div><div>2、数据库语言：</div><div>     （1）数据定义语言（DDL）：用于定义和管理数据对象，包括数据库、数据表等。例如：create、drop、alter等。</div><div>     （2）数据操作语言（DML）：用于操作数据库对象中包含的数据。例如：insert、update、delete语句。</div><div>     （3）数据查询语言（DQL）：用于查询数据库对象中所包含的数据，能够进行单表查询、连接查询、嵌套查询，以及集合查询等各种复杂程度不同的数据库查询，并将数据返回客户机中显示。例如：select</div><div>     （4）数据控制语言（DCL）：是用来管理数据库的语言，包括管理权限及数据更改。例如：grant、revoke、commit、rollback等。</div><div><font color="#DE5700">二、SQL语句</font></div><div>mysqladmin -u root password '123'                          <em><font color="#328712">#设置密码</font></em></div><div>mysql -u root -p -h localhost                                    <em><font color="#328712">#本地登录数据库</font></em></div><div>show databases;                                                        <em><font color="#328712">#查看数据库</font></em></div><div>show tables;                                                              <em><font color="#328712">#查看数据表</font></em></div><div>use 库名;                                                                   <em><font color="#328712">#切换数据库</font></em></div><div>describe 表名;                                                            <em><font color="#328712">#查看表结构</font></em></div><div><font color="#DE5700">增：</font></div><div>create database 库名;                                                <em><font color="#328712">#创建数据库</font></em></div><div>create table 表名 (字段1 值，字段2 值......);                  <em><font color="#328712">#创建数据表</font></em></div><div>insert into 表名 (字段1，字段2.......) values (数据1，数据2......);     <em><font color="#328712">#插入数据</font></em></div><div>create user 用户名@登录地址 identified by '密码'        <em><font color="#328712">#创建用户</font></em></div><div><font color="#DE5700">删：</font></div><div>drop database 库名;                                                 <em> <font color="#328712">#删除数据库</font></em></div><div>drop table 表名;                                                        <em><font color="#328712">#删除数据表</font></em></div><div>delete from 表名;                                                      <em><font color="#328712">#删除表中所有数据</font></em></div><div>delete from 表名 where 字段;                                    <em><font color="#328712">#删除表中某条记录</font></em></div><div><font color="#DE5700">改：</font></div><div>update 表名 set 字段1 where 字段2;                          <em><font color="#328712">#修改字段1的数据</font></em></div><div>update 表名 set 字段1 where 字段2 between num1 and num2;     <em><font color="#328712">#修改从num1到num2之间字段的值</font></em></div><div>grant 权限 on 数据库.数据表 to '用户'@'地址';             <em><font color="#328712">#修改权限</font></em></div><div>例：grant all on *.* to 'root'@'%' identified by '123456';   <i><font color="#328712">#*.*表示所有库，所有表；%表示允许所有连接；连接的账号为：root:123456</font></i></div><div>revoke 权限1，权限2 on 数据库.数据表 from '用户'@'地址';             <em><font color="#328712">#取消权限</font></em></div><div>set password=password（&quot;密码&quot;）                           <em><font color="#328712">#修改管理员密码或者普通用户修改自身密码</font></em></div><div>set password for '用户'@'地址'=password（&quot;密码&quot;）     <em><font color="#328712">#修改普通用户密码</font></em></div><div><font color="#DE5700">查：</font></div><div>select 字段 from 表名;                                                <em><font color="#328712">#查看表内数据</font></em></div><div><font color="#DE5700">备份：</font></div><div>mysqldump -u root -p --databases 数据库 &gt; 1.sql      <em><font color="#328712">#备份数据库到1.sql</font></em></div><div>mysql -u root -p &lt; 1.sql                                             <em><font color="#328712">#还原1.sql</font></em></div><div>mysqldump -u root  -p 数据库 数据表 &gt; 2.sql             <em><font color="#328712">#备份数据库中的某表到2.sql</font></em></div><div>mysql -u root -p &lt; 2.sql                                             <em><font color="#328712">#还原数据表</font></em></div><div>mysqldump -u root -p --databases 数据库1 数据库2 &gt; 3.sql     <em><font color="#328712">#备份多个数据库</font></em></div><div>mysql -u root -p &lt; 3.sql                                             <em><font color="#328712">#还原所有数据库</font></em></div><div>mysql -u root -p --all-databases &gt; 4.sql                     <em><font color="#328712">#备份所有数据库</font></em></div><div><font color="#DE5700">alter：</font></div><div>alter table 旧表名 rename 新表名;                                      <em><font color="#328712">#更改表名</font></em></div><div>例：alter table person rename ps;</div><div><em><font color="#328712">#将表person更名为ps</font></em></div><div>alter table 表名 modify 字段 字段类型;                                <em><font color="#328712">#更改字段类型</font></em></div><div>例：alter table ps modify name char(20);</div><div><em><font color="#328712">#修改表ps内的name字段的类型</font></em></div><div>alter table 表名 change 字段名 新字段名 字段类型;              <em><font color="#328712">#更改字段名(可同时修改字段类型)</font></em></div><div>例：alter table ps change info information char(50);</div><div><em><font color="#328712">#将表ps中的字段info的字段名更改为information</font></em></div><div>alter table 表名 add 新字段名 新字段类型 first;                    <em><font color="#328712">#添加新字段同时将该字段设置为第一列</font></em></div><div>例：alter table ps add nian year first;</div><div><em><font color="#328712">#向表ps中添加字段nian并设置为第一列</font></em></div><div>alter table 表名 add 新字段名 新字段类型 after 旧字段名;     <font color="#328712"><em>#添加新字段到某字段后</em></font></div><div>例：alter table ps add sex char(1) after id;</div><div><em><font color="#328712">#向表ps添加字段sex并放置于id字段的后面</font></em></div><div>alter talbe 表名 drop 字段;                                                 <em> <font color="#328712">#删除字段</font></em></div><div>例：alter table ps drop nian;</div><div><em><font color="#41AD1C">#删除表ps中的字段nian</font></em></div><div>alter table 表名 modify 旧字段 字段类型 after 旧字段;          <em><font color="#41AD1C">#调整字段位置（同时修改字段类型）</font></em></div><div>例：alter talbe ps modify age int(11) not null after sex;</div><div><em><font color="#41AD1C">#将表ps内的字段age调整至字段sex后面</font></em></div><div><br/></div><div><font color="#E30000">mysql -u 用户 -p -h 主机 -P 端口</font></div><div><font color="#E30000">grant 权限 on 数据库.数据表 to 用户@地址列表 identified by '密码';</font></div><div>地址列表可用%代表所有可用 不可用*</div><div><br/></div><div><font color="#DE5700">三、mysql日志管理</font></div><div><font color="#DE5700">1、种类：</font></div><div>     错误日志：</div><div>服务器启动和关闭过程中的信息</div><div>服务器运行过程中的错误信息</div><div>事务调度器运行一个时间时产生的信息</div><div>从服务器上启动从服务器进程时产生的信息</div><div><br/></div><div>     查询日志：一般查询日志</div><div>     慢查询日志：</div><div>     二进制日志：</div><div>     中继日志：主从同步，将主服务器上的二进制文件复制到本地某些日志中</div><div>     事务日志：记录innodb等支持事务的存储引擎执行事务时产生的日志</div><div>show global variables like '%log%'          #查看所有的日志变量</div><div><br/></div><div><font color="#DE5700">2、安装日志监视软件loganalyzer</font></div><div><font color="#DE5700">     1）Loganalyzer简介</font></div><div>      Loganalyzer是一款syslog日志和其他网络事件数据的web前端。它提供了对日志的简单浏览、搜索、基本分析和一些图表报告功能。数据可以从数据库或一般的syslog文本文件中获取，所以Loganalyzer不需要改变现有的记录架构。基于当前日志数据，它可以处理syslog日志消息，Windows事件日志记录，支持故障排除，使用户能够快速查找日志数据中看出问题的解决方案。</div><div>     Loganalyzer获取客户端日志会有两种保存模式，一种是直接读取客户端/var/log/目录下的日志并保存到服务端该目录下，一种是读取后保存到日志服务器数据库中，推荐使用后者。</div><div>     Loganalyzer采用php开发，所以日志服务器需要php的运行环境，本实验采用LAMP。</div><div>     <font color="#DE5700">2）系统环境</font></div><div>Rsyslog Server OS： CentOS 6.5</div><div>Rsyslog Server IP： 192.168.1.107</div><div>Rsyslog 版本： rsyslog-5.8.10-8.el6.i686</div><div>LogAnalyzer 版本： LogAnalyzer 3.6.5 (v3-stable)</div><div>LAMP 版本： httpd-2.2.15-30.el6.centos.i686 + mysql-5.1.73-3.el6_5.i686 + php-5.3.3-27.el6_5.i686</div><div>防火墙关闭/iptables：Firewall is not running</div><div>SELINUX=disabled</div><div>Rsyslog Client OS： RHEL 6.4</div><div>Rsyslog Client IP： 192.168.1.108</div><div><font color="#DE5700">     3）安装并设置LAMP环境</font></div><div><font color="#DE5700">3.1、安装LAMP环境</font></div><div># yum -y install http mysql* php*</div><div><font color="#DE5700">3.2、启动服务并加入开机启动</font></div><div>启动Apache</div><div># /etc/init.d/httpd start</div><div># chkconfig httpd on</div><div>启动数据库</div><div># /etc/init.d/mysqld start</div><div># chkconfig mysqld on</div><div><font color="#DE5700">3.3、设置MySQL root密码</font></div><div># mysqladmin -uroot password '123456'</div><div><font color="#DE5700">3.4、测试php运行环境</font></div><div># cd /var/www/html</div><div># vim index.php</div><div>&lt;?php</div><div>     phpinfo();</div><div>?&gt;</div><div>打开浏览器测试该php首页是否正确显示</div><div>     <font color="#DE5700">4）安装服务端软件</font></div><div><font color="#DE5700">4.1、检查是否安装了rsyslog软件</font></div><div># rpm -q rsyslog          <font color="#328712">#默认已经安装</font></div><div><font color="#DE5700">4.2、安装rsyslog连接MySQL数据库的模块</font></div><div># <font color="#E30000">yum -y install rsyslog-mysql</font></div><div>rsyslog-mysql为rsyslog将日志传送到MySQL数据库的一个模块，这里必须安装</div><div>    <font color="#DE5700"> 5）配置服务器端</font></div><div><font color="#DE5700">5.1、导入rsyslog-mysql数据库文件</font></div><div># cd /usr/share/doc/rsyslog-mysql-5.8.10/</div><div># mysql -uroot -p &lt; createDB.sql</div><div>查看数据库</div><div># mysql -uroot -p</div><div>mysql&gt;show databases;</div><div>mysql&gt;show tables;</div><div>导入数据库Syslog库并在该库中创建了两张空表SystemEvents和SystemEventsProperties。</div><div><font color="#DE5700">5.2、创建rsyslog用户在mysql下相关权限</font></div><div># mysql -uroot -p</div><div>mysql&gt;grant all on Syslog.* to rsyslog@localhost identified by '123456';</div><div>mysql&gt;flush privileges;</div><div>mysql&gt;exit</div><div><font color="#DE5700">5.3、配置服务端支持rsyslog-mysql模块，并开启UDP服务端口获取网内其他LINUX系统日志</font></div><div># vim /etc/rsyslog.conf</div><div>$ModLoad ommysql</div><div>*.* :ommysql:localhost,Syslog,rsyslog,123456</div><div>在####MODULES####下添加上面两行</div><div>说明：localhost表示本地主机，Syslog为数据库名，rsyslog为数据库的用户，123456为该用户密码。</div><div><font color="#DE5700">5.4、开启相关日志模块</font></div><div># vim /etc/rsyslog.conf</div><div>$ModLoad immark               <font color="#328712">#immark是模块名，支持日志标记</font></div><div>$ModLoad imudp                 <font color="#328712">#imudp是模块名，支持udp协议</font></div><div>$UDPServerRun 514             <font color="#328712">#允许514端口使用UDP协议转发过来的日志</font></div><div><font color="#DE5700">5.5、重启rsyslog服务</font></div><div># /etc/init.d/rsyslog restart</div><div>     <font color="#DE5700">6）配置客户端</font></div><div><font color="#DE5700">6.1、检查rsyslog是否安装</font></div><div># rpm -q rsyslog</div><div><font color="#DE5700">6.2、配置rsyslog客户端发送本地日志到服务端</font></div><div># vim /etc/rsyslog.conf</div><div>*.* @192.168.1.107                   <font color="#328712"> #将所有数据发送至服务端（192.168.1.107为服务端IP）</font></div><div>行尾增加上面这行内容，即客户端将本地日志发送到服务器。</div><div><font color="#DE5700">6.3、重启rsyslog服务</font></div><div># /etc/init.d/rsyslog restart</div><div><font color="#DE5700">6.4、编辑/etc/bashrc，将客户端的所有命令写入系统日志/var/log/messages中</font></div><div># vim /etc/bashrc</div><div>在文件尾部增加如下行</div><div>export PROMPT_COMMAND='{ msg=$(histtory 1 | { read x y; echo $y; });</div><div>logger &quot;[euid=$(whoami)]&quot;:$(who am i):[$(pwd)&quot;$msg&quot;;]}'</div><div>设置其生效</div><div># source /etc/bashrc</div><div>客户端配置完毕</div><div>     <font color="#DE5700">7）测试Rsyslog Server是否可以正常接受client端日志</font></div><div>Clinet端测试：</div><div><img src="mysql数据库_files/Image.png" type="image/png" data-filename="Image.png" height="183" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="895"/></div><div>Server端侦测：</div><div><img src="mysql数据库_files/Image [1].png" type="image/png" data-filename="Image.png" height="155" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="900"/></div><div>说明接收正常，包括重启机器的一些log都可以查看到。</div><div>     8）安装LogAnalyzer</div><div># tar -zxf loganalyzer-3.6.5.tar.gz</div><div># cd loganalyzer-3.6.5</div><div># mkdir -p /var/www/html/loganalyzer</div><div># rsync -a /usr/src/loganalyzer-3.6.5/src/* /var/www/html/loganalyzer/</div><div>     9）在浏览器中安装向导中安装LogAnalyzer</div><div>9.1 打开浏览器访问： http://192.168.1.107/loganalyzer/</div><div><br/></div><div><img src="mysql数据库_files/Image [2].png" type="image/png" data-filename="Image.png" height="428" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="824"/></div><div>提示没有配置文件，点击here利用向导生成</div><div>9.2、第一步，测试系统环境</div><div><img src="mysql数据库_files/Image [3].png" type="image/png" data-filename="Image.png" height="586" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="824"/></div><div>点击&quot;Next&quot;，进入第二步</div><div><img src="mysql数据库_files/Image [4].png" type="image/png" data-filename="Image.png" height="671" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="824"/></div><div>提示错误：缺少config.php文件，并且权限要设置为666，可以使用contrib目录下的configure.sh脚本生成。</div><div>查看configure.sh文件内容</div><div><img src="mysql数据库_files/Image [5].png" type="image/png" data-filename="Image.png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div>需要在/var/www/html/loganalyzer/下创建config.php文件，并设置其权限为666。</div><div># touch /var/www/html/loganalyzer/config.php</div><div># chmod 666 /var/www/html/loganalyzer/config.php</div><div>做完上面的操作之后，执行ReCheck操作，config.php文件可写，点击Next进入下一步</div><div><img src="mysql数据库_files/Image [6].png" type="image/png" data-filename="Image.png" height="593" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="824"/></div><div>9.3、 第三步，基础配置</div><div><img src="mysql数据库_files/Image [7].png" type="image/png" data-filename="Image.png" height="760" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="824"/></div><div>在 User Database Options 中，填入上面设置的参数，然后点击 Next.</div><div>9.4 第四步，创建表</div><div><img src="mysql数据库_files/Image [8].png" type="image/png" data-filename="Image.png" height="606" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="824"/></div><div>点击 Next 开始创建表。</div><div>9.5、 第五步，检查 SQL 结果</div><div><img src="mysql数据库_files/Image [9].png" type="image/png" data-filename="Image.png" height="606" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="824"/></div><div>9.6 、第六步，创建管理用户</div><div><img src="mysql数据库_files/Image [10].png" type="image/png" data-filename="Image.png" height="606" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="824"/></div><div>9.7 、第七步，创建第一个系统日志 source</div><div><img src="mysql数据库_files/Image [11].png" type="image/png" data-filename="Image.png" height="760" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="824"/></div><div>9.8、第八步，完成</div><div><img src="mysql数据库_files/Image [12].png" type="image/png" data-filename="Image.png" height="553" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="824"/></div><div><font color="#DE5700">10、测试</font></div><div>LogAnalyzer 首页</div><div><img src="mysql数据库_files/Image [13].png" type="image/png" data-filename="Image.png" height="540" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="900"/></div><div><br/></div></span>
</div></body></html> 