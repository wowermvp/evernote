<html>
<head>
  <title>用户和用户组管理</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1840"/>
<h1>用户和用户组管理</h1>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
用户配置文件-用户信息文件
<div>     /etc/passwd</div><div><img src="用户和用户组管理_files/Image.png" type="image/png" data-filename="Image.png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div>          第1字段：用户名称</div><div>          第2字段：密码标志</div><div>          第3字段：UID（用户ID）</div><div>                         0                    超级用户</div><div>                         1-499            系统用户（伪用户）</div><div>                         500-65535    普通用户</div><div>          第4字段：GID（用户初始组ID）</div><div>          第5字段：用户说明</div><div>          第6字段：家目录</div><div>                         普通用户：/home/用户名/</div><div>                         超级用户：/root/</div><div>          第7字段：登录之后的shell</div><div>     </div><div>     初始组和附加组</div><div>          初始组：就是指用户一登录就立刻拥有这个用户组的相关权限，每个用户的初始组只能有一个，</div><div>                  一般就是和这个用户的用户名相同的组名作为这个用户的初始组。</div><div>          附加组：指用户可以加入多个其他的用户组，并拥有这些组的权限，附加组可以有多个。</div><div>     </div><div>     shell就是Linux的命令解释器</div><div>     在/etc/passwd当中，除了标准shell是/bin/bash之外，还可以写如/sbin/nologin</div><div><br/></div><div>用户配置文件-影子文件</div><div>     /etc/shadow</div><div><img src="用户和用户组管理_files/Image [1].png" type="image/png" data-filename="Image.png" height="43" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="758"/></div><div>          第1字段：用户名</div><div>          第2字段：加密密码</div><div>               加密算法升级为SHA512散列加密算法</div><div>               如果密码位是“!!”或“*”代表没有密码，不能登录</div><div>          第3字段：密码最后一次修改日期</div><div>               使用1970年1月1日作为标准时间，每过一天时间戳加1</div><div>          第4字段：两次密码的修改间隔时间（和第3字段相比）</div><div>          第5字段：密码有效期（和第3字段相比）</div><div>          第6字段：密码修改到期前的警告天数（和第5字段相比）</div><div>          第7字段：密码过期后的宽限天数（和第5字段相比）</div><div>               0：  代表密码过期后立即失效</div><div>               -1:  则代表账号密码永远不失效</div><div>          第8字段：账号失效时间</div><div>               要用时间戳表示（时间戳：是指从1970年1月1日至今天的天数）</div><div>                    时间戳换算成日期：</div><div>                         date -d &quot;1970-01-01 16066&quot; days</div><div>                    把日期换算成时间戳：</div><div>                         echo $(($(date --date=&quot;2014/01/06&quot; +%s)/86400+1))</div><div>          第9字段：保留</div><div><br/></div><div>用户配置文件-组信息文件</div><div>     /etc/group</div><div>          <img src="用户和用户组管理_files/Image [2].png" type="image/png" data-filename="Image.png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div>                 第1字段：组名</div><div>          第2字段：组密码标志</div><div>          第3字段：GID</div><div>          第4字段：组中附加用户</div><div><br/></div><div>用户配置文件-组密码文件</div><div>     /etc/gshadow</div><div>          <img src="用户和用户组管理_files/Image [3].png" type="image/png" data-filename="Image.png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div>          第1字段：组名</div><div>          第2字段：组密码</div><div>          第3字段：组管理员用户名</div><div>          第4字段：组中附加用户</div><div><br/></div><div>用户和用户组管理-用户管理相关文件</div><div>     1、用户家目录</div><div>          普通用户：/home/用户名/，所有者和所属组都是此用户，权限是700.</div><div>          超级用户：/boot/，所有者和所属者都是root用户，权限是500.</div><div>     2、用户的邮箱</div><div>          /var/spool/mail/用户名</div><div>     3、用户模板目录</div><div>          /etc/skel/    用户都据此模板建立</div><div><br/></div><div><hr/></div><div><br/></div><div style="font-size: 15px;">权限管理</div><div><hr/><br/></div><div>     ACL权限</div><div>          ACL权限简介与开启</div><div>               <img src="用户和用户组管理_files/Image [4].png" type="image/png" data-filename="Image.png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div><br/></div><div>               ACL权限主要用来解决文件所属身份不足的问题</div><div><br/></div><div>               查看分区的ACL权限是否开启</div><div>               # dumpe2fs -h /dev/sda3</div><div>                    <i>#dumpe2fs命令是查询指定分区详细文件系统信息的命令</i></div><div>                    -h     仅显示超级块中信息，而不显示磁盘块组的详细信息</div><div>               </div><div>               临时开启分区ACL权限</div><div>                    # mount -o remount,acl /     <i>#重新挂载根分区，并挂载加入acl权限</i></div><div>               永久开启分区acl权限</div><div>                    # vi /etc/fstab</div><div>             UUID=e0e4ad96-855a-434c-8df0-d6c776708779 /                       ext4    defaults,<b><font color="#FF0000">acl</font></b>        1 1</div><div>               <i>#加入acl，现在一般默认就是挂载acl的</i></div><div>                    # mount -o remount /         <i>#重新挂载文件系统或重启动系统，使修改生效</i></div><div><br/></div><div>          查看与设定acl权限</div><div>               getfacl 文件名          <i>#查看acl权限</i></div><div>               </div><div>               setfacl  选项   文件名</div><div>                         -m     设定ACL权限</div><div>                         -x     删除指定的ACL权限</div><div>                         -b     删除所有的ACL权限</div><div>                         -d     设定默认ACL权限</div><div>                         -k     删除默认ACL权限</div><div>                         -R     递归设定ACL权限</div><div>               范例：$ setfacl -m <a href="file:///u:st:rx">u:st:rx</a> /project/    <i>#给用户st赋予r-x权限，使用“u:用户名:权限”</i></div><div><i>                                                        格式</i></div><div>                     $ setfacl -m <a href="file:///g:tgroup:rwx">g:tgroup:rwx</a> /project/   <i>#为组tgroup分配ACL权限，使用</i></div><div><i>                                                            “g:组名:权限”格式</i></div><div>                     $ setfacl -m <a href="file:///m:rx">m:rx</a> 文件名          <i>#设定mask权限为r-x。使用“m:权限”格式</i></div><div>          删除ACL权限</div><div>                     # setfacl -x <a href="file:///u:用户名">u:用户名</a> 文件名     <i>#删除指定用户的ACL权限</i></div><div>                     # setfacl -x <a href="file:///g:组名">g:组名</a> 文件名        <i>#删除指定用户组的ACL权限</i></div><div>                     # setfacl -b 文件名                  <i>#会删除文件的所有的ACL权限</i></div><div>          递归ACL权限</div><div>               递归ACL权限是指父目录在拥有ACL权限的同时，所有的子文件和子目录也会拥有相同的</div><div>               ACL权限。（只针对父目录中现在有文件生效）</div><div>               setfacl -m <a href="file:///u:用户名:权限">u:用户名:权限</a> -R 文件名        <i>#在赋予父目录权限之后，建立的文件是不具有</i><i>ACL权限的</i></div><div>          默认ACL权限</div><div>               默认ACL权限的作用是如果给你目录设定了默认ACL权限，那么父目录中所有新建的子文件都会继</div><div>               承父目录的ACL权限。（只针对新增加的子文件生效）</div><div>               setfacl -m <a href="file:///d:u:用户名:权限">d:u:用户名:权限</a> 文件名</div><div>          最大有效权限mask</div><div>               [root@localhost /]# setfacl -m <a href="file:///m:rx">m:rx</a> project/               <i>#设定mask权限为r-x。使用“m:权限”格式</i></div><div>               [root@localhost /]# getfacl project/</div><div>               # <a>file:</a> project/</div><div>               # owner: root/</div><div>               #group: tgroup</div><div><i>               </i>user: :rwx</div><div><i>               </i>group: :rwx   <i>                                #effective:r-x</i></div><div><i>             </i>  mask: :r-x</div><div><i>               #mask权限变为了r-x                    </i></div><div><i>               </i>other: :---</div><div><br/></div><div>     文件特殊权限</div><div>          SetUID权限</div><div>          SetUID的功能</div><div>               <font color="#FF0000">只有可以执行的二进制程序才能设定SUID权限</font></div><div>               <font color="#FF0000">命令的执行者要对该程序拥有x（可执行）权限</font></div><div>               命令执行者在执行该程序时即获得该程序文件的属主身份（在执行程序过程中灵魂附体为文件</div><div>           的属主）</div><div>               SetUID权限只在该程序执行过程中有效，也就是说身份改变只在程序执行过程中有效</div><div>               </div><div>               passwd命令拥有SetUID权限，所以普通用户可以修改自己的密码</div><div>          （密码文件保存位置：/etc/shadow）</div><div>               cat命令没有SetUID权限，所以普通用户不能查看/etc/shadow文件内容。</div><div><img src="用户和用户组管理_files/Image [5].png" type="image/png" data-filename="Image.png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div>               设定SetUID方法</div><div>                   4代表SetUID</div><div>                         chmod 4755 文件名               <i>#为文件设置SetUID权限，4代表SetUID.</i></div><div><i>                                                         （要删除SetUID权限，只需去掉4即可）</i></div><div>                         chmod u+s  文件名                <i>#功能同上</i></div><div>              危险的SetUID</div><div>                 关键目录应严格控制写权限。比如“/”,&quot;/usr&quot;等</div><div>                 用户的密码设置要严格遵守密码三原则</div><div>                 对系统中默认应该具有SetUID权限的文件作为一列表，定时检查有没有这之外的文件被设置了SetUID权限</div><div><br/></div><div>               SetGID权限</div><div>           SetGID针对文件的作用</div><div>               只有可执行的二进制文件才能设置SetGID权限</div><div>               命令执行者要对该程序拥有x（可执行）权限</div><div>               命令执行者在执行程序的时候，组身份升级为该程序文件的属组</div><div>               SetGID权限同样只在该程序执行过程中有效，也就是说组身份改变只在程序执行过程中有效</div><div>           SetGID针对目录的作用</div><div>               普通用户必须对此目录拥有r和x权限，才能进入此目录</div><div>               普通用户在此目录中的有效组变成此目录的属组</div><div>               普通用户对此目录拥有w权限时，新建的文件默认属组是这个目录的属组</div><div>          设定SetGID</div><div>               2代表SetGID</div><div>                    chmod 2755 文件名          <i>#为文件设置SetGID权限（要删除SetGID权限，去掉2即可）</i></div><div>                    chmod g+s 文件名</div><div><br/></div><div>          Sticky BIT权限</div><div>          SBIT粘着位的作用</div><div>              粘着位目前只对目录有效</div><div>              普通用户对该目录拥有w和x权限，即普通用户可以在此目录拥有写权限</div><div>              如果没有粘着位，因为普通用户拥有w权限，所以可以删除此目录下所有文件，包括其他用户建立的文件。一但赋予了粘着位，除了root可以删除所有文件，普通用户就算拥有w权限也只能删除自己建立的文件，但是不能删除其他用户建立的文件。</div><div><br/></div><div>               设置SBIT权限</div><div>                    chmod 1755 目录名</div><div>                    chmod o+t 目录名</div><div><br/></div><div><br/></div><div>     文件系统属性chattr权限</div><div>          命令名称：chattr</div><div>          命令所在路径：/usr/bin/chattr</div><div>          执行权限：所有用户</div><div>          功能描述：</div><div>          语法：chattr [+ - =选项] 文件或目录名</div><div>                         +：增加权限</div><div>                         -：删除权限</div><div>                         =：等于某权限</div><div>               选项：</div><div>                    i：如果对文件设置i属性，那么不允许对文件进行删除、改名，也不能添加和修改数据</div><div>                如果对目录设置i属性，那么只能修改目录下文件的数据，但不允许建立和删除文件。</div><div>                    a：如果对文件设置a属性，那么只能在文件中增加数据，但是不能删除也不能修改数据</div><div>                如果对目录设置a属性，那么只允许在目录中建立和修改文件，但是不允许删除。</div><div><br/></div><div>          命令名称：lsattr</div><div>          命令所在路径：/usr/bin/lsattr</div><div>          执行权限：所有用户</div><div>          功能描述：</div><div>          语法：lsattr 选项 文件名</div><div>                         -a 显示所有文件和目录</div><div>                         -d 若目标是目录，仅列出目录本身的属性，而不是子文件</div><div><br/></div><div>     </div><div>     sudo权限（给普通用户赋予部分管理员权限）</div><div>          root把本来只能超级用户才能执行的命令赋予普通用户执行</div><div>          sudo的操作对象是系统命令</div><div>          [root@localhost ~]# visudo          <i>#实际修改的是/etc/sudoers文件</i></div><div>               <i>root     ALL=（ALL）     ALL</i></div><div><i>               #用户名     被管理主机地址=（可使用的身份）     授权命令（绝对路径）</i></div><div><i>               #%wheel     ALL=(ALL)     ALL</i></div><div><i>               #%组名 被管理主机地址=（可使用的身份）     授权命令（绝对路径）</i></div><div><i>          </i>用户名/组名：代表root给哪个用户或用户组赋予命令，注意组名前加“%”</div><div>          用户可以用指定的命令管理指定IP地址的服务器。如果写ALL，代表可以管理任何主机，如果写固定IP，代表用户可以管理指定的服务器。（这里的IP指定的是用户可以管理哪个IP地址的服务器。那么你是一台独立的服务器，这里写ALL或你的服务器地址，作用是一样的。而写入网段，只有对NIS服务这样用户和密码集中管理的服务器才有意义）。如果我们这里写的是本机的IP地址，不代表只允许本机的用户使用指定命令，而是代表指定的用户可以从任何IP地址来管理当前服务器。</div><div>          可使用身份：就是把来源用户切换成什么身份使用，（ALL）代表可以切换成任意身份。</div><div>          授权命令：代表root把什么命令授权给普通用户。默认是ALL，代表任何命令，这个当然不行。如果需要给哪个命令授权，写入命名即可，不过需要注意一定要把命令写成绝对路径。</div><div>     举例：</div><div>     1）授权用户lamp可以重启服务器</div><div>          [root@localhost ~]#visudo</div><div>          lamp     ALL=/sbin/shutdown -r now</div><div><br/></div><div><i>     </i>2）授权一个用户管理web服务器</div><div>          首先要分析授权用户管理Apache至少要实现哪些基本制授权</div><div>          a、可以使用Apache管理脚本</div><div>          b、可以修改Apache配置文件</div><div>          c、可以更新网页内容</div><div>          假设Apache管理脚本程序为/etc/rc.d/init.d/httpd。</div><div>          为满足条件一，用visudo进行授权：</div><div>      [root@localhost ~]#visudo</div><div>      lamp     192.168.0.156=/etc/rc.d/init.d/httpd reload,/etc/rc.d/init.d/httpd configtest</div><div>          授权用户lamp可以连接192.168.0.156上的Apache服务器，通过Apache管理脚本重新读取配置文件让更改的设置生效（reload）和可以检测Apache配置文件语法错误（configtest），但不允许其执行关闭（stop）、重启（restart）等操作。</div><div>          为满足条件二，同样使用visudo授权：</div><div>      [root@localhost ~]# visudo</div><div>      lamp     192.168.0.156=/bin/vi  /etc/httpd/conf/httpd.conf</div><div>          授权用户lamp可以用root身份使用vi编辑Apache配置文件。</div><div>          以上两种sudo的设置，要特别注意，很多人使用sudo会犯两个错误：</div><div>               第一、授权命令没有细化到选项和参数；</div><div>               第二、认为只能授权管理员执行的命令。</div><div>          条件三比较简单，假设网页的存放目录为/var/www/html，则只需要授权lamp对此目录具有写权限或者索性更改目录所有者为lamp即可。如果需要，还可以设置lamp可以通过FTP等文件共享服务更新网页。</div><div>     3）授权aa用户可以添加其他普通用户</div><div>     aa     ALL=<font color="#FF0000">/usr/sbin/useradd</font>               <i>#赋予aa添加用户权限，命令必须写入绝对路径</i></div><div>     aa     ALL=/usr/bin/passwd                  <i>#赋予改密码权限，取消对root密码修改</i></div><div>     aa     ALL=/usr/bin/passwd     [A-Za-z]*,     !/usr/bin/passwd &quot; &quot;,     !/usr/bin/passwd root</div><div>          </div><div><i>         </i> 普通用户执行sudo赋予的命令</div><div>          $ sudo -l                         <i>#查看可用的sudo命令</i></div><div>          $ sudo /sbin/shutdown -r now      <i>#普通用户执行sudo赋予的命</i><i>令</i></div><div><span style="font-family: 新宋体;"><i><br/></i></span></div></span>
</div></body></html> 