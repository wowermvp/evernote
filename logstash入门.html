<html>
<head>
  <title>logstash入门</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1551"/>
<h1>logstash入门</h1>

<div>
<span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt"><div style="direction:ltr;border-width:100%"><div style="direction:ltr;margin-top:0in;margin-left:0in;width:7.2631in"><div style="direction:ltr;margin-top:0in;margin-left:0in;width:2.0277in"><p style="margin:0in;font-size:20.0pt"><span lang="en-US" style="font-family:Calibri">logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">入门</span></p></div><div style="direction:ltr;margin-top:.0409in;margin-left:0in;width:1.6118in"><p style="margin:0in;font-size:10.0pt;color:#767676"><span style="font-family: Calibri">2019</span><span style="font-family:&quot;Microsoft YaHei&quot;">年</span><span style="font-family:Calibri">1</span><span style="font-family:&quot;Microsoft YaHei&quot;">月</span><span style="font-family:Calibri">5</span><span style="font-family:&quot;Microsoft YaHei&quot;">日</span></p><p style="margin:0in;font-family:Calibri;font-size:10.0pt;color:#767676">18:23</p></div><div style="direction:ltr;margin-top:.4763in;margin-left:0in;width:7.2631in"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">简介</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Data shipper</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">ETL</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Extract</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Transform</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Load</span></li></ul></ul><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">架构简介</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image.png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Input 数 据 采 集 Filter 数 据 解 析 / 转 换 Output 数 据 输 出" height="140" width="600"/></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">input</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">stdin</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">file</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">redis</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">beats</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">kafka</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">……</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Filter</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">grok</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">mutate</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">drop</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">date</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Output</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">stdout</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">elasticsearch</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">redis</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Kafka</span></li></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Pipeline</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Input-filter-output</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">阶段处理流程</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">队列管理</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">插件生命周期管理</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Logstash event</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">内部流转的数据表现形式</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">原始数据在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">input</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">被转换为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">event</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">output event</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">被转换为目标格式数据</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在配置文件中可以对</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">event</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的属性进行增删改查</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [1].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Input/Output Data Input Output Data Codec(Code/Decode) Data Input decode Event encode Outpu Event Data" height="270" width="600"/></li></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [2].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Raw 一 Input Data codec- decode Filter codec- encode Output 一 ， Data" height="59" width="600"/></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">处理流程</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">-- input</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">output</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">配置（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">codec.conf</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">），</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bin/logstash -f codec.conf</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">input { stdin { codec =&gt; line }}</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">filter{}</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">output { stdout { codec =&gt; json }}</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [3].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Input Codec Queue Codec Input Batcher Batcher Batcher Filter Output" height="270" width="600"/></li></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">queue</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">的分类</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">in memory</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">无法处理进程</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">carsh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、机器宕机等情况，会导致数据丢失</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">persistent queue in disk</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可处理进程</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">crash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等情况，保证数据不丢失</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">保证数据至少消费一次</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">充当缓冲区，可以替代</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">kafka</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等消息队列的作用</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">queue.type:persisted</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">memory</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">queue.max_bytes:4gb</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">队列存储最大数据量</span></li></ul></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">pipeline worker thread</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">pipeline.workers | -w</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">线程数，即</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filter_output</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的处理线程数，默认是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cpu</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">核数</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">pipeline.batch.size | -b</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">batcher</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">一次批量获取待处理文档数，默认</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">125</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，可以根据输出进行调整，越大会占用越多的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">heap</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">空间，可以通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">jvm.options</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">调整</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">pipeline.batch.delay | -u</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">batcher</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等待的时长，单位为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ms</span></li></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">配置文件</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置相关的配置文件（在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">conf</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文件夹中，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">setting files</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash.yml logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">相关配置，比如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node.name</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri; font-size:11.0pt">path.data</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pipeline.workers</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">queue.type</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等，这其中的配置可以被命令行参数中的相关参数覆盖</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">node.name</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点名称，便于识别</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">path.config</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">配置文件的目录</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">path.data</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">持久化存储数据的文件夹，默认是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash home</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">目录下的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">data</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">path.log</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">日志文件的目录</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">pipeline.workers</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的线程数</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">(filter+output)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，优化的常用项</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">pipeline.batch.size/delay</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定批量处理数据的数目和延迟</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">queue.type</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定队列类型，默认是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">memory</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">queue.max_bytes</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">队列总容量，默认是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1g</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">jvm.options</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">修改</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">jvm</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">相关参数，比如修改</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">heap size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等</span></li></ul><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">配置文件</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">定义数据处理流程的文件，以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">.conf</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">结尾</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">用于配置</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">input</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">output</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">插件，框架如下所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">input{}</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:.75in;font-family:Calibri;font-size:11.0pt">filter{}</p><p lang="en-US" style="margin:0in;margin-left:.75in;font-family:Calibri;font-size:11.0pt">output{}</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">配置语法</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">主要有如下的数值类型：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">布尔类型</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">boolean</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">isFailed =&gt; true</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数值类型</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">number</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">port =&gt; 33</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字符串类型</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">string</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">name =&gt; &quot;Hello world&quot;</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数组</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">array/list</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">users =&gt; [{id =&gt; 1, name =&gt; bob}, {id =&gt; 2, name =&gt; jane}]</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">path =&gt; [&quot;/var/log/messages&quot;, &quot;/var/log/*.log&quot;]</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">哈希类型</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">hash</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">match =&gt; {</span></li></ul></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">&quot;field1&quot; =&gt; &quot;value1&quot;</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">&quot;field2&quot; =&gt; &quot;value2&quot;</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">注释</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">井号</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在配置中可以引用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash event</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的属性（字段），主要有如下两种形式：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">直接引用字段值</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">field reference</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">[]</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">即可，嵌套字段可以多层</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">[]</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">即可</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [4].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: •agent": " Moz 山 a / 5 ． 0 (compatible; MSIE 9 ． 0)", •ip": 气 92 ， 168 ， 24 ， 44 》 request': "/index.html" response": { •status": 200 ， "bytes": 52353 "os": "Windows 7 “ if [request] = if [ual[os] = "index"{ •windows"{" height="236" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在字符串中以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sprintf</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">方式引用</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">%{}</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来实现</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [5].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: •agent": · Moz 山 a / 5 ． 0 (compatible; MSIE 9 ． 0)", •ip": “ 192 ， 168 ， 24 ， 44 “ request': "/index.html" response": { •status": 200 ， "bytes": 52353 "os": "Windows 丆 = > "request is %{request}" req ua = > "ua is %{[ual[os])'" height="217" width="600"/></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">支持条件判断语法，从而扩展了配置的多样性，主要格式如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [6].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: if EXPRESSION { } else if EXPRESSION {" height="220" width="269"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">表达式主要包含如下操作符：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">比较：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">==</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">!=</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">&lt;</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">&gt;</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">&lt;=</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">&gt;=</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">正则是否匹配：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">=~</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">!~</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">包含（字符串或数组）：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">in</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">not in</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">布尔操作符：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">and</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">or</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">nand</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">xor</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">!</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分组操作符：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">()</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">if [action] == &quot;login&quot;</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">if [loglevel] == &quot;ERROR&quot; and [deployment] == &quot;production&quot;</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">if [foo] in [foobar]</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">if [foo] in &quot;foo&quot;</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">if &quot;hello&quot; in [greeting]</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">if [foo] in [&quot;hello&quot;, &quot;world&quot;, &quot;foo&quot;]</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">if !(&quot;foo&quot; in [&quot;hello&quot;, &quot;world&quot;])</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">if &quot;_grokparsefailure&quot; not in [tags]</span></li></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">命令行配置项</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">--node.name</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">-f --path.config pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">路径，可以是文件或文件夹</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">--path.settings logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">配置文件夹路径，其中要包含</span><span lang="en-US" style="font-family:Calibri; font-size:11.0pt">logstash.yml</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">-e --config.string</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指明</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">内容，多用于测试使用</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">-w --pipeline.workers</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">-b --pipeline.batch.size</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">--path.data</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">--debug</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">-t --config.test_and_exit</span></li></ul><p style="margin:0in;font-size:11.0pt;color:red"><span lang="en-US" style="font-family:Calibri">logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">配置方式建议</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;color:red"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">线上环境推荐采用配置文件的方式来设定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的相关配置，这样可以减少犯错的机会，而且文件便于进行版本化管理</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;color:red"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">命令行形式多用来进行快速的配置测试、验证、检查等</span></li></ul><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">多实例运行方式</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">bin/logstash --path.settings instance1</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">bin/logstash --path.settings instance2</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不同</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">instance</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中修改</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash.yml</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，自定义</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">path.data</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，确保其不相同即可</span></li></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">input plugin</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">input</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">插件指定数据输入源，一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以有多个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">input</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">插件，我们主要讲解下面的几个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">input</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">插件：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">stdin</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，最简单的输入，从标准输入读取数据，通用配置为：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">code</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">c</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">codec</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">ty</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pe</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">string</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，自定义该事件的类型，可用于后续判断</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">tags</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">array</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，自定义该事件类型，可用于后续判断</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">a</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">dd_field</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">hash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，为该事件添加字段</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [7].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: input-stdin.conf input { std i n { codec = > plain tags = > ["test"] type = > "std" add field = > {"key" = > "value") output{ stdout { codec = > •rubydebug" height="369" width="316"/></li></ul></ul></ul><p style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [8].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: output •type" = > " std “ "@version = > "test" message "@timestamp = > 2018 ． 03 · 06T16 ： 19 ： 20 ． 841 乙 "key" = > ''value" •tags" [ 0 ] •test" "host" = > "MacBook-Pro-2 」 ocal"" height="239" width="348"/></li></ul><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">file</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">从文件读取数据，如常见的日志文件。文件读取通常要解决几个问题：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文件内容如何只被读取一次，即重启</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">LS</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">时，从上次读取的位置继续</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">sincedb</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如何即时读取到文件内容</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">定时检查文件是否有更新</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如何发现新文件并进行读取</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以，定时检查新文件</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如果文件发生了归档</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">(rotation)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">操作，是否影响当前的内容读取</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不影响，被归档的文档内容可以继续被读取</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">基于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filewatch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">ru</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">by</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">库实现</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="https://github.com/jordansissel/ruby-filewatch"><span style="font-family:Calibri;font-size:11.0pt">https://github.com/jordansissel/ruby-filewatch</span></a></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">w</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">atch</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">tail</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [9].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: require "rubygems" require "filewatch/tail" t = FileWatch::Tail.new t.tail("/tmp/test* 」 og") t.subscribe do Ipath, linel puts "#{path}: #{line}" end" height="301" width="282"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">path</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为数组，指明读取的文件路径，基于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">glob</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配语法</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">path =&gt; [&quot;/var/log/**/*.log&quot;, &quot;/var/log/message&quot;]</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">exclude</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为数组排除不想监听的文件规则，基于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">glob</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配语法</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">exclude =&gt; &quot;*.gz&quot;</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sincedb_path</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为字符串，记录</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sincedb</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文件路径</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">start_position</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为字符串，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">begging or end</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，是否从头读取文件</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">stat_interval</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为数值，单位秒，定时检查文件是否有更新，默认</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">discover_interval</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为数值，单位秒，定时检查是否有新文件待读取，默认</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">15</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ignore_older</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为数值，单位秒，扫描文件列表时，如果该文件上次更新时间超过设定的时长，则不做处理，但依然会监控是否有新内容，默认关闭</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">close_older</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为数值，单位秒，如果监听的文件在超过该设定的时间内没有新内容，会被关闭文件句柄，释放资源，但依然会监控是否有新内容，默认</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">3600</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒，即</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个小时</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">kafka</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">ka</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">fka</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是最流行的消息队列，也是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">elastic stack</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">架构中常用的，使用相对简单</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">input {</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">kafka {</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">zk_connect =&gt; &quot;kafka:2181&quot;</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">group_id =&gt; &quot;logstash&quot;</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">topic_id =&gt; &quot;apache_logs&quot;</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">consumer_threads =&gt; 16</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">glob</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配语法</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">主要包含如下几种匹配符：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">*</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配任意字符，但不匹配以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">&quot;.&quot;</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">开头的隐藏文件，匹配这类文件时要使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">.*</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来匹配</span></li></ul><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">**</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">递归匹配子目录</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">?</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配单一字符</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">[]</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配多个字符，比如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">[a-z]</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">[^a-z]</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">{}</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配多个单词，比如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">{foo,bar,hello}</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">\</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">转义符号</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">&quot;/var/log/*.log&quot;</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">/var/log</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">目录下以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">.log</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">结尾的文件</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">&quot;/var/log/**/*.log&quot;</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">/var/log</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">所有子目录下以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">.log</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">结尾的文件</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">&quot;/var/log/{app1,app2,app3}/*.log&quot;</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">/var/log</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">目录下</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">app1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">app2</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">app3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">目录中以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">.log</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">结尾的文件</span></li></ul></ul></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Codec plugin</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Codec plugin</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">作用于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">input</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">output plugin</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，负责将数据在原始与</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash event</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">之间转换，常见的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">codec</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">有：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">plain</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">读取原始内容</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">dots</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将内容简化为点进行输出</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">rubydebug</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash events</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ruby</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">格式输出，方便调试</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">line</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">处理带有换行符的内容</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">json</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">处理</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">json</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">格式的内容</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">multiline</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">处理多行数据的内容</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">当一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">event</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">message</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">由多行组成时，需要使用该</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">codec</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，常见情况是堆栈日志信息处理，如下所示：</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [10].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Exception in thread "main" Java.lang.NuIIPointerException at com.example.mypr0Ject.Book.getTitle(Book.java:16) at com.example.mypr0Ject.Author.getB00kTitIes(Author.java:25) at com.example.mypr0Ject.Bootstrap.main(Bootstrap.Java:14)" height="121" width="600"/></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">主要设置参数如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pattern</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置行匹配的正则表达式，可以使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">grok</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">what previous|next</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">，如果匹配成功，那么匹配行归属上一个事件还是下一个事件</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">negate true or false</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否对</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pattern</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">的结果取反</span></li></ul></ul></ul></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"><span style="mso-spacerun:yes"> </span>filter plugin</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">功能强大的主要原因，它可以对</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash event</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">进行丰富的处理，比如解析数据、删除字段、类型转换等等，常见的有如下几个：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">date</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">日期解析</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将日期字符串解析为日期类型，然后替换</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">@timestamp</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字段或者指定的其他字段</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [11].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: filter { date { match = > [ "logdate" "MMM dd YYYY HH:mm:ss" ]" height="191" width="600"/></li></ul></ul></ul></ul><p style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [12].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: "@versionø = > " 1 " "logdate":"Jan 01 2018 12 ： 02 ： 08 “ "host" = > "MacBook-Pro-2.local" "logdate" = > "Jan 01 2018 12 ： 02 ： 08 “ "@timestamp" = > 2018 · 01 · 01T04 ： 02 ： 08 ． 000Z" height="121" width="600"/></li></ul><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">m</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">atch</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为数组，用于指定日期匹配的格式，可以一次指定多种日期格式</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Match =&gt; [&quot;logdate&quot;, &quot;MMM dd yyyy HH:mm:ss&quot;, &quot;MMM d yyyy HH:mm:ss&quot;, &quot;ISO8601&quot;]</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">target</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型为字符串，用于指定赋值的字段名，默认是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">@timestamp</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">timezone</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型字符串，用于指定时区</span></li></ul></ul><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">grok</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">正则匹配解析</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">grok</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">语法如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">%{SYNTAX:SEMANTIC}</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">SYNTAX</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">grok pattern</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的名称，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">SEMANTIC</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为赋值字段名称</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">%{NUMBER:duration}</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以匹配数值类型，但是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">grok</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配出的内容都是字符串类型，可以通过在最后指定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">int</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">或者</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">float</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来强制转换类型。</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">%{NUMBER:duration:float}</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">熟悉常见的一些</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pattern</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">规则利于编写匹配规则</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns"><span style="font-family:Calibri;font-size:11.0pt">https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns</span></a></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">基于正则自定义匹配规则</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">(?&lt;service_name&gt;[0-9a-z]{10,11})</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [13].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: input{stdin{}} filte r{ grok{ match=>{ message" { 10 ， 11D " =>"(?<service n a m e > [a-zO-9] output{stdout{codec= > rubydebug}}" height="271" width="389"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自定义</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">grok pattern</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pattern_definitions</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数，以键值对的方式定义</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pattern</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">名称和内容</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pattern_dir</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数，以文件的形式被读取</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [14].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: fi Ite r{ grok{ match=>{ message" = > "%{SERVICE:service}" p atte rn definitions = > { "SERVICE"=>"[a-zO-91{IO,II)"" height="330" width="394"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">match</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配多种样式</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [15].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: filter { grok { match = > { "message" = > [ "Duration: %{NUMBER:duration}", "Speed: 96{NUMBER:speed}" ] } }" height="114" width="600"/></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">overwrite</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [16].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: filter { grok { match = > { "message" = > "%{SYSLOGBASE} %{DATA:message}" } overwrite = > [ •message" ]" height="188" width="600"/></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">tag_on_failure</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_grokparsefailure</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，可以基于此做判断</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">调试建议</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">正则表达式</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="https://www.debuggex.com/"><span style="font-family:Calibri; font-size:11.0pt">https://www.debuggex.com/</span></a></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="http://www.regexr.com/"><span style="font-family:Calibri; font-size:11.0pt">http://www.regexr.com/</span></a></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">grok</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">调试</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="http://grokdebug.herokuapp.com/"><span style="font-family:Calibri; font-size:11.0pt">http://grokdebug.herokuapp.com/</span></a></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="http://grokconstructor.appspot.com/"><span style="font-family: Calibri;font-size:11.0pt">http://grokconstructor.appspot.com/</span></a></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">x-pack grok debugger</span></li></ul></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">dissect</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分割符解析</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">基于分割符原理解析数据，解决</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">grok</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">解析时消耗过多</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cpu</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">资源问题</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [17].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: %{clientip) %{ident} %{auth} [%{timestamp}] "%{request}" ％ {response) %{bytes) "%{referrer}" "%{agent}"" height="53" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">dissect</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的应用有一定的局限性</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">主要适用于每行格式相似且分隔符明确简单的场景</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">dissect</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">语法比较简单，有一系列字段</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">(field)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和分隔符</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">(delimiter)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">组成</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">%{}</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字段</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">%{}</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">之间是分隔符</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="logstash入门_files/Image [18].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: - h 刨 0 - 12 "b":"hello" （ ？ 12 “ 如 果 不 写 名 称 ， 即 ％ 0 ， 表 明 忽 略 该 值" height="238" width="600"/></li></ul></ul></ul><p style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [19].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: I Apr 26 12 ： 20 ： 02 "ts":"Apr 26 12 ： 20 ： 02 “ + 代 表 该 匹 配 值 追 加 到 ts 字 段 下" height="257" width="600"/></li></ul><p style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [20].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: I two three one go •order" %{+order/2) %{+order/3) %{+order/l) %(+order/4} / 后 面 的 数 字 代 表 拼 接 的 次 序 ： one two three go" height="239" width="600"/></li></ul><p style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [21].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: ％ { ？ } 代 表 忽 略 匹 配 值 ， 但 是 赋 予 字 段 名 ， 用 于 后 续 匹 配 用 a=1&b=2 ％ { & } 代 表 将 匹 配 值 赋 予 keyl 的 匹 配 值" height="298" width="600"/></li></ul><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">dissect</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以自动处理空的匹配值</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">dissect</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分割后的字段值都是字符串，可以使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">convert_datatype</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">属性进行类型转换</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [22].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: filter { dissect { convert datatype age = > "int"" height="273" width="293"/></li></ul></ul><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">mutate</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">使用最频繁的操作，可以对字段进行各种操作，比如重命名、删除、替换、更新等，主要操作如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">convert</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实现字段类型转换，类型为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">hash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，仅支持转换为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">integer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">float</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">string</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">boolean</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">filter{</span></li></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">mutate{</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">convert</span> =&gt; { &quot;age&quot; =&gt; &quot;integer&quot; }</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">gsub</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">对字段内容进行替换，类型为数组，每</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">项为一个替换配置</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">filter{</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">mutate{</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">gsub</span> =&gt; [</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt">&quot;path&quot;, &quot;/&quot;, &quot;_&quot;,</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt">&quot;urlparams&quot;, &quot;[<a href="file://%3f%23-/">\\?#-</a>]&quot;, &quot;.&quot;</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">]</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">split/join/merge</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字符串切割、数组合并为字符串、数组合并为数组</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将字符串切割为数组</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">filter{</span></li></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">mutate{</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">split</span> =&gt; {&quot;jobs&quot; =&gt; &quot;,&quot;}</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将数组拼接为字符串</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">filter{</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">mutate{</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">join</span> =&gt; {&quot;params&quot; =&gt; &quot;,&quot;}</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将两个数组合并为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个数组，字符串会被转为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个元素的数组进行操作</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">filter{</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">mutate{</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">merge</span> =&gt; {&quot;dest_arr&quot; =&gt; &quot;source_arr&quot;}</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">rename</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字段重命名</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">filter{</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">mutate{</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">rename</span> =&gt; {&quot;HOSTNAME&quot; =&gt; &quot;client_ip&quot;}</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">update/replace</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">更新字段内容，区别在于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">update</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">只在字段存在时生效，而</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">replace</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在字段不存在时会执行新增字段操作</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [23].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: filter { mutate { replace = > { "message = > "%{source host}: My n ew messageø } 可 以 引 用 Logstash Event 中 的 字 段 值" height="201" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">remove_field</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">删除字段</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">filter{</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">mutate{</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">remove_field</span> =&gt; [&quot;message&quot;]</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">json</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">json</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">解析字段内容到指定字段中</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [24].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 要 解 析 的 字 段 名 解 析 后 的 存 储 字 段 ， 默 认 和 message 同 级 别 filter { json { = > "message" source target = > msg_Json" height="162" width="413"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">geoip</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">增加地理位置数据，常用插件，根据</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ip</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">地址提供对应的地域信息，比如经纬度、城市名等，方便进行地理数据分析</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">filter{</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">geoip</span>{</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">source =&gt; &quot;ip&quot;</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ruby</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">最灵活插件，利用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ruby</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">代码来动态修改</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash event</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">filter{</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">ruby</span>{</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">code</span> =&gt; 'size = event.get(&quot;decription&quot;).size;</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">event.set(&quot;description_size&quot;,&quot;size&quot;)'</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">output plugin</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">stdout</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，输出到标准输出，多用于调试</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">output{</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt"><span style="font-weight:bold">stdout</span>{</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">codec =&gt; rubydebug</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:.75in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">file</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，输出到文件，实现将分散在多地的文件统一到一处的需求，比如将所有</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">web</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">机器的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">web</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">日志收集到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个文件中，从而方便查阅信息</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [25].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: output file { path = > "/var/log/web 」 og" codec = > line { fo r at = > "%{message}") 默 认 输 出 json 格 式 的 数 据 ， 通 过 format 可 以 输 出 原 始 格 式" height="292" width="421"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">elasticsearch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，输出到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">elasticsearch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，是最常用的插件，基于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">http</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">协议实现</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [26].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: output { elasticsearch { 只 写 d ata 和 client hosts = > 「 127 ， 0 1 ： 9200 127 ， 0 ， 029200 " ] node 地 址 index = > "nginx-%{+YYYY.MM.dd}" template = > "Jnginx-template.json" template_name = > "nginx_template" template overwrite = > true" height="173" width="600"/></li></ul></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">调试的配置建议</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">调试阶段建议大家使用如下配置：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">http</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">做</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">input</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，方便输入测试数据，并且可以结合</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">reload</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的特性（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">stdin</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">无法</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">reload</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">stdout</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">做</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">output</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">codec</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">rubydebug</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，即时查看解析结果</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">测试错误输入情况下输出，以便对错误情况进行处理</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">input{http{port=&gt;7474}}</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:.75in;font-family:Calibri;font-size:11.0pt">filter{}</p><p lang="en-US" style="margin:0in;margin-left:.75in;font-family:Calibri;font-size:11.0pt">output{stdout{codec=&gt;rebydebug}}</p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">处理建议</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">@metadata</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">特殊字段，其内容不会输出在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">output</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">适合用来存储做条件判断、临时存储的字段</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">相比</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">remove_field</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">有一定的性能提升</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="logstash入门_files/Image [27].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: input { stdin { } } filter { mutate { add-field = > { '[@metadata][debug]• = > true } } mutate { add field = > { "show" = > "This data will be in the output" } } output { if [@metadata][debug]{ stdout { codec = > rubydebug }" height="302" width="600"/></li></ul></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p style="margin:0in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">监控运维之</span><span lang="en-US" style="font-family:Calibri">api</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">提供了丰富的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来查看</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">logstash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的当前状态</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="http://localhost:9600/"><span style="font-family:Calibri;font-size: 11.0pt">http://localhost:9600</span></a></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="http://localhost:9600/_node"><span style="font-family:Calibri; font-size:11.0pt">http://localhost:9600/_node</span></a></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="http://localhost:9600/_node/stats"><span style="font-family:Calibri; font-size:11.0pt">http://localhost:9600/_node/stats</span></a></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="http://localhost:9600/_node/hot_threads"><span style="font-family: Calibri;font-size:11.0pt">http://localhost:9600/_node/hot_threads</span></a></li></ul></ul></div></div></div><div><p style="margin:0in"> </p><p style="text-align:left;margin:0in;font-family:Arial;font-size:9pt; color:#969696;direction:ltr">已使用 Microsoft OneNote 2016 创建。</p></div></span>
</div></body></html> 