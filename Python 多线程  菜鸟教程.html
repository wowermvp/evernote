<html>
<head>
  <title>Python 多线程 | 菜鸟教程</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1743"/>
<h1>Python 多线程 | 菜鸟教程</h1>

<div><span><br/><div style="font-size: 16px"><div style="overflow-y:scroll;"><div style="font-size:12px;color:rgb(0, 0, 0);background-color:rgb(246, 244, 240);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><div><div style="background-color:rgb(255, 255, 255);"><div style="overflow:hidden;background-color:rgb(255, 255, 255);"><div> <h1 style="font-size:210%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:0px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">Python 多线程</h1> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">多线程类似于同时执行多个不同程序，多线程运行有如下优点：</p> <ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;">使用线程可以把占据长时间的程序中的任务放到后台去处理。</li> <li style="padding:2px 0px;">用户界面可以更加吸引人，这样比如用户点击了一个按钮去触发某些事件的处理，可以弹出一个进度条来显示处理的进度</li> <li style="padding:2px 0px;">程序的运行速度可能加快</li> <li style="padding:2px 0px;">在一些等待的任务实现上如用户输入、文件读写和网络收发数据等，线程就比较有用了。在这种情况下我们可以释放一些珍贵的资源如内存占用等等。</li> </ul> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">线程在执行过程中与进程还是有区别的。每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口。但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制。 </p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">每个线程都有他自己的一组CPU寄存器，称为线程的上下文，该上下文反映了线程上次运行该线程的CPU寄存器的状态。 </p><p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">指令指针和堆栈指针寄存器是线程上下文中两个最重要的寄存器，线程总是在进程得到上下文中运行的，这些地址都用于标志拥有线程的进程地址空间中的内存。 </p> <ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;">线程可以被抢占（中断）。</li> <li style="padding:2px 0px;">在其他线程正在运行时，线程可以暂时搁置（也称为睡眠） -- 这就是线程的退让。 </li> </ul> <br/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">开始学习Python线程</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">Python中使用线程有两种方式：函数或者用类来包装线程对象。</p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">函数式：调用thread模块中的start_new_thread()函数来产生新线程。语法如下:</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(0, 0, 0);">thread</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">start_new_thread </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">function</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> args</span><span style="color:rgb(102, 102, 0);">[,</span><span style="color:rgb(0, 0, 0);"> kwargs</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">参数说明:</p> <ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;">function - 线程函数。</li> <li style="padding:2px 0px;">args - 传递给线程函数的参数,他必须是个tuple类型。</li> <li style="padding:2px 0px;">kwargs - 可选参数。</li> </ul> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">实例：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);">#coding=utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> thread
</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> time

</span><span style="color:rgb(136, 0, 0);"># 为线程定义一个函数</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">def</span><span style="color:rgb(0, 0, 0);"> print_time</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> threadName</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> delay</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
   count </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">0</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(0, 0, 136);">while</span><span style="color:rgb(0, 0, 0);"> count </span><span style="color:rgb(102, 102, 0);">&lt;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">5</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
      time</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">sleep</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">delay</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
      count </span><span style="color:rgb(102, 102, 0);">+=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);">
      </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;%s: %s&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> threadName</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> time</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">ctime</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">time</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">time</span><span style="color:rgb(102, 102, 0);">())</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 创建两个线程</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">try</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   thread</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">start_new_thread</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> print_time</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;Thread-1&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
   thread</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">start_new_thread</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> print_time</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;Thread-2&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">4</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">except</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Error: unable to start thread&quot;</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">while</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(0, 0, 136);">pass</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">执行以上程序输出结果如下：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Jan</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">22</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">15</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">42</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">17</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2009</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Jan</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">22</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">15</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">42</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">19</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2009</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Jan</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">22</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">15</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">42</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">19</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2009</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Jan</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">22</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">15</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">42</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2009</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Jan</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">22</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">15</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">42</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">23</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2009</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Jan</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">22</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">15</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">42</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">23</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2009</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Jan</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">22</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">15</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">42</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">25</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2009</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Jan</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">22</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">15</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">42</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">27</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2009</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Jan</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">22</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">15</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">42</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">31</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2009</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Jan</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">22</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">15</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">42</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">35</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2009</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">线程的结束一般依靠线程函数的自然结束；也可以在线程函数中调用thread.exit()，他抛出SystemExit exception，达到退出线程的目的。 </p> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">线程模块</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">Python通过两个标准库thread和threading提供对线程的支持。thread提供了低级别的、原始的线程以及一个简单的锁。</p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">thread 模块提供的其他方法： </p> <ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;">threading.currentThread(): 返回当前的线程变量。 </li> <li style="padding:2px 0px;">threading.enumerate(): 返回一个包含正在运行的线程的list。正在运行指线程启动后、结束前，不包括启动前和终止后的线程。 </li> <li style="padding:2px 0px;">threading.activeCount(): 返回正在运行的线程数量，与len(threading.enumerate())有相同的结果。</li> </ul> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">除了使用方法外，线程模块同样提供了Thread类来处理线程，Thread类提供了以下方法:</p> <ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;"><b>run():</b> 用以表示线程活动的方法。</li> <li style="padding:2px 0px;"><b>start():</b>启动线程活动。<p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"></p></li> <li style="padding:2px 0px;"><b> join([time]):</b> 等待至线程中止。这阻塞调用线程直至线程的join() 方法被调用中止-正常退出或者抛出未处理的异常-或者是可选的超时发生。</li> <li style="padding:2px 0px;"><b> isAlive():</b> 返回线程是否活动的。</li> <li style="padding:2px 0px;"><b> getName():</b> 返回线程名。</li> <li style="padding:2px 0px;"><b> setName():</b> 设置线程名。</li> </ul> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">使用Threading模块创建线程</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">使用Threading模块创建线程，直接从threading.Thread继承，然后重写__init__方法和run方法：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);">#coding=utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> threading
</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> time

exitFlag </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">0</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">class</span><span style="color:rgb(0, 0, 0);"> myThread </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">threading</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">   </span><span style="color:rgb(136, 0, 0);">#继承父类threading.Thread</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">def</span><span style="color:rgb(0, 0, 0);"> __init__</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> threadID</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> name</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> counter</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
        threading</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">__init__</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">threadID </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> threadID
        </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> name
        </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">counter </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> counter
    </span><span style="color:rgb(0, 0, 136);">def</span><span style="color:rgb(0, 0, 0);"> run</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">                   </span><span style="color:rgb(136, 0, 0);">#把要执行的代码写到run函数里面 线程在创建后会直接运行run函数 </span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Starting &quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name
        print_time</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">counter</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">5</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Exiting &quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name

</span><span style="color:rgb(0, 0, 136);">def</span><span style="color:rgb(0, 0, 0);"> print_time</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">threadName</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> delay</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> counter</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">while</span><span style="color:rgb(0, 0, 0);"> counter</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">if</span><span style="color:rgb(0, 0, 0);"> exitFlag</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
            thread</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 136);">exit</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
        time</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">sleep</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">delay</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;%s: %s&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">threadName</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> time</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">ctime</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">time</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">time</span><span style="color:rgb(102, 102, 0);">()))</span><span style="color:rgb(0, 0, 0);">
        counter </span><span style="color:rgb(102, 102, 0);">-=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 创建新线程</span><span style="color:rgb(0, 0, 0);">
thread1 </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> myThread</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Thread-1&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
thread2 </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> myThread</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Thread-2&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 开启线程</span><span style="color:rgb(0, 0, 0);">
thread1</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">start</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
thread2</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">start</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Exiting Main Thread&quot;</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">以上程序执行结果如下；</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(102, 0, 102);">Starting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Starting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Exiting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Main</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Mar</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">09</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">03</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Mar</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">09</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">04</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Mar</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">09</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">04</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Mar</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">09</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">05</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Mar</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">09</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">06</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Mar</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">09</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">06</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Mar</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">09</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">07</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Exiting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Mar</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">09</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">08</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Mar</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">09</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thu</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Mar</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">09</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">12</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Exiting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span></pre> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">线程同步</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">如果多个线程共同对某个数据修改，则可能出现不可预料的结果，为了保证数据的正确性，需要对多个线程进行同步。 </p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> 使用Thread对象的Lock和Rlock可以实现简单的线程同步，这两个对象都有acquire方法和release方法，对于那些需要每次只允许一个线程操作的数据，可以将其操作放到acquire和release方法之间。如下： </p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">多线程的优势在于可以同时运行多个任务（至少感觉起来是这样）。但是当线程需要共享数据时，可能存在数据不同步的问题。</p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> 考虑这样一种情况：一个列表里所有元素都是0，线程&quot;set&quot;从后向前把所有元素改成1，而线程&quot;print&quot;负责从前往后读取列表并打印。</p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> 那么，可能线程&quot;set&quot;开始改的时候，线程&quot;print&quot;便来打印列表了，输出就成了一半0一半1，这就是数据的不同步。为了避免这种情况，引入了锁的概念。 </p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> 锁有两种状态——锁定和未锁定。每当一个线程比如&quot;set&quot;要访问共享数据时，必须先获得锁定；如果已经有别的线程比如&quot;print&quot;获得锁定了，那么就让线程&quot;set&quot;暂停，也就是同步阻塞；等到线程&quot;print&quot;访问完毕，释放锁以后，再让线程&quot;set&quot;继续。 </p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> 经过这样的处理，打印列表时要么全部输出0，要么全部输出1，不会再出现一半0一半1的尴尬场面。</p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">实例：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);">#coding=utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> threading
</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> time

</span><span style="color:rgb(0, 0, 136);">class</span><span style="color:rgb(0, 0, 0);"> myThread </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">threading</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">def</span><span style="color:rgb(0, 0, 0);"> __init__</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> threadID</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> name</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> counter</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
        threading</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">__init__</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">threadID </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> threadID
        </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> name
        </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">counter </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> counter
    </span><span style="color:rgb(0, 0, 136);">def</span><span style="color:rgb(0, 0, 0);"> run</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Starting &quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name
       </span><span style="color:rgb(136, 0, 0);"># 获得锁，成功获得锁定后返回True</span><span style="color:rgb(0, 0, 0);">
       </span><span style="color:rgb(136, 0, 0);"># 可选的timeout参数不填时将一直阻塞直到获得锁定</span><span style="color:rgb(0, 0, 0);">
       </span><span style="color:rgb(136, 0, 0);"># 否则超时后将返回False</span><span style="color:rgb(0, 0, 0);">
        threadLock</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">acquire</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
        print_time</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">counter</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">3</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(136, 0, 0);"># 释放锁</span><span style="color:rgb(0, 0, 0);">
        threadLock</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">release</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">def</span><span style="color:rgb(0, 0, 0);"> print_time</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">threadName</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> delay</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> counter</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">while</span><span style="color:rgb(0, 0, 0);"> counter</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
        time</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">sleep</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">delay</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;%s: %s&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">threadName</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> time</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">ctime</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">time</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">time</span><span style="color:rgb(102, 102, 0);">()))</span><span style="color:rgb(0, 0, 0);">
        counter </span><span style="color:rgb(102, 102, 0);">-=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);">

threadLock </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> threading</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(102, 0, 102);">Lock</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
threads </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">[]</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 创建新线程</span><span style="color:rgb(0, 0, 0);">
thread1 </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> myThread</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Thread-1&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
thread2 </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> myThread</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Thread-2&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 开启新线程</span><span style="color:rgb(0, 0, 0);">
thread1</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">start</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
thread2</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">start</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 添加线程到线程列表</span><span style="color:rgb(0, 0, 0);">
threads</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">append</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">thread1</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
threads</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">append</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">thread2</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 等待所有线程完成</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">for</span><span style="color:rgb(0, 0, 0);"> t </span><span style="color:rgb(0, 0, 136);">in</span><span style="color:rgb(0, 0, 0);"> threads</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
    t</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">join</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Exiting Main Thread&quot;</span></pre> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">线程优先级队列（ Queue） </h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> Python的Queue模块中提供了同步的、线程安全的队列类，包括FIFO（先入先出)队列Queue，LIFO（后入先出）队列LifoQueue，和优先级队列PriorityQueue。这些队列都实现了锁原语，能够在多线程中直接使用。可以使用队列来实现线程间的同步。</p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">Queue模块中的常用方法:</p><p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> </p><ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;">Queue.qsize() 返回队列的大小 </li> <li style="padding:2px 0px;">Queue.empty() 如果队列为空，返回True,反之False </li> <li style="padding:2px 0px;">Queue.full() 如果队列满了，返回True,反之False</li> <li style="padding:2px 0px;">Queue.full 与 maxsize 大小对应 </li> <li style="padding:2px 0px;">Queue.get([block[, timeout]])获取队列，timeout等待时间 </li> <li style="padding:2px 0px;">Queue.get_nowait() 相当Queue.get(False)</li> <li style="padding:2px 0px;">Queue.put(item) 写入队列，timeout等待时间 </li> <li style="padding:2px 0px;">Queue.put_nowait(item) 相当Queue.put(item, False)</li> <li style="padding:2px 0px;">Queue.task_done() 在完成一项工作之后，Queue.task_done()函数向任务已经完成的队列发送一个信号</li> <li style="padding:2px 0px;">Queue.join() 实际上意味着等到队列为空，再执行别的操作</li> </ul> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">实例:</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);">#coding=utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Queue</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> threading
</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> time

exitFlag </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">0</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">class</span><span style="color:rgb(0, 0, 0);"> myThread </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">threading</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">def</span><span style="color:rgb(0, 0, 0);"> __init__</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> threadID</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> name</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> q</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
        threading</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">__init__</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">threadID </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> threadID
        </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> name
        </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">q </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> q
    </span><span style="color:rgb(0, 0, 136);">def</span><span style="color:rgb(0, 0, 0);"> run</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Starting &quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name
        process_data</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">q</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Exiting &quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">self</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">name

</span><span style="color:rgb(0, 0, 136);">def</span><span style="color:rgb(0, 0, 0);"> process_data</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">threadName</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> q</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">while</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">not</span><span style="color:rgb(0, 0, 0);"> exitFlag</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
        queueLock</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">acquire</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">if</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">not</span><span style="color:rgb(0, 0, 0);"> workQueue</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">empty</span><span style="color:rgb(102, 102, 0);">():</span><span style="color:rgb(0, 0, 0);">
            data </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> q</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 136);">get</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
            queueLock</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">release</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
            </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;%s processing %s&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">threadName</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> data</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(0, 0, 136);">else</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
            queueLock</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">release</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
        time</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">sleep</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

threadList </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 136, 0);">&quot;Thread-1&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Thread-2&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Thread-3&quot;</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);">
nameList </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 136, 0);">&quot;One&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Two&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Three&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Four&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Five&quot;</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);">
queueLock </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> threading</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(102, 0, 102);">Lock</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
workQueue </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Queue</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(102, 0, 102);">Queue</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 102, 102);">10</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
threads </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">[]</span><span style="color:rgb(0, 0, 0);">
threadID </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 创建新线程</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">for</span><span style="color:rgb(0, 0, 0);"> tName </span><span style="color:rgb(0, 0, 136);">in</span><span style="color:rgb(0, 0, 0);"> threadList</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
    thread </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> myThread</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">threadID</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> tName</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> workQueue</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
    thread</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">start</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
    threads</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">append</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">thread</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
    threadID </span><span style="color:rgb(102, 102, 0);">+=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 填充队列</span><span style="color:rgb(0, 0, 0);">
queueLock</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">acquire</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">for</span><span style="color:rgb(0, 0, 0);"> word </span><span style="color:rgb(0, 0, 136);">in</span><span style="color:rgb(0, 0, 0);"> nameList</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
    workQueue</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">put</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">word</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
queueLock</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">release</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 等待队列清空</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">while</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">not</span><span style="color:rgb(0, 0, 0);"> workQueue</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">empty</span><span style="color:rgb(102, 102, 0);">():</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">pass</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 通知线程是时候退出</span><span style="color:rgb(0, 0, 0);">
exitFlag </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 等待所有线程完成</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">for</span><span style="color:rgb(0, 0, 0);"> t </span><span style="color:rgb(0, 0, 136);">in</span><span style="color:rgb(0, 0, 0);"> threads</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
    t</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">join</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Exiting Main Thread&quot;</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">以上程序执行结果：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(102, 0, 102);">Starting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Starting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Starting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">3</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);"> processing </span><span style="color:rgb(102, 0, 102);">One</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(0, 0, 0);"> processing </span><span style="color:rgb(102, 0, 102);">Two</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">3</span><span style="color:rgb(0, 0, 0);"> processing </span><span style="color:rgb(102, 0, 102);">Three</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);"> processing </span><span style="color:rgb(102, 0, 102);">Four</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(0, 0, 0);"> processing </span><span style="color:rgb(102, 0, 102);">Five</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Exiting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">3</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Exiting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Exiting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">Exiting</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Main</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Thread</span></pre> </div></div></div></div></div></div></div><br/></span>
</div></body></html> 