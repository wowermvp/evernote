<html>
<head>
  <title>使用expect实现shell自动交互</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="580"/>
<h1>使用expect实现shell自动交互</h1>

<div>
<span><div><br/></div><div style="background-color: rgb(255, 255, 255);"><div style="background-color: rgb(216, 215, 215);"><div style="background-color: rgb(238, 238, 238);"><div style="background-color: rgb(255, 255, 255);"><h1 style="text-align: center; display: block;"><span style="color: black; font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em; font-weight: normal;"><font style="font-size: 10pt;">使用expect实现shell自动交互</font></span></h1><div style="font-size: 13px; word-wrap: break-word; word-break: normal;"><div style="top: 0px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">﻿﻿</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">shell脚本需要交互的地方可以使用here文档是实现，但是有些命令却需要用户手动去就交互如passwd、scp</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">对自动部署免去用户交互很痛苦，expect能很好的解决这类问题。</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expect的核心是spawn expect send set</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">spawn 调用要执行的命令</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expect 等待命令提示信息的出现，也就是捕捉用户输入的提示：</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">send 发送需要交互的值，替代了用户手动输入内容</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">set 设置变量值</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">interact 执行完成后保持交互状态，把控制权交给控制台，这个时候就可以手工操作了。如果没有这一句登录完成后会退出，而不是留在远程终端上。</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expect eof 这个一定要加，与spawn对应表示捕获终端输出信息终止，类似于if....endif</span></div></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expect脚本必须以interact或expect eof结束，执行自动化任务通常expect eof就够了。</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">设置expect永不超时</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">set timeout -1</span></div></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">设置expect 300秒超时，如果超过300没有expect内容出现，则推出</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">set timeout 300</span></div></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expect编写语法，expect使用的是tcl语法。</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">一条Tcl命令由空格分割的单词组成. 其中, 第一个单词是命令名称, 其余的是命令参数</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">cmd arg arg arg</span></div></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">$符号代表变量的值. 在本例中, 变量名称是foo.</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">$foo</span></div></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">方括号执行了一个嵌套命令. 例如, 如果你想传递一个命令的结果作为另外一个命令的参数, 那么你使用这个符号</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">[cmd arg]</span></div></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">双引号把词组标记为命令的一个参数. &quot;$&quot;符号和方括号在双引号内仍被解释</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">&quot;some stuff&quot;</span></div></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">大括号也把词组标记为命令的一个参数. 但是, 其他符号在大括号内不被解释</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">{some stuff}</span></div></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">反斜线符号是用来引用特殊符号. 例如：\n 代表换行. 反斜线符号也被用来关闭&quot;$&quot;符号, 引号,方括号和大括号的特殊含义</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expect使用实例</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">1。首先确认expect的包要安置。</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">#rpm -qa | grep expect</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">如果没有则需要下载安装，</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">#yum install expect</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">2.安装完成后，查看expect的路径，可以用</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">#which expect</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">/usr/bin/expect</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">3.编辑脚本</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">#vi autosu.sh</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">添加如下内容</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">#!/usr/bin/expect -f //这个expect的路径就是用which expect 查看的结果</span></div></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">spawn su - nginx //切换用户</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expect &quot;password:&quot; //提示让输入密码</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">send &quot;test\r&quot; //输入nginx的密码</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">interact //操作完成</span></div></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">4.确定脚本有可执行权限</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">chmod +x autosu.sh</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">5.执行脚本 expect autosu.sh 或 ./autosu.sh</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expect常用脚本</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">登陆到远程服务器</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">#!/usr/bin/expect</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">set timeout 5</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">set server [lindex $argv 0]</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">set user [lindex $argv 1]</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">set passwd [lindex $argv 2]</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">spawn ssh -l $user $server</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">expect {</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">    &quot;(yes/no)&quot; </span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">    { </span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">        send &quot;yes\r&quot;; </span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">        exp_continue</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">    }</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">    &quot;password:&quot;</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">    {</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">        send &quot;$passwd\r&quot;</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">    }</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">}</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">expect &quot;*Last login*&quot;</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;">interact</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;"><br/></span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; font-size: 13px; line-height: 1.5em;"><br/></span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">scp拷贝文件</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">#!/usr/bin/expect</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">set timeout 10</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">set host [lindex $argv 0]        //第1个参数，其它2,3,4参数类似</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">set username [lindex $argv 1]</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">set password [lindex $argv 2]</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">set src_file [lindex $argv 3]</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">set dest_file [lindex $argv 4]</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">spawn scp $src_file</span> <a href="http://www.programgo.com/article/5591491550/mailto:$username@$host:$dest_file" style="font-size: 13px; font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em; color: rgb(36, 124, 164); text-decoration: none;" target="_blank">$username@$host:$dest_file</a></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expece</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">{</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">    &quot;(yes/no)?&quot;</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">    {</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">        send &quot;yes\n&quot;</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">        expect &quot;*assword:&quot;</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">        {</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">            send &quot;$password\n&quot;</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">        }</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">    }</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">    &quot;*assword:&quot;</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">    {</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">        send &quot;$password\n&quot;</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">    }</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">}</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expect &quot;100%&quot;</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">expect eof</span></div><div style="margin: 0px; padding: 0px 0px 10px;"><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">使用方法</span></div><div><span style="font-size: 13px; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">./expect_scp 192.168.75.130 root 123456 /root/src_file /root/dest_file</span></div><div><span style="font-size: 13px; color: rgb(102, 102, 102); font-family: SimSun, 宋体, 'Arial Narrow'; line-height: 1.5em;">以上的命令执行后，将把本地/root目录下的src_file文件拷贝到用户名为root，密码为123456的主机192.168.75.130中的/root下，同时还将这个源文件重命名为dest_file</span></div></div></div><div style="font-size: 13px; text-align: center;"></div></div></div></div></div><div><br/></div><div><br/></div><div><span style="font-size: 9pt;">#!/bin/sh</span></div><div><span style="font-size: 9pt;">echo &quot;--------------------flushall_all_redis init--------------------&quot;</span></div><div><span style="font-size: 9pt;">Server09=(&quot;root1&quot; &quot;root1_pwd&quot;)</span></div><div><span style="font-size: 9pt;">Server10=(&quot;root2&quot; &quot;root2_pwd&quot;)</span></div><div><span style="font-size: 9pt;">function exe()</span></div><div><span style="font-size: 9pt;">{</span></div><div><span style="font-size: 9pt;">expect -c &quot;</span></div><div><span style="font-size: 9pt;">    $1</span></div><div><span style="font-size: 9pt;">    set timeout 300</span></div><div><span style="font-size: 9pt;">    expect {</span></div><div><span style="font-size: 9pt;">        \&quot;*(yes/no)?\&quot;</span></div><div><span style="font-size: 9pt;">         {</span></div><div><span style="font-size: 9pt;">            send \&quot;yes\n\&quot;</span></div><div><span style="font-size: 9pt;">            expect \&quot;*assword:\&quot; {</span></div><div><span style="font-size: 9pt;">                send \&quot;$2\n\&quot;</span></div><div><span style="font-size: 9pt;">            }</span></div><div><span style="font-size: 9pt;">        }</span></div><div><span style="font-size: 9pt;">        \&quot;*password:\&quot;</span></div><div><span style="font-size: 9pt;">        {</span></div><div><span style="font-size: 9pt;">            send \&quot;$2\n\&quot;</span></div><div><span style="font-size: 9pt;">        }</span></div><div><span style="font-size: 9pt;">    }</span></div><div><span style="font-size: 9pt;">        expect eof</span></div><div><span style="font-size: 9pt;">&quot;</span></div><div><span style="font-size: 9pt;">}</span></div><div><span style="font-size: 9pt;">echo &quot;&quot;</span></div><div><span style="font-size: 9pt;">echo &quot;--------------------start reflush redis from 10.175.23.9--------------------&quot;</span></div><div><span style="font-size: 9pt;">exe &quot;spawn ssh -l ${Server09[0]} 10.175.23.9 \&quot;/home/weihu/bin/flushall_redis.sh\&quot;&quot; &quot;${Server09[1]}&quot;</span></div><div><span style="font-size: 9pt;">echo &quot;&quot;</span></div><div><span style="font-size: 9pt;">echo &quot;--------------------start reflush redis from 10.175.23.10--------------------&quot;</span></div><div><span style="font-size: 9pt;">exe &quot;spawn ssh -l ${Server10[0]} 10.175.23.10 \&quot;/home/weihu/bin/flushall_redis.sh\&quot;&quot; &quot;${Server10[1]}&quot;</span></div></span>
</div></body></html> 