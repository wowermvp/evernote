<html>
<head>
  <title>常用SQL技巧</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="573"/>
<h1>常用SQL技巧</h1>

<div>
<span><div><font style="font-size: 10pt;">巧用RAND()提取随机行</font></div><div>    在mysql中，产生随机数的方法是RAND()函数。可以利用这个函数与order by子句一起完成随机抽取某些行的功能，它的原理其实就是order by RAND()能够把数据随机排序。</div><div>mysql&gt; select * from sale2 order by rand() limit 5;</div><div><br/></div><div><font style="font-size: 10pt;">利用GROUP BY的WITH ROLLUP子句做统计</font></div><div>在SQL语句中，使用group by的with rollup字句可以检索出更多的分组聚合信息，它不仅仅能像一般group by语句那样检索出各组的聚合作息，还能检索出本组类的整体聚合信息，如下例：</div><div>(1)创建表sales并初始化数据：</div><div>mysql&gt;create table sales(year int not null,country varchar(20) not null,product varchar(32) not null,profit int);</div><div>insert into sales values(2004,'china','tnt1',2001);</div><div>insert into sales values(2004,'china','tnt2',2002);</div><div><span style="font-size: 9pt;">insert into sales values(2004,'china','tnt3',2003);</span></div><div><span style="font-size: 9pt;">insert into sales values(2005,'china','tnt1',2004);</span></div><div><span style="font-size: 9pt;">insert into sales values(2005,'china','tnt2',2005);</span></div><div><span style="font-size: 9pt;">insert into sales values(2005,'china','tnt3',2006);</span></div><div><span style="font-size: 9pt;">insert into sales values(2005,'china','tnt1',2007);</span></div><div><span style="font-size: 9pt;">insert into sales values(2005,'china','tnt2',2008);</span></div><div><span style="font-size: 9pt;">insert into sales values(2005,'china','tnt3',2009);</span></div><div><span style="font-size: 9pt;">insert into sales values(2006,'china','tnt1',2010);</span></div><div><span style="font-size: 9pt;">insert into sales values(2006,'china','tnt2',2011);</span></div><div><span style="font-size: 9pt;">insert into sales values(2006,'china','tnt3',2012);</span></div><div><span style="font-size: 9pt;">(2)按照year、country、product列分组对profit列进行聚合计算如下：</span></div><div><span style="font-size: 9pt;">mysql&gt;select year,country,product,sum(profit) from sales group by year, country, product;</span></div><div><span style="font-size: 9pt;">+-------+----------+----------+-------------+</span></div><div><span style="font-size: 9pt;">| year  | country  | product  | sum(profit) |</span></div><div><span style="font-size: 9pt;">+-------+----------+----------+-------------+</span></div><div><span style="font-size: 9pt;">| 2004  | china    | tnt1     | 2001        |</span></div><div><span style="font-size: 9pt;">| 2004  | china    | tnt2     | 2002        |</span></div><div><span style="font-size: 9pt;">| 2004  | china    | tnt3     | 2003        |</span></div><div><span style="font-size: 9pt;">| 2005  | china    | tnt1     | 4011        |</span></div><div><span style="font-size: 9pt;">| 2005  | china    | tnt2     | 4013        |</span></div><div><span style="font-size: 9pt;">| 2005  | china    | tnt3     | 4015        |</span></div><div><span style="font-size: 9pt;">| 2006  | china    | tnt1     | 2010        |</span></div><div><span style="font-size: 9pt;">| 2006  | china    | tnt2     | 2011        |</span></div><div><span style="font-size: 9pt;">| 2006  | china    | tnt3     | 2012        |</span></div><div><span style="font-size: 9pt;">+-------+----------+----------+-------------+</span></div><div><br/></div><div><span style="font-size: 9pt;">mysql&gt;select year,country,product,sum(profit) from sales group by year, country, product with rollup;</span></div><div><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">+-------+----------+----------+-------------+</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| year  | country  | product  | sum(profit) |</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">+-------+----------+----------+-------------+</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2004  | china    | tnt1     | 2001        |</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2004  | china    | tnt2     | 2002        |</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2004  | china    | tnt3     | 2003        |</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2004  | china    |          | 6006        |</span></span></div></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2004  |          |          | 6006        |</span></span></span></div></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2005  | china    | tnt1     | 4011        |</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2005  | china    | tnt2     | 4013        |</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2005  | china    | tnt3     | 4015        |</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2005  | china    |          | 12039       |</span></span></div></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2005  |          |          | 12039       |</span></span></span></div></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2006  | china    | tnt1     | 2010        |</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2006  | china    | tnt2     | 2011        |</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2006  | china    | tnt3     | 2012        |</span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2006  | china    |          | 6033        |</span></span></div></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| 2006  |          |          | 6033        |</span></span></span></div></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: medium; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">| NULL  |          |          | 24078       |</span></span></span></span></div></div><div><span style="box-sizing: border-box; font-size: 9pt; letter-spacing: normal; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 宋体; font-variant: normal; line-height: 14.399999618530273px;">+-------+----------+----------+-------------+</span></div><div><br/></div><div><span style="line-height: 13.600000381469727px;">从上面例子可以看到第2个SQL语句的结果比第一个SQL语句的结果多出了很多行，而这些行反映出了更多的信息，例如，第2个SQL语句的结果前3行表示2004年在中国各个产品（tnt1、tnt2、tnt3）的利润，而第4行表示2004年在中国所有产品的利润是6006，这个信息在第一个SQL语句中是不能反映出来的，第5行表示2004年全世界所有产品的利润是6006（当然这里country字段只有china）。</span></div><div><span style="line-height: 13.600000381469727px;">其实with rollup反映的是一种OLAP思想，也就是说这一个group by语句执行完成后可以满足用户想要得到的任何一个分组以及分组组合的聚合信息值。</span></div><div><span style="line-height: 13.600000381469727px;">注意：1、当使用rollup时，不能同时使用order by子句进行结果排序。换言之，rollup和order by是互相排斥的。</span></div><div><span style="line-height: 13.600000381469727px;">      2、LIMIT用在ROLLUP后面</span></div><div><br/></div><div>用BIT GROUP FUNCTIONS做统计</div><div>......</div><div><br/></div><div>数据库名、表名大小写问题</div><div><span>    </span>在MySQL中，所使用的操作系统的大小写敏感性决定了数据库名和表名的大小写敏感性。由于大多数UNIX操作系统对大小写敏感导致了数据库名和表名对大小写的敏感性，由于 Windows系统本身对大小写不敏感，因此Windows下MySQL数据库名和表名对大小写也不敏感。</div><div><span>    在MySQL中如何在硬盘上保存、使用表名和数据库名由lower_case_table_name系统变量决定，可以在启动mysqld时设置这个系统变量。lower_case_table_name取值范围如下：</span><br/></div><div><div><span><br/></span></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 521px;"></col></colgroup><tbody><tr><td style="vertical-align: middle; width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);"><div>值</div></td><td style="vertical-align: middle; width: 521px; padding: 8px; border: 1px solid rgb(204, 204, 204);"><div>含义</div></td></tr><tr><td style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);"><div>0</div></td><td style="width: 521px; padding: 8px; border: 1px solid rgb(204, 204, 204);"><div>使用CREATE TABLE或CREATE DATABASE语句指定的大写和小写在硬盘上保存表名和数据库名。名称对大小写敏感。在UNIX系统中的默认设置就是这个值。</div></td></tr><tr><td style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);"><div>1</div></td><td style="width: 521px; padding: 8px; border: 1px solid rgb(204, 204, 204);"><div>表名在硬盘上以小写保存，名称对大小写敏感。MySQL将所有表名转换为小写以便存储和查找。该值为Windows和Mac OS X系统中的默认值。</div></td></tr><tr><td style="width: 130px; padding: 8px; border: 1px solid rgb(204, 204, 204);"><div>2</div></td><td style="width: 521px; padding: 8px; border: 1px solid rgb(204, 204, 204);"><div>表名和数据库名在硬盘上使用CREATE TABLE或CREATE DATABASE语句指定的大小写进行保存，但MySQL将它们转换成小写以便查找。此值只在对大小写不敏感的文件系统上适用。</div></td></tr></tbody></table><div><span><br/></span></div><div><span>注意：1、在UNIX中将lower_case_table_name设置为1并且重启mysqld之前，必须先将旧的数据库名和表名转换为小写。</span></div><div><span>      2、尽管在某些平台中数据库名和表名对大小写不敏感，但是最好养成在同一查询中使用相同大小写来引用给定的数据库名或表名的习惯。</span></div></div></span>
</div></body></html> 