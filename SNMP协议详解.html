<html>
<head>
  <title>SNMP协议详解</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1801"/>
<h1>SNMP协议详解</h1>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="background-color: rgb(255, 255, 255);"><div style="text-align: left;margin-bottom: 21px;"><strong style="color: rgb(85, 85, 85); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 12.7272720336914px; line-height: 20.9090900421143px; text-align: start; widows: 1;">          简单网络管理协议（SNMP）</strong><span style="color: rgb(85, 85, 85); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 12.7272720336914px; line-height: 20.9090900421143px; text-align: start; widows: 1;">是TCP/IP协议簇的一个应用层协议。在1988年被制定，并被Internet体系结构委员会（IAB）采纳作为一个短期的网络管理解决方案；由于SNMP的简单性，在Internet时代得到了蓬勃的发展，1992年发布了SNMPv2版本，以增强SNMPv1的安全性和功能。现在，已经有了SNMPv3版本。</span></div><div style="text-align: left;margin-bottom: 21px;"><span style="color: rgb(85, 85, 85); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in;">          一套完整的SNMP系统主要包括管理信息库（MIB）、管理信息结构（SMI）及SNMP报文协议。</span></div><div style="margin: 35px 0px; color: rgb(85, 85, 85);"><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">（1）管理信息库MIB：任何一个被管理的资源都表示成一个对象，称为被管理的对象。MIB是被管理对象的集合。它定义了被管理对象的一系列属性：对象的名称、对象的访问权限和对象的数据类型等。每个<strong>SNMP</strong>设备（Agent）都有自己的MIB。MIB也可以看作是NMS（网管系统）和Agent之间的沟通桥梁。它们之间的关系如图1所示。</p><p style="margin: 10px auto; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"> <img src="SNMP协议详解_files/SouthEast.png" type="image/png" data-filename="SouthEast.png" height="148" style="border:none;max-width:602px;height:auto;cursor: default;cursor: default;" width="478"/></p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><br/></p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">　　　　　　图1 NMS Agent和MIB的关系</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><br/></p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 0.31in; text-indent: 0.32in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">MIB文件中的变量使用的名字取自ISO和ITU管理的对象标识符（object identifier）名字空间。它是一种分级树的结构。如图2所示，第一级有三个节点：ccitt、iso、iso-ccitt。低级的对象ID分别由相关组织分配。一个特定对象的标识符可通过由根到该对象的路径获得。一般网络设备取iso节点下的对象内容。如名字空间ip结点下一个名字为ipInReceives的MIB变量被指派数字值3，因而该变量的名字为：</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 0.31in; text-indent: 0.32in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">      iso.org.dod.internet.mgmt.mib.ip.ipInReceives</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 0.31in; text-indent: 0.32in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">相应的数字表示（对象标识符OID，唯一标识一个MIB对象）为：</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">1.3.6.1.2.1.4.3</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><img src="SNMP协议详解_files/SouthEast [1].png" type="image/png" data-filename="SouthEast.png" alt="snmps树" height="336" style="border:none;max-width:602px;height:auto;cursor: default;cursor: default;" width="602"/><br/></p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">　　　　　　　　　　　　　　　　　　　　　　　图2 MIB树结构</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 0.31in; text-indent: 0.27in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">当网络管理协议在报文中使用MIB变量时，每个变量名后还要加一个后缀，以作为该变量的一个实例。如ipInReceives的实例数字表示为：1.3.6.1.2.1.4.3.0.</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.27in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">需要注意的是，MIB中的管理对象的OID有些需要动态确定，如IP路由表，为了指明地址202.120.86.71的下一站路由(next hop)，我们可以引用这样的实例：</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 0.31in; text-indent: 0.27in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">iso.org.dod.internet.mgmt.mib.ip. ipRouteTable.ipRouteEntry.ipRouteNextHop.202.120.86.71, 相应的数字表示为：1.3.6.1.2.1.4.21.1.7.202.120.86.71</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 0.31in; text-indent: 0.27in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">对于这种动态对象标识的实例，由于无法转换为预先指定的Readkey名称，与飞邻的产品架构冲突（需要动态生成可变Readkey），暂不考虑支持。</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><br/></p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">（2）管理信息结构（SMI）</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">SMI定义了SNMP框架所用信息的组织、组成和标识，它还为描述MIB对象和描述协议怎样交换信息奠定了基础。</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">SMI定义的数据类型：</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">◆ 简单类型（simple）</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">Integer：整型是-2,147,483,648~2,147,483,647的有符号整数</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">octet string: 字符串是0~65535个字节的有序序列</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">OBJECT IDENTIFIER: 来自按照ASN.1规则分配的对象标识符集</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">◆    简单结构类型（simple-constructed）</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.36in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">SEQUENCE 用于列表。这一数据类型与大多数程序设计语言中的“structure”类似。一个SEQUENCE包括0个或更多元素，每一个元素又是另一个ASN.1数据类型</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"> SEQUENCE OF type 用于表格。这一数据类型与大多数程序设计语言中的“array”类似。一个表格包括0个或更多元素，每一个元素又是另一个ASN.1数据类型。</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">◆    应用类型（application-wide）</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">IpAddress: 以网络序表示的IP地址。因为它是一个32位的值，所以定义为4个字节；</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">counter：计数器是一个非负的整数，它递增至最大值，而后回零。在SNMPv1中定义的计数器是32位的，即最大值为4，294，967，295；</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">Gauge ：也是一个非负整数，它可以递增或递减，但达到最大值时保持在最大值，最大值为232-1；</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">time ticks：是一个时间单位，表示以0.01秒为单位计算的时间；</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><br/></p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><span style="font-family:Verdana,Geneva,Arial,Helvetica,sans-serif;font-size:12.727272033691406px;line-height:20.909090042114258px;"><span style="font-weight:normal;">SNMP</span><span style="font-weight:normal;">报文</span></span></p><p style="margin: 10px auto 0in 0.31in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">SNMP报文结构如下：（编码之前）</p><center style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 12.727272033691406px; line-height: 20.909090042114258px;"><table cellpadding="7" cellspacing="0" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border:1px solid rgb(192,192,192);border-collapse:collapse;" width="373"><colgroup><col width="357"></col></colgroup><tbody><tr><td style="border:1px solid rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" valign="top" width="357"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">版本号</p></td></tr><tr><td style="border:1px solid rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" valign="top" width="357"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">团体名</p></td></tr><tr><td style="border:1px solid rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" valign="top" width="357"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">协议数据单元PDU</p></td></tr></tbody></table></center><p style="margin: 10px auto 0in 0.32in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">SNMP共有5种报文，所以其PDU也有5中，第七点会详细介绍<strong>SNMP的5种协议数据单元。</strong></p><h3 style="line-height: 35px; margin: 0px; padding: 0px; font-size: 1.2em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><a name="t0" style="text-decoration:none;color:rgb(12, 137, 207);"></a> <strong><span style="font-weight:normal;">1 </span>SNMP的5种协议数据单元</strong></h3><p style="margin: 10px auto 0in 0.32in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">SNMP规定了5种协议数据单元PDU（也就是SNMP报文），用来在管理进程和代理之间的交换。</p><p style="margin: 10px auto 0in 0.32in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">get-request操作：从代理进程处提取一个或多个参数值。</p><p style="margin: 10px auto 0in 0.32in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">get-next-request操作：从代理进程处提取紧跟当前参数值的下一个参数值。</p><p style="margin: 10px auto 0in 0.32in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">set-request操作：设置代理进程的一个或多个参数值。</p><p style="margin: 10px auto 0in 0.32in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">get-response操作：返回的一个或多个参数值。这个操作是由代理进程发出的，它是前面三种操作的响应操作。trap操作：代理进程主动发出的报文，通知管理进程有某些事情发生。<br/>
前面的3种操作是由管理进程向代理进程发出的，后面的2个操作是代理进程发给管理进程的，为了简化起见，前面3个操作今后叫做get、get-next和set操作。图1描述了SNMP的这5种报文操作。请注意，在代理进程端是用熟知端口161俩接收get或set报文，而在管理进程端是用熟知端口162来接收trap报文。</p><p align="center" style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><img src="SNMP协议详解_files/SouthEast [2].png" type="image/png" data-filename="SouthEast.png" alt="snmp报文转发流程" height="230" style="border:none;max-width:602px;height:auto;cursor: default;cursor: default;" width="435"/><br/></p><p align="center" style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">图1 SNMP的5种报文操作</p><p style="margin: 10px auto 0in 0.31in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">图2是封装成UDP数据报的5种操作的SNMP报文格式。可见一个SNMP报文共有三个部分组成，即公共SNMP首部、get/set首部、trap首部、变量绑定。</p><p align="center" style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><img src="SNMP协议详解_files/SouthEast [3].png" type="image/png" data-filename="SouthEast.png" alt="snmp报文格式PDU" height="383" style="border:none;max-width:602px;height:auto;cursor: default;cursor: default;" width="547"/><br/></p><p style="margin: 10px auto 0in 0.65in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; text-indent: -0.07in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">（1）公共SNMP首部<br/>
共三个字段：<br/>
 版本 <br/>
写入版本字段的是版本号减1，对于SNMP（即SNMPV1）则应写入0。<br/>
 共同体（community）<br/>
共同体就是一个字符串，作为管理进程和代理进程之间的明文口令，常用的是6个字符“public”。<br/>
 PDU类型<br/>
根据PDU的类型，填入0～4中的一个数字，其对应关系如表2所示意图。</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; text-indent: 0.44in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">表2 PDU类型</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><br/></p><dl style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 12.727272033691406px; line-height: 20.909090042114258px;"></dl><p style="margin: 10px auto 0in 0.47in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">（2）get/set首部<br/>
 请求标识符(request ID)<br/>
这是由管理进程设置的一个整数值。代理进程在发送get-response报文时也要返回此请求标识符。管理进程可同时向许多代理发出get报文，这些报文都使用UDP传送，先发送的有可能后到达。设置了请求标识符可使管理进程能够识别返回的响应报文对于哪一个请求报文<br/>
 差错状态（error status）<br/>
由代理进程回答时填入0～5中的一个数字，见表3的描述</p><p style="margin: 10px auto 0in 0.47in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">表3 差错状态描述</p><center style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 12.727272033691406px; line-height: 20.909090042114258px;"><table cellpadding="7" cellspacing="1" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border:1px solid rgb(192,192,192);border-collapse:collapse;" width="428"><colgroup><col width="61"></col><col width="83"></col><col width="236"></col></colgroup><tbody><tr><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:double none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="61"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;text-transform:uppercase;">差错状态</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:double none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="83"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;text-transform:uppercase;">名字</p></td><td style="border-width:1px;border-style:double double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="236"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;text-transform:uppercase;">说明</p></td></tr><tr><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="61"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">0</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="83"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">noError</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="236"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">一切正常</p></td></tr><tr><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="61"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">1</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="83"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">tooBig</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="236"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">代理无法将回答装入到一个SNMP报文之中</p></td></tr><tr><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="61"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">2</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="83"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">noSuchName</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="236"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">操作指明了一个不存在的变量</p></td></tr><tr><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="61"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">3</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="83"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">badValue</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="236"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">一个set操作指明了一个无效值或无效语法</p></td></tr><tr><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="61"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">4</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="83"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">readOnly</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="236"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">管理进程试图修改一个只读变量</p></td></tr><tr><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none double double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="61"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">5</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none double solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="83"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">genErr</p></td><td style="border-width:1px;border-style:solid double double solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="236"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">某些其他的差错</p></td></tr></tbody></table></center><p style="margin: 10px auto 0in 0.49in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"> 差错索引(error index)<br/>
当出现noSuchName、badValue或readOnly的差错时，由代理进程在回答时设置的一个整数，它指明有差错的变量在变量列表中的偏移。<br/>
（3）trap首部<br/>
 企业（enterprise）<br/>
填入trap报文的网络设备的对象标识符。此对象标识符肯定是在图3的对象命名树上的enterprise结点{1.3.6.1.4.1}下面的一棵子树上。<br/>
 trap类型</p><p style="margin: 10px auto 0in 0.5in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">此字段正式的名称是generic-trap，共分为表4中的7种。</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><br/></p><center style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 12.727272033691406px; line-height: 20.909090042114258px;"><table cellpadding="7" cellspacing="1" dir="ltr" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border:1px solid rgb(192,192,192);border-collapse:collapse;" width="561"><colgroup><col width="75"></col><col width="146"></col><col width="292"></col></colgroup><tbody><tr valign="top"><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:double none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="75"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">trap类型</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:double none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="146"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;text-transform:uppercase;">名字</p></td><td style="border-width:1px;border-style:double double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="292"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;text-transform:uppercase;">说明</p></td></tr><tr valign="top"><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="75"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">0</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="146"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">coldStart</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="292"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">代理进行了初始化</p></td></tr><tr valign="top"><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="75"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">1</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="146"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">warmStart</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="292"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">代理进行了重新初始化</p></td></tr><tr valign="top"><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="75"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">2</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="146"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">linkDown</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="292"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">一个接口从工作状态变为故障状态</p></td></tr><tr valign="top"><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="75"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">3</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="146"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">linkUp</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="292"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">一个接口从故障状态变为工作状态</p></td></tr><tr valign="top"><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="75"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">4</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="146"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">authenticationFailure</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="292"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">从SNMP管理进程接收到具有一个无效共同体的报文</p></td></tr><tr valign="top"><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="75"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">5</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none solid solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="146"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">egpNeighborLoss</p></td><td style="border-width:1px;border-style:solid double solid solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="292"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">一个EGP相邻路由器变为故障状态</p></td></tr><tr valign="top"><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none double double;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="75"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">6</p></td><td style="border-top-width:1px;border-bottom-width:1px;border-left-width:1px;border-style:solid none double solid;border-top-color:rgb(0,0,0);border-bottom-color:rgb(0,0,0);border-left-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0in 0in 0.08in;word-break:normal!important;" width="146"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">enterpriseSpecific</p></td><td style="border-width:1px;border-style:solid double double solid;border-color:rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" width="292"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">代理自定义的事件，需要用后面的“特定代码”来指明</p></td></tr></tbody></table></center><br style="font-family:Verdana,Geneva,Arial,Helvetica,sans-serif;font-size:12.727272033691406px;line-height:20.909090042114258px;"/><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"></p><p style="margin: 10px auto 0in 0.5in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">当使用上述类型2、3、5时，在报文后面变量部分的第一个变量应标识响应的接口。<br/>
 特定代码(specific-code)<br/>
指明代理自定义的时间（若trap类型为6），否则为0。<br/>
 时间戳(timestamp)<br/>
指明自代理进程初始化到trap报告的事件发生所经历的时间，单位为10ms。例如时间戳为1908表明在代理初始化后1908ms发生了该时间。<br/>
（4）变量绑定(variable-bindings)<br/>
指明一个或多个变量的名和对应的值。在get或get-next报文中，变量的值应忽略。</p><p style="margin: 10px auto; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"> </p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 20.909090042114258px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><strong>管理变量的表示</strong></p><p style="margin: 10px auto 0in 0.34in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">管理变量表示管理对象类型在某一时刻的值（或称该类型的实例），<strong>SNMP</strong>以管理变量作为操作对象。</p><p style="margin: 10px auto 0in 0.34in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">管理变量的表示方法是这样规定的：形如x.y，其中x是管理对象的object identifer。y是能唯一确定对象类型值的一组数字，在非表型变量中为0，在表型变量中是这个表的索引，比如接口表中的接口号，或路由表中的目的网络地址等等 。如：在MIB文件里定义了ipAdEntNetMask这一管理对象，其object identifier为1.3.6.1.1.5.6.1.3它是个路由表中的一项，它的一个实例就是路由表中某一行的子网掩码，如果这行的索引、目的网络地址为129.102.1.0。则这个变量名是：1.3.6.1.1.5.6.1.3.129.102.1.0。在以后的说明中，为了方便，把唯一确定管理变量的一组数字，也就是x.y中的y称作实例。</p><h2 style="margin: 10px 0px 0px; padding: 0px; font-size: 1em; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; line-height: 20.909090042114258px;"><a name="t1" style="text-decoration:none;color:rgb(12, 137, 207);"></a> <a name="__RefHeading__28597_857369842" style="text-decoration:none;color:rgb(12, 137, 207);" target="_blank"></a>SNMP的运行过程</h2><p style="margin: 10px auto 0in 0.31in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">驻留在被管设备上的AGENT从UDP端口161接受来自网管站的串行化报文，经解码、团体名验证、分析得到管理变量在MIB树中对应的节点，从相应的模块中得到管理变量的值，再形成响应报文，编码发送回网管站。网管站得到响应报文后，再经同样的处理，最终显示结果。</p><p style="margin: 10px auto 0in 0.31in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">下面根据RFC1157详细介绍Agent接受到报文后采取的动作：</p><p style="margin: 10px auto 0in 0.31in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">首先解码生成用内部数据结构表示的报文，解码依据ASN.1的基本编码规则，如果在此过程中出现错误导致解码失败则丢弃该报文，不做进一步处理。</p><p style="margin: 10px auto 0in 0.31in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">第二步：将报文中的版本号取出，如果与本Agent支持的SNMP版本不一致，则丢弃该报文，不做进一步处理。当前北研的数据通信产品只支持SNMP版本1。</p><p style="margin: 10px auto 0in 0.31in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">第三步：将报文中的团体名取出，此团体名由发出请求的网管站填写。如与本设备认可的团体名不符，则丢弃该报文，不做进一步处理，同时产生一个陷阱报文。SNMPv1只提供了较弱的安全措施，在版本3中这一功能将大大加强。</p><p style="margin: 10px auto 0in 0.31in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">第四步：从通过验证的ASN.1对象中提出协议数据单元PDU，如果失败，丢弃报文，不做进一不处理。否则处理PDU，结果将产生一个报文，该报文的发送目的地址应同收到报文的源地址一致。</p><p style="margin: 10px auto 0in 0.31in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">根据不同的PDU，SNMP协议实体将做不同的处理：</p><h3 style="line-height: 35px; margin: 0px; padding: 0px; font-size: 1.2em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><a name="t2" style="text-decoration:none;color:rgb(12, 137, 207);"></a> <a name="__RefHeading__28599_857369842" style="text-decoration:none;color:rgb(12, 137, 207);" target="_blank"></a>1.1 GetRequest PDU</h3><p style="margin: 10px auto 0in 0.43in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">第一种情况：如果PDU中的变量名在本地维护的MIB树中不存在,则接受到这个PDU的协议实体将向发出者发送一个GetResponse报文，其中的PDU与源PDU只有一点不同：将ERROR-STATUS置为noSuchName,并在ERROR-INDEX中指出产生该变量在变量LIST中的位置。</p><p style="margin: 10px auto 0in 0.43in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">第二种情况：如果本地协议实体将产生的响应报文的长度大于本地长度限制，将向该PDU的发出者发送一个GetResponse报文，该PDU除了ERROR-STATUS置为tooBig，ERROR-INDEX置为0以外，与源PDU相同。</p><p style="margin: 10px auto 0in 0.43in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">第三种情况：如果本地协议实体因为其他原因不能产生正确的响应报文，将向该PDU的发出者发送一个GetResponse报文，该PDU除了ERROR-STATUS置为genErr，ERROR-INDEX置为出错变量在变量LIST中的位置，其余与源PDU相同。</p><p style="margin: 10px auto 0in 0.43in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">第四中情况：如果上面的情况都没有发生，则本地协议实体向该PDU的发出者发送一个GetResponse报文，该PDU中将包含变量名和相应值的对偶表，ERROR-STATUS为noError,ERROR-INDEX为0，request-id域的值应与收到PDU的request-id相同。</p><h3 style="line-height: 35px; margin: 0px; padding: 0px; font-size: 1.2em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><a name="t3" style="text-decoration:none;color:rgb(12, 137, 207);"></a> <a name="__RefHeading__28601_857369842" style="text-decoration:none;color:rgb(12, 137, 207);" target="_blank"></a>1.2 GetNextRequest PDU</h3><p style="margin: 10px auto 0in 0.41in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">GetNextRequest PDU的最重要的功能是表的遍历，这种操作受到了前面所说的管理变量的表示方法的支持，从而可以访问一组相关的变量，就好象他们在一个表内。</p><p style="margin: 10px auto 0in 0.41in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">下面通过一个例子解释表遍历的过程：</p><p style="margin: 10px auto 0in 0.41in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">被管设备维护如下路由表：</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">Destination NextHop Metric</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">10.0.0.99 89.1.1.42 5</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">9.1.2.3 99.0.0.3 3</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">10.0.0.51 89.1.1.42 5</p><p style="margin: 10px auto 0in 0.4in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">假设网管站欲取得这张路由表的信息，该表的索引是目的网络地址。</p><p style="margin: 10px auto 0in 0.4in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">网管站向被管设备发送一个GetNextRequest PDU,其中的受管对象的标识如下</p><p style="margin: 10px auto 0in 0.4in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">GetNextRequest ( ipRouteDest, ipRouteNextHop, ipRouteMetric1 )</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">SNMP agent响应如下GetResponse PDU:</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; text-indent: 0.29in; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">GetResponse (( ipRouteDest.9.1.2.3 = &quot;9.1.2.3&quot; ),</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">( ipRouteNextHop.9.1.2.3 = &quot;99.0.0.3&quot; ),</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">( ipRouteMetric1.9.1.2.3 = 3 ))</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">网管站继续：</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">GetNextRequest ( ipRouteDest.9.1.2.3,</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">ipRouteNextHop.9.1.2.3,</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">ipRouteMetric1.9.1.2.3 )</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">agent响应：</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">GetResponse (( ipRouteDest.10.0.0.51 = &quot;10.0.0.51&quot; ),</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">( ipRouteNextHop.10.0.0.51 = &quot;89.1.1.42&quot; ),</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">( ipRouteMetric1.10.0.0.51 = 5 ))</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">值得注意的是agent必须能够确定下一个管理变量名，以保证所有变量能被取到且只被取到一次。</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">网管站继续：</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">GetNextRequest ( ipRouteDest.10.0.0.51,</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">ipRouteNextHop.10.0.0.51,</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">ipRouteMetric1.10.0.0.51 )</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">agent 响应：</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">GetResponse (( ipRouteDest.10.0.0.99 = &quot;10.0.0.99&quot; ),</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">( ipRouteNextHop.10.0.0.99 = &quot;89.1.1.42&quot; ),</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; background-color: rgb(238, 238, 238);">( ipRouteMetric1.10.0.0.99 = 5 ))</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">网管站继续</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">GetNextRequest ( ipRouteDest.10.0.0.99,</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">ipRouteNextHop.10.0.0.99,</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">ipRouteMetric1.10.0.0.99 )</p><p style="margin: 10px auto 0in 0.29in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">这时因为路由表中所有的行都被取遍，agent因返回路由表对象的下一字典后继即该管理对象在MIB树中的后序遍历的直接后继。这里应是nettoMediaIndex，管理对象的OBJECT IDENTIFIER。这个响应通知网管站对表的遍历已经完成。</p><h3 style="line-height: 35px; margin: 0px; padding: 0px; font-size: 1.2em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><a name="t4" style="text-decoration:none;color:rgb(12, 137, 207);"></a> <a name="__RefHeading__28603_857369842" style="text-decoration:none;color:rgb(12, 137, 207);" target="_blank"></a>1.3 GetResponse PDU</h3><p style="margin: 10px auto 0in 0.29in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">GetResponse PDU只有当受到getRequest GetNextRequest SetRequest才由协议实体产生，网管站收到这个PDU后，应显示其结果。</p><h3 style="line-height: 35px; margin: 0px; padding: 0px; font-size: 1.2em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><a name="t5" style="text-decoration:none;color:rgb(12, 137, 207);"></a> <a name="__RefHeading__28605_857369842" style="text-decoration:none;color:rgb(12, 137, 207);" target="_blank"></a>1.4 SetRequest PDU</h3><p style="margin: 10px auto 0in 0.3in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">SetRequest PDU除了PDU类型标识以外，和GetRequest相同，当需要对被管变量进行写操作时，网管站侧的协议实体将生成该PDU。</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">对SetRequest的响应将根据下面情况分别处理：</p><p style="margin: 10px auto 0in 0.29in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">如果是关于一个只读变量的设置请求，则收到该PDU的协议实体产生一个GetReponse报文，并置error status为noSuchName, error index的值是错误变量在变量list中的位置。</p><p style="margin: 10px auto 0in 0.29in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; background-color: rgb(238, 238, 238);">如果被管设备上的协议实体收到的PDU中的变量对偶中的值，类型、长度不符和要求，则收到该PDU的协议实体产生一个GetReponse报文，并置error status为badValue, error index的值是错误变量在变量list中的位置。</p><p style="margin: 10px auto 0in 0.29in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">如果需要产生的GetReponse报文长度超过了本地限制，则收到该PDU的协议实体产生一个GetReponse报文，并置error status为tooBig, error index的值是0。</p><p style="margin: 10px auto 0in 0.29in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">如果是其他原因导致SET失败，则收到该PDU的协议实体产生一个GetReponse报文，并置error status为genErr, error index的值是错误变量在变量list中的位置。</p><p style="margin: 10px auto 0in 0.29in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">如果不符合上面任何情况，则agent将把管理变量设置收到的PDU中的相应值，这往往可以改变被管设备的运行状态。同时产生一个GetResponse PDU，其中error status置为noError,error index的值为0。</p><h3 style="line-height: 35px; margin: 0px; padding: 0px; font-size: 1.2em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><a name="t6" style="text-decoration:none;color:rgb(12, 137, 207);"></a> <a name="__RefHeading__28607_857369842" style="text-decoration:none;color:rgb(12, 137, 207);" target="_blank"></a>1.5 Trap PDU</h3><p style="margin: 10px auto 0in 0.29in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">Trap PDU的有如下的形式</p><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><br/></p><center style="font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 12.727272033691406px; line-height: 20.909090042114258px;"><table cellpadding="7" cellspacing="0" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border:1px solid rgb(192,192,192);border-collapse:collapse;" width="253"><colgroup><col width="237"></col></colgroup><tbody><tr><td style="border:1px solid rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" valign="top" width="237"><p style="margin:10px auto 0in;padding:0px;font-size:13px;line-height:1.8;">产生trap的系统的OBJECT IDENTIFIER</p><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;"><br/></p></td></tr><tr><td style="border:1px solid rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" valign="top" width="237"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">系统的IP地址</p></td></tr><tr><td style="border:1px solid rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" valign="top" width="237"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">普通类型</p></td></tr><tr><td style="border:1px solid rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" valign="top" width="237"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">特定类型</p></td></tr><tr><td style="border:1px solid rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" valign="top" width="237"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">时戳</p></td></tr><tr><td style="border:1px solid rgb(0,0,0);border-collapse:collapse;padding:0in 0.08in;word-break:normal!important;" valign="top" width="237"><p style="margin:10px auto;padding:0px;font-size:13px;line-height:1.8;">变量对偶表</p></td></tr></tbody></table></center><p style="margin: 10px auto 0in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;"><br/></p><p style="margin: 10px auto 0in 0.28in; padding: 0px; font-size: 12.727272033691406px; line-height: 19.09090805053711px; font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;">Trap是被管设备遇到紧急情况时主动向网管站发送的消息。网管站收到trap PDU后要将起变量对偶表中的内容显示出来。一些常用的trap类型有冷、热启动，链路状态发生变化等。</p></div></div></span>
</div></body></html> 