<html>
<head>
  <title>php-fpm的配置和优化 - 作业部落 Cmd Markdown 编辑阅读器</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1308"/>
<h1>php-fpm的配置和优化 - 作业部落 Cmd Markdown 编辑阅读器</h1>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px"><div style="font-size:100%;color:rgb(44, 62, 80);background-color:rgb(249, 249, 245);"><div style="font-family:&quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:14px;line-height:20px;color:rgb(44, 62, 80);background-color:rgb(249, 249, 245);"><div><div style="font-size:16px;line-height:27px;overflow:auto;overflow-x:hidden;font-family:&quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Helvetica Neue&quot;, &quot;Microsoft Yahei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;"><div></div>

<div></div>

<h1 style="margin:50px 0px 20px;font-family:inherit;font-weight:500;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-size:30px;">php-fpm的配置和优化</h1>

<p style="margin:0px 0px 20px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">php</code></p>

<hr style="margin:30px 0px;border-width:0px 0px 1px;border-top-style:solid;border-top-color:rgb(238, 238, 238);border-bottom-style:dashed;border-bottom-color:rgb(207, 207, 207);"/>

<p style="margin:0px 0px 20px;">我在前面几篇中，很详细的讲述了php-fpm的<a href="https://www.zybuluo.com/phper/note/50231" style="color:rgb(0, 136, 204);text-decoration:none;" target="_blank">各种介绍</a>，和<a href="https://www.zybuluo.com/phper/note/72879" style="color:rgb(0, 136, 204);text-decoration:none;" target="_blank">安装</a>。今天来看一下它的配置文件<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">php-fpm</code>的各种配置以及一些常见的优化。</p>

<div></div>

<h2 style="margin:35px 0px 20px;font-family:inherit;font-weight:500;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-size:26px;">php-fpm的安装目录</h2>

<p style="margin:0px 0px 20px;">下面是我的平时的环境搭建php的各种安装目录，大家的基本也差不多。</p>

<div></div>

<h3 style="margin:20px 0px;font-family:inherit;font-weight:500;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-size:21px;">centos等linux平台</h3>

<div></div>

<pre style="word-break:break-all;background:none 0px 0px repeat scroll rgba(102, 128, 153, 0.0470588);border-width:0px;color:rgb(51, 51, 51);border-radius:4px;border:1px solid rgba(0, 0, 0, 0.14902);white-space:pre-wrap;line-height:20px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;word-wrap:break-word;margin:0px 0px 20px;display:block;background-color:rgba(102, 128, 153, 0.0470588);box-shadow:rgba(255, 255, 255, 0.0980392) 0px 1px 2px inset, rgba(102, 128, 153, 0.0470588) 45px 0px 0px inset, rgba(102, 128, 153, 0.0470588) 0px 1px 0px;font-size:14px;padding:9.5px;"><ol style="padding:0px;margin:0px 0px 10px 25px;margin-top:0px;margin-bottom:0px;color:rgba(102, 128, 153, 0.4);margin-left:35px;"><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 136, 0);">/usr/</span><span style="color:rgb(0, 0, 136);">local</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">usr</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 136);">local</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">etc</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">ini</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">usr</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 136);">local</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">sbin</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 0, 0);">fpm</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">usr</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 136);">local</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">etc</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 0, 0);">fpm</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">conf</span></code></li></ol></pre>

<div></div>

<h3 style="margin:20px 0px;font-family:inherit;font-weight:500;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-size:21px;">mac平台</h3>

<div></div>

<pre style="word-break:break-all;background:none 0px 0px repeat scroll rgba(102, 128, 153, 0.0470588);border-width:0px;color:rgb(51, 51, 51);border-radius:4px;border:1px solid rgba(0, 0, 0, 0.14902);white-space:pre-wrap;line-height:20px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;word-wrap:break-word;margin:0px 0px 20px;display:block;background-color:rgba(102, 128, 153, 0.0470588);box-shadow:rgba(255, 255, 255, 0.0980392) 0px 1px 2px inset, rgba(102, 128, 153, 0.0470588) 45px 0px 0px inset, rgba(102, 128, 153, 0.0470588) 0px 1px 0px;font-size:14px;padding:9.5px;"><ol style="padding:0px;margin:0px 0px 10px 25px;margin-top:0px;margin-bottom:0px;color:rgba(102, 128, 153, 0.4);margin-left:35px;"><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 136, 0);">/usr/</span><span style="color:rgb(0, 0, 0);">bin</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">etc</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">ini</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">usr</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">bin</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 0, 0);">fpm</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">etc</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 0, 0);">fpm</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">conf</span></code></li></ol></pre>

<p style="margin:0px 0px 20px;">由于我开发以Mac为主，所以就用Mac的环境配置来学习。</p>

<div></div>

<h2 style="margin:35px 0px 20px;font-family:inherit;font-weight:500;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-size:26px;">php-fpm配置详解</h2>

<p style="margin:0px 0px 20px;">这是搜索的一份还算算比较详细的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">php-fpm.conf</code>配置详解，我会针对性的修改下，当然php手册上也有详细的讲解：<a href="http://php.net/manual/zh/install.fpm.configuration.php" style="color:rgb(0, 136, 204);text-decoration:none;" target="_blank">http://php.net/manual/zh/install.fpm.configuration.php</a></p>

<div></div>

<pre style="word-break:break-all;background:none 0px 0px repeat scroll rgba(102, 128, 153, 0.0470588);border-width:0px;color:rgb(51, 51, 51);border-radius:4px;border:1px solid rgba(0, 0, 0, 0.14902);white-space:pre-wrap;line-height:20px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;word-wrap:break-word;margin:0px 0px 20px;display:block;background-color:rgba(102, 128, 153, 0.0470588);box-shadow:rgba(255, 255, 255, 0.0980392) 0px 1px 2px inset, rgba(102, 128, 153, 0.0470588) 45px 0px 0px inset, rgba(102, 128, 153, 0.0470588) 0px 1px 0px;font-size:14px;padding:9.5px;"><ol style="padding:0px;margin:0px 0px 10px 25px;margin-top:0px;margin-bottom:0px;color:rgba(102, 128, 153, 0.4);margin-left:35px;"><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">pid </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">/usr/</span><span style="color:rgb(0, 0, 136);">local</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">run</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 0, 0);">fpm</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">pid</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#pid设置，一定要开启,上面是Mac平台的。默认在php安装目录中的var/run/php-fpm.pid。比如centos的在: /usr/local/php/var/run/php-fpm.pid</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">error_log  </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">/usr/</span><span style="color:rgb(0, 0, 136);">local</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">log</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 0, 0);">fpm</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">log</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#错误日志，上面是Mac平台的，默认在php安装目录中的var/log/php-fpm.log，比如centos的在: /usr/local/php/var/log/php-fpm.log</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">log_level </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> notice</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#错误级别. 上面的php-fpm.log纪录的登记。可用级别为: alert（必须立即处理）, error（错误情况）, warning（警告情况）, notice（一般重要信息）, debug（调试信息）. 默认: notice.</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">emergency_restart_threshold </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">60</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">emergency_restart_interval </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">60s</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#表示在emergency_restart_interval所设值内出现SIGSEGV或者SIGBUS错误的php-cgi进程数如果超过 emergency_restart_threshold个，php-fpm就会优雅重启。这两个选项一般保持默认值。0 表示 '关闭该功能'. 默认值: 0 (关闭).</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">process_control_timeout </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">0</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#设置子进程接受主进程复用信号的超时时间. 可用单位: s(秒), m(分), h(小时), 或者 d(天) 默认单位: s(秒). 默认值: 0.</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">daemonize </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> yes</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#后台执行fpm,默认值为yes，如果为了调试可以改为no。在FPM中，可以使用不同的设置来运行多个进程池。 这些设置可以针对每个进程池单独设置。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">listen </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">127.0</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 102, 102);">0.1</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">9000</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#fpm监听端口，即nginx中php处理的地址，一般默认值即可。可用格式为: 'ip:port', 'port', '/path/to/unix/socket'. 每个进程池都需要设置。如果nginx和php在不同的机器上，分布式处理，就设置ip这里就可以了。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">listen</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">backlog </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#backlog数，设置 listen 的半连接队列长度，-1表示无限制，由操作系统决定，此行注释掉就行。backlog含义参考：http://www.3gyou.cc/?p=41</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">listen</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">allowed_clients </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">127.0</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 102, 102);">0.1</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#允许访问FastCGI进程的IP白名单，设置any为不限制IP，如果要设置其他主机的nginx也能访问这台FPM进程，listen处要设置成本地可被访问的IP。默认值是any。每个地址是用逗号分隔. 如果没有设置或者为空，则允许任何服务器请求连接。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">listen</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">owner </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> www</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">listen</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 136);">group</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> www</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">listen</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">mode </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">0666</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#unix socket设置选项，如果使用tcp方式访问，这里注释即可。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">user </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> www</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 136);">group</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> www</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#启动进程的用户和用户组，FPM 进程运行的Unix用户, 必须要设置。用户组，如果没有设置，则默认用户的组被使用。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">pm </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">dynamic</span><span style="color:rgb(0, 0, 0);"> </span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#php-fpm进程启动模式，pm可以设置为static和dynamic和ondemand</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#如果选择static，则进程数就数固定的，由pm.max_children指定固定的子进程数。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#如果选择dynamic，则进程数是动态变化的,由以下参数决定：</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">pm</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">max_children </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">50</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(136, 0, 0);">#子进程最大数</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">pm</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">start_servers </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(136, 0, 0);">#启动时的进程数，默认值为: min_spare_servers + (max_spare_servers - min_spare_servers) / 2</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">pm</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">min_spare_servers </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(136, 0, 0);">#保证空闲进程数最小值，如果空闲进程小于此值，则创建新的子进程</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">pm</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">max_spare_servers </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">3</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(136, 0, 0);">#，保证空闲进程数最大值，如果空闲进程大于此值，此进行清理</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">pm</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">max_requests </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">500</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#设置每个子进程重生之前服务的请求数. 对于可能存在内存泄漏的第三方模块来说是非常有用的. 如果设置为 '0' 则一直接受请求. 等同于 PHP_FCGI_MAX_REQUESTS 环境变量. 默认值: 0.</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">pm</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">status_path </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">status</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#FPM状态页面的网址. 如果没有设置, 则无法访问状态页面. 默认值: none. munin监控会使用到</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">ping</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">path </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">ping</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#FPM监控页面的ping网址. 如果没有设置, 则无法访问ping页面. 该页面用于外部检测FPM是否存活并且可以响应请求. 请注意必须以斜线开头 (/)。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">ping</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">response </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> pong</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#用于定义ping请求的返回相应. 返回为 HTTP 200 的 text/plain 格式文本. 默认值: pong.</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">access</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">log </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> log</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">$pool</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">access</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">log</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#每一个请求的访问日志，默认是关闭的。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">access</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">format </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;%R - %u %t \&quot;%m %r%Q%q\&quot; %s %f %{mili}d %{kilo}M %C%%&quot;</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#设定访问日志的格式。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">slowlog </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> log</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">$pool</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">log</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">slow</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#慢请求的记录日志,配合request_slowlog_timeout使用，默认关闭</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">request_slowlog_timeout </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">10s</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#当一个请求该设置的超时时间后，就会将对应的PHP调用堆栈信息完整写入到慢日志中. 设置为 '0' 表示 'Off'</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">request_terminate_timeout </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">0</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#设置单个请求的超时中止时间. 该选项可能会对php.ini设置中的'max_execution_time'因为某些特殊原因没有中止运行的脚本有用. 设置为 '0' 表示 'Off'.当经常出现502错误时可以尝试更改此选项。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">rlimit_files </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">1024</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#设置文件打开描述符的rlimit限制. 默认值: 系统定义值默认可打开句柄是1024，可使用 ulimit -n查看，ulimit -n 2048修改。</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">rlimit_core </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">0</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#设置核心rlimit最大限制值. 可用值: 'unlimited' 、0或者正整数. 默认值: 系统定义值.</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">chroot </span><span style="color:rgb(102, 102, 0);">=</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#启动时的Chroot目录. 所定义的目录需要是绝对路径. 如果没有设置, 则chroot不被使用.</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">chdir </span><span style="color:rgb(102, 102, 0);">=</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#设置启动目录，启动时会自动Chdir到该目录. 所定义的目录需要是绝对路径. 默认值: 当前目录，或者/目录（chroot时）</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">catch_workers_output </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> yes</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(136, 0, 0);">#重定向运行过程中的stdout和stderr到主要的错误日志文件中. 如果没有设置, stdout 和 stderr 将会根据FastCGI的规则被重定向到 /dev/null . 默认值: 空.</span></code></li></ol></pre>

<p style="margin:0px 0px 20px;">当然还有一些无关紧要的设置，用到了再说吧。</p>

<div></div>

<h2 style="margin:35px 0px 20px;font-family:inherit;font-weight:500;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-size:26px;">一些重要的设置</h2>

<div></div>

<h3 style="margin:20px 0px;font-family:inherit;font-weight:500;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-size:21px;">php-fpm进程分配</h3>

<p style="margin:0px 0px 20px;">在之前的文章中就说过了。在fasgcgi模式下，php会启动多个php-fpm进程，来接收nginx发来的请求，那是不是进程越多，速度就越快呢？这可不一定！得根据我们的机器配置和业务量来决定。</p>

<p style="margin:0px 0px 20px;">我们先来看下，设定进程的配置在哪里？</p>

<pre style="line-height:20px;padding:10px 15px;border-width:0px;color:rgb(51, 51, 51);border-radius:4px;display:block;border:1px solid rgba(0, 0, 0, 0.14902);font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;word-break:break-all;word-wrap:break-word;white-space:pre-wrap;background:none 0px 0px repeat scroll rgba(102, 128, 153, 0.0470588);margin:0px 0px 20px;font-size:14px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;">pm = static | dynamic | ondemand
</code></pre>

<p style="margin:0px 0px 20px;">pm可以设置成这样3种，我们用的最多的就上前面2种。</p>

<div></div>

<h4 style="margin:10px 0px;font-family:inherit;font-weight:500;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-size:18px;">pm = static 模式</h4>

<p style="margin:0px 0px 20px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm = static</code> 表示我们创建的php-fpm子进程数量是固定的，那么就只有<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm.max_children = 50</code>这个参数生效。你启动php-fpm的时候就会一起全部启动51(1个主＋50个子)个进程，颇为壮观。</p>

<div></div>

<h4 style="margin:10px 0px;font-family:inherit;font-weight:500;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-size:18px;">pm = dynamic 模式</h4>

<p style="margin:0px 0px 20px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm = dynamic</code>模式，表示启动进程是动态分配的，随着请求量动态变化的。他由 <code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm.max_children</code>，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm.start_servers</code>，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm.min_spare_servers</code>，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm.max_spare_servers</code> 这几个参数共同决定。</p>

<p style="margin:0px 0px 20px;">上面已经讲过，这里再重申一下吧：</p>

<p style="margin:0px 0px 20px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm.max_children ＝ 50</code> 是最大可创建的子进程的数量。必须设置。这里表示最多只能50个子进程。</p>

<p style="margin:0px 0px 20px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm.start_servers = 20</code> 随着php-fpm一起启动时创建的子进程数目。默认值：min_spare_servers + (max_spare_servers - min_spare_servers) / 2。这里表示，一起启动会有20个子进程。</p>

<p style="margin:0px 0px 20px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm.min_spare_servers = 10</code> <br/>
设置服务器空闲时最小php-fpm进程数量。必须设置。如果空闲的时候，会检查如果少于10个，就会启动几个来补上。</p>

<p style="margin:0px 0px 20px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;color:rgb(44, 62, 80);border-radius:4px;white-space:nowrap;border:0px;background-color:rgb(214, 219, 223);font-size:14px;">pm.max_spare_servers = 30</code> <br/>
设置服务器空闲时最大php-fpm进程数量。必须设置。如果空闲时，会检查进程数，多于30个了，就会关闭几个，达到30个的状态。</p>

<div></div>

<h4 style="margin:10px 0px;font-family:inherit;font-weight:500;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-size:18px;">到底选择static还数dynamic?</h4>

<p style="margin:0px 0px 20px;">很多人恐惧症来袭，不知道选什么好？</p>

<p style="margin:0px 0px 20px;">一般原则是：动态适合小内存机器，灵活分配进程，省内存。静态适用于大内存机器，动态创建回收进程对服务器资源也是一种消耗。</p>

<p style="margin:0px 0px 20px;">如果你的内存很大，有8-20G，按照一个php-fpm进程20M算，100个就2G内存了，那就可以开启static模式。如果你的内存很小，比如才256M，那就要小心设置了，因为你的机器里面的其他的进程也算需要占用内存的，所以设置成dynamic是最好的，比如：pm.max_chindren = 8, 占用内存160M左右，而且可以随时变化，对于一半访问量的网站足够了。</p>

<div></div>

<h3 style="margin:20px 0px;font-family:inherit;font-weight:500;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-size:21px;">慢日志查询</h3>

<p style="margin:0px 0px 20px;">我们有时候会经常饱受500,502问题困扰。当nginx收到如上错误码时，可以确定后端php-fpm解析php出了某种问题，比如，执行错误，执行超时。</p>

<p style="margin:0px 0px 20px;">这个时候，我们是可以开启慢日志功能的。</p>

<pre style="line-height:20px;padding:10px 15px;border-width:0px;color:rgb(51, 51, 51);border-radius:4px;display:block;border:1px solid rgba(0, 0, 0, 0.14902);font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;word-break:break-all;word-wrap:break-word;white-space:pre-wrap;background:none 0px 0px repeat scroll rgba(102, 128, 153, 0.0470588);margin:0px 0px 20px;font-size:14px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;">slowlog = /usr/local/var/log/php-fpm.log.slow
request_slowlog_timeout = 15s
</code></pre>

<p style="margin:0px 0px 20px;">当一个请求该设置的超时时间15秒后，就会将对应的PHP调用堆栈信息完整写入到慢日志中。</p>

<p style="margin:0px 0px 20px;">php-fpm慢日志会记录下进程号，脚本名称，具体哪个文件哪行代码的哪个函数执行时间过长：</p>

<div></div>

<pre style="word-break:break-all;background:none 0px 0px repeat scroll rgba(102, 128, 153, 0.0470588);border-width:0px;color:rgb(51, 51, 51);border-radius:4px;border:1px solid rgba(0, 0, 0, 0.14902);white-space:pre-wrap;line-height:20px;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;word-wrap:break-word;margin:0px 0px 20px;display:block;background-color:rgba(102, 128, 153, 0.0470588);box-shadow:rgba(255, 255, 255, 0.0980392) 0px 1px 2px inset, rgba(102, 128, 153, 0.0470588) 45px 0px 0px inset, rgba(102, 128, 153, 0.0470588) 0px 1px 0px;font-size:14px;padding:9.5px;"><ol style="padding:0px;margin:0px 0px 10px 25px;margin-top:0px;margin-bottom:0px;color:rgba(102, 128, 153, 0.4);margin-left:35px;"><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 102, 102);">21</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(102, 0, 102);">Nov</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">2013</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">14</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">30</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">38</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 0, 0);">pool www</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);"> pid </span><span style="color:rgb(0, 102, 102);">11877</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(0, 0, 0);">script_filename </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">/usr/</span><span style="color:rgb(0, 0, 136);">local</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">lnmp</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">nginx</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">html</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">www</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">quancha</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">cn</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">www</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">fyzb</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">php</span></code></li><li style="padding-left:15px;line-height:20px;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;border-radius:4px;padding:0px;color:inherit;white-space:pre-wrap;border:0px;background-color:transparent;font-size:14px;"><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 102, 102);">0xb70fb88c</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);"> file_get_contents</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">usr</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 136);">local</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">lnmp</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">nginx</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">html</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">www</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">quancha</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">cn</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">www</span><span style="color:rgb(102, 102, 0);">/</span><span style="color:rgb(0, 0, 0);">fyzb</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">php</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 102, 102);">2</span></code></li></ol></pre>

<p style="margin:0px 0px 20px;">通过日志，我们就可以知道第2行的file_get_contents 函数有点问题，这样我们就能追踪问题了。</p></div></div></div></div></div><br/></div></span>
</div></body></html> 