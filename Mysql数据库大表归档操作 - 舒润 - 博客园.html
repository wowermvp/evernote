<html>
<head>
  <title>Mysql数据库大表归档操作 - 舒润 - 博客园</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1321"/>
<h1>Mysql数据库大表归档操作 - 舒润 - 博客园</h1>

<div>
<span><br/><div style="background-image: url(file:///images/o_kubrickbg.jpg); background-color: rgb(214, 211, 214); background-position: 50% 50%; background-repeat: no-repeat repeat;"><div style="text-align:left;overflow:hidden;background-color:transparent;"><div><h2 style="margin-top:10px;font-size:1.1em;"><span style="font-family: Verdana, Arial, sans-serif, 'Lucida Grande';"><a href="http://www.cnblogs.com/rainy-shurun/p/5220948.html" style="color:rgb(0, 102, 255);text-decoration:none;">Mysql数据库大表归档操作</a> </span></h2><div style="padding-left: 5px;"><div style="margin-bottom:20px;word-break:break-word;"><p style="margin:10px auto;text-indent:0px;"><span style="font-family: Verdana, Arial, sans-serif, 'Lucida Grande';"><span style="color: rgb(51, 51, 51);">由于公司的某个系统数据表过亿，考虑到数据表的压力。所以根据某个时间点对数据表做了一个归档。以下的操作是在当前的数据库新建表用于存储历史数据，然后再对生产表做一个清理操作。如果有条件的话可以把归档的数据放在一台新的数据库服务器上。（具体的表名和时间结点根据自己需要修改）</span></span></p><p style="margin:10px auto;text-indent:0px;"><span style="font-family: Verdana, Arial, sans-serif, 'Lucida Grande';"><span style="color: rgb(51, 51, 51);"> </span></span></p><p style="margin:10px auto;text-indent:0px;"><span style="font-family: Verdana, Arial, sans-serif, 'Lucida Grande';"><span style="color: rgb(51, 51, 51);">归档sql：</span></span></p><p style="margin:10px auto;text-indent:0px;"><span style="font-family: Verdana, Arial, sans-serif, 'Lucida Grande';"><span style="color: rgb(51, 51, 51);"> 方法一：  复制表并且按照条件插入数据（此种方法除了主键索引不包括其他索引）</span></span></p><div style="border:1px solid rgb(204, 204, 204);padding:5px;overflow:auto;color:rgb(0, 0, 0);background-color:rgb(245, 245, 245);margin:10px auto;font-family:'Courier New';font-size:12px;"><div style="background-color:rgb(245, 245, 245);margin:10px auto;"><span style="padding-right:5px;font-family:'Courier New';font-size:12px;"><a style="color:rgb(0, 102, 255);text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Mysql数据库大表归档操作 - 舒润 - 博客园_files/copycode.gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="max-width: 900px; border: none; background-color: rgb(245, 245, 245); height: auto;" width="20"/></a></span></div><pre style="margin-top:0px;margin-bottom:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New';font-size:12px;"><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">CREATE</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">TABLE</span> lime_survey_549656_20151001 <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">as</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">select</span> <span style="font-family:'Courier New';font-size:12px;color:#808080;">*</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">from</span> lime_survey_549656  <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">where</span> submitdate <span style="font-family:'Courier New';font-size:12px;color:#808080;">&lt;</span> &quot;<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">2015</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">10</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">01</span> <span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span><span style="font-family:'Courier New';font-size:12px;color:#000000;">&quot;;  
</span><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">ALTER</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">TABLE</span> lime_survey_549656_20151001 change id id <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">int</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">primary</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">key</span><span style="font-family:'Courier New';font-size:12px;color:#000000;"> auto_increment;  
</span><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">CREATE</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">TABLE</span> lime_survey_186194_20151001 <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">as</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">select</span> <span style="font-family:'Courier New';font-size:12px;color:#808080;">*</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">from</span> lime_survey_186194 <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">where</span> submitdate <span style="font-family:'Courier New';font-size:12px;color:#808080;">&lt;</span> &quot;<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">2015</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">10</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">01</span> <span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span><span style="font-family:'Courier New';font-size:12px;color:#000000;">&quot;;  
</span><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">ALTER</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">TABLE</span> lime_survey_186194_20151001 change id id <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">int</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">primary</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">key</span><span style="font-family:'Courier New';font-size:12px;color:#000000;"> auto_increment;  
</span><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">CREATE</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">TABLE</span> lime_survey_279575_20151001 <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">as</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">select</span> <span style="font-family:'Courier New';font-size:12px;color:#808080;">*</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">from</span> lime_survey_279575 <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">where</span> submitdate <span style="font-family:'Courier New';font-size:12px;color:#808080;">&lt;</span> &quot;<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">2015</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">10</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">01</span> <span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span><span style="font-family:'Courier New';font-size:12px;color:#000000;">&quot;;  
</span><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">ALTER</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">TABLE</span> lime_survey_279575_20151001 change id id <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">int</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">primary</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">key</span> auto_increment;  
</pre><div style="background-color:rgb(245, 245, 245);margin:10px auto;"><span style="padding-right:5px;font-family:'Courier New';font-size:12px;"><a style="color:rgb(0, 102, 255);text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Mysql数据库大表归档操作 - 舒润 - 博客园_files/copycode [1].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="max-width: 900px; border: none; background-color: rgb(245, 245, 245); height: auto;" width="20"/></a></span></div></div><p style="margin:10px auto;text-indent:0px;"><span style="font-family: Verdana, Arial, sans-serif, 'Lucida Grande';"><span style="color: rgb(51, 51, 51);"> </span></span></p><p style="margin:10px auto;text-indent:0px;"><span style="font-family: Verdana, Arial, sans-serif, 'Lucida Grande';"><span style="color: rgb(51, 51, 51);">方法二： 创建一张空表，结构和索引和原表一样</span></span></p><div style="border:1px solid rgb(204, 204, 204);padding:5px;overflow:auto;color:rgb(0, 0, 0);background-color:rgb(245, 245, 245);margin:10px auto;font-family:'Courier New';font-size:12px;"><div style="background-color:rgb(245, 245, 245);margin:10px auto;"><span style="padding-right:5px;font-family:'Courier New';font-size:12px;"><a style="color:rgb(0, 102, 255);text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Mysql数据库大表归档操作 - 舒润 - 博客园_files/copycode [2].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="max-width: 900px; border: none; background-color: rgb(245, 245, 245); height: auto;" width="20"/></a></span></div><pre style="margin-top:0px;margin-bottom:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New';font-size:12px;"><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">create</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">table</span> lime_survey_549656_20151001 <span style="font-family:'Courier New';font-size:12px;color:#808080;">like</span><span style="font-family:'Courier New';font-size:12px;color:#000000;"> lime_survey_549656;   
</span><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">INSERT</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">INTO</span> lime_survey_549656_20151001 <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">select</span> <span style="font-family:'Courier New';font-size:12px;color:#808080;">*</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">from</span> lime_survey_549656  <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">where</span> submitdate <span style="font-family:'Courier New';font-size:12px;color:#808080;">&lt;</span> &quot;<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">2015</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">10</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">01</span> <span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span><span style="font-family:'Courier New';font-size:12px;color:#000000;">&quot;;  
</span><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">create</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">table</span> lime_survey_186194_20151001 <span style="font-family:'Courier New';font-size:12px;color:#808080;">like</span><span style="font-family:'Courier New';font-size:12px;color:#000000;"> lime_survey_186194;   
</span><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">INSERT</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">INTO</span> lime_survey_186194_20151001 <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">select</span> <span style="font-family:'Courier New';font-size:12px;color:#808080;">*</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">from</span> lime_survey_186194  <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">where</span> submitdate <span style="font-family:'Courier New';font-size:12px;color:#808080;">&lt;</span> &quot;<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">2015</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">10</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">01</span> <span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span><span style="font-family:'Courier New';font-size:12px;color:#000000;">&quot;;  
</span><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">create</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">table</span> lime_survey_279575_20151001 <span style="font-family:'Courier New';font-size:12px;color:#808080;">like</span><span style="font-family:'Courier New';font-size:12px;color:#000000;"> lime_survey_279575;   
</span><span style="font-family:'Courier New';font-size:12px;color:#0000ff;">INSERT</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">INTO</span> lime_survey_279575_20151001 <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">select</span> <span style="font-family:'Courier New';font-size:12px;color:#808080;">*</span> <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">from</span> lime_survey_279575  <span style="font-family:'Courier New';font-size:12px;color:#0000ff;">where</span> submitdate <span style="font-family:'Courier New';font-size:12px;color:#808080;">&lt;</span> &quot;<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">2015</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">10</span><span style="font-family:'Courier New';font-size:12px;color:#808080;">-</span><span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">01</span> <span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>:<span style="font-family:'Courier New';font-size:12px;color:#800000;font-weight:bold;">00</span>&quot;;  
</pre><div style="background-color:rgb(245, 245, 245);margin:10px auto;"><span style="padding-right:5px;font-family:'Courier New';font-size:12px;"><a style="color:rgb(0, 102, 255);text-decoration:none;border:none;background-color:rgb(245, 245, 245);" title="复制代码"><img src="Mysql数据库大表归档操作 - 舒润 - 博客园_files/copycode [3].gif" type="image/gif" data-filename="copycode.gif" alt="复制代码" height="20" style="max-width: 900px; border: none; background-color: rgb(245, 245, 245); height: auto;" width="20"/></a></span></div></div><p style="margin:10px auto;text-indent:0px;"><span style="font-family: Verdana, Arial, sans-serif, 'Lucida Grande';"><span style="color: rgb(51, 51, 51);"> </span></span></p><div style="margin:10px auto;text-indent:0px;"><div><span style="font-family: Verdana, Arial, sans-serif, 'Lucida Grande';"><span style="color: rgb(51, 51, 51);">数据归档成功后清理数据sql:</span></span></div><div><span style="font-family: Verdana, Arial, sans-serif, 'Lucida Grande';"><span style="color: rgb(51, 51, 51);"><br/></span></span></div></div></div></div></div></div></div></span>
</div></body></html> 