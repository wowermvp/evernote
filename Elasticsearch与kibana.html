<html>
<head>
  <title>Elasticsearch与kibana</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1586"/>
<h1>Elasticsearch与kibana</h1>

<div>
<span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt"><div style="direction:ltr;border-width:100%"><div style="direction:ltr;margin-top:0in;margin-left:0in;width:9.3222in"><div style="direction:ltr;margin-top:0in;margin-left:0in;width:2.993in"><p style="margin:0in;font-size:20.0pt"><span lang="en-US" style="font-family:&quot;Calibri Light&quot;">Elasticsearch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei Light&quot;">与</span><span lang="en-US" style="font-family:&quot;Calibri Light&quot;">kibana</span></p></div><div style="direction:ltr;margin-top:.0409in;margin-left:0in;width:1.6118in"><p style="margin:0in;font-size:10.0pt;color:#767676"><span style="font-family: Calibri">2019</span><span style="font-family:&quot;Microsoft YaHei&quot;">年</span><span style="font-family:Calibri">1</span><span style="font-family:&quot;Microsoft YaHei&quot;">月</span><span style="font-family:Calibri">5</span><span style="font-family:&quot;Microsoft YaHei&quot;">日</span></p><p style="margin:0in;font-family:Calibri;font-size:10.0pt;color:#767676">15:33</p></div><div style="direction:ltr;margin-top:.2416in;margin-left:0in;width:9.3222in"><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">elasticsearch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">配置说明</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">配置文件位于</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">config</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">目录中</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">elasticsearch.yml es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的相关配置</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">jvm.options jvm</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的相关参数</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">log4j2.properties</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">日志相关配置</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Elasticsearch.yml</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">关键配置</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cluster.name</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">集群名称，以此作为是否同一集群的判断条件</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">node.name</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点名称，以此作为集群中不同节点的区分条件</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">network.host/http.port</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">网络地址和端口，用于</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">http</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">和</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">transport</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">服务使用</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">path.data</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据存储地址</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">path.log</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">日志存储地址</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Development</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">与</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Production</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">模式说明</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">transport</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的地址是否绑定在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">localhost</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为判断标准</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">network.host</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Development</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">模式下在启动时会以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">warning</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的方式提示配置检查异常</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Production</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">模式下在启动时会以</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">error</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的方式提示配置检查异常退出</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数修改的第二种方式</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">bin/elasticsearch -E http.port=9200</span></li></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">Elasticsearch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">本地启动集群的方式</span></p><ol style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in;font-family:Calibri;font-size:11.0pt; font-weight:normal;font-style:normal" type="1"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle" value="1"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt; font-weight:normal;font-style:normal;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">bin/elasticsearch</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">bin/elasticsearch -Ehttp.port=8200 -Epath.data=node2</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">bin/elasticsearch -Ehttp.port=7200 -Epath.data=node3</span></li></ol><p style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">kibana</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">配置说明</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">配置位于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">config</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文件夹中</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Kibana.yml</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">关键配置说明</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Server.host/server.port</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">访问</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">kibana</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">用的地址和端口</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Elasticsearch.url</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">待访问</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">elasticsearch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的地址</span></li></ul></ul><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"><span lang="en-US">kibana</span><span lang="zh-CN">常用功能说明</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">discover</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据搜索查看</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">visualize</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">图表制作</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">dashboard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">仪表盘制作</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">timelion</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">时序数据的高级可视化分析</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">devtools</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">开发者工具</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">management</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">配置</span></li></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"><span lang="en-US">elasticsearch</span><span lang="zh-CN">常用术语</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">document</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档数据</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt"><span style="mso-spacerun:yes">       </span> #</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">具体存在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">elasticsearch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的一条数据</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">json object</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，由字段</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">(Field)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">组成，觉数据类型如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字符串：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text, keywork</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数值型：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">long, integer, short, byte, double, float, half_float, scaled_float</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">布尔：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">boolean</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">日期：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">date</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">二进制：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">binary</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">范围类型：</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">integer_range, float_range, long_range, double_range, date_range</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">每个文档有唯一的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">标识</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自行指定</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不指定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自动生成</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Document metadata</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">元数据，用于标注文档的相关信息</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">：文档所在的索引名</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_type</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">：文档所在的类型名</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">：文档唯一</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">id</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_uid</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">：组合</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，由</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_type</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">组成（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">6.x _type</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不再起作用，同</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">一样）</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_source</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">：文档的原始</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">json</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据，可以从这里获取每个字段的内容</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_all</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">：整合所有字段内容到该字段，默认禁用</span></li></ul></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">索引</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"><span style="mso-spacerun:yes">       </span> #</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">相当于</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">mysql</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的数据库，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">6</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">版本中相当于</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">table</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">索引中存储具有相同结构的文档（</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">document</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">每个索引都有自己的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">mapping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">定义，用于定义字段名和类型</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">一个集群可以有多个索引，比如：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">nginx</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">日志存储的时候可以按照日期每天生成一个索引来存储</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">nginx-log-2017-01-01</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">nginx-log-2017-01-02</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">nginx-log-2017-01-03</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">正排索引</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">到文档内容、单词的关联关系</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">倒排索引</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">单词到文档</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的关联关系</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">倒排索引组成</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">倒排索引是搜索引擎的核心，主要包含两部分</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">单词词典（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term dictionary</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">记录所有文档的单词，一般都比较大</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">记录单词到倒排列表的关联信息</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">单词字典的实现一般是用</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">B+ Tree</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，示例如下图：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">下图排序采用拼音实现，构造方法参见如下网址</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html</span></a></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle; font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image.png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: php ， 搜 索 引 擎 诞 生 ,elasticsearch 流 行 流 行 世 界 php, 如 何 世 界 语 言 搜 索 引 擎 语 言 ， 最 好" height="167" width="600"/></li></ul></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">倒排列表（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">posting list</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">倒排列表（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">posting list</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）记录了单词对应的文档集合，由倒排索引项（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">posting</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）组成</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">倒排索引项（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">posting</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）主要包含如下信息：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，用于获取原始信息</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">单词频率（</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">TF, Term Frequency</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">），记录该单词在该文档中的出现次数，用于后续相关性算分</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">位置（</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">postion</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">），记录单词在文档中的分词位置（多个），用于做词语搜索（</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">phrase query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size: 11.0pt">）</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">偏移（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">offset</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">），记录单词在文档的开始和结束位置，用于做高亮显示</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">以“搜索引擎”为例</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle; font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [1].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 文 档 内 容 elasticsearch 是 最 流 行 的 搜 索 引 擎 php 是 世 界 上 最 好 的 语 言 搜 索 引 擎 是 如 何 诞 生 的 Posting Li st 文 档 ID 1 2 3 Docld 1 3 TF 1 1 Position 2 0 Offset < 18 ， 22 > < 0 ， 4 >" height="341" width="600"/></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">单词字典与倒排列表整合在一起的结构如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [2].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Term Dictionary 诞 生 ,elasticsearch php ， 搜 索 引 擎 世 界 流 行 1 ph p ， 如 何 世 界 语 言 搜 索 引 擎 指 向 倒 排 文 件 中 的 位 移 Posting List 1 1 2 3 2 2 语 言 ， 最 好 2 · 此 处 倒 排 索 引 项 只 写 了 dodd" height="270" width="600"/></li></ul></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">存储的是一个</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">json</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">格式的文档，其中包含多个字段，每个字段会有自己的倒排索引，类似下图：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [3].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: •username•:"alfred\ •job":•programmer• username 倒 排 索 引 倒 排 索 引" height="149" width="600"/></li></ul></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">type</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">索引中的数据类型</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"><span style="mso-spacerun:yes">       </span> #</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">相当于</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">mysql</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的表，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">6</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中只能存在一个</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">type</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，后续版本会删除</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">type</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">概念</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">field</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字段，文档属性</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Query DSL</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询语法</span></li></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Rest API</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">elasticsearch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">集群对外提供</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">RESTful API</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">REST - Representational state transfer</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">URI</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指定资源，如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">document</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Http method</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指明资源操作类型，如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">GET</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">POST</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">PUT</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">DELETE</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">常用两种交互方式</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">curl</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">命令行</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Kibana devtools</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">索引</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">API</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">有专门的</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">index API</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，用于创建、更新、删除索引配置等</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">创建索引</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">PUT /test_index<span style="mso-spacerun:yes">       </span> #</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">创建名为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">test_index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的索引</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">GET _cat/indices<span style="mso-spacerun:yes">       </span> #</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查看现有索引</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">DELETE /test_index<span style="mso-spacerun:yes">      </span> #</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">删除索引</span></li></ul></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">创建文档</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指定</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">创建文档</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">PUT /test_index/doc/1</span></li></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">&quot;username&quot;:&quot;alfred&quot;,</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">&quot;age&quot;:1</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt">}</p><p style="margin:0in;margin-left:1.125in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">创建文档时，如果索引不存在，</span><span lang="en-US" style="font-family:Calibri">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">会自动创建对应的</span><span lang="en-US" style="font-family:Calibri">index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">和</span><span lang="en-US" style="font-family:Calibri">type</span></p><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不指定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">创建文档</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">POST /test_index/doc</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">&quot;username&quot;:&quot;tom&quot;,</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">&quot;age&quot;:20</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询文档</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">搜索所有文档，用到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_search</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">GET /test_index/doc/_search</span></li></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">&quot;query&quot;:{</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">&quot;term&quot;:{</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">&quot;_id&quot;:&quot;1&quot;</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">}</p><p style="margin:0in;margin-left:1.125in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt"><span lang="zh-CN">查询语句，</span><span lang="en-US">json</span><span lang="zh-CN">格式，放在</span><span lang="en-US">http body</span><span lang="zh-CN">中发送到</span><span lang="en-US">es</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">批量创建文档</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">api</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">允许一次创建多个文档，从而减少网络传输开销，提升写入速率</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">endpoint</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">_bulk</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">，如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">POST _bulk</span></li></ul></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">{&quot;index&quot;:{&quot;_index&quot;:&quot;test_index&quot;,&quot;_type&quot;:&quot;doc&quot;,&quot;_id&quot;:&quot;3&quot;}}</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">{&quot;username&quot;:&quot;alfred&quot;,&quot;age&quot;:10}</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">{&quot;delete&quot;:{&quot;_index&quot;:&quot;test_index&quot;,&quot;_type&quot;:&quot;doc&quot;,&quot;_id&quot;:&quot;1&quot;}}</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">{&quot;update&quot;:{&quot;_id&quot;:&quot;2&quot;,&quot;_index&quot;:&quot;test_index&quot;,&quot;_type&quot;:&quot;doc&quot;}}</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">{&quot;doc&quot;:{&quot;age&quot;:&quot;20&quot;}}</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">批量查询文档</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">允许一次查询多个文档</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">endpoin</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">t</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">_mget</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">，如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">GET /_mget</span></li></ul></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">&quot;docs&quot;:[</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt">&quot;_index&quot;:&quot;test_index&quot;,</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt">&quot;_type&quot;:&quot;doc&quot;,</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt">&quot;_id&quot;:&quot;1&quot;</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">},</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt">&quot;_index&quot;:&quot;test_index&quot;,</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt">&quot;_type&quot;:&quot;doc&quot;,</p><p lang="en-US" style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt">&quot;_id&quot;:&quot;2&quot;</p><p lang="en-US" style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">]</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">}</p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分词</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分词是指将文本转换成一系列单词（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term or token</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）的过程，也可以叫做文本分析，在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">里面称</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Analysis</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，如下图所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [4].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: elasticsearch 是 最 流 行 的 搜 索 引 擎 elasticsearch 流 行 搜 索 引 擎" height="211" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分词器</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分词器是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中专门处理分词的组件，英文为</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Analyzer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，它的组成如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">C</span><span style="font-family:Calibri;font-size:11.0pt">haracter Filters</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">针对原始文本进行处理，比如去除</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">html</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">特殊标记符</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Tokenizer</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将原始文本按照一定规则切分为单词</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Token Filters</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">针对</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">tokenizer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">处理的单词就行再加工，比如转小写、删除或新增等处理</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分词器调用顺序</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [5].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Th e QUICK brown foxes j u m ped over the lazy dog ！ Standard Analyzer Character Filters Tokenizer Token Filters [ the, quick, brown, foxes, Jumped, ove the, la dog ]" height="484" width="600"/></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Analyze API</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es提供了一个测试分词的</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">接口，方便验证分词效果，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">endpoint</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是</span><span lang="en-US" style="font-weight:bold;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">_analyze</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以直接指定</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">analyzer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">进行测试</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [6].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 分 词 器 测 试 文 本 POST _analyze analyzer": •standard• text•."hello world!k request 分 词 结 果 起 始 偏 移 结 束 偏 移 分 词 位 置 response •tokens": [ "token". “ h 刨 0 “ start offset": 0 end offset": 5, •type": •<ALPHANUM>" position ： 0 •token": •world" "Sta rt_offset" ： 6 ， •end 0 e 亡 11 ， •type": •<ALPHANUM>" position": 1" height="327" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以直接指定索引中的字段进行测试</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [7].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 测 试 字 段 测 试 文 本 测 试 的 索 引 request POST test index/-analyze field": •username", text" “ h 刨 0 world!•" height="247" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以自定义分词器进行测试</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [8].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 自 定 义 analyzer request POST _analyze tokenized: •standard" •fi Iter•: [ “ lowerca I, text" "Hello World!"" height="217" width="600"/></li></ul></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es自带如下的分词器</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">Standard</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认分词器</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">其组成如图，特性为：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按词切分，支持多语言</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">小写处理</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [9].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: The 2 QUICK Brown-Foxesjumped over the lazy dog's bone. Tokenizer Standard Token Filters Standard Lower case Stop(disabled default) [ the, 2 ， quick, brown, foxes, jum ped over, the, lazy, dog 's, bone ]" height="508" width="600"/></li></ul></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">Simple</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">其组成如图，特性为：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照非字母切分</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">小写处理</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [10].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: The 2 QUICK Brown-Foxesjumped over the lazy dog's bone. Tokenizer Lower Case [ the, quick, brown, foxes, jum ped over, the, lazy, dog, s, bone ]" height="282" width="600"/></li></ul></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">Whitespace</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">其组成如图，特性为：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照空格进行切分</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [11].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: The 2 QUICK Brown-Foxesjumped over the lazy dog's bone. Tokenizer Whitespace [ The, 2 ， QUICK, Brown-Foxes, ju m ped, OV the, lazy, dog's, bone. ]" height="271" width="600"/></li></ul></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">Stop</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Stop word</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指语气助词等修饰性的词语，比如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">the</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">an</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、的、这等等</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">其组成如图，特性为：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">相比</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">simple analyzer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size: 11.0pt">多了</span><span lang="en-US" style="font-family:Calibri; font-size:11.0pt">stop word</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">处理</span></li></ul></ul></ul></ul></ul><p style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [12].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: The 2 QUICK Brown-Foxes jumped over the lazy dog's bone. Tokenizer Lower Case Token Filters Stop [ quick, brown, foxes,jumped, over, lazy, dog, s, bone ]" height="425" width="600"/></li></ul><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">Keyword</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">其组成如图，特性为：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不分词，直接将输入作为一个单词输出</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [13].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: The 2 QUICK Brown-Foxesjumped over the lazy dog's bone. Tokenizer Keyword [ The 2 QUICK Brown-Foxes ium Ded over the la ZV do 只 、 bone." height="319" width="600"/></li></ul></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">Pattern</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">其组成如图，特性为：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过正则表式自定义分割符</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">\W+</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，即非字词的符号作为分隔符</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [14].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: The 2 QUICK Brown-Foxesjumped over the lazy dog's bone. Tokenizer Pattern Token Filters Lower Case Stop(disabled default) [ the, 2 ， quick, brown, foxes,jum over, the, lazy S bone ]" height="480" width="600"/></li></ul></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">Language</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">提供了</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">30+</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">常见语言的分词器</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Arabic,</span> <span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">armenian</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">, basque, bengali, brazilian, bulgarian,catalan, cjk, czech, danish, dutch,english…</span></li></ul></ul><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中文分词</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中文分词指的是将一个汉字序列切分成一个一个单独的词。在英文中，单词之间是以空格作为自然分界符，汉语中词没有一个形式上的分界符。</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上下文不同，分词结果迥异，比如交叉歧义问题，比如下面两种分词都合理</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">乒乓球拍</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">/</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">卖</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">/</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">完了</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">乒乓球</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">/</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">拍卖</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">/</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">完了</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="https://mp.weixin.qq.com/s/SiHSMrn8IxCmrtHbcwL-NQ"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">http</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">s://mp.weixin.qq.com/s/SiHSMrn8IxCmrtHbcwL-NQ</span></a></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">常用分词系统</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">IK</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实现中英文单词的切分，支持</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ik_smart</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ik_maxword</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等模式</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可自定义词库，支持热更新分词词典</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="https://github.com/medcl/elasticsearch-analysis-ik"><span style="font-family:Calibri;font-size:11.0pt">https://github.com/medcl/elasticsearch-analysis-ik</span></a></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Jieba</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">py</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">thon</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中最流行的分词系统，支持分词和词性标注</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">支持繁体分词、自定义词典、并行分词等</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="https://github.com/sing1ee/elasticsearch-jieba-plugin"><span style="font-family:Calibri;font-size:11.0pt">https://github.com/sing1ee/elasticsearch-jieba-plugin</span></a></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">基于自然语言处理的分词系统</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Hanlp</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">由一系列模型与算法组成的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">java</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">工具包，目标是普及自然语言处理在生产环境中的应用</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="https://github.com/hankcs/HanLP"><span style="font-family:Calibri; font-size:11.0pt">https://github.com/hankcs/HanLP</span></a></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">THULAC</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">THU Lexical Analyzer for Chiness</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">，由清华大学自然语言处理与社会人文计算实验室研制推出的一套中文分词法分析工具包，具有中文分词和词性标注功能</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><a href="https://github.com/microbun/elasticsearch-thulac-plugin"><span style="font-family:Calibri;font-size:11.0pt">https://github.com/microbun/elasticsearch-thulac-plugin</span></a></li></ul></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自定义分词</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">当自带的分词无法满足需求时，可以自定义分词</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过自定义</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Character Filters</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Tokenizer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri; font-size:11.0pt">Token Filter</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">实现</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Character Filters</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Tokenizer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">之前对原始文本进行处理，比如增加、删除或替换字符等</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自带的如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">HTML Strip</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">去除</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">html</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">标签和转换</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">html</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实体</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">M</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">apping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">进行字符替换操作</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Pa</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ttern Replace</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">进行正则匹配替换</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">会影响后续</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">tokenizer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">解析的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">postion</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">offset</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">信息</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Character Filters</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">测试时可以采用如下</span><span lang="en-US" style="font-family:Calibri;font-size: 11.0pt">api</span></li></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [15].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request keywo rd 类 型 的 to ken izer 可 以 直 接 看 到 输 出 结 果 指 明 要 使 用 的 char filter POST _analyze token izer ' keywo rd ' •char filter': [ •html_strip• l, •text" ： •<p>l&apos,rxt SO response •tokens": [ •token" I' m so happy! •start offset• ： 0 ， •end offset" ： 32 ， •type" ： "word' position": 0" height="248" width="600"/></li></ul><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Tokenizer</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将原始文本按照一定的规则切分为单词（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term or token</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自带的如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">standard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照单词进行分割</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">letter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照非字符类进行分割</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">whitespace</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照空格进行分割</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">UAX URL Email</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">standard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分割，但不会分割邮箱和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">url</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">NGram</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Edge NGram</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">连词分割</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Path Hierarchy</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size: 11.0pt">按照文件路径进行分割</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Tokenizer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">测试时可以采用如下</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">：</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [16].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Tokenizer 测 试 时 可 以 采 用 如 下 api ： POST _analyze request 指 定 要 测 试 的 tokenizer tokenized: •path hierarchy• •text": "/one/two/three• response •tokens•: [ •token•: •/one•, •start 0 set' ： 0 •end offset': 4 ， •type•: •word · ， position•: 0 •token•. "/one/two• •start offset•: 0 •end-offset': 8 ， •type•: •word · ， position': 0 •token• ． •/one/two/three•, •start_offset•: 0 ， •end offset•: 14 ， •type•: •word 》 position': 0" height="336" width="600"/></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Token Filters</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">对于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">tokenizer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">输出的单词（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）进行增加、删除、修改等操作</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自带的如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">lowercase</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将所有</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">转换小写</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">stop</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">删除</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">stop words</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">NGram</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Edge NGram</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">连词分割</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">synonym</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">添加近义词的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">测试时可以采用如下</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">：</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [17].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: · Filter 测 讠 寸 可 以 采 用 如 下 api ： 指 定 要 测 试 的 filter POST _analyze •text": •a Hello,world!" •tokenizer•.• "standard" fi Iter •stop •lowercase", •type": •ngram•, min_gram•: 4 ， max_gram•: 4 •tokens•: [ "token": "hell" "start_offset•: 2 ， request •end offset": 7 ， •<ALPHANUM>" position" ： 1 •token-. •ello•, "start_offset• ： 乙 •end offset": 7 ， "type" •<ALPHANUM>" position' ： 1 •token-. •worr •start_offset•: 8 ， response •end offset": 13 ， · p 的 •<ALPHANUM>" position": 2 •token": •orld•, •start_offset•: 8 ， •end 0 e 亡 13 ， •type" •<ALPHANUM>" position": 2" height="321" width="600"/></li></ul></ul><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自定义分词</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">API</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自定义分词需要在索引的配置中设定，如下所示：</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [18].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 分 词 配 置 ， 可 以 自 定 义 char filter tokenizer filter analyzer request PUT test index •settings ： analysis": { char filter': O, tokenizer•: 0 ， "filter": O, analyzer": 0" height="358" width="600"/></li></ul></ul><p style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [19].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 我 们 自 定 义 如 下 图 所 示 的 分 词 器 Custom Analyzer Character Filters HTML Strip Tokenizer Standard Token Filters Lower case ASCII Folding PUT test index 'settings": { •analysis": { •analyzer': { my custom analyzer": { 呼 P 矿 custom 。 to kenizer @ "standard' •char fi Iter "html-strip• 'filter": [ •lowercase', •asciifolding•" height="362" width="600"/></li></ul><p style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [20].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 我 们 自 定 义 如 下 图 所 示 的 分 词 器 二 Custom Analyzer Character Filters Custom Mapping ` Tokenizer Custom Pattern Token Filters Lower case Custom Stop PUT test i ndex2 •settings": { •analysis": { •analyzer': { my_custom analyzer type• ： •custom •, •char filter": [ emoticons •tokenizer•: pu nctuation 'filter": 〔 •lowercase ， english stop •tokenizer•: { punctuation• ： { •type•: •pattern', •pattern'. · [ 是 ？ ] · •char filter•: { •emoticons": { •type": •mapping mappings": [ 訇 = > -happy- 气 = > -sad “ •english-stop•: { •type": •stop", •stopwords": •-english-•" height="311" width="600"/></li></ul><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Mapping</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类似数据库中的表结构的定义，主要作用如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">定义</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">下的表的字段名（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Field name</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">定义字段类型，比如数值型、字符串型、布尔型</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">定义倒排索引相关的配置，比如是否索引、记录</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">position</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自定义</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">mapping</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自定义</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">mapping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如下所示：</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [21].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request PUT my index ， mappings 关 键 词 type 名 称 字 段 名 称 和 类 型 定 义 mappings': { properties': { title- ： { type• ： •text• name': { ' 呼 四 ' ： 'keyword• age•: { type-. •integer• 字 段 类 型" height="474" width="600"/></li></ul></ul><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">m</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">apping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的字段类型一旦设定后，禁止直接修改，原因如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Lucene</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实现的倒排索引生成后不允许修改</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">重新建立新的索引，然后做</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">reindex</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">操作</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">允许新增字段</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">dynamic</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数来控制字段的新增</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">true</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">（默认）允许自动新增字段</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">false</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不允许自动新增字段，但是文档可以正常写入，但无法对字段进行查询等操作</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">strict</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档不能写入，报错</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [22].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: PUT my_index •mappings": { "my-type": { "dynamic": false, properties": { “ user• ： { properties': { name": { •type": •text" request socia 丨 networks": { "dynamic": tru e, properties": 0" height="252" width="600"/></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">copy_to</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将该字段的值复制到目标字段，实现类似</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_all</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的作用</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不会出现在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_source</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中，只用来搜索</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [23].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: PUT my-i ndex •mappings": { properties": { "first name": { •type• ： •text", COPY to": “ | | "last name': { •type" ： •text", COPY to': "full "full na me •type": •text" name name" height="378" width="600"/></li></ul></ul><p style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [24].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: req u est PUT my-index/doc/l •first name": •John• •last_name•: •Smith• G ET my_index/-search query": { •match": { full name query": "John Smith" operator": •and"" height="456" width="343"/></li></ul><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt"> </p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Index</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">控制当前字段是否索引，默认为</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">true</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，即记录索引，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">false</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不记录，即不可搜索</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [25].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: PUT my_index •mappings": { properties": { •cookie•: { •type': •text", "index": fa Ise request PUT my-index/doc/l •cookie':•name=alfred" G ET my-index/-search •error•: { •root_cause •index• •caused response •my-index3" "illegal-argument_exception• query•:{ •match": { •cookie': name• "reason": "Cannot search on field [cookie] Since it is not indexed." "status": 400" height="238" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Index_options</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">用于控制倒排索引记录的内容，有如下</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">4</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">种配置</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">docs</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">只记录</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">doc id</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">freqs</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">记录</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">doc id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term frequencies</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">positions</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">记录</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">doc id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term frequencies</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term position</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">offsets</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">记录</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">doc id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term frequencies</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">ter</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">m position</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">c</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">haracter offsets</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型默认为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">positions</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，其他默认为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">docs</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">记录内容越多，占用空间越大</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">n</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ull_value</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">当字段遇到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">null</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">值时的处理策略，默认为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">null</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，即空值，此时</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">会忽略该值。可以通过设定该值设定字段的默认值</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [26].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request PUT my-i nd ex •mappings": { •my-type': { properties": { "status code•: { "keyword- •type" •null value". •NULL"" height="408" width="333"/></li></ul></ul><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Dynamic mapping</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es可以自动识别文档字段类型，从而降低用户使用成本，如下所示：</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [27].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request PUT (test-index/doc/l G ET /test_index/-mapping es 自 动 识 别 age 为 long 类 型 username 为 text 类 型 response •test_index•: { •mappings•: { properties•: { •type•: •long• username•: { type•: •text•, e 尾 { •keyword•: { •type'. •keyword', •ignore-above•: 256" height="320" width="600"/></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是依靠</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">json</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档的字段类型来实现自动识别字段类型，支持的类型如下：</span></li></ul></ul><div style="direction:ltr"><table border="1" cellpadding="0" cellspacing="0" style="direction:ltr; border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width: 1pt;margin-left:.7083in"><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8131in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">json</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">类型</span></p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.3861in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">类型</span></p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8131in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:Calibri;font-size:11.0pt"><span lang="zh-CN">nul</span><span lang="en-US">l</span></p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.3861in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">忽略</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8131in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:Calibri;font-size:11.0pt"><span lang="zh-CN">bo</span><span lang="en-US">olean</span></p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.3861in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Boolean</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8326in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">浮点类型</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.3666in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Float</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8131in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">整数</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.3861in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Long</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8131in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">o</span><span lang="en-US" style="font-family:Calibri">bject</span></p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.3861in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Object</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8131in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">array</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.3861in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">由第一个非</span><span lang="en-US" style="font-family:Calibri">null</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">值的类型决定</span></p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8131in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">string</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.4555in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">匹配为日期则设定为</span><span lang="en-US" style="font-family:Calibri">date</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">类型（默认开启）</span></p><p style="margin:0in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">匹配为数字的话设为</span><span lang="en-US" style="font-family:Calibri">float</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">或</span><span lang="en-US" style="font-family:Calibri">long</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;">类型（默认关闭）</span></p><p style="margin:0in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">匹配为</span><span lang="en-US" style="font-family:Calibri">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">类型，并附带</span><span lang="en-US" style="font-family:Calibri">keyword</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;">的子字段</span></p></td></tr></table></div><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">日期的自动识别可以自行配置日期格式，以满足各种需求</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">[&quot;strict_date_optional_time&quot;,&quot;yyyy/MM/dd HH:mm:ss</span> <span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">Z</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">||yyy/MM/dd Z&quot;]</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">strict_date_optional_time</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">ISO</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">datetime</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的格式，完整格式类似下面：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">YYYY-MM-DDThh:mm:ssTZD(eg 1997-07-16T19:20:30+01:00)</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">dynamic_date_formats</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以自定义日期类型</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">d</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ate_detection</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以关闭日期自动识别的机制</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字符串是数字时，默认不会自动识别为整型，因为字符串中出现数字是完全合理的</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">numeric_detection</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以开启字符串中数字的自动识别，如下所示：</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [28].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request response PUT my_i ndex •mappings": { ' my-type': { numeric detection': true PUT my_i ndex/my-type/l •my_float•: · 1 ℃ · ， · my-integer": •1' G ET my-index/-mapping •my-indexl': { mappings•: { @my-type': { nu menc detection': true, properties' ： { •my_float": { •type• ． 'float' my_integer•: { •type• ， •long" height="272" width="600"/></li></ul></ul><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Dynamic templates</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">允许根据</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自动识别的数据类型、字段名等来动态设定字段类型，可以实现如下效果：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">所有字符串类型都设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">keyword</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型，即默认不分词</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">所有以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">message</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">开头的字段都设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型，即分词</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">所有以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">long_</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">开头的字段都设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">long</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">所有自动匹配为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">double</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型的都设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">float</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型，以节省空间</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Dynamic templates API</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [29].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 数 组 ， 可 指 定 过 个 匹 配 规 则 template 的 名 称 匹 配 规 则 设 置 mapping 信 息 PUT test index •mappings": { *doe: { •dynamic templates': [ •strings': { •match mapping type': •string mapping': { •type' ： 'keyword•" height="402" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配规则一般有如下几个参数：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">match_mapping_type</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">e</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">s</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自动识别的字段类型，如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">boolean,long,string</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">match,unmatch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配字段名</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">p</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ath_match,path_unmatch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配路径</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字符串默认使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">keyword</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认会为字符串设置为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型，并增加一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">keyword</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的子字段</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [30].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: PUT test_index mappings": { •dynamic-templates": [ •strings-as-keywords': { •match mapping type': •string ， mapping': { •type'. · keywo rd ·" height="466" width="411"/></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">message</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">开头的字段都设置为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [31].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: PUT test_index •mappings": { •dynamic-templates": [ message-as_text•: { •match mapping type': "stri ng •match•: •message* mapping': { type': •text"" height="480" width="404"/></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自定义</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">mapping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的操作步骤如下：</span></li><ol style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in;font-family:Calibri;font-size:11.0pt; font-weight:normal;font-style:normal" type="1"><li style="margin-top:0;margin-bottom:0;vertical-align:middle" value="1"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt;font-weight:normal; font-style:normal;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">写入一条文档到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt; font-weight:normal;font-style:normal;font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt;font-weight:normal;font-style:normal;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">的临时索引中，获取</span><span lang="en-US" style="font-family: Calibri;font-size:11.0pt;font-weight:normal;font-style:normal;font-family: Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt;font-weight:normal;font-style:normal; font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自动生成的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt;font-weight:normal; font-style:normal;font-family:Calibri;font-size:11.0pt">mapping</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">修改步骤</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">得到的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">mapping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，自定义相关的设置</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">使用步骤</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">2</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">mapping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">创建实际所需索引</span></li></ol></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">索引模板</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">索引模板，英文</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index template</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，主要用于在新建索引时自动应用预先设定的配置，简化索引创建的操作步骤</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以设定索引的配置和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">mapping</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以有多个模板，根据</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">order</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">order</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">大的覆盖小的配置</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">索引模板API，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">endpoint</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">_template</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，如下所示：</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [32].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 匹 配 的 索 引 名 称 order 顺 序 配 置 索 引 的 配 置 PUT template/test template •index patterns': 「 te*•, •bar*•j, •order":0, •settings': { •number of_shards•: 1 •mappings': { source•: { •enabled': false •properties': { •name": { •type": •keyword• template 名 称 PUT test index GET test index 创 建 索 引 并 看 配 置" height="353" width="600"/></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">获取与删除的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">API</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">GET</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_template</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">GET _template/test_template</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">DELETE _template/test_template</span></li></ul></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据类型</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">核心数据类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字符串型</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">keyword</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数值类型</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">long</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">integer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">short</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">byte</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">double</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">float</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">half_float</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">scaled_float</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">日期类型</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">date</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">布尔类型</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bollean</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">二进制类型</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">binary</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">范围类型</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">integer_range</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">float_range</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">long_range</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">double_range</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">date_range</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">复杂数据类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数组类型</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">array</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">对象类型</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">object</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">嵌套类型</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">nested object</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">地理位置数据类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">geo_point</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">geo_shape</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">专用类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">记录</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ip</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">地址</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ip</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实现自动补全</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">completion</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">记录分词数</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">token_count</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">记录字符串</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">hash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">值</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">murmur3</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Percolator</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Join</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">多字段特性</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">multi-fields</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">允许对同一个字段采用不同的配置，比如分词，常见例子如对人名实现拼音搜索，只需要在人名中新增一个子字段为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pinyin</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">即可</span></li></ul></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Search API</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实现对</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中存储的数据进行查询分析，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">endpoint</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">_search</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，如下所示</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">GET /_search</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">GET /my_index/_search</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">GET /my_index1,my_index2/_search</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">GET /my_*/_search</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询主要有两种形式</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">URI search</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">操作简便，方便通过命令行进行测试</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">仅包含部分查询语法</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">GET /my_index/_search?q=user:alfred</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">URI query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数来实现搜索，常用参数如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">q</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指定查询的语句，语法为</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">query string syntax</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">df q</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中不指定字段时默认查询的字段，如果不指定，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">会查询所有字段</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sort</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">排序</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">timeout</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指定超时时间，默认不超时</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">from,size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">用于分页</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [33].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: U RI Search G ET /my_index/_search?q = alfred&df= user&sort=age:asc&from =4&size= IO&timeout=1s 查 询 user 字 段 包 含 alfred 的 文 档 ， 结 果 按 照 age 升 序 排 列 ， 返 回 第 14 个 文 档 · 如 果 超 过 Is 没 有 结 束 ， 则 以 超 时 结 束" height="137" width="600"/></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">URI search - Query string syntax</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">与</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">phrase</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">alfred way</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等效于</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">alfred OR way</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">&quot;alfred way&quot;</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size: 11.0pt">词语查询，要求先后顺序</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">泛查询</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">alfred</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等效于在所有字段去匹配该</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指定字段</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">name:alfred</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Group</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分组设定，使用括号指定匹配的规则</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">(quick OR brown) AND fox</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">status:(active OR pending) title:(full text search)</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">布尔操作符</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">AND(&amp;&amp;),OR(||),NOT(!)</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">name:(tom NOT lee)</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">注意大写，不能小写</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">+ -</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分别对应</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">must</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">must_not</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">.name:(tom +lee -alfred)</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">name:((lee &amp;&amp; !alfred) || (tom &amp;&amp; lee &amp;&amp; !alfred))</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">+</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">url</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中会被解析为空格，要使用</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">encode</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">后的结果才可以，为</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">%2B</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">范围查询，支持数值和日期</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">区间写法，闭区间用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">[]</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，开区间用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">{}</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">age:[1 TO 10]</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">意为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1 &lt;=age&lt;=10</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">age:[1 TO 10}</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">意为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1 &lt;=age&lt;10</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">age:[1 TO]</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">意为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">age&gt;=1</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">age:[* TO 10]</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">意为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">age&lt;=10</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">算术符号写法</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">age:&gt;=1</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">age:(&gt;=1 &amp;&amp; &lt;=10)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">或者</span><span lang="en-US" style="font-family:Calibri; font-size:11.0pt">age:(+&gt;=1 +&lt;=10)</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通配符查询</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">?</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">代表</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个字符，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">*</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">代表</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">0</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">或多个字符</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">name:t?m</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">name:tom*</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">name:t*m</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通配符匹配执行效率低，且占用较多内存，不建议使用</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如无特殊需求，不要将</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">?/*</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">放在最前面</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">正则表达式匹配</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">name:/[mb]oat/</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">模糊匹配</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">fuzzy query</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">name:roam~1</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">匹配与</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">roam</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">差</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">character</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的词，比如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">foam roams</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">近似度查询</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">proximity search</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">&quot;fox quick&quot;~5</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为单位进行差异比较，比如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">&quot;quick fox&quot; &quot;quick brown fox&quot;</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">都会被匹配</span></li></ul></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Request Body Search</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将查询语句通过</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">http request body</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">发送到</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">，主要包含如下参数</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">符合</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Query DSL</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">语法的查询语句</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">from,size</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">timeout</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">sort</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">…</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Query DSL(Domain Specific Language)</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">基于</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">json</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">定义的查询语言，主要包含如下两种类型：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字段查询，如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term,match,range</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等，只针对某一字段进行查询</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">全文匹配</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">针对</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型的字段进行全文检索，会对查询语句先进行分词处理，如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">match</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">match_phrase</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Match query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size: 11.0pt">对字段做全文检索，最基本和常用的查询类型，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">endpoint</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-weight:bold;font-family:&quot;Microsoft YaHei&quot;;font-size: 11.0pt">match</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">API</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">示例如下</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi: embed;margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">GE</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">T test_search_index/_search</span></li></ul></ul></ul></ul></ul></ul></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:3.375in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:3.75in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">&quot;query&quot;:{</p><p lang="en-US" style="margin:0in;margin-left:4.125in;font-family:Calibri;font-size:11.0pt">&quot;<span style="font-weight:bold">match</span>&quot;:{</p><p lang="en-US" style="margin:0in;margin-left:4.5in;font-family:Calibri;font-size:11.0pt">&quot;username&quot;:&quot;alfred way&quot;</p><p lang="en-US" style="margin:0in;margin-left:4.125in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:3.75in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:3.375in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">}</p><ul style="margin-left:3.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [34].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 对 0 询 浯 句 分 词 alfred way alfred 倒 排 索 引 多 个 单 词 之 间 关 系 是 亻 十 么 ？ 只 有 一 忡 卩 可 彡 页 同 时 ？ way 单 词 alfred W 文 档 旧 列 表 根 据 username 的 倒 排 索 1,2 引 进 行 匹 配 算 分 1 Doc 1 根 username 的 倒 排 索 引 进 行 匹 配 算 分 TF/IDF BM25 汇 总 得 分 根 据 得 分 排 序 ， 返 回 匹 配 文 档" height="308" width="600"/></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">operator</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数可以控制单词间的匹配关系，可选项为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">or</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">and</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">minimum_should_match</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数可以控制需要匹配的单词数</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [35].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 字 段 名 request G ET test-search-index/-search query": { •match': { username': { 待 查 询 的 语 句 query': •alfred way ， Query Clause minimum should match': “ 2 “" height="275" width="600"/></li></ul></ul><ul style="margin-left:3.0in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">M</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">atch Phrase Query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">endpoint</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">match_phrase</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">对字段作检索，有顺序要求，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">API</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">示例如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [36].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request 关 踺 词 字 段 名 G ET test_search-index/ search query": { •match phrase': { •job': "java engineer 待 查 询 的 字 符 串 Sea rch Text" height="208" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">slop</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数可以控制单词间的间隔</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [37].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request G ET test_search-index/ search query": { •match phrase': { query•: Java engineer•, 关 词" height="336" width="600"/></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Query String Query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">endpoint</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">query_string</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类似于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">URI search</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">q</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数查询</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [38].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 键 词 指 明 默 认 查 询 的 字 段 名 GET test_search-index/ search query•:{ query_qring•: { 'default field': •username•, query•: •alfred AND way"" height="272" width="600"/></li></ul></ul></ul><p style="margin:0in;margin-left:3.75in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:3.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [39].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 腱 词 指 明 默 认 直 询 的 字 段 名 request G ET test search-index/ search query•:{ query_string•: { "fields': 「 username•,•job"] query': "alfred OR (java AND ruby)"" height="280" width="600"/></li></ul><ul style="margin-left:3.0in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Simple Query String Query</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类似</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">Q</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">uery String</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，但是会忽略错误的查询语法，并且支持部分查询语法，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">endpoint</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-weight:bold;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">simple_query_string</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">其常用的逻辑符号如下，不能使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">AND</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">OR</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">NOT</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等关键词：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">+</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">代指AND</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">-</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">代指NOT</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">|</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">代指OR</span></li></ul></ul></ul><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">单词匹配</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不会对查询语句做分词处理，直接去匹配字段的倒排索引，如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">terms</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">range</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Term Query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">endpoint</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">term</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将查询语句作为整个单词进行查询，即不对查询语句做分词处理，如下所示：</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [40].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request GET test_search-index/-search 关 踺 词 query•:{ •term•:{ username "••alfred"" height="269" width="600"/></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Range Query</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">范围查询主要针对数值和日期类型，如下所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [41].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 腱 词 比 较 关 踺 词 ： gt - greater than gte - greater than or equal to It - less than Ite - | ess than or equal to request GET test_search-index/-search query":{ •gte•: 10 ， •Ite•: 20" height="270" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">针对日期做查询如下所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [42].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request GET test-search-index/-search query•:{ •range': { "birth": { •gte•: 鬥 990 ． 01-01•" height="340" width="466"/></li></ul></ul></ul></ul><p style="margin:0in;margin-left:3.375in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:3.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [43].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request G ET test-search-index/-search query":{ range': { "birth": { gte•: •now-20y• Date Math" height="430" width="466"/></li></ul><ul style="margin-left:3.0in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">D</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ate Math</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">针对日期提供一种更好地计算方式，格式如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [44].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 基 准 日 期 ， 也 可 以 是 具 体 的 日 期 ， 比 如 2018 · 01 · 01 ， 使 用 具 体 日 期 的 时 候 要 用 Il 做 隔 离 now - Id 计 算 公 式 ， 主 要 有 如 下 3 种 ： +1h - 加 1 个 小 时 -Id · 减 1 天 /d - 将 时 间 舍 入 到 天" height="190" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">单位主要有如下几种：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">y - years</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">M - months</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">w - weeks</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">d - days</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">h - hours</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">m - mintues</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">s - seconds</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">假如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">now</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">2018-01-02 12:00:00</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，那么如下的计算结果实际为：</span></li></ul></ul><div style="direction:ltr"><table border="1" cellpadding="0" cellspacing="0" style="direction:ltr; border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width: 1pt;margin-left:3.7083in"><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.4791in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">计算公式</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.3833in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实际结果</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.4791in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">now+1h</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.4527in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">2018-01-02 13:00:00</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.4791in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">now-1h</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.4527in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">2018-01-02 11:00:00</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.4791in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">now-1h/d</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.4527in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">2018-01-02 00:00:00</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.4986in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">2016-01-01||+1M/d</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.4333in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">2016-02-01 00:00:00</p></td></tr></table></div><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">复合查询</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bool</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询等，包含一个或多个字段查询或者复合查询语句</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">复合查询是指包含字段类查询或复合查询的类型，主要包括以下几类</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">constant_score query</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">该查询将其内部的查询结果文档得分都设定为</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">或者</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">boost</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的值</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">多用于结合</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bool</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询实现自定义得分</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [45].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 踺 词 只 能 有 一 个 request G ET test_search_index/_search query":{ constant score': { •filter': { “ match · ： {" height="376" width="600"/></li></ul></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">bool query</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">布尔查询由一个和多个布尔子句组成，主要包含如下</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">4</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个：</span></li></ul></ul></ul></ul><div style="direction:ltr"><table border="1" cellpadding="0" cellspacing="0" style="direction:ltr; border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width: 1pt;margin-left:3.3333in"><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8909in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">filter</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.4291in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">只过滤符合条件的文档，不计算相关性得分</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8909in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">must</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.4986in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">文档必须符合</span><span lang="en-US" style="font-family:Calibri">must</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">中所有条件，会影响相关性得分</span></p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.9104in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">must_not</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.4097in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">文档必须符合</span><span lang="en-US" style="font-family:Calibri">must_not</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">中的所有条件</span></p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8909in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">should</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.4847in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">文档可以符合</span><span lang="en-US" style="font-family:Calibri">should</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">中的条件，会影响相关性得分</span></p></td></tr></table></div><ul style="margin-left:3.0in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bool</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">API</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如下所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [46].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 键 词 支 持 数 组 request G ET test_search-index/-search query": { “ b00 俨 ： { •must": [ must not •should': [" height="412" width="424"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询只过滤符合条件的文档，不会进行相关性算分</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">针对</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">会有智能缓存，因此其执行效率很高</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">做简单匹配查询且不考虑算分时，推荐使用</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">替代</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [47].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request GET test_search-index/-search 关 键 词 term query query": { •term': { username ： •alfred"" height="437" width="600"/></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">must</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [48].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 踺 词 2 个 match query 文 档 最 终 得 分 为 这 两 个 查 询 的 得 分 加 和 G ET test_sea rch index/-search 查 询 username 包 含 alfred query": { 并 且 job 包 含 specialist 关 键 词 “ b00 { 的 文 档 列 表 •match': { · "alfred" username ． •match': { •job": •specialist•" height="344" width="600"/></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">must not</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [49].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 查 询 job 中 包 含 java 关 键 词 但 不 包 含 ruby 关 键 词 的 文 档 列 表 关 词 G ET test_search_index/_search quer 疒 ： { “ b000 { "must': [ •match': { •job": •java• •must not": [ •match': { •job": •ruby"" height="408" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">should</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">使用分两种情况</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bool</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询只包含</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">should</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，不包含</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">must</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询，文档必须满足至少一个条件</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Minimum_should_match</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以控制满足条件的个数或者百分比</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [50].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 踺 词 最 少 满 足 2 个 条 件 request G ET test_search_index/_search query “ b000 { {"term": Cjob": •java"}}, {"term': {"job": •specialist"}} minimum should match": 2" height="409" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bool</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询中同时包含</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">should</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">must</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询，文档不必满足</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">should</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的条件，但是如果满足条件，会增加相关性得分</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [51].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request G ET test search index/_search •query': { “ b000 { {"term":Cusername•:"aIfred"}} •should• 「 job": •ruby"}} {•term": 查 询 username 包 含 alfred 的 文 档 ， 同 时 将 job 包 含 ru by 的 文 档 排 在 前 面" height="333" width="600"/></li></ul></ul></ul><ul style="margin-left:2.625in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">dis_max query</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">function_score query</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">boosting query</span></li></ul><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Query Context VS Filter Context</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">当一个查询语句位于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">或</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上下文时，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">执行的结果会不同，对比如下：</span></li></ul></ul><div style="direction:ltr"><table border="1" cellpadding="0" cellspacing="0" style="direction:ltr; border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width: 1pt;margin-left:2.9583in"><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.9104in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上下文类型</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.7923in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">执行类型</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.4472in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">使用方式</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.9104in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Query</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.7923in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查找与查询语句最匹配的文档，对所有文档进行相关性算分并排序</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.475in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">. query</p><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">. bool</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">中的</span><span lang="en-US" style="font-family:Calibri">must</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">和</span><span lang="en-US" style="font-family:Calibri">should</span></p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.9104in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Filter</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.7923in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查找与查询语句相匹配的文档</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.475in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">. bool</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">中的</span><span lang="en-US" style="font-family:Calibri">filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">与</span><span lang="en-US" style="font-family:Calibri">must_not</span></p><p style="margin:0in;font-size:11.0pt"><span lang="en-US" style="font-family:Calibri">. Constant_score</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">中</span><span lang="en-US" style="font-family:Calibri">filter</span></p></td></tr></table></div><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">GET /my_index/_search</span></li></ul><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">&quot;query&quot;:{</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">&quot;term&quot;:{&quot;user&quot;:&quot;alfred&quot;}</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">}</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">相关性算分</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">相关性算分是指文档与查询语句间的相关度，英文为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">relevance</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过倒排索引可以获取与查询语句相匹配的文档列表，那么如何将最符合用户查询需求的文档放到当前列呢？</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">本质是一个排序问题，排序的依据是相关性算分</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">相关性算分的几个重要概念如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Term Frequency(TF)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">词频，即单词在该文档中出现的次数，词频越高，相关度越高</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Document Frequency(DF)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">文档频率，即单词出现的文档数</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Inverse Document Frequency(IDF)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">逆向文档频率，与文档频率相反，简单理解为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1/DF</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">。即单词出现的文档数越少，相关度越高</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Field-length Norm</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档越短，相关性越高</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">ES</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">目前主要有两个相关性算分模型，如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">TF/IDF</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">模型是</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Lucene</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的经典模型，其计算公式如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [52].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: score(q ， d) 相 关 性 得 分 q 为 查 询 语 句 d 为 匹 配 的 文 档 coord(q,d) · queryNorm(q) · 〗 （ tf(t in d) t in q · idf(t)2 idf 计 算 · t.getBoost() · norm(t ， d) ） Field Length N orm 计 算 t 为 查 询 语 句 分 词 后 的 单 词 计 算" height="157" width="600"/></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">explain</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数来查看具体的计算方法，但要注意：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的算分是按照</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">进行的，即</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的分数计算是相互独立的，所以在使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">explain</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的时候注意分片数</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以通过设置索引的分片数为</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来避免这个问题</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle; font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [53].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request G ET test_search_index/_search "explain": tru e, query": { •match": { username": •alfred way request PUT test search index •settings": { "index•:{ number of shards"•" height="196" width="600"/></li></ul></ul></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">BM25</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">模型</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">5.x</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">之后的默认模型，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">BM</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Best Match</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">25</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指迭代了</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">25</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">次才计算方法，是会对</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">TF/IDF</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的一个优化，其计算公式如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [54].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Given a query 0 ， containing keywords ql ， ． ． · ， q ” ， the BM25 score Of a document D is. 1 一 b + b ． avgdl 当 f() 增 大 时 ， 该 值 会 无 限 接 近 于 f(), D) 指 q, （ 即 查 询 语 句 分 词 kl + 1 后 的 单 词 ） 在 文 档 D 中 的 TF" height="192" width="600"/></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">相关性算分问题</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">相关性算分在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">与</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">间是相互独立的，也就意味着同一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">IDF</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等值在不同的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上是不同的。文档的相关性算分和它所处的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">相关，在文档数量不多时，会导致相关性算分严重不准的情况发生</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">解决思路有两个：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">一是设置分片数为</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个，从根本上排除问题，在文档数量不多的时候可以考虑方案，比如百万到千万级别的文档数量</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">二是使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">DFS Query-then-Fetch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">查询方式，</span><span lang="en-US" style="font-family:Calibri; font-size:11.0pt">DFS Query-then-Fetch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是在拿到所有文档后再重新完整的计算一次相关性算分，耗费更多的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cpu</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和内存，执行性能也比较低下，一般不建议使用。使用方式如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [55].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: req uest G ET test search relevance/_search? sea rc h type=dfs query then fetc h query': { •match":{ •name•:"hello" 指 定 sea rch-type" height="278" width="600"/></li></ul></ul></ul></ul></ul><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Count API</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">获取符合条件的文档数，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">endpoint</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">_count</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [56].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: req uest G ET test search index/ count query":{ •match':{ •alfred" username ： response 'count": 3 ， “ shards": { •total": 1 ， •successful": 1, •skipped": 0 ， "failed": 0" height="206" width="600"/></li></ul><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Source Filtering</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">过滤返回结果中</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">_source</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的字段，主要有如下几种方式：</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [57].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: G ET test_search index/_search? 不 返 回 _source 返 回 部 分 字 段 source=username u rl 参 数 G ET test search index/-search G ET test_search-index/-search source": false G ET test search index/_search source": ["username","age source": { "includes"' "excludes"• "birth"" height="190" width="600"/></li></ul><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Elasticsearch CRUD</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">cr</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">eate</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">创建文档</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">read</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">读取文档</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">update</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">更新文档</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">delete</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">删除文档</span></li></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Elasticsearch create</p><p style="margin:0in;margin-left:.375in"><img src="Elasticsearch与kibana_files/Image [58].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: POST /accounts/person/l name• ： "John• •lastname" ： •Doe* •job_description" ： •Systems administrator and Linux specialit• ， index': •accounts" —type': "person" 到 result": •created•, 。 shards": { "total": 2 ， "successful": l, "failed": 0 •created•: true" height="251" width="600"/></p><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Elasticsearch read</p><p style="margin:0in;margin-left:.375in"><img src="Elasticsearch与kibana_files/Image [59].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: G ET /accounts/person/l " index": "accounts" -type": "person", version": 1 ， "found": true, _source": { name": "John" "lastname": "Doe" "job_description": " System s administrator and Linux specialit"" height="251" width="600"/></p><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Elasticsearch update</p><p style="margin:0in;margin-left:.375in"><img src="Elasticsearch与kibana_files/Image [60].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: POST /accounts/person/l/-update "job_description" ： "Systems administrator and Linux specialist" " index": "accounts", -type": person", version": 2 ， "result": "updated" " shards": { "total": 2 ， successful": 1 ， "failed": 0" height="251" width="600"/></p><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Elasticsearch delete</p><p style="margin:0in;margin-left:.375in"><img src="Elasticsearch与kibana_files/Image [61].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: DELETE [accou nts/perso n/1 DELETE /accou nts "found": true, " index": "accounts" -type": person", version": 3 ， "result": "deleted", " shards": { " tota 俨 ： 2 ， "successful": 1 ， "failed": 0" height="251" width="600"/></p><p style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分布式特性</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">支持集群模式，是一个分布式系统，其好处主要有两个：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">增大系统容量，如内存、磁盘，使得</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">集群可以支持</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">PB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">级的数据</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">提高系统可用性，即使部分节点停止服务，整个集群依然可以正常服务</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">集群由多个</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实例组成</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不同集群通过集群名字来区分，可通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cluster.name</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">进行修改，默认为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">elasticsearch</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">每个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实例本质是一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">jvm</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">进程，且有自己的名字，通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node.name</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">进行修改</span></li></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Cluster state</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">集群相关的数据称为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cluster state</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，主要记录如下信息：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点信息，比如节点名称、连接地址等</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">索引信息，比如索引名称、配置等</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">……</span></li></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Master node</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以修改</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cluster state</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的节点名称为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点，一个集群只能有一个</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Cluster state</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">存储在每个节点上，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">维护最新版本并同步给其他节点</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点是通过集群中所有节点选举产生的，可以被选举的节点称为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">master-eligible</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点，相关配置如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">node.master:true</span></li></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Coordinating node</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">处理请求的节点即为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">coordinating</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点，该节点为所有节点默认角色，不能取消</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">路由请求到正确的节点处理，比如创建索引的请求到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点</span></li></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Data node</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">存储数据的节点即为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">data</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点，默认节点都是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">data</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型，相关配置如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">node.data:true</span></li></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Shard</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分片是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">支持</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">PB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">级数据的基石</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分片存储了部分数据，可以分布于任意节点上</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分片数在索引创建时指定且后续不允许再更改，默认为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">5</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分片有主分片和副本分片之分，以实现数据的高可用</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">副本分片的数据由主分片同步，可以有多个，从而提高读取的吞吐量</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">下图演示的是</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个节点的集群中</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">test_index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的分片分布情况，创建时我们指定了</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个分片和</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个副本，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如下所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">PUT test_index</span></li></ul></ul><p lang="en-US" style="margin:0in;margin-left:.75in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">&quot;settings&quot;:{</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">&quot;number_of_shards&quot;:3,</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">&quot;number_of_replicas&quot;:1</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:.75in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">}</p><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [62].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Cluster [my-cluster] Index [test_index] node2 node3 Primary Shard 主 分 片 nodel PO RI RO Replication Shard 副 本 分 片" height="139" width="600"/></li></ul><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Cluster health</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过如下</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以查看集群健康状况，包括以下三种：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">green</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">健康状态，指所有主副分片都正常分配</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">yellow</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指所有主分片都正常分配，但是有副本分片未正常分配</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">red</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">有主分片未正常分配</span></li></ul></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档分布式存储</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档到分片的映射算法（使得文档均匀地分布在所有分片上，以充分利用资源）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过如下公式计算文档对应的分片</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Shard = hash(routing)%number_of_primary_shards</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">hash</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">算法保证可以将数据均匀地分散在分片中</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">routing</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是一个关键参数，默认是文档</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，也可以自行指定</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Number_of_primary_shards</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是主分片数</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">该算法与主分片数相关，这也是分片数一旦确定后便不能更改的原因</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档创建流程</span></li><ol style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in;font-family:Calibri;font-size:11.0pt; font-weight:normal;font-style:normal" type="1"><li style="margin-top:0;margin-bottom:0;vertical-align:middle" value="1"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt;font-weight:normal; font-style:normal;font-family:Calibri;font-size:11.0pt">client</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt;font-weight:normal; font-style:normal;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">向</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt; font-weight:normal;font-style:normal;font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt;font-weight:normal;font-style:normal;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">发起创建文档的请求</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">routing</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">计算该文档应该存储在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上，查询</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cluster state</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">后确认主分片</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">P1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node2</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上，然后转发创建文档的请求到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node2</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">P1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">接收并执行创建文档请求后，将同样的请求发送到副本分片</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">R1</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">R1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">接收并执行创建文档请求后，通知</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">P1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">成功的结果</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">P1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">接收副本分片结果后，通知</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">创建成功</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">返回结果到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">client</span></li></ol><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档读取流程</span></li><ol style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in;font-family:Calibri;font-size:11.0pt; font-weight:normal;font-style:normal" type="1"><li style="margin-top:0;margin-bottom:0;vertical-align:middle" value="1"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt;font-weight:normal; font-style:normal;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">client</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt;font-weight:normal;font-style:normal;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">向</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt;font-weight:normal;font-style:normal;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt;font-weight:normal;font-style:normal;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">发起获取文档</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt;font-weight:normal;font-style:normal;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt;font-weight:normal;font-style:normal;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">的请求</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">routing</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">计算该文档在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上，查询</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cluster state</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">后获取</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的主副分片列表，然后以轮询的机制获取一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，比如这里是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">R1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，然后转发读取文档的请求到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node1</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">R1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">接收并执行读取文档请求后，将结果返回</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">返回结果给</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">client</span></li></ol><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档批量创建的流程</span></li><ol style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in;font-family:Calibri;font-size:11.0pt; font-weight:normal;font-style:normal" type="1"><li style="margin-top:0;margin-bottom:0;vertical-align:middle" value="1"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt;font-weight:normal; font-style:normal;font-family:Calibri;font-size:11.0pt">client</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt;font-weight:normal; font-style:normal;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">向</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt; font-weight:normal;font-style:normal;font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt;font-weight:normal;font-style:normal;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">发起批量创建文档的请求</span><span lang="en-US" style="font-family: Calibri;font-size:11.0pt;font-weight:normal;font-style:normal;font-family: Calibri;font-size:11.0pt">(bulk)</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">routing</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">计算所有文档对应的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，然后按照主</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分配对应执行的操作，同时发送请求到涉及的主</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，比如这里</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个主</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">都需要参与</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">主</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">接收并执行请求后，将同样的请求同步到对应的副本</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">副本</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">执行结果返回结果到主</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，主</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">再返回</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">整合结果后返回</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">client</span></li></ol><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档批量读取的流程</span></li><ol style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in;font-family:Calibri;font-size:11.0pt; font-weight:normal;font-style:normal" type="1"><li style="margin-top:0;margin-bottom:0;vertical-align:middle" value="1"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt;font-weight:normal; font-style:normal;font-family:Calibri;font-size:11.0pt">client</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt;font-weight:normal; font-style:normal;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">向</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt; font-weight:normal;font-style:normal;font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt;font-weight:normal;font-style:normal;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">发起批量获取文档的请求</span><span lang="en-US" style="font-family: Calibri;font-size:11.0pt;font-weight:normal;font-style:normal;font-family: Calibri;font-size:11.0pt">(mget)</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">routing</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">计算所有文档对应的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，然后以轮询的机制获取要参与</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，按照</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">构建</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">mget</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">请求，同时发送请求到涉及的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，比如这里有</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">2</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">需要参与</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">R1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">R2</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">返回文档结果</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">返回结果给</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">client</span></li></ol></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">脑裂问题</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt"><span style="mso-spacerun:yes"> </span></span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">脑裂问题，英文</span><span lang="en-US" style="font-family:Calibri; font-size:11.0pt">split-brain</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">，是分布式系统中的经典网络问题，如下图所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Node2</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">与</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">会重新选举</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，比如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node2</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">成为了新</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，此时会更新</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cluster state</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Node1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自己组成集群后，也会更新</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cluster state</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">同一个集群有两个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，而且维护不同的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cluster state</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，网络恢复后无法选择正确的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [63].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Cluster [my-cluster] nodel node2 重 新 选 举 node3 女" height="157" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">解决方案为仅在可选举</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master-eligible</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点数大于等于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">quorum</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">时才可以进行</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">选举</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Quorum=master-eligible</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点数</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">/2+1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，例如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">master-elibible</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">节点时，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">quorum</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">2</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">。</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">discovery.zen.minimum_</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">ma</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ster_nodes</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">quorum</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">即可避免脑裂</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [64].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 可 选 举 数 为 2 ， 重 master 可 选 举 数 未 达 到 2 ， 不 选 举 Cluster (my_cl uster] nodel data allocation cluster state 3 网 络 隔 node2 data allocation cluster state 引 node3 女 data allocation cluster state 3 ' 待 网 络 恢 复 后 ， nodel 可 正 常 加 入 集 群" height="159" width="600"/></li></ul></ul><p style="margin:0in;font-family:Calibri;font-size:11.0pt"><span lang="zh-CN">S</span><span lang="en-US">hard</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">倒排索引不可变更</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">倒排索引一旦生成，不能更改</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">其好处如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不用考虑并发写文件的问题，杜绝了锁机制带来的性能问题</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">由于文件不再更改，可以充分利用文件系统缓存，只需载入一次，只要内存足够，对该文件的读取都会从内存读取，性能高</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">利于生成缓存数据</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">利于对文件进行压缩存储，节省磁盘和内存存储空间</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">坏处为需要写入新文档时，必须重新构建倒排索引文件，然后替换老文件后，新文档才能被检索，导致文档实时性差</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [65].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 新 文 档 倒 排 索 引 件 重 新 构 建 倒 排 索 引 文 件 一 开 销 大 ， 时 间 长 文 档 实 时 性 差 文 档 查 询 新 文 档 新 倒 排 索 引 文 件" height="377" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档搜索实时性</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">解决方案是新文档直接生成新的倒排索引文件，查询的时候同时查询所有的倒排文件，然后做结果的汇总计算即可</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [66].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 新 文 档 倒 排 索 引 文 件 0 洵 文 档 开 销 小 ， 提 高 了 文 构 建 倒 排 索 引 文 件 档 实 时 性 倒 排 索 引 文 件 2 查 询 新 文 档" height="360" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">L</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ucene</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">便采用了这种方案，它构建的单个倒排索引称为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，合在一起称为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，与</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">概念不同。</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">对应一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">lucene index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">。</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Lucene</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">会有一个专门的文件来记录所有的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">信息，称为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">commit point</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">。</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [67].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Segment 0 Lucene Index Segment 1 Commit Poi nt Seg ment 2" height="422" width="600"/></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档搜索实时性</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">re</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">f</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">resh</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">se</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">gment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">写入磁盘的过程依然很耗时，可以借助文件系统缓存的特性，先将</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在缓存中创建并开放查询来进一步提升实时性，该过程在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中被称为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">。</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">之前文档会先存储在一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">buffer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">时将</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">buffer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的所有文档清空并生成</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">。</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es默认每</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒执行一次</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，因此文档的实时性被提高到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒，这也是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">被称为近实时</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">(Near Real Time)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的原因。</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">发生的时机主要有如下几种情况：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">间隔时间达到时，通过</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">index.settings.refresh_interval</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来设定，默认是</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Index.buffer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">占满时，其大小通过</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">indices.memory.index_buffer_size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置，默认为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">jvm heap</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">10%</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，所有</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">共享</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">flush</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">发生时也会发生</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">（如果在内存中的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">还没有写入磁盘前发生了宕机，那么其中的文档就无法恢复了，如何解决这个问题？）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">引入</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">t</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">r</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">an</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">slog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">机制，写入文档到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">buffer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">时，同时将该操作写入</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">。</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文件会即时写入磁盘</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">(fsync)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">6.x</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认每个请求都会落盘，可以修改为每</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">5</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒写一次，这样风险便是丢失</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">5</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒内的数据，相关配置为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index.translog.*</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">启动时会检查</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文件，并从中恢复数据</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Flush</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">flush</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">发生的时机主要有如下几种情况：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">间隔时间达到，默认是</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">30</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分钟，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">5.x</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">之前可以通过</span><span lang="en-US" style="font-weight:bold;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">index.translog.flush_threshold_period</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">修改，之后无法修改</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">占满时，其大小可以通过</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">index.translog.flush_threshold_size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">控制，默认是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">512mb</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，每个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">有自己的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">删除与更新文档</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">一旦生成就不能更改，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">lucene</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">专门维护一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">.del</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的文件，记录所有已经删除的文档，注意</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">.del</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上记录的文档在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">lucene</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">内部的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，在查询结果返回前会被滤掉</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">.del</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的所有文档</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">更新文档，首先删除文档，然后再创建新文档</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Segment</span> <span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">me</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">rging</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">随着</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的增多，由于一次查询的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数增多，查询速度会变慢</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">会定时在后台进行</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">s</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">egment</span> <span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">mer</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ge</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的操作，减少</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的数量</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">force_merge api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以手动强制做</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment merge</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的操作</span></li></ul></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">排序</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认会采用相关性算分排序，用户可以通过设定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sorting</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数来自行设定排序规则</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [68].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request G ET test search index/ search 关 踺 词 "birth":"desc" 按 照 出 生 日 期 倒 序 排 列" height="175" width="600"/></li></ul></ul><p style="margin:0in;margin-left:.75in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [69].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 腱 词 指 相 关 性 得 分 指 文 档 内 部 Id ， 和 索 引 的 顺 序 关 份 片 内 唯 一 ） request G ET test_search-index/-search "birth': "desc• score': •desce “ do 芒 ： "desc- 按 照 多 个 字 段 排 序 分 别 按 照 出 生 日 期 倒 排 ， 得 分 倒 排 ， 文 档 内 部 Id 倒 排" height="302" width="600"/></li></ul><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照字符串排序比较特殊，因为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">有</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">keyword</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">两种类型，针对</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型排序，如下所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [70].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: username 是 text 类 型 request G ET test search index/-search •sort•:{ username ： response •error': { •root_ca use• ： [ type": "illegal-argument-exception" reason': •Fielddata is disabled 0 n text fields by default. Set fielddata=true on [username] in order to load fielddata in memory by u ni nverti ng the i nverted index. N Ote that this ca n however use sig n ificant 、 memory. Alternatively use a keyword field instead."" height="203" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">针对</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">keyword</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型排序，可以返回预期结果</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [71].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: username.keyword 是 keyword 类 型 request G ET test search index/_search •sort•:{ username.keyword••"desc• response 气 00k “ ： 3 ， •timed_out•: false, · shards•: { •total•: 1 ， •successful•: 1 ， •skipped•: 0 •failed': 0 •hits': { •total•: 生 max_score•: null, "hits': [ ． index•: •test_search_index• type- · d00" height="236" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">排序的过程实质是对字段原始内容排序的过程，这个过程中倒排索引无法发挥作用，需要用到正排索引，也就是通过文档</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和字段可以快速得到字段原始内容。</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">对此提供了</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">2</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">种实现方式：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filedata</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认禁用</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">doc values</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认启用，除了</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Fielddata vs docvalues</span></li></ul><div style="direction:ltr"><table border="1" cellpadding="0" cellspacing="0" style="direction:ltr; border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width: 1pt;margin-left:.7083in"><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8201in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">对比</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.7805in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Fielddata</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:2.6104in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Docvalues</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8395in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">创建时机</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.7805in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">搜索时即时创建</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:2.7423in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">索引时创建，与倒排索引创建时机一致</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8395in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">创建位置</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.7805in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Jvm heap</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:2.5909in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">磁盘</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8201in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">优点</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.7805in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"><span lang="zh-CN">不会占用额外磁盘资源</span></p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:2.6104in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"><span lang="zh-CN">不会占用</span><span lang="en-US">heap</span><span lang="zh-CN">内存</span></p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.8201in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">缺点</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.8in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"><span lang="zh-CN">文档过多时，即时创建会花过多时间，占用过多</span><span lang="en-US">heap</span></p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:2.7423in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"><span lang="zh-CN">减慢索引的速度，占用额外的磁盘资源</span></p></td></tr></table></div><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">fielddata</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认是关闭的，可以通过如下</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">开启：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">此时字符串是按照分词后的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">排序，往往结果很难符合预期</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">一般是在对分词做聚合分析的时候开启</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [72].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 可 以 随 时 开 启 和 关 闭 request PUT test search index/ mapping/doc properties": { username•:{ •type": text', "fielddata": true" height="272" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">docvalues</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认是启用的，可以在创建索引的时候关闭：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如果后面要再开启</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">doc values</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，需要做</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">reindex</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">操作</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [73].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 设 置 为 false 即 可 request PUT test doc valuesl/ •mappings": { properties": { username": { •type": "keyword• "doc values": false" height="385" width="600"/></li></ul></ul><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">Docvalues_fields</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以通过该字段获取</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">fielddata</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">或者</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">doc values</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中存储的内容</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [74].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 指 明 需 要 的 字 段 request G ET test search_index/_search 'docvalue fields': [ username •username.keyword"" height="244" width="600"/></li></ul></ul></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分页与遍历</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">提供了</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">种方式来解决分页与遍历的问题：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">from/size</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">from</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指明开始位置</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指明获取总数</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">GET test_search_index/_search</span></li></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">&quot;from&quot;:1,</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">&quot;size&quot;:2</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">}</p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">深度分页是一个经典的问题：在数据分片存储的情况下如何获取前</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">1000</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个文档</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">获取从</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">990-1000</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的文档时，会在每个分片上都先获取</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">1000</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个文档，然后再由</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">coordinating node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">聚合所有分片的结果后再排序选取前</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">1000</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">个文档</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">页数越深，处理文档越多，占用内存越多，耗时越长。尽量避免深度分页，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">index.max_result_window</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">限定最多到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">10000</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">条数据</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [75].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: Coordinating Node 1000 园 将 5000 个 文 档 排 序 后 返 回 990 一 1000 的 1000 园 10 佣 园 1000 同 1000 园" height="207" width="600"/></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-weight:bold;font-family:Calibri;font-size:11.0pt">total_page=(total+page_size-1)/page_size</span></li></ul></ul><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">s</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">croll</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">（遍历文档集的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，以快照的方式来避免深度分页的问题：不能用来做实时搜索，因为数据不是实时的；尽量不要使用复杂的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sort</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">条件，使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_doc</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">最高效；使用稍嫌复杂；）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">第一步要发起</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">scroll search</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，如下所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在收到该请求后会根据查询条件创建文档</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">合集的快照</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [76].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request G ET test_search index/-search?scroll= 5m 后 续 调 用 scroll api 时 的 参 数 scroll id•: response size":l 指 明 每 次 scroll 返 回 的 文 档 数 "DXFIZXJ5QW5kRmVOY2gBAAAAAAAABi EWX3FLSTZFOF9URFdqWHIvX3gtYmhtdw 该 scroll 快 照 有 效 时 间" height="179" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">第二步调用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">scroll search</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，获取文档合集，如下所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不断迭代调用直到返回</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">hits.hits</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数组为空时停止</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [77].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 、 request scroll id": response 下 一 次 调 用 使 用 POST search/scroll 指 明 有 效 "scroll• ： "5m" 时 间 •scroll ids: · DXFIZXJ 5QW5 k RmVOY2g BAAAAAAAAB i MWX3FLSTZFOF9URFdqWHlvX3gtYmhtdw 到 took “ ： 35, "hits": { •total": 6 ， max_score" height="254" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">过多的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">scroll</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">调用会占用大量内存，可能通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">clear api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">删除过多的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">scroll</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">快照：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [78].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: req u est DELETE /_search/scroll •scroll_id" ： [ "DXFIZXJ5QW.. "DnFIZXJ5VGhlbk 乙 ““ DELETE I-search/scroll/_all" height="293" width="438"/></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">search_after</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">（避免深度分页的性能问题，提供实时的下一页文档获取功能：缺点是不能使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">from</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数，即不能指定页数；只能下一页，不能上一页；使用简单；）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">第一步为正常搜索，但要指定</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">sort</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">值，并保证值唯一</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">第二步为使用上一步最后一个文档的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sort</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">值进行查询</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [79].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 要 保 障 sort request G ET test_search index/-search •size•:l, "sort":{ age":"desc". " id":"desc" G ET test_search index/-search •size•:l, search after age•:"desc• “ id•:'desc• response •total•: 6 ， 'hits•: [ “ index•: •test search_index• -type•: •doe, “ 28 “ ，" height="282" width="600"/></li></ul></ul><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><div style="direction:ltr"><table border="1" cellpadding="0" cellspacing="0" style="direction: ltr;border-collapse:collapse;border-style:solid;border-color:#A3A3A3; border-width:1pt"><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.9854in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.3048in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">场景</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.9854in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">from/size</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.3743in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">需要实时获取顶部的部分文档，且需要自由翻页</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.9854in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">scroll</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.3048in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">需要全部文档，如导出所有数据的功能</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:1.0048in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">search_after</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.2854in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">需要全部文档，不需要自由翻页</p></td></tr></table></div></li></ul><p style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">聚合分析</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">聚合分析，英文为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Aggregation</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">除搜索功能外提供的针对</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据做统计分析的功能</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">功能丰富，提供B</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ucket</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">metir</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等多种分析方式，可以满足大部分的分析需求</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实时性高，所有的计算结果都是即时返回的，而</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">hadoop</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等大数据系统一般是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">T+1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">级别的</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">聚合分析作为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">search</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的一部分，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如下所示：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [80].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 键 词 ， 与 query 同 级 自 定 义 聚 合 名 称 可 以 包 含 多 个 聚 合 分 析 G ET test search index/-search •size•:O, <aggregation name>• ： { <aggregation type* ： { <aggregation bodY> [,•aggs• ： { [<sub-aggregation>]+ } l? [,•«aggregation name 2 > “ ： 仁" height="183" width="600"/></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">聚合分析</span> <span lang="en-US" style="font-family:Calibri;font-size:11.0pt">-</span> <span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分类</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为了便于理解，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将聚合分析主要分为如下</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">4</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bcuket</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，分桶类型，类似</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">SQL</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">group by</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">语法，即按照一定的规则将文档分配到不同的桶中，达到分类分析的目的</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bucket</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的分桶类型策略，常见的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bucket</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">聚合分析如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Terms</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，该分桶策略最简单，直接按照</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来分桶，如果</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型，则按照分词后的结果分桶</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [81].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 腱 词 指 明 term 字 段 指 定 返 回 数 目 request GET test_search_index/_search •size• ： 0 ， •aggs•: { •jobs': { •terms': { 'field•: •job.keyword' size•: 5" height="282" width="450"/></li></ul></ul></ul></ul></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [82].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: •took': 441, aggregations•: { •jobs': { •doc count_error_u pper_bou n •sum other doc cou nt•: 0 ， •buckets•: [ •key•: •ruby engineer•, •doc count•: 2 •key•: •web engineer•, •doc_count•: 2 response 'key': •Java eng i neer•, •doc count•: 1 'key'. 'Java senior englneer•, ” do （ count•: 1" height="349" width="450"/></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">terms</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不准确解决方法</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，消除数据分散的问题，但无法承载大数据量</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">合理设置</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard_size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的大小，即每次从</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上额外获取数据，以提升准确度</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [83].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: G ET test search index/-search Size": 0 •aggs•: { •terms': { Afield": •job.keyword" Size• ： 1, •shard size":10" height="350" width="300"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard_size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">大小设定方法，设定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">show_term_doc_count_error</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以查看每个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bucke</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">误算的最大值</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Shard_size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认大小如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">Shard_size=(size*1.5)+10</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过调整</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard_size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的大小降低</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">doc_count_error_upper_bound</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来提升准确度，增大了整体的计算量，从而降低了响应时间</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [84].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request G ET test_search-index/-search •size": 0 •aggs•: { •jobs": { •terms": { "field": •job.keyword" •size" ： 乙 •show term doc count error ： true" height="376" width="398"/></li></ul></ul></ul><p style="margin:0in;margin-left:3.0in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:3.0in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [85].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: response 气 00k 。 ： 4 ， aggregations": { 为 0b ： { "doc count_error_upper_bound": 0 ， •sum Other doc_count•: 4 ， "buckets": [ •key': •ru by engineer", 'doc count": 2 ， 'doc count err&r upper bound': 0 0 表 示 计 算 准 确" height="434" width="395"/></li></ul><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">terms</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">聚合返回结果中有如下两个统计值：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">doc_count_error_upper_bound</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">被遗漏的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可能的最大值</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sum_other_doc_count</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">返回结果</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">bucket</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">外其他</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">term</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的文档总数</span></li></ul></ul><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">range</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，通过指定的数值的范围来设定分桶规则</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [86].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 键 词 指 定 每 个 range 的 范 围 request GET test_search-index/-search •size•: 0 ， •aggs•: { ' salary range•: { range•: { ranges•: [ ． to 》 1 •from•: 1 佣 ， •from•: 200" height="445" width="448"/></li></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [87].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: •took': 79 ， aggregations': { •salary range': { 'buckets': [ •key•: “ · 10000 0 。 ， 气 0 。 ： 10000 •doc count': 2 · key• “ 10000 ． 0 ． 2 0 ． 0 》 •from': 10000 ， 气0@： 20000 •doc_count•: 3 response 'key': “ 20 開 0 ． 0 · 艹 •from•: 200 佣 ， •doc count•: 1" height="365" width="452"/></li></ul><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">date range</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，通过指定日期的范围来设定分桶规则</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [88].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 指 定 返 回 结 果 的 日 期 格 式 指 定 日 期 ， 可 以 使 用 date math request GET test_search-index/-search •size•: 0 ， •aggs•: { 'date { •range': { 'field•: •birth', •format•: •yyyy• •ranges•: [ ” from “ ： “ 1980 “ ， "to": “ 1990 “ •from•. ． 1990 》 · to · ： “ 2 “ •from• ， 2 闐 0 ·" height="466" width="454"/></li></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [89].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 气 00k “ ： 14 ， aggregations•: { 'date range': { •buckets': [ •key•: 。 1980 ． 1990 “ ， 'from': 315532800000 •from as string': · 1980 气 0 “ ： 631152 0000 ， 气 0 as string•: 。 1990 “ •doc count': 4 · key' ： · 1990 ． 20m · •from•: 631152000000 response 'from as-stnng•: “ 19 · 气 0 · ： 946684800000 •to-as-string ' ： “ 2000 · •doc count• ： 2 •from•: 946684800000 'from as-string•: “ 2 佣 0 “ 'doc count': 0" height="341" width="457"/></li></ul><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">histogram</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，直方图，以固定间隔的策略来分割数据</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [90].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 键 词 指 定 间 隔 大 小 指 定 数 据 范 围 request G ET test_search-index/-search Size• ： 0 ， •salary hist•:{ •histogram': { 'field': •sala · •interval': 5000 •extended bounds•: { min•: 0 ， max•: 40000" height="375" width="458"/></li></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [91].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: •took': 23 ， aggregations': { •salary hist•: { 'buckets': [ •doc count 》 0 •key': 5 0 'doc count•: 2 •key•: 1 00 尾 0 （ count•: 2 'key•: 15000 ， •doc count': 1 response •key•: 2 佣 00 'doc count• ： 0 •key': 25 0 ， 尾 0 （ count•: 0 •key": 3 佣 00 ， 'doc count• ： 1 •keys: 35000, 'doc count• ： 0 •key". 40000 ， 尾 0 （ count• ： 0" height="472" width="460"/></li></ul><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">date histogram</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，针对日期的直方图或者柱状图，是时序数据分析中常用的聚合分析类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [92].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 键 词 指 定 间 隔 大 小 指 定 日 期 格 式 化 request GET test_search index/_search Size• ： 0 ， •date istogram•: { •field•: •birthi •interval•: •year •format•:•yyyy" height="315" width="466"/></li></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [93].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 气 00k “ ： 208 ， aggregations': { · byyear•: { 'buckets': [ · key a s string•: @1980 · key• ： 3155328 佣 0 佣 ， •doc count': 1 •key-as-string•: “ 198r •key': 3471 S52 佣 000 ， 'doc count': 0 •key-as-string': @1982 “ •key': 3786912 佣 000 ， •doc_count•: 0 response •key-as-stnng•: “ 1983 》 •key•: 410227200000 •doc_count•: 0 •key-as-stnng•: “ 19 · ' key• ， 1763200000 ， 尾 00 （ ount · ： 0 •key-as-stnng•: “ 1985 》 ' key• ： 473385 0000 尾 一 （ oun 亡 1 · key-as_stnng ' ： “ 1986L ． key• ： 5 921 0000 'doc_count•: 0 · key-as-string · ： “ 1987L @key• ： 53 57 0000" height="452" width="468"/></li></ul><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">metric</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，指标分析类型，如计算最大值、最小值、平均值等等</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">单值分析，只输出一个分析结果</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">min,max,avg,sum</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">返回数值类字段的最小值</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [94].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 不 需 要 返 回 文 档 列 表 req uest G ET test_search-index/-search "size":O, ， 是 否 返 回 文 档 列 表 •r\in age•:{ 关 腱 词 e 尾 “ ： •age•" height="215" width="395"/></li></ul></ul></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [95].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: response 气 00 贮 ： 409 ， •timed out• ： false, @ shards': { •total•: 1, •successful• ： 1 ， •skipped•: 0 ， •failed': 0 'hits': { 气 Ota 「 ： 6 ， max_score• ： 0 ， · hits• ： O aggregations': { min_age•: { •value': 18" height="383" width="241"/></li></ul><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Cardinality</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，意为集合的势，或者基数，是指不同数值的个数，类似SQ</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">L</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">distinct count</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的概念</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [96].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 踺 词 req uest G ET test search index/ search •size' ： 0 ， •count ofjob•:{ •cardinality•: { e 尾 · ： •job.keyword•" height="289" width="406"/></li></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [97].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: response 气 00k · ： 12 •timed_out•: false, “ shards•: { 气 Ota 「 ： 1, •successful• ： 1 ， •skipped": 0 •failed': 0 •total': 6 ， max_score• ： 0 aggregations': { •count ofjob': { •value•: 4" height="454" width="287"/></li></ul><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">多值分析，输出多个分析结果</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">stats,extended stats</span></li></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [98].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 踺 词 request G ET test search index/-search •size' ： 0 ， •stats age•:{ •stats•: { •fiel 返 回 一 系 列 数 值 类 型 的 统 计 值 ， 包 max ， aVg ， Sum ， count" height="272" width="376"/></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [99].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: response ， took · ： 498 ， •timed ou 旷 ： false, ， shards•: { 气 Ota 「 ： I, •successful•: 1 ， •skipped": 0 •failed': 0 aggregations · stats age': { •count': 6 ， 矶 18 ， ml n · max “ ： 22 ． 5 ， avg 135 sum ·" height="446" width="280"/></li></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [100].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 踺 词 req I-jest G ET test_search index/-search •size• ： 0 •stats_age•:{ •extended stats•: { e 尾 · ： •age- 对 stats 的 扩 展 ， 包 含 了 更 多 的 统 计 数 据 ， 如 方 差 、 标 准 差 等" height="242" width="343"/></li></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.625in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [101].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: response 气 00k ， ： 52, •ti med out•: false, aggregations': { •stats age•: { •count': 6 ， •min•: 18 ， •max': 2 & •avg': 225 •sum•: 13s •sum Of squares': 312L •variance': 13 ． 916666666666666 •std deviation•: 3 ， 7305 880933232 ， •std deviation bounds•: { •upper•: 29 ． 96100976186M64 ， •lowe 亡 15 ． 038990238133536" height="373" width="296"/></li></ul><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">percentile,percentile rank</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">top hits</span></li></ul><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，管道分析类型，基于上一级的聚合分析结果进行再分析，</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">pipeline</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的分析结果会输出到原结果中，根据输出位置的不同，分为以下两类：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">parent</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">结果内嵌到现有的聚合分析结果中</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">derivative</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">moving average</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">cumulative sum</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sibling</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">结果与现有聚合分析结果同级</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">max/min/avg/sum bucket</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [102].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 键 词 request GET test-search_index/-search •size•:0, •jobs•:{ •terms': { 'field “ ： •job.keyword• •size•: 10 •avg sa lary•:{ •field•: •salary' •min salary byjob•:{ •min bucket•: { •buckets path•: •jobs>avg-salary•" height="525" width="483"/></li></ul></ul></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [103].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 气 00k · ： 97 ， aggregations': { •doc count_error_upper_bound •sum other do 《 （ ou nt• ： 0 ， •buckets': [ · key•: •ruby eng i n 0 'doc count•: 2 ， •avg-salary•: { •value•: 135 佣 •key': •web eng ineer •doc_count•: 2 ， •avg-salary': { •value": 6500 response •key•. •Java engi neer•, 'doc count• ： 1 ， •avg-salary• ： { •value': 1 佣 •min salary byjob': { •value•: 6500 ， •web eng i neer•" height="458" width="483"/></li></ul><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">stats/extended stats bucket</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">percentils bucket</span></li></ul><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">matrix</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，矩阵分析类型</span></li></ul><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">作用范围</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">聚合分析默认作用是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的结果集，可以通过如下的方式改变其作用范围：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为某个聚合分析设定过滤条件，从而在不更改整体</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">语句的情况下修改了作用范围</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [104].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: GET test_search index/ search •size': 0 ， •aggs•: { •jobs salary small"• 过 滤 •range•: { •salary": { 气 0 。 ： 100m •jobs': { •terms 'field'. •job.k ord" request •jobs': { •terms 'field•: •job.keyword"" height="377" width="454"/></li></ul></ul></ul></ul><p style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [105].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 气 00k “ ： 7 在 aggregations': { 'doc-count-error-upper-bound' 0 •sum Other doc cou nt•.• 0 ， 'buckets': [ ' key• ： •ruby engi neer•, •doc_count•: 2 ' key• ： •web eng ineer•, •doc count•: 2 ' key• ： •Java eng ineer•, •doc_count•: 1 response key•. Java senior eng ineer•, •doc cou nt•: 1 •jobs { 'doc cou nt•: 3 ， •jobs•: { •doc-count-error-upper-bound•: 0 ， •sum_other doc_count•: 0 'buckets•: [ •key': •web engineer •doc count': 2 •key': •java engineer% •doc count': 1" height="387" width="460"/></li></ul><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">post_filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">作用于文档过滤，但在聚合分析后生效</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">global</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">无视</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">过滤条件，基于全部文档进行分析</span></li></ul><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">排序</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以使用自带的关键数据进行排序，比如：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_count</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档数</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_key</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">按照</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">key</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">值排序</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [106].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request GET test search index/_search •size• ： 0 ， •jobs•: { •terms•: { •field': •job-keyword ． ， •size': 10 •order': [ count"• asc 指 明 多 个 排 序 值 " key":"desc"" height="441" width="469"/></li></ul></ul></ul><p style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">近似统计算法</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的聚合分析中，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">cardinality</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">percentile</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分析使用的是近似统计算法</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">结果是近似准确的，但不一定精准</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以通过参数的调整使其结果精准，但同时也意味着更多的计算时间和更大的性能消耗</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [107].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 《 海 量 数 据 ！ 权 衡 三 者 只 能 取 其 二 § 实 时 性 准 确 度 訁" height="442" width="600"/></li></ul></ul><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据建模</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">英文为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">data modeling</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，为创建数据模型的过程</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据模型（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">data model</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">对现实世界进行抽象描述的一种工具和方法</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">通过抽象的实体及实体之间的联系的形式去描述业务规则，从而实现对现实世界的映射</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据建模过程</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">概念模型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">确定系统的核心需求和范围的边界，设计实体和实体之间的关系</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">逻辑模型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">进一步梳理业务需求，确定每个实体的属性、关系和约束等</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">物理模型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">结合具体的数据库产品，在满足业务读写性能等需求的前提下确定最终的定义</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">MySQL</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">MongoDB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">elasticsearch</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">等</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">第三范式</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是基于</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">lucene</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">以倒排索引为基础实现的存储体系，不遵循关系数据库中的范式约定</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [108].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 业 务 需 求 数 据 需 求 部 署 需 求 性 能 需 求 丨 概 念 / 逻 辑 模 型 物 理 模 型 · 实 体 列 表 · 实 体 属 性 描 述 · 实 体 间 关 系 描 述 ES Index Template ES Index Mapping 配 置 - 字 段 配 置 - 索 引 关 系 处 理" height="234" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">mapping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字段相关设置</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">enabled</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">true|false</span></li></ul><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">仅存储，不做搜索或数据分析</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">index</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">true|false</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否构建倒排索引</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">index_options</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">docs|freqs|positions|offsets</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">存储倒排索引的哪些信息</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">norms</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">true|false</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否存储归一化相关参数，如果字段仅用于过滤和聚合分析，可关闭</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">doc_values</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">True|false</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否启用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">doc_values</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，用于排序和聚合分析</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">field_data</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">false|true</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型启用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">fielddata</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，实现排序和聚合分析</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">store</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">false|true</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否存储该字段值</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">coerce</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">true|false</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否开启自动数据类型转换功能，比如字符串转为数字、浮点转为整型等</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">multifields</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">多字段</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">灵活使用多字段特性来解决多样的业务需求</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">d</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ynamic</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">true|false|strict</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">控制</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">mapping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">自动更新</span></li></ul><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">data_detection</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">true|false</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否自动识别日期类型</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">mapping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字段属性的设定流程</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [109].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 是 何 种 类 型 ？ 是 否 需 要 另 行 存 储 ？ 是 否 需 要 检 索 ？ 是 否 需 要 排 序 和 聚 合 分 析 ？" height="286" width="600"/></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是何种类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">字符串类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">需要分词则设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">text</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型，否则设置为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">keyword</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">枚举类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">基于性能考虑将其设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">keyword</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">类型，即便该数据为整型</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数值类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">尽量选择贴近的类型，比如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">byte</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">即可表示所有数值时，即选用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">byte</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，不要用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">long</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">其他类型</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">比如布尔类型、日期、地理位置数据等</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否需要检索</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">完全不需要检索、排序、聚合分析的字段</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">enabled</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">false</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不需要检索的字段</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">false</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">需要检索的字段，可以通过如下配置设定需要的存储粒度</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Index_options</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">结合需要设定</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">norms</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不需要归一化数据时关闭即可</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否需要另行存储</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sto</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">r</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">e</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">true</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，即可存储该字段的原始内容（与</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_source</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的不相关）</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">一般结合</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_source</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">enabled</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">false</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">时使用</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是否需要排序和聚合分析</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不需要排序或者聚合分析功能</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">doc_values</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">false</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">fielddata</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">false</span></li></ul></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">关联关系处理</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不擅长处理关系数据库中的关联关系，比如文章表</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">blog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">与评论表</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">comment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">之间通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">blog_id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">关联，在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中可以通过如下两种手段变相解决</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">nested object</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实例：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">评论</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">comment</span></li></ul></ul></ul></ul></ul><p style="margin:0in;margin-left:2.25in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">文章</span><span lang="en-US" style="font-family:Calibri">id blog_id</span></p><p style="margin:0in;margin-left:2.25in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">评论人</span> <span lang="en-US" style="font-family:Calibri">username</span></p><p style="margin:0in;margin-left:2.25in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">评论日期</span> <span lang="en-US" style="font-family:Calibri">dat</span><span lang="zh-CN" style="font-family: Calibri">e</span></p><p style="margin:0in;margin-left:2.25in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">评论内容</span> <span lang="en-US" style="font-family:Calibri">content</span></p><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在关系数据库中实现</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [110].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: •title•:"BIog Number One", •author":"alfred" 两 张 表 实 现 Comment 1 •blog id•:"l" username":"lee “ date 2017 ． 01 ． 02 》 •content":•awesome article ！ “ Comment 2 username":•fax• 尾 ate ？ 2017 ． 04 ． 02 》 •content•:•thanks!"" height="329" width="524"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中实现（</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">ne</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">sted object</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [111].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: "title": " 引 og Number One" "authqr": "alfred• comments': [ "date": “ 2017 · 01 · 02L •content": •awesome article!• username": •fax" "date": “ 2017 · 04 ． 02L "content" "thanks!"" height="320" width="237"/></li></ul></ul><p style="margin:0in;margin-left:2.25in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [112].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: response GET blog-index/-search q uery•: { •must': [ •match•: { comments.username ： •match•: { request •lee• •thanks• “ hits•: [ “ index•: •blog-index' •-type•. •doc", •_score•: 0 ． 57S364 乙 source•: { •title•: ' 引 og Number One", •author•: •alfred• comments•: [ username•: 'date": ． 2017 · 01 ． 02 》 •content': •awesome article! “ username': •fax• •date": · 2017 · · 02L •content•: •thanks!•" height="366" width="600"/></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">c</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">omments</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认是一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">object array</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，存储结构类似下面的形式：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [113].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: •title•: · 引 og Number One•, 。 author': •alfred' comments.username•: [ •lee• ． ～ ． 一 一 字 段 以 列 表 的 形 式 •comments.date•: 〔 · 2017 ． 01 ． 02 •, ． 2017 · ． 02 “ comments-content awesome article!• •thanks!•" height="411" width="279"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Nested object</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">可以解决这个问题</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [114].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: PUT blog index nested •mappings": { “ do 亡 { properties': { •title•:{ •type': •text", "fields': { 'keyword":{ •type" ： · keyword ' •ignore above': 100 •publish-date•:{ •type' ： ' date" •author•:{ •type•:"keyword•, ignore a bove•: 100 指 定 c 。 皿 ent 字 段 类 型 为 nested •abstract•:{ •type': •text' •enabled•:false •comments•:{ -Atype•:•nested", properties": { u sername• ： { •type•:"keyword" 'ignore-above•:100 'date•:{ type' :"date• •content•:{ type' ： •text-" height="361" width="456"/></li></ul></ul><p style="margin:0in;margin-left:2.625in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:2.625in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [115].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: req u est GET blog_index-nested/_search q uery•: { 查 询 时 指 定 关 键 词 path •path': •comments', query•: { “ b00 「 ： { •must": [ •match": { •lee' comments.username• 、 •match": { ： •thanks• •comments.content•" height="409" width="268"/></li></ul><ul style="margin-left:2.25in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Nested object array</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的存储结构类似下面的形式：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [116].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: •title•: · 引 og Number One' •author•: •alfred• comments.username•: •lee• •comments.date•: · 2017 ． 01 ． 0 丆 comments.content•: •awesome article! “ •comments.username•: •fax• .com ments.date•: ' 2017 ． ． 02L •thanks!• .com ments.content•." height="263" width="302"/></li></ul></ul><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">parent/child</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">还提供了类似关系数据库中</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">join</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的实现方式，使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">join</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据类型实现</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [117].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 指 明 类 型 父 类 型 名 称 PUT 刨 og index_parent child mappings•: { · do 亡 { properties•: { type': •join•, •relations•: { •blog': •comment• 指 明 父 子 关 系 子 类 型 名 称" height="278" width="600"/></li></ul></ul></ul><p style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.875in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [118].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 指 明 父 类 型 指 明 子 类 型 指 明 父 文 档 Id request # 创 建 父 文 档 PUT b | 09 index_parent child/doc/l •title•:•blog join•:'blog• # 创 建 子 文 档 PUT blog-index-parent child/doc/comment-l?routing=l comment• :•comment world “ name ： comment ， parent•:l 指 明 routing 值 ， 确 保 一 般 使 用 父 文 档 Id" height="213" width="600"/></li></ul><ul style="margin-left:1.5in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">常见</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">语法包括如下几种：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">parent_id</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">返回某父文档的子文档</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [119].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 键 词 指 定 子 文 档 类 型 GET blog-index-parent_child/_search •query•:{ pa rent id':{ type':•comment', 指 明 父 文 档 id" height="156" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">has_child</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">返回包含某子文档的父文档</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [120].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 腱 词 指 定 子 文 档 类 型 GET blog-index-parent_child/_search •query•:{ •has child•: { type': •comment', •query': { •match": { •comment': •world• 指 明 子 文 档 的 查 询 条 件" height="213" width="600"/></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">has_parent</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">返回包含某父文档的子文档</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [121].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 关 踺 词 指 定 父 文 档 类 型 blog-index-parent_ch ild/_search query•:{ •has parent•: { parent_type•: •blog', query': { •match•: { •title•: 'blog• 指 明 父 文 档 的 查 询 条 件" height="204" width="600"/></li></ul></ul></ul><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">nested object vs parent/child</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><div style="direction:ltr"><table border="1" cellpadding="0" cellspacing="0" style="direction: ltr;border-collapse:collapse;border-style:solid;border-color:#A3A3A3; border-width:1pt"><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.6673in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">对比</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:2.6534in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">netsted object</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.6069in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">parent/child</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.6673in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">优点</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:2.6534in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文档存储在一起，因此读取性能高</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.6069in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">父子文档可以独立更新，互不影响</p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.6673in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">缺点</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:2.6729in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">更新父或子文档时需要更新整个文档</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.7388in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-size:11.0pt"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">为了维护</span><span lang="en-US" style="font-family:Calibri">join</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;">的关系，需要占用部分内存读取性能较差</span></p></td></tr><tr><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:.6673in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">场景</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:2.6534in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">子文档偶尔更新，查询频繁</p></td><td style="border-style:solid;border-color:#A3A3A3;border-width:1pt; vertical-align:top;width:3.6069in;padding:2.0pt 3.0pt 2.0pt 3.0pt"><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">子文档更新频繁</p></td></tr></table></div></li></ul></ul><p style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p lang="en-US" style="margin:0in;font-family:Calibri;font-size:11.0pt">Reindex</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">指重建所有数据的过程，一般发生如下情况：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">mapping</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置变更，比如字段类型变化、分词器字典更新等</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置变更，比如分片数更改等</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">迁移数据</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">提供了现成的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">API</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">用于完成该工作</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">update_by_query</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在现有索引上重建</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size: 11.0pt"><img src="Elasticsearch与kibana_files/Image [122].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 将 blog-index 的 所 有 文 档 POST blog index/ update by query?conflicts=proceed 如 果 遇 至 刂 版 本 冲 突 ， 覆 盖 并 继 续 执 行" height="78" width="600"/></li></ul></ul></ul><p style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [123].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 更 新 文 档 的 字 段 值 可 以 更 新 部 分 文 档 POST blog-index/ update by query script': { source": “ CtX. source.likes++" "lang": "painless• query': { "term": { user': •tom"" height="203" width="438"/></li></ul><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">_reindex</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在其他索引上重建</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [124].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 将 sou rce 的 数 据 重 建 到 dest 中 POST reindex •source": { "index• "dest•: { •index• "blog-index" "blog-new-index"" height="207" width="491"/></li></ul></ul><p style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [125].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: 冲 突 时 覆 盖 并 继 续 POST reindex •conflicts': proceed source': { •index": "blog-index" •queryn: { •term": { user•: •tom Odest•: { "index ． "blog-new index"" height="338" width="461"/></li></ul><ul style="margin-left:.75in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据重建的时间受源索引文档的规模的影响，当规模越大时，所需时间越多，此时需要通过设定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">url</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参数</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">wait_for_completion</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">false</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来异步执行，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">以</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">task</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来描述此类执行任务</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">提供了</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">task api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来查看任务的执行进度和相关数据</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [126].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: request POST blog_index/-update-by-query? conflicts=proceed&wait for completion=false request GET tasks/_qK16E8_TDWJXyo_x-bhmw:5661996 关 键 字 response •task•: •_qK16E8_TDWJXyo_x-bhmw:5661996• response •completed": true, •task": { “ node•: qK16E8_TDWjXyo_x-bhmw•, •id•: 5661996 ， •type•: •transport", •action•: · ind ices:data/write/u pdate/ byquery•, •status': { •total': 1, •updated•: 1, •created•: 0 'deleted•: 0 ， 'batches': 1 ， version conflicts noops•: 0 •retries•: { •bulk•: 0 ，" height="372" width="600"/></li></ul></ul><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt"> </p><p style="margin:0in;font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">集群调优</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置尽量简洁</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Elasticsearch.yml</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中尽量只写必备的参数，其他可以通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">动态设置的参数都通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">来设定</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">参见文档</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">“</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">setup elasticsearch -&gt; important elasticsearch configuration</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">”</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">随着</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">版本的升级，很多网络流传的配置参数已经不再支持，因此不需要随便复制别人的集群配置参数</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">Elasticsearch.yml</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中建议设定的基本参数</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">cluster.name</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">node.name</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">node.master/node.data/node.ingest</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">network.host</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">建议显示指定为网</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ip</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，不要偷懒直接设为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">0.0.0.0</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">discovery.zen.ping.unicast.hosts</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定集群其他节点地址</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">discovery.zen.minimum_master_nodes</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">一般设定为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">2</span></li><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">path.data/path.log</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">除上述参数外再根据需要再增加其他的静态配置参数</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">动态设定的参数有</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">transient</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">persistent</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">两种设置，前者在集群重启后会丢失，后者不会，全两种设定都会覆盖</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">elasticsearch.yml</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的配置</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">PUT /_culster/settings</span></li></ul></ul></ul><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt">{</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">&quot;persistent&quot;:{</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">&quot;discovery.zen.minimum_master_nodes&quot;:2</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">},</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">&quot;transient&quot;:{</p><p lang="en-US" style="margin:0in;margin-left:1.875in;font-family:Calibri;font-size:11.0pt">&quot;indices.store.throttle.max_bytes_per_sec&quot;:&quot;50mb&quot;</p><p lang="en-US" style="margin:0in;margin-left:1.5in;font-family:Calibri;font-size:11.0pt">}</p><p lang="en-US" style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt">}</p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">jvm</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">内存设定</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">不要超过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">31GB</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">预留一半内存给操作系统，用来做文件缓存</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">具体大小根据该</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">要存储的数据量来估算，为了保证性能，在内存和数据量有一个建议比例</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">搜索类项目的比例建议在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1:16</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">以内</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">日志类项目的比例建议在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1:48~1:96</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">假设总数据量大小为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1TB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个副本，那么每个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">要存储的数据量为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">2TB/3=666GB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，即</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">700GB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">左右，做</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">20%</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的预留空间，每个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">要存储大约</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">850GB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的数据</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如果是搜索类项目，每个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">内存大小为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">850GB/16=53GB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，大于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">31GB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">。</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">31*16=496</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，即每个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">最多存储</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">496GB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据，所以需要至少</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">5</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如果是日志类型项目，每个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">内存大小为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">850GB/48=18GB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，因此</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">3</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个节点足够</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">es写数据过程</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">refresh</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">写入磁盘的过程依然很耗时，可以借助文件系统缓存的特性，先将</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在缓存中创建并开放查询来进一步提升实时性，该过程在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中被称为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">；</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">之前文档会先存储在一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">buffer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">时将</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">buffer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中的所有文档清空并生成</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">；</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认每</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒执行一次</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，因此文档的实时性被提高到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒，这也是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">被称为近实时（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">near real time</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">）的原因。</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">（解决内存中的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">还没有写入磁盘前发生空宕机，文档无法恢复的问题）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">引入</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">机制。写入文档到</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">buffer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">时，同时将该操作写入</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">；</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文件会即时写入磁盘（</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">fsync</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">），</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">6.x</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认每个请求都会落盘，可以修改为每</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">5</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒写一次，这样风险便是丢失</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">5</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">秒内的数据，相关配置为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index.translog.*</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">；</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">启动时会检查</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文件，并从中恢复数据。</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">f</span><span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">l</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ush</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">（负责将内存中的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">写入磁盘）</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">写入磁盘；</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index buffer</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">清空，其中的文档生成一个新的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，相当于一个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">操作；</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">更新</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">commit point</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">并写入磁盘；</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">执行</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">fsync</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">操作，将内存中的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">segment</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">写入磁盘；</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">删除旧的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">文件。</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">写性能优化</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">目标是增大写吞吐量</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">-EPS(events per second)</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size: 11.0pt">越高越好</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">优化方案</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">客户端：多线程写，批量写</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">ES</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">：在高质量数据建模的前提下，主要是</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">、</span><span lang="en-US" style="font-weight:bold; font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">和</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">flush</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">之间做文章</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">目标为降低</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">频率</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">增大</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">refresh_interval</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;; font-size:11.0pt">，降低实时性，以增大一次</span><span lang="en-US" style="font-family: Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">处理的文档数，默认是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1s</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，设置为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">-1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">直接禁止自动</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">refresh</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">；</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">增大</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index buffer size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，参数为</span><span lang="en-US" style="font-weight:bold;font-family:Calibri; font-size:11.0pt">indices.memory.index_buffer_size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">（静态参数，需要设定在</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">elasticsearch.yml</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">中），默认为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">10%</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">；</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">目标是降低</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">写磁盘的频率，从而提高写效率，但会降低容灾能力</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">index.translog.burability</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">设置为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">async</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，</span><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">index.translog.sync_interval</span><span lang="zh-CN" style="font-family: &quot;Microsoft YaHei&quot;;font-size:11.0pt">设置需要的大小，比如</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">120s</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，那么</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">会改为每</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">120s</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">写一次磁盘；</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">index.translog.flush_threshold_size</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">默认为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">512MB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，即</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">translog</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">超过该大小时会触发一次</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">flush</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，那么调大该大小可以避免</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">flush</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的发生。</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">副本设置为</span><span lang="en-US" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">0</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，写入完毕后再增加</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">合理地设计</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数，并保证</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">均匀地分配在所有</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上，充分利用所有</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的资源</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-weight:bold;font-family:Calibri;font-size:11.0pt">index.</span><span lang="zh-CN" style="font-weight:bold;font-family:Calibri; font-size:11.0pt">rout</span><span lang="en-US" style="font-weight:bold; font-family:Calibri;font-size:11.0pt">ing.allocation.total_shards_per_node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">限定每个索引在每个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上可分配的总主副分片数</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">5</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，某索引有</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">10</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个主分片，</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个副本，上述值应该设置为多少？</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="square"><li lang="en-US" style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:Calibri;font-size:11.0pt">(10+10)/5=4</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">实际设置为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">5</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个，防止某个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">node</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">下线时，分片迁移失败的问题</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">主要为</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">index</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">级别的设置优化，以日志场景举例，一般会有如下的索引设定：</span></li></ul></ul><p style="margin:0in;margin-left:1.125in;font-family:Calibri;font-size:11.0pt"> </p><ul style="margin-left:1.125in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle;font-size:11.0pt"><img src="Elasticsearch与kibana_files/Image [127].png" type="image/png" data-filename="Image.png" alt="计算机生成了可选文字: •settings•: { •index•: { " refresh interval": “ 30S " •number of shards': “ 5 · ， •routing": { •allocation": { •total shards per node': · 3 。 •translog•: { sync interval': •30s", •durability': •async- number of replicas•: 。 0 “ •mappings•:( · do 亡 { •dynamic-false, properties• ： { [ data model ]" height="446" width="275"/></li></ul><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">读性能优化</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据建模，高质量数据建模是优化的基础</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">将需要通过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">script</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">脚本动态计算的值提前算好作为字段存到文档中</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">尽量使得数据模型贴近业务模型</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数据规模，根据不同的数据规模设定不同的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">SLA</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上万条数据与上千万条数据性能肯定存在差异</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">索引配置调优，索引配置优化主要包括如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">根据数据规模设置合理的主分片数，可能通过测试得到最适合的分片数</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设置合理的副本数目，不是越多越好</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">查询语句调优，查询语句调优主要有以下几种常见手段</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">尽量使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">上下文，减少算分的场景，由于</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">filter</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">有缓存机制，可以极大提升查询性能</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">尽量不使用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">script</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">进行字段计算或者算分排序等</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">结合</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">profile</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">、</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">explain</span> <span lang="zh-CN" style="font-family:Calibri;font-size:11.0pt">api</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">分析慢查询语句的症结所在，然后再去优化数据模型</span></li></ul></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">如何设定</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="circle"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">es</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的性能基本是线性扩展的，因此我们只要测出</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的性能指标，然后根据实际性能需求就能算出需要的</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">数。比如单</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">写入</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">eps</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">10000</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，而线上</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">eps</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">需求是</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">50000</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，那么你需要</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">5</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">。（实际还要考虑副本的情况）</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">测试</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">1</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">个</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">的流程如下：</span></li><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">搭建与生产环境相同配置的单节点集群</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">设定一个单分片零副本的索引</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">获取实际生产数据进行测试，获取写性能指标</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">针对数据进行查询请求，获取读性能指标</span></li></ul><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">压测工具可以采用</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">esrally</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">压测的流程还是比较复杂，可以根据经验来设定。如果是搜索引擎场景，单</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">大小不要超过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">15GB</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">，如果是日志场景，单</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">大小不要超过</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">50GB(shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">越大，查询性能越低</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">)</span></li><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">此时只要估算出你索引的总数据大小，然后再除以上面的单</span><span lang="en-US" style="font-family:Calibri;font-size:11.0pt">shard</span><span lang="zh-CN" style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">大小也可以得到分片数。</span></li></ul></ul><p style="margin:0in;font-family:Calibri;font-size:11.0pt"> </p><p style="margin:0in;font-family:Calibri;font-size:11.0pt"><span lang="zh-CN">x</span><span lang="en-US">-pack monitoring</span></p><ul style="margin-left:.375in;direction:ltr;unicode-bidi:embed; margin-top:0in;margin-bottom:0in" type="disc"><li style="margin-top:0;margin-bottom:0;vertical-align:middle"><span style="font-family:&quot;Microsoft YaHei&quot;;font-size:11.0pt">官方推出免费集群监控功能</span></li></ul></div></div></div><div><p style="margin:0in"> </p><p style="text-align:left;margin:0in;font-family:Arial;font-size:9pt; color:#969696;direction:ltr">已使用 Microsoft OneNote 2016 创建。</p></div></span>
</div></body></html> 