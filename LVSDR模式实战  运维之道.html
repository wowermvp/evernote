<html>
<head>
  <title>LVS/DR模式实战 | 运维之道</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="589"/>
<h1>LVS/DR模式实战 | 运维之道</h1>

<div>
<span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="box-sizing:border-box;font-family:sans-serif;text-size-adjust:100%;font-size:62.5%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);"><div style="box-sizing:border-box;font-family:&quot;Microsoft Yahei&quot;, Helvetica, Arial, sans-serif;font-size:12px;color:rgb(61, 68, 80);background:url(&quot;../images/bg.jpg&quot;);word-wrap:break-word;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;border-radius:4px;background-color:rgb(255, 255, 255);box-shadow:rgb(194, 194, 194) 0px 0px 5px;"><div style="box-sizing:border-box;"><p style="box-sizing:border-box;margin:0px 0px 10px;">线上服务器清理的差不多了，准备做一下服务器分层架构，就是将LNMP环境分离开，用到了LB集群，先来点理论吧。</p><p style="box-sizing:border-box;margin:0px 0px 10px;">负载均衡LB集群主要关注的是并发处理能力，常用的有：LVS、nginx、haproxy。</p><p style="box-sizing:border-box;margin:0px 0px 10px;">LVS是基于四层的负载均衡，不支持复杂特性的负载均衡，转发效率比7层略高</p><p style="box-sizing:border-box;margin:0px 0px 10px;">nginx、haproxy都是七层的负载均衡，可以根据特性进行负载均衡，比较灵活。</p><p style="box-sizing:border-box;margin:0px 0px 10px;">这里主要说说LVS的原理与配置方法，</p><p style="box-sizing:border-box;margin:0px 0px 10px;">LVS原理其实就是利用iptables的INPUT链，侦听在INPUT链，拦截访问集群服务的数据包，将进入数据包的包头进行更改，不同类型更改包头的方式也不一样，转发给后端的RS，最后RS处理请求后在转发给用户。</p><p style="box-sizing:border-box;margin:0px 0px 10px;">LVS：linux virtual server，lvs与iptable不能同时使用</p><p style="box-sizing:border-box;margin:0px 0px 10px;">LVS类型：</p><p style="box-sizing:border-box;margin:0px 0px 10px;">NAT: 地址转换  跟DNAT原理相同，多目标</p><p style="box-sizing:border-box;margin:0px 0px 10px;">DR: 直接路由</p><p style="box-sizing:border-box;margin:0px 0px 10px;">TUN: 隧道</p><p style="box-sizing:border-box;margin:0px 0px 10px;">LVS的调度方法：</p><p style="box-sizing:border-box;margin:0px 0px 10px;">有10种，分别如下:</p><p style="box-sizing:border-box;margin:0px 0px 10px;">固定调度,也叫静态调度，有四种：</p><p style="box-sizing:border-box;margin:0px 0px 10px;">rr: 轮叫，轮询</p><p style="box-sizing:border-box;margin:0px 0px 10px;">wrr: Weight, 加权</p><p style="box-sizing:border-box;margin:0px 0px 10px;">sh: source hash, 源地址hash</p><p style="box-sizing:border-box;margin:0px 0px 10px;">dh：目标地址hash</p><p style="box-sizing:border-box;margin:0px 0px 10px;">动态调度方法，有六种：</p><p style="box-sizing:border-box;margin:0px 0px 10px;">lc: 最少连接</p><p style="box-sizing:border-box;margin:0px 0px 10px;">active*256+inactive</p><p style="box-sizing:border-box;margin:0px 0px 10px;">谁的小，挑谁</p><p style="box-sizing:border-box;margin:0px 0px 10px;">wlc: 加权最少连接</p><p style="box-sizing:border-box;margin:0px 0px 10px;">(active*256+inactive)/weight</p><p style="box-sizing:border-box;margin:0px 0px 10px;">sed: 最短期望延迟</p><p style="box-sizing:border-box;margin:0px 0px 10px;">（active+1)*256/weight</p><p style="box-sizing:border-box;margin:0px 0px 10px;">nq: never queue</p><p style="box-sizing:border-box;margin:0px 0px 10px;">LBLC: 基于本地的最少连接</p><p style="box-sizing:border-box;margin:0px 0px 10px;">LBLCR: 基于本地的带复制功能的最少连接</p><p style="box-sizing:border-box;margin:0px 0px 10px;">默认的调度方法是wlc</p><p style="box-sizing:border-box;margin:0px 0px 10px;">好了，具体LVS工作流程可以Google，有非常详细的文档，选用最常用的DR模式配置，简单的架构图如下：案例用于BBS论坛</p><p style="box-sizing:border-box;margin:0px 0px 10px;"><a href="http://www.myjishu.com/wp-content/uploads/2015/01/LVS-DR.png" style="box-sizing:border-box;color:rgb(210, 50, 45);text-decoration:none;"><img src="LVSDR模式实战  运维之道_files/Image.png" type="image/png" data-filename="Image.png" alt="LVS-DR" height="535" style="box-sizing: border-box; max-width: 100%; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; vertical-align: middle; height: auto; margin: 10px auto; display: block;" width="943"/></a></p><p style="box-sizing:border-box;margin:0px 0px 10px;">Director配置脚本如下：</p><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><table border="0" cellpadding="0" cellspacing="0" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;box-sizing:border-box;border-collapse:collapse;border-spacing:0px;max-width:100%;background-color:transparent;width:559px;"><tr style="box-sizing:border-box;"><td style="box-sizing:border-box;width:6.261180679785331%;"><div style="box-sizing:border-box;">1</div><div style="box-sizing:border-box;">2</div><div style="box-sizing:border-box;">3</div><div style="box-sizing:border-box;">4</div><div style="box-sizing:border-box;">5</div><div style="box-sizing:border-box;">6</div><div style="box-sizing:border-box;">7</div><div style="box-sizing:border-box;">8</div><div style="box-sizing:border-box;">9</div><div style="box-sizing:border-box;">10</div><div style="box-sizing:border-box;">11</div><div style="box-sizing:border-box;">12</div><div style="box-sizing:border-box;">13</div><div style="box-sizing:border-box;">14</div><div style="box-sizing:border-box;">15</div><div style="box-sizing:border-box;">16</div><div style="box-sizing:border-box;">17</div><div style="box-sizing:border-box;">18</div><div style="box-sizing:border-box;">19</div><div style="box-sizing:border-box;">20</div><div style="box-sizing:border-box;">21</div><div style="box-sizing:border-box;">22</div><div style="box-sizing:border-box;">23</div><div style="box-sizing:border-box;">24</div><div style="box-sizing:border-box;">25</div><div style="box-sizing:border-box;">26</div><div style="box-sizing:border-box;">27</div><div style="box-sizing:border-box;">28</div><div style="box-sizing:border-box;">29</div><div style="box-sizing:border-box;">30</div><div style="box-sizing:border-box;">31</div><div style="box-sizing:border-box;">32</div><div style="box-sizing:border-box;">33</div><div style="box-sizing:border-box;">34</div><div style="box-sizing:border-box;">35</div><div style="box-sizing:border-box;">36</div><div style="box-sizing:border-box;">37</div><div style="box-sizing:border-box;">38</div><div style="box-sizing:border-box;">39</div><div style="box-sizing:border-box;">40</div><div style="box-sizing:border-box;">41</div><div style="box-sizing:border-box;">42</div><div style="box-sizing:border-box;">43</div><div style="box-sizing:border-box;">44</div><div style="box-sizing:border-box;">45</div><div style="box-sizing:border-box;">46</div><div style="box-sizing:border-box;">47</div><div style="box-sizing:border-box;">48</div><div style="box-sizing:border-box;">49</div><div style="box-sizing:border-box;">50</div><div style="box-sizing:border-box;">51</div><div style="box-sizing:border-box;">52</div><div style="box-sizing:border-box;">53</div><div style="box-sizing:border-box;">54</div><div style="box-sizing:border-box;">55</div><div style="box-sizing:border-box;">56</div><div style="box-sizing:border-box;">57</div><div style="box-sizing:border-box;">58</div><div style="box-sizing:border-box;">59</div><div style="box-sizing:border-box;">60</div><div style="box-sizing:border-box;">61</div><div style="box-sizing:border-box;">62</div><div style="box-sizing:border-box;">63</div><div style="box-sizing:border-box;">64</div><div style="box-sizing:border-box;">65</div><div style="box-sizing:border-box;">66</div><div style="box-sizing:border-box;">67</div><div style="box-sizing:border-box;">68</div><div style="box-sizing:border-box;">69</div><div style="box-sizing:border-box;">70</div><div style="box-sizing:border-box;">71</div><div style="box-sizing:border-box;">72</div><div style="box-sizing:border-box;">73</div><div style="box-sizing:border-box;">74</div><div style="box-sizing:border-box;">75</div><div style="box-sizing:border-box;">76</div><div style="box-sizing:border-box;">77</div></td><td style="box-sizing:border-box;width:93.99190043826395%;"><div style="box-sizing:border-box;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;"><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">#!/bin/bash</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">#</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># LVS script for VS/DR</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># chkconfig: - 90 10</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">. </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/etc/rc</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">.d</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/init</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">.d</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/functions</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">#</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">VIP=192.168.8.230</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">DIP=192.168.8.226</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">RIP1=192.168.8.224</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">RIP2=192.168.8.225</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">PORT=80</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">RSWEIGHT1=2</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">RSWEIGHT2=5</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">#</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">case</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;$1&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">in</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">start)</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ifconfig</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">eth0:0 $VIP broadcast $VIP netmask 255.255.255.255 up</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/route</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">add -host $VIP dev eth0:0</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Since this is the Director we must be able to forward packets</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">1 &gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/proc/sys/net/ipv4/ip_forward</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Clear all iptables rules.</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/iptables</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-F</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Reset iptables counters.</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/iptables</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-Z</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Clear all ipvsadm rules/services.</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ipvsadm</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-C</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Add an IP virtual service for VIP 192.168.8.230 port 80</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># In this recipe, we will use the round_robin scheduling method.</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># In production, however, you should use a weighted, dynamic scheduling method.</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ipvsadm</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-A -t $VIP:80 -s wlc</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Now direct packets for this VIP to</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># The real server IP(RIP) inside the cluster</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ipvsadm</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-a -t $VIP:80 -r $RIP1 -g -w $RSWEIGHT1</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ipvsadm</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-a -t $VIP:80 -r $RIP2 -g -w $RSWEIGHT2</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/bin/touch</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/var/lock/subsys/ipvsadm</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&amp;&gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/dev/null</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">;;</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">stop)</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Stop forwarding Packets</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 &gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/proc/sys/net/ipv4/ip_forward</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Reset ipvsadm</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ipvsadm</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-C</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Bring down the VIP interface</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/route</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">del $VIP</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ifconfig</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">eth0:0 down</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/bin/rm</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-f </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/var/lock/subsys/ipvsadm</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;ipvs is stopped...&quot;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">;;</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">status)</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">if</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">[ ! -e </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/var/lock/subsys/ipvsadm</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">];</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">then</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;ipvsadm is stooppd ...&quot;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">else</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;ipvsadm is running ....&quot;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">ipvsadm -L -n</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">fi</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">;;</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">*)</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;Usage: $0 {start|stop|status]&quot;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">;;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">esac</code></div></div></td></tr></table></div></div><p style="box-sizing:border-box;margin:0px 0px 10px;">后端RS的配置脚本如下：</p><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><table border="0" cellpadding="0" cellspacing="0" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;box-sizing:border-box;border-collapse:collapse;border-spacing:0px;max-width:100%;background-color:transparent;width:514px;"><tr style="box-sizing:border-box;"><td style="box-sizing:border-box;width:6.809338521400778%;"><div style="box-sizing:border-box;">1</div><div style="box-sizing:border-box;">2</div><div style="box-sizing:border-box;">3</div><div style="box-sizing:border-box;">4</div><div style="box-sizing:border-box;">5</div><div style="box-sizing:border-box;">6</div><div style="box-sizing:border-box;">7</div><div style="box-sizing:border-box;">8</div><div style="box-sizing:border-box;">9</div><div style="box-sizing:border-box;">10</div><div style="box-sizing:border-box;">11</div><div style="box-sizing:border-box;">12</div><div style="box-sizing:border-box;">13</div><div style="box-sizing:border-box;">14</div><div style="box-sizing:border-box;">15</div><div style="box-sizing:border-box;">16</div><div style="box-sizing:border-box;">17</div><div style="box-sizing:border-box;">18</div><div style="box-sizing:border-box;">19</div><div style="box-sizing:border-box;">20</div><div style="box-sizing:border-box;">21</div><div style="box-sizing:border-box;">22</div><div style="box-sizing:border-box;">23</div><div style="box-sizing:border-box;">24</div><div style="box-sizing:border-box;">25</div><div style="box-sizing:border-box;">26</div><div style="box-sizing:border-box;">27</div><div style="box-sizing:border-box;">28</div><div style="box-sizing:border-box;">29</div><div style="box-sizing:border-box;">30</div><div style="box-sizing:border-box;">31</div><div style="box-sizing:border-box;">32</div><div style="box-sizing:border-box;">33</div><div style="box-sizing:border-box;">34</div><div style="box-sizing:border-box;">35</div><div style="box-sizing:border-box;">36</div><div style="box-sizing:border-box;">37</div><div style="box-sizing:border-box;">38</div><div style="box-sizing:border-box;">39</div><div style="box-sizing:border-box;">40</div><div style="box-sizing:border-box;">41</div><div style="box-sizing:border-box;">42</div><div style="box-sizing:border-box;">43</div><div style="box-sizing:border-box;">44</div><div style="box-sizing:border-box;">45</div><div style="box-sizing:border-box;">46</div><div style="box-sizing:border-box;">47</div><div style="box-sizing:border-box;">48</div><div style="box-sizing:border-box;">49</div><div style="box-sizing:border-box;">50</div><div style="box-sizing:border-box;">51</div><div style="box-sizing:border-box;">52</div><div style="box-sizing:border-box;">53</div><div style="box-sizing:border-box;">54</div><div style="box-sizing:border-box;">55</div><div style="box-sizing:border-box;">56</div></td><td style="box-sizing:border-box;width:93.97475830265765%;"><div style="box-sizing:border-box;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;"><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">#!/bin/bash</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">#</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Scrip to start LVS DR real server.</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># chkconfig: - 90 10</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># description: LVS DR real server</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">. </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/etc/rc</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">.d</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/init</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">.d</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/functions</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">VIP=192.168.8.230</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">host=`</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/bin/hostname</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">`</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">case</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;$1&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">in</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">start)</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Start LVS-DR real server on this machine.</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ifconfig</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">lo down</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ifconfig</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">lo up</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">1 &gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/proc/sys/net/ipv4/conf/eth0/arp_ignore</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">2 &gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/proc/sys/net/ipv4/conf/eth0/arp_announce</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">1 &gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/proc/sys/net/ipv4/conf/all/arp_ignore</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">2 &gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/proc/sys/net/ipv4/conf/all/arp_announce</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ifconfig</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">lo:0 $VIP broadcast $VIP netmask 255.255.255.255 up</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/route</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">add -host $VIP dev lo:0</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">;;</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">stop)</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Stop LVS-DR real server loopback devuce(s).</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ifconfig</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">lo:0 down</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 &gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/proc/sys/net/ipv4/conf/eth0/arp_ignore</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 &gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/proc/sys/net/ipv4/conf/eth0/arp_announce</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 &gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/proc/sys/net/ipv4/conf/all/arp_ignore</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 &gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/proc/sys/net/ipv4/conf/all/arp_announce</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">;;</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">status)</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Status of LVS-DR real server.</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">islothere=`</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/sbin/ifconfig</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;lo:0&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">| </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">grep</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-i $VIP`</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">isrothere=`</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">netstat</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-rn | </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">grep</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-i </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;lo&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">| </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">grep</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-i $VIP`</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">if</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">[ ! </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;$islothere&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-o ! </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;$isrothere&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">];</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">then</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Either the route or the lo:0 device</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># not found.</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;LVS-DR real server Stopped.&quot;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">else</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;LVS-DR real server running.&quot;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">fi</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">;;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">*)</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Invalid entry.</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;$0: Usage: $0 {start|status|stop}&quot;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">exit</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">1</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">;;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">esac</code></div></div></td></tr></table></div></div><p style="box-sizing:border-box;margin:0px 0px 10px;">分别启动Director和RS上面的ipvsadm服务，然后需要写LVS的后端健康监测脚本，在Director上面运行脚本如下：</p><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><table border="0" cellpadding="0" cellspacing="0" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;box-sizing:border-box;border-collapse:collapse;border-spacing:0px;max-width:100%;background-color:transparent;width:751px;"><tr style="box-sizing:border-box;"><td style="box-sizing:border-box;width:4.660452729693742%;"><div style="box-sizing:border-box;">1</div><div style="box-sizing:border-box;">2</div><div style="box-sizing:border-box;">3</div><div style="box-sizing:border-box;">4</div><div style="box-sizing:border-box;">5</div><div style="box-sizing:border-box;">6</div><div style="box-sizing:border-box;">7</div><div style="box-sizing:border-box;">8</div><div style="box-sizing:border-box;">9</div><div style="box-sizing:border-box;">10</div><div style="box-sizing:border-box;">11</div><div style="box-sizing:border-box;">12</div><div style="box-sizing:border-box;">13</div><div style="box-sizing:border-box;">14</div><div style="box-sizing:border-box;">15</div><div style="box-sizing:border-box;">16</div><div style="box-sizing:border-box;">17</div><div style="box-sizing:border-box;">18</div><div style="box-sizing:border-box;">19</div><div style="box-sizing:border-box;">20</div><div style="box-sizing:border-box;">21</div><div style="box-sizing:border-box;">22</div><div style="box-sizing:border-box;">23</div><div style="box-sizing:border-box;">24</div><div style="box-sizing:border-box;">25</div><div style="box-sizing:border-box;">26</div><div style="box-sizing:border-box;">27</div><div style="box-sizing:border-box;">28</div><div style="box-sizing:border-box;">29</div><div style="box-sizing:border-box;">30</div><div style="box-sizing:border-box;">31</div><div style="box-sizing:border-box;">32</div><div style="box-sizing:border-box;">33</div><div style="box-sizing:border-box;">34</div><div style="box-sizing:border-box;">35</div><div style="box-sizing:border-box;">36</div><div style="box-sizing:border-box;">37</div><div style="box-sizing:border-box;">38</div><div style="box-sizing:border-box;">39</div><div style="box-sizing:border-box;">40</div><div style="box-sizing:border-box;">41</div><div style="box-sizing:border-box;">42</div><div style="box-sizing:border-box;">43</div><div style="box-sizing:border-box;">44</div><div style="box-sizing:border-box;">45</div><div style="box-sizing:border-box;">46</div><div style="box-sizing:border-box;">47</div><div style="box-sizing:border-box;">48</div><div style="box-sizing:border-box;">49</div><div style="box-sizing:border-box;">50</div><div style="box-sizing:border-box;">51</div><div style="box-sizing:border-box;">52</div><div style="box-sizing:border-box;">53</div><div style="box-sizing:border-box;">54</div><div style="box-sizing:border-box;">55</div><div style="box-sizing:border-box;">56</div><div style="box-sizing:border-box;">57</div><div style="box-sizing:border-box;">58</div><div style="box-sizing:border-box;">59</div><div style="box-sizing:border-box;">60</div><div style="box-sizing:border-box;">61</div><div style="box-sizing:border-box;">62</div><div style="box-sizing:border-box;">63</div><div style="box-sizing:border-box;">64</div><div style="box-sizing:border-box;">65</div><div style="box-sizing:border-box;">66</div><div style="box-sizing:border-box;">67</div><div style="box-sizing:border-box;">68</div><div style="box-sizing:border-box;">69</div><div style="box-sizing:border-box;">70</div><div style="box-sizing:border-box;">71</div><div style="box-sizing:border-box;">72</div></td><td style="box-sizing:border-box;width:95.98642991983803%;"><div style="box-sizing:border-box;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;"><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">#!/bin/bash</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># Userd by LVS service Status Check.</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">VIP=192.168.8.230</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">CPORT=80</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">FAIL_BACK=127.0.0.1</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">RS=(</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;192.168.8.224&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;192.168.8.225&quot;</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">)</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">declare</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-a RSSTATUS</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">RW=(</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;2&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;1&quot;</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">)</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">RPORT=80</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">TYPE=g</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">CHKLOOP=3</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">LOG=</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/var/log/ipvsmonitor</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">.log</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">addrs(){</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">ipvsadm -a -t $VIP:$CPORT -r $1:$RPORT -$TYPE -w $2</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">[ $? -</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">eq</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 ] &amp;&amp; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">return</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 || </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">return</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">1</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">}</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">delrs(){</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">ipvsadm -d -t $VIP:$CPORT -r $1:$RPORT</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">[ $? -</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">eq</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 ] &amp;&amp; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">return</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 || </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">return</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">1</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">}</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">checkrs(){</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">local</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">I=1</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">while</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">[ $I -</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">le</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">$CHKLOOP ]; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">do</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">if</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">curl --connect-timeout 1 http:</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">//</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">$1 &amp;&gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/dev/null</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">then</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">return</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">fi</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">let</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">I++</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">done</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">return</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">1</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">}</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">initstatus(){</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">local</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">I</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">local</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">COUNT=0;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">for</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">I </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">in</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">${RS[*]}; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">do</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">if</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">ipvsadm -L -n | </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">grep</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;$I:$RPORT&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&amp;&gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/dev/null</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">then</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">            </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">RSSTATUS[$COUNT]=1</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">else</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">            </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">RSSTATUS[$COUNT]=0</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">fi</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">let</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">COUNT++</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">done</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">}</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">initstatus</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">while</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">:; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">do</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">let</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">COUNT=0</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">for</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">I </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">in</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">${RS[*]}; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">do</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">if</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">checkrs $I; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">then</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">            </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">if</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">[ ${RSSTATUS[$COUNT]} -</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">eq</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 ]; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">then</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">                </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">addrs $I ${RW[$COUNT]}</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">                </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">[ $? -</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">eq</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 ] &amp;&amp; RSSTATUS[$COUNT]=1 &amp;&amp; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;`date +'%F %H:%M:%S'`, $I is back.&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&gt;&gt; $LOG</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">            </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">fi</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">else</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">            </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">if</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">[ ${RSSTATUS[$COUNT]} -</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">eq</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">1 ]; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">then</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">                </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">delrs $I</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">                </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">[ $? -</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">eq</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 ] &amp;&amp; RSSTATUS[$COUNT]=0 &amp;&amp; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;`date +'%F %H:%M:%S'`, $I is gone.&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&gt;&gt; $LOG</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">            </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">fi</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">fi</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">        </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">let</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">COUNT++</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">done</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">    </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">sleep</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">5</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">done</code></div></div></td></tr></table></div></div><p style="box-sizing:border-box;margin:0px 0px 10px;">这样LVS基本就配置完成了，BBS存在用户session的问题，虽然有很多种解决方法，这里如果只用lvs来解决的话，就要用到LVS的持久连接了，配置如下：</p><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><table border="0" cellpadding="0" cellspacing="0" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;box-sizing:border-box;border-collapse:collapse;border-spacing:0px;max-width:100%;background-color:transparent;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="box-sizing:border-box;"><div style="box-sizing:border-box;">1</div></td><td style="box-sizing:border-box;"><div style="box-sizing:border-box;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;"><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">ipvsadm -E -t 192.168.8.230:80 -s wlc -p 3600</code></div></div></td></tr></tbody></table></div></div><p style="box-sizing:border-box;margin:0px 0px 10px;">这样用户访问后端一台RS在3600s内都只会访问这一台RS，可以发现这样做会破坏LB的效果，不过可以解决用户session的问题。</p><p style="box-sizing:border-box;margin:0px 0px 10px;">简单说说rsync+inotify的配置方法，用于同步BBS的网页文件</p><p style="box-sizing:border-box;margin:0px 0px 10px;">rsync就不多说了，在每台RS上面安装rsync然后配置rsync，并开启rsync服务，Director上安装inotify后，侦听脚本如下：</p><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><table border="0" cellpadding="0" cellspacing="0" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;box-sizing:border-box;border-collapse:collapse;border-spacing:0px;max-width:100%;background-color:transparent;width:938px;"><tr style="box-sizing:border-box;"><td style="box-sizing:border-box;width:3.731343283582089%;"><div style="box-sizing:border-box;">1</div><div style="box-sizing:border-box;">2</div><div style="box-sizing:border-box;">3</div><div style="box-sizing:border-box;">4</div><div style="box-sizing:border-box;">5</div><div style="box-sizing:border-box;">6</div><div style="box-sizing:border-box;">7</div><div style="box-sizing:border-box;">8</div><div style="box-sizing:border-box;">9</div><div style="box-sizing:border-box;">10</div><div style="box-sizing:border-box;">11</div><div style="box-sizing:border-box;">12</div><div style="box-sizing:border-box;">13</div><div style="box-sizing:border-box;">14</div><div style="box-sizing:border-box;">15</div><div style="box-sizing:border-box;">16</div><div style="box-sizing:border-box;">17</div></td><td style="box-sizing:border-box;width:96.99248120300753%;"><div style="box-sizing:border-box;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;"><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">#!/bin/bash</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># lixiang by created, 2014/12/31</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># used rsync web data</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">src=</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/home/www/</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">des1=web</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">des2=web</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">host1=192.168.8.224</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">host2=192.168.8.225</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">user1=root</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">user2=root</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/usr/local/bin/inotifywait</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-mrq --timefmt </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">'%d/%m/%y %H:%M'</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">--</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">format</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">'%T %w%f'</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-emodify,delete,create,attrib $src | </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">while</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">read</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">file</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">do</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/usr/bin/rsync</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-avrP --delete --ignore-errors --progress $src $user1@$host1::$des1</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/usr/bin/rsync</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-avrP --delete --ignore-errors --progress $src $user2@$host2::$des2</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;${file} was rsynced&quot;</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&gt;&gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/var/log/rsync</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">.log 2&gt;&amp;1</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">done</code></div></div></td></tr></table></div></div><p style="box-sizing:border-box;margin:0px 0px 10px;">写了个monitor脚本，监控inotify进程，写在crontab中5分钟运行一次，如下：</p><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><table border="0" cellpadding="0" cellspacing="0" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;box-sizing:border-box;border-collapse:collapse;border-spacing:0px;max-width:100%;background-color:transparent;width:328px;"><tr style="box-sizing:border-box;"><td style="box-sizing:border-box;width:10.670731707317072%;"><div style="box-sizing:border-box;">1</div><div style="box-sizing:border-box;">2</div><div style="box-sizing:border-box;">3</div><div style="box-sizing:border-box;">4</div><div style="box-sizing:border-box;">5</div><div style="box-sizing:border-box;">6</div><div style="box-sizing:border-box;">7</div><div style="box-sizing:border-box;">8</div><div style="box-sizing:border-box;">9</div><div style="box-sizing:border-box;">10</div></td><td style="box-sizing:border-box;width:89.96444731738849%;"><div style="box-sizing:border-box;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;"><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">#!/bin/bash</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;"># used by monitor inotify Process.</code></div><div style="box-sizing:border-box;"> </div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">ps</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">-lef |pgrep inotify &amp;&gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/dev/null</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">if</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">[ $? -</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">eq</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">0 ]; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">then</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;inotify is running....&quot;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">else</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/bin/sh</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/root/inotify</code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">.sh &amp;&gt; </code><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">/dev/null</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&amp;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">echo</code> <code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">&quot;inotify already running...&quot;</code></div><div style="box-sizing:border-box;"><code style="box-sizing:border-box;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:90%;padding:2px 4px;color:rgb(199, 37, 78);white-space:nowrap;background-color:rgb(249, 242, 244);border-radius:4px;">fi</code></div></div></td></tr></table></div></div><p style="box-sizing:border-box;margin:0px 0px 10px;">NFS配置就不多说了，注意Director上面要关闭iptables，后端RS挂载用户上传目录即可，记得要写入fstab中。</p><p style="box-sizing:border-box;margin:0px 0px 10px;">共享mysql将BBS应用的mysql指向一台mysql服务器即可</p><p style="box-sizing:border-box;margin:0px 0px 10px;">双线的配置方法：</p><p style="box-sizing:border-box;margin:0px 0px 10px;">目前很多服务器都是双线的，为了更好的提供用户体验，对应lvs的配置也很简单，只需要配置2个实例即可：联通配置一个VIP、电信配置一个VIP，对应用2个RS状态健康监测脚本。</p><p style="box-sizing:border-box;margin:0px 0px 10px;">这样简单的LB集群就搭建完毕了，其实还存在一个问题：Director存在单点问题，下次在补充。。</p><div style="box-sizing:border-box;"><ul style="box-sizing:border-box;list-style-type:none;padding-left:0px;margin:20px 0px;text-align:center;list-style:none;"><li><span style="text-align:center;list-style:none;list-style-type:none;display:table;"> </span></li></ul></div></div></div></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 