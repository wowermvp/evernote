<html>
<head>
  <title>Apache详解</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1450"/>
<h1>Apache详解</h1>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div>Apache的配置文件</div><div><br/></div><div>配置文件所在目录：</div><div>rpm包安装：/etc/httpd/conf/</div><div>源码包安装：/usr/local/apache2/etc/</div><div>主配置文件：</div><div>httpd.conf</div><div>旧版本中的配置文件：</div><div>资源配置文件：srm.conf</div><div>访问许可权配置文件：access.conf</div><div><br/></div><div>AccessConfig和ResourceConfig</div><div><br/></div><div>为了对旧版本的Apache兼容， Apache服务器在每次启动时都查找并读取access.conf和srm.conf文件的内容。httpd.conf文件中的AccessConfig和ResourceConfig指令用于指定access.conf和srm.conf文件的位置，默认值为：</div><div>AccessConfig conf/access.conf ResourceConfig conf/srm.conf</div><div>出于安全性的考虑，可以设置为：</div><div>AccessConfig /dev/null</div><div>ResourceConfig /dev/null</div><div>指定这两个文件为空设备文件“/dev/null ”，这样可以避免恶意的修改access.conf和srm.conf文件对系统配置的影响。</div><div><br/></div><div>配置的内容</div><div><br/></div><div>1、全局变量</div><div>2、配置主服务器</div><div>3、配置虚拟主机</div><div><br/></div><div><b><font color="#DE5700">全局变量</font></b></div><div><br/></div><div><font color="#DE5700">1．选择服务器启动类型 ServerType</font></div><div>ServerType standalone | inetd</div><div>ServerType用于定义apache服务器的运行模式，默认值standalone为独立运行的服务器，如设置为inetd则由xinetd服务器负责apache服务器的启动。</div><div><br/></div><div><font color="#DE5700">2．设置服务器的根目录 ServerRoot</font></div><div>ServerRoot &quot;/etc/httpd &quot;</div><div>ServerRoot用于指定apache服务器的配置文件及日志文件存放的根目录，默认为目录&quot;/etc/httpd &quot; 。</div><div><br/></div><div><font color="#DE5700">3．设置加锁文件 &lt;IfModule ! mpm_winnt.c&gt;......</font></div><div><br/></div><div><font color="#DE5700">4．设置ScoreBoardFile 维护进程的内部数据，通常不需设置。</font></div><div><br/></div><div><font color="#DE5700">5．设置PidFile 指定存储httpd父进程的PID的文件</font></div><div>PidFile /var/run/httpd.pid</div><div>PidFile用于指定记录httpd进程号（PID）的文件位置，默认值为“/var/run/httpd.pid”。</div><div><br/></div><div><font color="#DE5700">6．设置超时时间 Timeout</font></div><div>Timeout 300</div><div>指定站点响应的秒数。若超过这段时间仍未收到或送出数据，就断开连接。</div><div>KeepAlive On|Off</div><div>启用此项，表示允许保持连接，让每次连接能提出多个请求。避免每请求一个文件就跟服务器建立一次连接。</div><div>MaxKeepAliveRequests 100</div><div>每次连接可提出请求的数量，设置为0表示数量不限，默认值为100。</div><div>KeepAliveTimeout 15</div><div>连续两个请求之间的时间如果超过15秒还未到达，则视为连接中断。</div><div><br/></div><div><font color="#DE5700">7．设置服务器进程数 &lt;IfModule prefork.c&gt;......</font></div><div>&lt;IfModule prefork.c&gt;</div><div>MinSpareServers 5</div><div>MaxSpareServers 20</div><div>提供浏览服务的httpd进程的数目需要随连接数目的多少而变化，因此需要随时保持几个闲置的httpd进程等候新的连接请求。若闲置的进程数少于5个（默认值），则表示闲置进程太少，需要将其增加到5个；若多于20个（默认值）则表示闲置进程太多，需将其减少到20个。</div><div>StartServers 8</div><div>当apache服务器启动时，httpd进程的数目，默认值为8。</div><div>MaxClients 150</div><div>同事接入的数目太多时会降低系统访问性能，设置此参数可限制同时连接的最大数值，默认值为150。</div><div>&lt; /IfModule&gt;</div><div><br/></div><div><font color="#DE5700">8．设置地址绑定 Listen</font></div><div>Listen 12.34.56.78:80</div><div>用于设置apache服务器监听指定IP和（或）端口上的连接请求。</div><div>Listen 80</div><div>指定apache服务器监听的端口号。</div><div><br/></div><div><font color="#DE5700">9．选择模块 LoadModule ......</font></div><div>载入模块指令</div><div>Apache服务器采用动态共享对象（DSO，Dynamic Shared Object）的机制，在启动Apache服务器时可根据实际需要载入适当的模块，使其具有相应的功能。</div><div>载入模块的相关指令有：</div><div>LoadModule</div><div>ClearModuleList</div><div>AddModule</div><div><br/></div><div>LoadModule指令用于动态载入模块，即将模块外挂在Apache服务器上。</div><div>语法：</div><div>LoadModule 模块名称 模块文件路径全名</div><div>实例：</div><div>LoadModule status_module modules/mod_status.so</div><div><br/></div><div>ClearModuleList</div><div>ClearModuleList指令用于清空Apache服务器内建的模块列表。通常先使用该指令清空列表，再使用AddModule指令向模块列表加入模块。</div><div><br/></div><div>AddModule</div><div>AddModule指令用于向模块列表加入新的模块名称。</div><div>语法：</div><div>AddModule 模块</div><div>实例：</div><div>AddModule mod_status.c</div><div><br/></div><div><font color="#DE5700">10．配置状态信息 ExtendedStatus</font></div><div><br/></div><div><b><font color="#DE5700">配置主服务器</font></b></div><div><br/></div><div><font color="#DE5700">1．设置用户和组 User和Group</font></div><div>User apache Group apache 设置httpd用哪个用户帐号和组来启动，默认使用apache用户和组。</div><div><br/></div><div><font color="#DE5700">2．设置Email地址 ServerAdmin</font></div><div>ServerAdmin root@localhost</div><div>服务器管理员的邮件地址，当服务器运行出错时将向此邮件地址发信。</div><div><br/></div><div><font color="#DE5700">3．设置服务器名 ServerName</font></div><div>ServerName localhost</div><div>设置主机的名称，此名称会被送到远程连接程序，以取代安装Apache主机的真实名称。默认值是localhost，行首加#号，关闭此功能。</div><div><br/></div><div><font color="#DE5700">4．设置正式名称 UseCanonicalName</font></div><div><br/></div><div><font color="#DE5700">5．设置文档目录 DocumentRoot</font></div><div>DocumentRoot &quot;/var/www/html&quot;</div><div>指定Apache服务器存放网页的文档根目录。</div><div><br/></div><div><font color="#DE5700">6．设置访问选项和覆盖 &lt;Directory /&gt;Options ......</font></div><div>容器指令（container directive）通常包括在&lt;&gt;括号内，较容易识别。条件指令&lt;IfDefine&gt;和&lt;IfModule&gt;不是容器指令，他们是例外。常用的容器指令有：</div><div>&lt;Directory&gt;</div><div>&lt;Files&gt;</div><div>&lt;Location&gt;</div><div>&lt;VirtualHost&gt;</div><div><br/></div><div>&lt;Directory&gt;… &lt;/Directory&gt;</div><div>&lt;Directory /&gt; 设置“/”根目录的访问权限</div><div>Options FollowSymLinks</div><div>AllowOverride None</div><div>&lt;/Directory&gt; 目录属性设置结束</div><div>使用&lt;Directory&gt;… &lt;/Directory&gt;设置指定目录的访问权限，其中可包含：</div><div>Options</div><div>AllowOverride</div><div>Order</div><div>Allow</div><div>Deny</div><div>五个属性。</div><div><br/></div><div>Options属性</div><div>Options FollowSymLinks Indexes MultiViews</div><div>Options可以组合设置下列选项：</div><div>All：用户可以在此目录中作任何事情。</div><div>ExecCGI：允许在此目录中执行CGI程序。</div><div>FollowSymLinks：服务器可使用符号链接指向的文件或目录。</div><div>Indexes：服务器可生成此目录的文件列表。</div><div>None：不允许访问此目录。</div><div><br/></div><div>AllowOverride</div><div>AllowOverride None</div><div>AllowOverride会根据设定的值决定是否读取目录中的.htaccess文件，来改变原来所设置的权限。</div><div>All：读取.htaccess文件的内容，修改原来的访问权限。</div><div>None：不读取.htaccess文件</div><div>为避免用户自行建立.htaccess文件修改访问权限，http.conf文件中默认设置每个目录为： AllowOverride None。</div><div><br/></div><div>AccessFileName</div><div>AccessFileName filename</div><div>AccessFileName指令用于指定保护目录设定文件的文件名称，默认值为“.htaccess”。</div><div>AccessFileName .acl</div><div><br/></div><div>Allow</div><div>设定允许访问Apache服务器的主机</div><div>Allow from all</div><div>允许所有主机的访问</div><div>Allow from 202.96.0.97 202.96.0.98</div><div>允许来自指定IP地址主机的访问</div><div><br/></div><div>Deny 设定拒绝访问Apache服务器的主机 Deny from all 拒绝来自所有主机的访问 Deny from 202.96.0.99 202.96.0.88 拒绝指定IP地址主机的访问</div><div><br/></div><div>Order Order allow,deny Order用于指定allow和deny的先后次序。</div><div><br/></div><div><font color="#DE5700">7．设置用户目录 UserDir</font></div><div>UserDir public_html</div><div>UserDir用于设定用户个人主页存放的目录，默认为“public_html”目录，即/home/anyuser/public_html。</div><div><br/></div><div><font color="#DE5700">8．设置目录索引 DirectoryIndex</font></div><div>DirectoryIndex index.html index.htm index.shtml index.php</div><div>DirectoryIndex指令用于指定目录中默认的索引文件名称，可同时指定多个文件名称，两两之间用空格分割。默认值为index.html。</div><div><br/></div><div><font color="#DE5700">9．设置访问控制 AccessFileName</font></div><div>AccessFileName .htaccess</div><div>定义每个目录下的访问控制文件的文件名，默认为.htaccess ;编辑文件如下：</div><div><br/></div><div>&lt;Files&gt;…&lt;/Files&gt;</div><div>&lt;Files&gt;容器包含只应用于指定文件的指令，文件应该由文件名（必要时使用统配符）指定。</div><div>实例：</div><div>&lt;Files = “^\.ht”&gt;</div><div>Order allow,deny</div><div>Deny from all</div><div>&lt;/Files&gt;</div><div><br/></div><div>&lt;Location&gt;… &lt;/Location&gt;</div><div>&lt;Location&gt;容器包含只应用于特定URL的指令。</div><div>实例：</div><div>&lt;Location /server-status&gt;</div><div>SetHandler server-status</div><div>order deny,allow</div><div>allow from 127.0.0.1</div><div>deny from all</div><div>&lt;/Location&gt;</div><div><br/></div><div>10．设置MIME类型文件 TypesConfig</div><div><br/></div><div>11．配置日志文件 HostnameLookups</div><div><br/></div><div>12．设置服务器信息 ServerTokens</div><div><br/></div><div>13．设置目录别名 Alias</div><div>Alias用于设置路径别名</div><div>Alias /doc/ /usr/share/doc/</div><div>给“/usr/share/doc/” 设置路径别名为“/doc/”</div><div><br/></div><div>14．设置索引选项 AddIconByEncoding 为目录索引中的不同类型的文件产生不同的图标。</div><div><br/></div><div>15．定义编码和语言 AddEncoding 定义一些压缩文件的MIME类型。</div><div><br/></div><div>16．添加MIME类型和处理类型 AddType</div><div><br/></div><div>17．自定义错误响应 ErrorDocument</div><div><br/></div><div>18．设置浏览器响应 BrowserMatch</div><div><br/></div><div><b><font color="#DE5700">建立虚拟Web站点</font></b></div><div><br/></div><div><font color="#DE5700">1、基于IP的虚拟主机的配置</font></div><div><font color="#DE5700">a、RPM包安装的Apache配置如下：</font></div><div>实例：添加不同的IP地址：</div><div># ifconfig eth0:0 192.168.0.2</div><div># route add -host 192.168.0.2 eth0:0</div><div>编辑/etc/httd/conf/httpd.conf文件添加如下内容：</div><div>&lt;VirtualHost 192.168.0.2:80&gt;</div><div><font color="#E30000">DocumentRoot /var/www/mailserver1        </font><i style="color: rgb(50, 135, 18);">#网页存放的根目录</i></div><div><font color="#E30000">ServerName mail.astronomy.com              </font> <font color="#328712"><i>#服务器的域名</i></font></div><div>ErrorLog logs/mailserver error_log</div><div>CustomLog logs/mailserver-access_log common</div><div>&lt;/VirtualHost&gt;</div><div>&lt;VirtualHost 192.168.0.1:80&gt;</div><div><font color="#E30000">DocumentRoot /var/www/mailserver2      </font><i style="color: rgb(50, 135, 18);">#网页存放的根目录</i></div><div><font color="#E30000">ServerName mail.astronomy.org              </font> <i><font color="#328712">#服务器的域名</font></i></div><div>ErrorLog logs/mailserver error_log</div><div>CustomLog logs/mailserver-access_log common</div><div>&lt;/VirtualHost&gt;</div><div>重启服务</div><div># /etc/init.d/httpd restart</div><div><font color="#DE5700">b、源码包安装的Apache配置如下：</font></div><div>添加不同的IP地址：</div><div> ifconfig eth0:0 192.168.0.2 netmask 255.255.255.0</div><div><font color="#328712"><i>#虚拟出一张网卡</i></font></div><div>编辑/usr/local/apache2/etc/httpd.conf</div><div><font color="#E30000">Include etc//extra/httpd-vhosts.conf          </font><i><font color="#328712">#必须开启一这项</font></i></div><div>编辑/usr/local/apache2/etc/extra/httpd-vhosts.conf</div><div>&lt;VirtualHost 192.168.0.2:80&gt;</div><div><font color="#E30000">DocumentRoot /var/www/mailserver1        </font><i style="color: rgb(50, 135, 18);">#网页存放的根目录</i></div><div><font color="#E30000">ServerName mail.astronomy.com               </font><font color="#328712"><i>#服务器的域名</i></font></div><div>ErrorLog logs/mailserver error_log</div><div>CustomLog logs/mailserver-access_log common</div><div>&lt;/VirtualHost&gt;</div><div>&lt;VirtualHost 192.168.0.1:80&gt;</div><div><font color="#E30000">DocumentRoot /var/www/mailserver2      </font><font color="#328712"><i>#网页存放的根目录</i></font></div><div><font color="#E30000">ServerName mail.astronomy.org               </font><i><font color="#328712">#服务器的域名</font></i></div><div>ErrorLog logs/mailserver error_log</div><div>CustomLog logs/mailserver-access_log common</div><div>&lt;/VirtualHost&gt;</div><div>重启服务</div><div>/usr/local/apache2/bin/apachectl stop</div><div>/usr/local/apache2/bin/apachectl start</div><div><i><font color="#328712">#由于源码包安装的apache重启时，有时不能加载配置文件，所以采用先关后开的方法</font></i></div><div>---------------------------------------------------------------------</div><div><br/></div><div><font color="#DE5700">2、基于域名的虚拟主机的配置</font></div><div><font color="#DE5700">a、RPM包安装的Apache</font></div><div>实例：在DNS中添加相关的主机记录</div><div>修改httpd.conf 文件</div><div><font color="#E30000">NameVirtualHost *:80          </font><i><font color="#328712">#必须开启这一项</font></i></div><div>&lt;VirtualHost *:80&gt;</div><div><font color="#E30000">DocumentRoot /var/www/mailserver1</font></div><div><font color="#E30000">ServerName mail.astronomy.com</font></div><div>ErrorLog logs/mailserver error_log</div><div>CustomLog logs/nameserver access_log common</div><div>&lt;/VirtualHost&gt;</div><div>&lt;VirtualHost *:80&gt;</div><div>DocumentRoot /var/www/mailserver2</div><div>ServerName mail.astronomy.org</div><div>ErrorLog logs/mailserver error_log</div><div>CustomLog logs/nameserver access_log common</div><div>&lt;/VirtualHost&gt;</div><div>重启服务</div><div># /etc/init.d/httpd restart</div><div><font color="#DE5700">b、源码包安装的Apache</font></div><div>实例：在DNS中添加相关的主机记录</div><div>修改/usr/local/apache2/etc/httpd.conf 文件</div><div><font color="#E30000">Include etc//extra/httpd-vhosts.conf          </font><i><font color="#328712">#必须开启一这项</font></i></div><div>编辑/usr/local/apache2/etc/extra/httpd-vhosts.conf</div><div>&lt;VirtualHost *:80&gt;</div><div>DocumentRoot /var/www/mailserver1</div><div>ServerName mail.astronomy.com</div><div>ErrorLog logs/mailserver error_log</div><div>CustomLog logs/nameserver access_log common</div><div>&lt;/VirtualHost&gt;</div><div>&lt;VirtualHost *:80&gt;</div><div><font color="#E30000">DocumentRoot /var/www/mailserver2</font></div><div><font color="#E30000">ServerName mail.astronomy.org</font></div><div>ErrorLog logs/mailserver error_log</div><div>CustomLog logs/nameserver access_log common</div><div>&lt;/VirtualHost&gt;</div><div>重启服务</div><div>/usr/local/apache2/bin/apachectl stop</div><div>/usr/local/apahce2/bin/apachectl start</div></span>
</div></body></html> 