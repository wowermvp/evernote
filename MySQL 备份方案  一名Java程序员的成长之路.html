<html>
<head>
  <title>MySQL 备份方案 // 一名Java程序员的成长之路</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1345"/>
<h1>MySQL 备份方案 // 一名Java程序员的成长之路</h1>

<div>
<span><br/><div style="background-color: rgb(255, 255, 255); padding-right: 320px; background-position: initial initial; background-repeat: initial initial;"><div style="opacity:1;display:block;transform:translateY(0px);"><div><h1 style="margin:0px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:26px;text-align:center;"><span style="color: rgb(85, 85, 85);">MySQL 备份方案</span></h1><div style="margin:3px 0px 60px;color:rgb(153, 153, 153);font-size:12px;text-align:center;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;">发表于 2015-08-31   |   分类于 <a href="http://emacsist.github.io/categories/mysql/" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);">mysql</a>   |   <a href="http://emacsist.github.io/2015/08/31/MySQL-%E5%A4%87%E4%BB%BD%E6%96%B9%E6%A1%88/#comments" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);">0 Comments</a></span></div></div><div style="text-align:justify;"><h2 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:24px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">Percona XtraBackup</span></h2><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">介绍</span></h3><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><a href="https://www.percona.com/doc/percona-xtrabackup/" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">官方文档</a></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">它是一个MySQL的开源的热备工具，备份时不会锁数据库。当前最新版本为2.2，它可以备份MySQL 5.1, 5.5和5.6的<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">InnoDB</code>, <code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">XtraDB</code>和<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">MyISAM</code>类型的表。</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">相比MySQL自带的<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">mysqldump</code>，它有以下特点：</span></span></span></p><ul style="list-style:square;"><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">非常快速和可靠</span></span></span></li><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">备份期间，不会中断处理事务处理</span></span></span></li><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">节约磁盘空间和网络带宽（传输时，会进行流压缩）</span></span></span></li><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">自动备份验证</span></span></span></li><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">由于恢复非常快，所以可用时间高</span></span></span></li><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">可以增量备份</span></span></span></li><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">可在线中进行MySQL服务器之间的表迁移</span></span></span></li><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">非常容易地创建一个MySQL从复制</span></span></span></li><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">备份时，不会添加额外的服务器负载</span></span></span></li></ul><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">它的详细介绍，请看官方手册介绍：</span><a href="https://www.percona.com/doc/percona-xtrabackup/2.2/intro.html" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">Intro</a></span></span></p><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">安装</span></h3><h4 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:20px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">下载地址</span></h4><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><a href="https://www.percona.com/downloads/XtraBackup/" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">Download</a></span></span></p><h4 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:20px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">Ubuntu 使用 apt 方式</span></h4><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><a href="https://www.percona.com/doc/percona-xtrabackup/2.2/installation/apt_repo.html" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">官方文档</a></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">好像由于要翻墙，我搬了下来：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:496px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:7.056451612903227%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:92.99939909005066%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">apt-key adv --keyserver keys.gnupg.net --recv-keys <span style="color:rgb(245, 135, 31);">1</span>C4CBDCDCD2EFD2A</span><br/><br/><span style="height:20px;"><span style="color:rgb(142, 144, 140);"># 添加到 /etc/apt/sources.list</span></span><br/><span style="height:20px;"><span style="color:rgb(142, 144, 140);"># 注意，这里的 VERSION 请替换为自己的ubuntu版本</span></span><br/><span style="height:20px;">deb http://repo.percona.com/apt VERSION main</span><br/><span style="height:20px;">deb-src http://repo.percona.com/apt VERSION main</span><br/><br/><span style="height:20px;">sudo apt-get update</span><br/><span style="height:20px;">sudo apt-get install percona-xtrabackup</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">源码方式，请参看源码目录的安装说明，在此不多说了。</span></span></span></p><h4 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:20px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">工具说明</span></h4><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex</code>: 它是一个包装的Perl脚本，可以备份整个表类型为<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">MyISAM</code>, <code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">InnoDB</code>和<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">XtraDB</code>的MySQL实例。</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">xtrabackup</code>: 一个用C写的二进制工具，仅用于复制<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">InnoDB</code>和<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">XtraDB</code>数据</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">xbcrypt</code>： 用于加/解密备份的文件的工具</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">xbstream</code>: 用于<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">sbstream</code>格式文件。</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">注意：虽然可以单独使用<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">xtrabackup</code>工具，但是，还是建议使用<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex</code>这个包装的脚本来执行，让它来为你调用<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">xtrabackup</code>。</span></span></span></p><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">使用方式</span></h3><h4 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:20px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">全量备份</span></h4><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><strong style="font-weight:bold;">备份</strong></span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:622px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:5.627009646302251%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:94.99999999999999%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">$ innobackupex --user=DBUSER --password=SECRET /path/to/backup/dir/</span><br/><span style="height:20px;">$ innobackupex --user=LUKE  --password=US3TH3F0RC3 --stream=tar ./ | bzip2 -</span><br/><span style="height:20px;">$ xtrabackup --user=DVADER --password=<span style="color:rgb(245, 135, 31);">14</span>MY0URF4TH3R --backup --target-dir=/data/bkps/</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">如果不指定<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">--user</code>，它会假定数据库的用户和你当前执行这些命令的用户名一样。</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">指定<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">my.cnf</code>文件：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:734px;"><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:4.768392370572207%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:96%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">$ innobackupex --defaults-file=/tmp/other-my.cnf --user=DBUSER --password=SECRET /path/to/backup/dir/</span><br/></pre></td></tr></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">注意，这个必须是第一个参数.</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">连接数据库的其他选项：</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">-port</code>: MySQL端口<br/><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">-socket</code>: MySQL的Socket文件<br/><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">-host</code>: MySQL主机</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">这些选项是传递给<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">mysql</code>的，你可以参考其他<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">mysql --help</code>允许的选项。</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><strong style="font-weight:bold;">权限</strong></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">你需要在文件系统级别对服务器的<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">datadir</code>（即数据目录）拥有<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">READ</code>, <code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">WRITE</code>和<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">EXECUTE</code>权限</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">在创建MySQL用户时，最小权限的例子：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql&gt; CREATE USER <span style="color:rgb(113, 140, 0);">'bkpuser'</span>@<span style="color:rgb(113, 140, 0);">'localhost'</span> IDENTIFIED BY <span style="color:rgb(113, 140, 0);">'s3cret'</span>;</span><br/><span style="height:20px;">mysql&gt; GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON *.* TO <span style="color:rgb(113, 140, 0);">'bkpuser'</span>@<span style="color:rgb(113, 140, 0);">'localhost'</span>;</span><br/><span style="height:20px;">mysql&gt; FLUSH PRIVILEGES;</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><strong style="font-weight:bold;">准备</strong><br/><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">$ innobackupex --user=DBUSER --password=SECRET /path/to/backup/dir/</code>这步只是备份而已，但没有恢复数据，还要执行以下操作</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">$ innobackupex --apply-log --use-memory=4G /path/to/backup/dir</code><br/>
如果不指定<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">--use-memory</code>，默认是<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">100M</code></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><strong style="font-weight:bold;">恢复</strong></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex --copy-back /path/to/BACKUP-DIR</code></span></span></span></p><h4 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:20px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">增量</span></h4><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><strong style="font-weight:bold;">备份阶段</strong></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">首先使用以下命令，创建一个基础的增量序列</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex /data/backups</code></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后创建第一个增量备份:</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex --incremental /data/backups --incremental-basedir=BASEDIR</code></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后再创建另一个增量备份：</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex --incremental /data/backups --incremental-basedir=INCREMENTAL-DIR-1</code><br/>
这时，要特别注意，以后每一次的增量备份，都要修改 <code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">--incremental-basedir=</code>参数为上一次的值</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><strong style="font-weight:bold;">准备阶段</strong></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex --apply-log --redo-only BASE-DIR</code></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后依次恢复（从旧到新）增量备份的数据</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex --apply-log --redo-only BASE-DIR --incremental-dir=INCREMENTAL-DIR-1</code><br/><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex --apply-log --incremental-dir=INCREMENTAL-DIR-2</code><br/>
…</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">注意，第二条没有<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">--redo-only</code>参数。这个参数应该用于当合并所有增量，但除了最近一次的。</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">一旦完成了所有增量恢复，就可以执行以下命令了：</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex --apply-log BASE-DIR</code></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><strong style="font-weight:bold;">恢复阶段</strong></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex --copy-back BASE-DIR</code></span></span></span></p><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">参考资料</span></h3><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">[1]</span> <a href="http://www.cnblogs.com/yuyue2014/p/3705448.html" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">xtrabackup原理</a></span></span></p><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">xtrabackup 实战</span></h3><h4 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:20px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">全量备份及恢复</span></h4><h5 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:18px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">备份</span></h5><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">注意：这里的<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">--user</code>以及<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">--password</code>是上连接该DB的用户名和密码，而且必须要拥有相应的权限，请参考上面的[权限]说明。<br/><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">/home/mysql/3306/backup</code>：这里是保存备份的位置</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-<span style="color:rgb(245, 135, 31);">5.6</span>$ innobackupex --user=bkpuser --password=s3cret --socket=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">3306</span>.socket --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/backup</span><br/><br/><span style="height:20px;">InnoDB Backup Utility v1.<span style="color:rgb(245, 135, 31);">5.1</span>-xtrabackup; Copyright <span style="color:rgb(245, 135, 31);">2003</span>, <span style="color:rgb(245, 135, 31);">2009</span> Innobase Oy</span><br/><span style="height:20px;">and Percona LLC and/or its affiliates <span style="color:rgb(245, 135, 31);">2009</span>-<span style="color:rgb(245, 135, 31);">2013</span>.  All Rights Reserved.</span><br/><br/><span style="height:20px;">This software is published under</span><br/><span style="height:20px;">the GNU GENERAL PUBLIC LICENSE Version <span style="color:rgb(245, 135, 31);">2</span>, June <span style="color:rgb(245, 135, 31);">1991</span>.</span><br/><br/><span style="height:20px;">Get the latest version of Percona XtraBackup, documentation, and <span style="color:rgb(245, 135, 31);">help</span> resources:</span><br/><span style="height:20px;">http://www.percona.com/xb/p</span><br/><br/><span style="height:20px;">...中间省略输出....一定要看到有以下一句才算是成功!</span><br/><span style="height:20px;">innobackupex: Backup created <span style="color:rgb(137, 89, 168);">in</span> directory <span style="color:rgb(113, 140, 0);">'/home/mysql/3306/backup/2015-09-01_11-17-17'</span></span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">150901</span> <span style="color:rgb(245, 135, 31);">11</span>:<span style="color:rgb(245, 135, 31);">17</span>:<span style="color:rgb(245, 135, 31);">22</span>  innobackupex: Connection to database server closed</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">150901</span> <span style="color:rgb(245, 135, 31);">11</span>:<span style="color:rgb(245, 135, 31);">17</span>:<span style="color:rgb(245, 135, 31);">22</span>  innobackupex: completed OK!</span><br/></pre></td></tr></tbody></table></div><h5 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:18px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">还原</span></h5><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">这里模拟数据损坏（直接删除mysql数据目录的相应的数据部分数据文件）</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:2687px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:1.3025679196129512%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/><span style="height:20px;">16</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:99.00309698948243%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;"><span style="color:rgb(245, 135, 31);">cd</span> /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">test</span></span><br/><span style="height:20px;"><span style="color:rgb(142, 144, 140);">#删除aa表的所有数据</span></span><br/><span style="height:20px;">rm -rf aa.*</span><br/><br/><span style="height:20px;"><span style="color:rgb(142, 144, 140);">#这时看表时，可以发现没有了aa表，而且启动时也有警告提示:</span></span><br/><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span> <span style="color:rgb(245, 135, 31);">11</span>:<span style="color:rgb(245, 135, 31);">56</span>:<span style="color:rgb(245, 135, 31);">34</span> <span style="color:rgb(245, 135, 31);">28638</span> [ERROR] InnoDB: Table <span style="color:rgb(245, 135, 31);">test</span>/aa <span style="color:rgb(137, 89, 168);">in</span> the InnoDB data dictionary has tablespace id <span style="color:rgb(245, 135, 31);">6</span>, but tablespace with that id or name does not exist. Have you deleted or moved .ibd files? This may also be a table created with CREATE TEMPORARY TABLE whose .ibd and .frm files MySQL automatically removed, but the table still exists <span style="color:rgb(137, 89, 168);">in</span> the InnoDB internal data dictionary.</span><br/><br/><br/><span style="height:20px;">mysql&gt; mysql&gt; show tables;</span><br/><span style="height:20px;">+----------------+</span><br/><span style="height:20px;">| Tables_<span style="color:rgb(137, 89, 168);">in</span>_<span style="color:rgb(245, 135, 31);">test</span> |</span><br/><span style="height:20px;">+----------------+</span><br/><span style="height:20px;">| mvcc           |</span><br/><span style="height:20px;">+----------------+</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">1</span> row <span style="color:rgb(137, 89, 168);">in</span> <span style="color:rgb(245, 135, 31);">set</span> (<span style="color:rgb(245, 135, 31);">0.00</span> sec)</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">这表示物理删除了数据文件，但是MySQL的数据字典里，还存在有表aa的信息，MySQL在启动的时候忽略了这个错误，继续启动。</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">现在，准备还原数据看看：</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><strong style="font-weight:bold;">准备阶段</strong></span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><br/><span style="height:20px;">innobackupex --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf  --apply-log --use-memory=<span style="color:rgb(245, 135, 31);">4</span>G /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/backup</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">执行完后，发现报错：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/><span style="height:20px;">16</span><br/><span style="height:20px;">17</span><br/><span style="height:20px;">18</span><br/><span style="height:20px;">19</span><br/><span style="height:20px;">20</span><br/><span style="height:20px;">21</span><br/><span style="height:20px;">22</span><br/><span style="height:20px;">23</span><br/><span style="height:20px;">24</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:~$ innobackupex --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf  --apply-log --use-memory=<span style="color:rgb(245, 135, 31);">4</span>G /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/backup</span><br/><br/><span style="height:20px;">InnoDB Backup Utility v1.<span style="color:rgb(245, 135, 31);">5.1</span>-xtrabackup; Copyright <span style="color:rgb(245, 135, 31);">2003</span>, <span style="color:rgb(245, 135, 31);">2009</span> Innobase Oy</span><br/><span style="height:20px;">and Percona LLC and/or its affiliates <span style="color:rgb(245, 135, 31);">2009</span>-<span style="color:rgb(245, 135, 31);">2013</span>.  All Rights Reserved.</span><br/><br/><span style="height:20px;">This software is published under</span><br/><span style="height:20px;">the GNU GENERAL PUBLIC LICENSE Version <span style="color:rgb(245, 135, 31);">2</span>, June <span style="color:rgb(245, 135, 31);">1991</span>.</span><br/><br/><span style="height:20px;">Get the latest version of Percona XtraBackup, documentation, and <span style="color:rgb(245, 135, 31);">help</span> resources:</span><br/><span style="height:20px;">http://www.percona.com/xb/p</span><br/><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">150901</span> <span style="color:rgb(245, 135, 31);">12</span>:<span style="color:rgb(245, 135, 31);">06</span>:<span style="color:rgb(245, 135, 31);">36</span>  innobackupex: Starting the apply-log operation</span><br/><br/><span style="height:20px;">IMPORTANT: Please check that the apply-log run completes successfully.</span><br/><span style="height:20px;">           At the end of a successful apply-log run innobackupex</span><br/><span style="height:20px;">           prints <span style="color:rgb(113, 140, 0);">&quot;completed OK!&quot;</span>.</span><br/><br/><span style="height:20px;">Could not open required defaults file: /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/backup/backup-my.cnf</span><br/><span style="height:20px;">Fatal error <span style="color:rgb(137, 89, 168);">in</span> defaults handling. Program aborted</span><br/><span style="height:20px;">innobackupex: got a fatal error with the following stacktrace: at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">4545</span>.</span><br/><span style="height:20px;">     main::get_option(<span style="color:rgb(113, 140, 0);">'innodb_data_file_path'</span>) called at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">2631</span></span><br/><span style="height:20px;">    main::apply_<span style="color:rgb(245, 135, 31);">log</span>() called at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">1578</span></span><br/><span style="height:20px;">innobackupex: Error: no <span style="color:rgb(113, 140, 0);">'innodb_data_file_path'</span> option <span style="color:rgb(137, 89, 168);">in</span> group <span style="color:rgb(113, 140, 0);">'mysqld'</span> <span style="color:rgb(137, 89, 168);">in</span> server configuration file <span style="color:rgb(113, 140, 0);">'/usr/local/mysql-data/3306/my.cnf'</span> at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">4545</span>.</span><br/><span style="height:20px;">mysql@yang:~$</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">这时，打开MySQL终端，输入以下命令：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:384px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:9.114583333333332%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:90.99999999999999%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql&gt; show variables like <span style="color:rgb(113, 140, 0);">'innodb_data_file_path'</span></span><br/><span style="height:20px;">    -&gt; ;</span><br/><span style="height:20px;">+-----------------------+------------------------+</span><br/><span style="height:20px;">| Variable_name         | Value                  |</span><br/><span style="height:20px;">+-----------------------+------------------------+</span><br/><span style="height:20px;">| innodb_data_file_path | ibdata1:<span style="color:rgb(245, 135, 31);">12</span>M:autoextend |</span><br/><span style="height:20px;">+-----------------------+------------------------+</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">1</span> row <span style="color:rgb(137, 89, 168);">in</span> <span style="color:rgb(245, 135, 31);">set</span> (<span style="color:rgb(245, 135, 31);">0.00</span> sec)</span><br/><br/><span style="height:20px;">mysql&gt;</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后，在配置文件 <code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">/home/mysql/3306/backup/backup-my.cnf</code>的<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">[mysqld]</code>组中，添加以下参数:</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">innodb_data_file_path=ibdata1:<span style="color:rgb(245, 135, 31);">12</span>M:autoextend</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">注意，这个是备份目录下的文件。</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后，又发现报错：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/><span style="height:20px;">16</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">xtrabackup version <span style="color:rgb(245, 135, 31);">2.2</span>.<span style="color:rgb(245, 135, 31);">12</span> based on MySQL server <span style="color:rgb(245, 135, 31);">5.6</span>.<span style="color:rgb(245, 135, 31);">24</span> Linux (x86_64) (revision id: <span style="color:rgb(245, 135, 31);">8726828</span>)</span><br/><span style="height:20px;">xtrabackup: <span style="color:rgb(245, 135, 31);">cd</span> to /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/backup</span><br/><span style="height:20px;">xtrabackup: Error: cannot open ./xtrabackup_checkpoints</span><br/><span style="height:20px;">xtrabackup: error: xtrabackup_<span style="color:rgb(245, 135, 31);">read</span>_metadata()</span><br/><span style="height:20px;">xtrabackup: This target seems not to have correct metadata...</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span> <span style="color:rgb(245, 135, 31);">12</span>:<span style="color:rgb(245, 135, 31);">20</span>:<span style="color:rgb(245, 135, 31);">19</span> <span style="color:rgb(245, 135, 31);">7</span>f3854c9c780  InnoDB: Operating system error number <span style="color:rgb(245, 135, 31);">2</span> <span style="color:rgb(137, 89, 168);">in</span> a file operation.</span><br/><span style="height:20px;">InnoDB: The error means the system cannot find the path specified.</span><br/><span style="height:20px;">xtrabackup: Warning: cannot open ./xtrabackup_logfile. will try to find.</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span> <span style="color:rgb(245, 135, 31);">12</span>:<span style="color:rgb(245, 135, 31);">20</span>:<span style="color:rgb(245, 135, 31);">19</span> <span style="color:rgb(245, 135, 31);">7</span>f3854c9c780  InnoDB: Operating system error number <span style="color:rgb(245, 135, 31);">2</span> <span style="color:rgb(137, 89, 168);">in</span> a file operation.</span><br/><span style="height:20px;">InnoDB: The error means the system cannot find the path specified.</span><br/><span style="height:20px;">  xtrabackup: Fatal error: cannot find ./xtrabackup_logfile.</span><br/><span style="height:20px;">xtrabackup: Error: xtrabackup_init_temp_<span style="color:rgb(245, 135, 31);">log</span>() failed.</span><br/><span style="height:20px;">innobackupex: got a fatal error with the following stacktrace: at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">2649</span>.</span><br/><span style="height:20px;">  main::apply_<span style="color:rgb(245, 135, 31);">log</span>() called at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">1578</span></span><br/><span style="height:20px;">innobackupex: Error:</span><br/><span style="height:20px;">innobackupex: ibbackup failed at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">2649</span>.</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">解决办法：<br/>
因为在备份时，默认情况下生成的路径为<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">/home/mysql/3306/backup/2015-09-01_11-17-17</code>，所以，应该将最后的目录参数改为<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">/home/mysql/3306/backup/2015-09-01_11-17-17</code>，再试一次：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:1854px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:1.8878101402373246%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/><span style="height:20px;">16</span><br/><span style="height:20px;">17</span><br/><span style="height:20px;">18</span><br/><span style="height:20px;">19</span><br/><span style="height:20px;">20</span><br/><span style="height:20px;">21</span><br/><span style="height:20px;">22</span><br/><span style="height:20px;">23</span><br/><span style="height:20px;">24</span><br/><span style="height:20px;">25</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:99.00914210812792%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:~$ innobackupex --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf --apply-log --use-memory=<span style="color:rgb(245, 135, 31);">4</span>G /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/backup/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_11-<span style="color:rgb(245, 135, 31);">17</span>-<span style="color:rgb(245, 135, 31);">17</span>/</span><br/><br/><span style="height:20px;">InnoDB Backup Utility v1.<span style="color:rgb(245, 135, 31);">5.1</span>-xtrabackup; Copyright <span style="color:rgb(245, 135, 31);">2003</span>, <span style="color:rgb(245, 135, 31);">2009</span> Innobase Oy</span><br/><span style="height:20px;">and Percona LLC and/or its affiliates <span style="color:rgb(245, 135, 31);">2009</span>-<span style="color:rgb(245, 135, 31);">2013</span>.  All Rights Reserved.</span><br/><br/><span style="height:20px;">This software is published under</span><br/><span style="height:20px;">the GNU GENERAL PUBLIC LICENSE Version <span style="color:rgb(245, 135, 31);">2</span>, June <span style="color:rgb(245, 135, 31);">1991</span>.</span><br/><br/><span style="height:20px;">Get the latest version of Percona XtraBackup, documentation, and <span style="color:rgb(245, 135, 31);">help</span> resources:</span><br/><span style="height:20px;">http://www.percona.com/xb/p</span><br/><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">150901</span> <span style="color:rgb(245, 135, 31);">12</span>:<span style="color:rgb(245, 135, 31);">33</span>:<span style="color:rgb(245, 135, 31);">35</span>  innobackupex: Starting the apply-log operation</span><br/><br/><span style="height:20px;">IMPORTANT: Please check that the apply-log run completes successfully.</span><br/><span style="height:20px;">           At the end of a successful apply-log run innobackupex</span><br/><span style="height:20px;">           prints <span style="color:rgb(113, 140, 0);">&quot;completed OK!&quot;</span>.</span><br/><br/><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">150901</span> <span style="color:rgb(245, 135, 31);">12</span>:<span style="color:rgb(245, 135, 31);">33</span>:<span style="color:rgb(245, 135, 31);">35</span>  innobackupex: Starting ibbackup with <span style="color:rgb(245, 135, 31);">command</span>: xtrabackup  --defaults-file=<span style="color:rgb(113, 140, 0);">&quot;/home/mysql/3306/backup/2015-09-01_11-17-17/backup-my.cnf&quot;</span>  --defaults-group=<span style="color:rgb(113, 140, 0);">&quot;mysqld&quot;</span> --prepare --target-dir=/home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/backup/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_11-<span style="color:rgb(245, 135, 31);">17</span>-<span style="color:rgb(245, 135, 31);">17</span> --use-memory=<span style="color:rgb(245, 135, 31);">4</span>G</span><br/><span style="height:20px;">...输出省略...</span><br/><span style="height:20px;">xtrabackup: starting shutdown with innodb_fast_shutdown = <span style="color:rgb(245, 135, 31);">1</span></span><br/><span style="height:20px;">InnoDB: FTS optimize thread exiting.</span><br/><span style="height:20px;">InnoDB: Starting shutdown...</span><br/><span style="height:20px;">InnoDB: Shutdown completed; <span style="color:rgb(245, 135, 31);">log</span> sequence number <span style="color:rgb(245, 135, 31);">232371734</span></span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">150901</span> <span style="color:rgb(245, 135, 31);">12</span>:<span style="color:rgb(245, 135, 31);">33</span>:<span style="color:rgb(245, 135, 31);">39</span>  innobackupex: completed OK!</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">这次终于成功了，判断的标志是最后是否打印<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">innobackupex: completed OK!</code></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><em>正式还原</em></span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">innobackupex --copy-back --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/backup/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_11-<span style="color:rgb(245, 135, 31);">17</span>-<span style="color:rgb(245, 135, 31);">17</span></span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">很悲剧地又发现报以下错误：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/><span style="height:20px;">16</span><br/><span style="height:20px;">17</span><br/><span style="height:20px;">18</span><br/><span style="height:20px;">19</span><br/><span style="height:20px;">20</span><br/><span style="height:20px;">21</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:~$ innobackupex --copy-back --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/backup/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_11-<span style="color:rgb(245, 135, 31);">17</span>-<span style="color:rgb(245, 135, 31);">17</span></span><br/><br/><span style="height:20px;">InnoDB Backup Utility v1.<span style="color:rgb(245, 135, 31);">5.1</span>-xtrabackup; Copyright <span style="color:rgb(245, 135, 31);">2003</span>, <span style="color:rgb(245, 135, 31);">2009</span> Innobase Oy</span><br/><span style="height:20px;">and Percona LLC and/or its affiliates <span style="color:rgb(245, 135, 31);">2009</span>-<span style="color:rgb(245, 135, 31);">2013</span>.  All Rights Reserved.</span><br/><br/><span style="height:20px;">This software is published under</span><br/><span style="height:20px;">the GNU GENERAL PUBLIC LICENSE Version <span style="color:rgb(245, 135, 31);">2</span>, June <span style="color:rgb(245, 135, 31);">1991</span>.</span><br/><br/><span style="height:20px;">Get the latest version of Percona XtraBackup, documentation, and <span style="color:rgb(245, 135, 31);">help</span> resources:</span><br/><span style="height:20px;">http://www.percona.com/xb/p</span><br/><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">150901</span> <span style="color:rgb(245, 135, 31);">12</span>:<span style="color:rgb(245, 135, 31);">39</span>:<span style="color:rgb(245, 135, 31);">40</span>  innobackupex: Starting the copy-back operation</span><br/><br/><span style="height:20px;">IMPORTANT: Please check that the copy-back run completes successfully.</span><br/><span style="height:20px;">           At the end of a successful copy-back run innobackupex</span><br/><span style="height:20px;">           prints <span style="color:rgb(113, 140, 0);">&quot;completed OK!&quot;</span>.</span><br/><br/><span style="height:20px;">innobackupex: got a fatal error with the following stacktrace: at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">2201</span>.</span><br/><span style="height:20px;">       main::<span style="color:rgb(137, 89, 168);">if</span>_directory_exists_and_empty(<span style="color:rgb(113, 140, 0);">'/usr/local/mysql-data/3306'</span>, <span style="color:rgb(113, 140, 0);">'Original data'</span>) called at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">2474</span></span><br/><span style="height:20px;">        main::copy_back(<span style="color:rgb(245, 135, 31);">0</span>) called at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">1578</span></span><br/><span style="height:20px;">innobackupex: Error: Original data directory <span style="color:rgb(113, 140, 0);">'/usr/local/mysql-data/3306'</span> is not empty! at /usr/bin/innobackupex line <span style="color:rgb(245, 135, 31);">2201</span>.</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">原来，还要令<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">/usr/local/mysql-data/3306</code> 这个目录为空才行.所以，为了安全见，再备份下：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mv /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span> /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>.old</span><br/><span style="height:20px;">mkdir /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span></span><br/><span style="height:20px;">sudo chown mysql:mysql /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/ -R</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后再试一次：</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">这里要注意，这使用了<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">3306.old/my.cnf</code></span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data$ innobackupex --copy-back --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>.old/my.cnf /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/backup/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_11-<span style="color:rgb(245, 135, 31);">17</span>-<span style="color:rgb(245, 135, 31);">17</span></span><br/><span style="height:20px;">....输出省略...</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">150901</span> <span style="color:rgb(245, 135, 31);">12</span>:<span style="color:rgb(245, 135, 31);">51</span>:<span style="color:rgb(245, 135, 31);">07</span>  innobackupex: completed OK!</span><br/><span style="height:20px;">mysql@yang:/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data$</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><em>重启</em><br/>
重启后，再检查数据：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:496px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:7.056451612903227%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:93%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql&gt; use <span style="color:rgb(245, 135, 31);">test</span>;</span><br/><span style="height:20px;">Reading table information <span style="color:rgb(137, 89, 168);">for</span> completion of table and column names</span><br/><span style="height:20px;">You can turn off this feature to get a quicker startup with -A</span><br/><br/><span style="height:20px;">Database changed</span><br/><span style="height:20px;">mysql&gt; show tables;</span><br/><span style="height:20px;">+----------------+</span><br/><span style="height:20px;">| Tables_<span style="color:rgb(137, 89, 168);">in</span>_<span style="color:rgb(245, 135, 31);">test</span> |</span><br/><span style="height:20px;">+----------------+</span><br/><span style="height:20px;">| aa             |</span><br/><span style="height:20px;">| mvcc           |</span><br/><span style="height:20px;">+----------------+</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">2</span> rows <span style="color:rgb(137, 89, 168);">in</span> <span style="color:rgb(245, 135, 31);">set</span> (<span style="color:rgb(245, 135, 31);">0.00</span> sec)</span><br/><br/><span style="height:20px;">mysql&gt;</span><br/></pre></td></tr></tbody></table></div><h4 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:20px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">增量备份与还原</span></h4><h5 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:18px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">备份</span></h5><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><em>进行基础备份</em></span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:1322px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:2.64750378214826%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:98.0067201557569%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:~/<span style="color:rgb(245, 135, 31);">3306</span>$ innobackupex --user=bkpuser --password=s3cret --socket=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">3306</span>.socket --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/base</span><br/><span style="height:20px;">InnoDB Backup Utility v1.<span style="color:rgb(245, 135, 31);">5.1</span>-xtrabackup; Copyright <span style="color:rgb(245, 135, 31);">2003</span>, <span style="color:rgb(245, 135, 31);">2009</span> Innobase Oy</span><br/><span style="height:20px;">and Percona LLC and/or its affiliates <span style="color:rgb(245, 135, 31);">2009</span>-<span style="color:rgb(245, 135, 31);">2013</span>.  All Rights Reserved.</span><br/><br/><span style="height:20px;">This software is published under</span><br/><span style="height:20px;">the GNU GENERAL PUBLIC LICENSE Version <span style="color:rgb(245, 135, 31);">2</span>, June <span style="color:rgb(245, 135, 31);">1991</span>.</span><br/><br/><span style="height:20px;">Get the latest version of Percona XtraBackup, documentation, and <span style="color:rgb(245, 135, 31);">help</span> resources:</span><br/><span style="height:20px;">http://www.percona.com/xb/p</span><br/><br/><span style="height:20px;">...中间省略输出....一定要看到有以下一句才算是成功!</span><br/><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">150901</span> <span style="color:rgb(245, 135, 31);">13</span>:<span style="color:rgb(245, 135, 31);">02</span>:<span style="color:rgb(245, 135, 31);">13</span>  innobackupex: completed OK!</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><em>进行第一次增量备份</em></span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:~/<span style="color:rgb(245, 135, 31);">3306</span>$ innobackupex --user=bkpuser --password=s3cret --socket=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">3306</span>.socket --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf --incremental-basedir=/home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/base/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_13-<span style="color:rgb(245, 135, 31);">02</span>-<span style="color:rgb(245, 135, 31);">10</span> --incremental /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/incremental/one</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">结果如下：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:~/<span style="color:rgb(245, 135, 31);">3306</span>$ innobackupex --user=bkpuser --password=s3cret --socket=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">3306</span>.socket --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf --incremental-basedir=/home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/base/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_13-<span style="color:rgb(245, 135, 31);">02</span>-<span style="color:rgb(245, 135, 31);">10</span> --incremental /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/incremental/one</span><br/><br/><span style="height:20px;">...中间省略输出....一定要看到有以下一句才算是成功!</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">150901</span> <span style="color:rgb(245, 135, 31);">13</span>:<span style="color:rgb(245, 135, 31);">07</span>:<span style="color:rgb(245, 135, 31);">32</span>  innobackupex: completed OK!</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">这中间做一些其他的数据库操作，比如插入几条新数据，然后再进行第二次境量备份<br/>
注意 <code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">incremental-basedir</code>和<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">-incremental</code>参数的变化</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:~/<span style="color:rgb(245, 135, 31);">3306</span>$ innobackupex --user=bkpuser --password=s3cret --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf --incremental-basedir=/home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/incremental/one/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_13-<span style="color:rgb(245, 135, 31);">07</span>-<span style="color:rgb(245, 135, 31);">29</span> --incremental /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/incremental/two</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><strong style="font-weight:bold;">特别注意</strong></span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">因为默认情况下，备份的目录会自动生成时间截，所以，参数要定位到时间截的目录。</span></span></span></p><h5 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:18px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">还原</span></h5><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><em>准备阶段</em></span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:~$ innobackupex --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf  --apply-log --redo-only --use-memory=<span style="color:rgb(245, 135, 31);">4</span>G /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/base/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_13-<span style="color:rgb(245, 135, 31);">02</span>-<span style="color:rgb(245, 135, 31);">10</span></span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">模拟数据损坏</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:377px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:9.283819628647215%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/><span style="height:20px;">16</span><br/><span style="height:20px;">17</span><br/><span style="height:20px;">18</span><br/><span style="height:20px;">19</span><br/><span style="height:20px;">20</span><br/><span style="height:20px;">21</span><br/><span style="height:20px;">22</span><br/><span style="height:20px;">23</span><br/><span style="height:20px;">24</span><br/><span style="height:20px;">25</span><br/><span style="height:20px;">26</span><br/><span style="height:20px;">27</span><br/><span style="height:20px;">28</span><br/><span style="height:20px;">29</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:91.00316352777696%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">删除某几条数据</span><br/><br/><span style="height:20px;">mysql&gt; select * from aa;</span><br/><span style="height:20px;">+----+--------+</span><br/><span style="height:20px;">| id | name   |</span><br/><span style="height:20px;">+----+--------+</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">1</span> | yang   |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">2</span> | yang2  |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">3</span> | yang-s |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">4</span> | y      |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">5</span> | yy     |</span><br/><span style="height:20px;">+----+--------+</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">5</span> rows <span style="color:rgb(137, 89, 168);">in</span> <span style="color:rgb(245, 135, 31);">set</span> (<span style="color:rgb(245, 135, 31);">0.00</span> sec)</span><br/><br/><span style="height:20px;">mysql&gt; insert into aa (name) values (<span style="color:rgb(113, 140, 0);">'yy'</span>);mysql&gt;</span><br/><span style="height:20px;">mysql&gt; delete from aa <span style="color:rgb(245, 135, 31);">where</span> id &lt; <span style="color:rgb(245, 135, 31);">3</span>;</span><br/><span style="height:20px;">Query OK, <span style="color:rgb(245, 135, 31);">2</span> rows affected (<span style="color:rgb(245, 135, 31);">0.00</span> sec)</span><br/><br/><span style="height:20px;">mysql&gt; select * from aa;</span><br/><span style="height:20px;">+----+--------+</span><br/><span style="height:20px;">| id | name   |</span><br/><span style="height:20px;">+----+--------+</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">3</span> | yang-s |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">4</span> | y      |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">5</span> | yy     |</span><br/><span style="height:20px;">+----+--------+</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">3</span> rows <span style="color:rgb(137, 89, 168);">in</span> <span style="color:rgb(245, 135, 31);">set</span> (<span style="color:rgb(245, 135, 31);">0.00</span> sec)</span><br/><br/><span style="height:20px;">mysql&gt;</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><em>还原</em></span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mv /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span> /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>.old2</span><br/><span style="height:20px;">mysql@yang:~$ innobackupex --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>.old2/my.cnf  --copy-back /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/base/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_13-<span style="color:rgb(245, 135, 31);">02</span>-<span style="color:rgb(245, 135, 31);">10</span></span><br/><br/><span style="height:20px;"><span style="color:rgb(142, 144, 140);">##复制回配置文件及启动脚本</span></span><br/><br/><span style="height:20px;">`copy /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>.old2/my.cnf /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>.old2/startup.sh /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/`</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">启动mysql，这时看到数据：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql&gt; select * from aa;</span><br/><span style="height:20px;">+----+--------+</span><br/><span style="height:20px;">| id | name   |</span><br/><span style="height:20px;">+----+--------+</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">1</span> | yang   |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">2</span> | yang2  |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">3</span> | yang-s |</span><br/><span style="height:20px;">+----+--------+</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">3</span> rows <span style="color:rgb(137, 89, 168);">in</span> <span style="color:rgb(245, 135, 31);">set</span> (<span style="color:rgb(245, 135, 31);">0.00</span> sec)</span><br/><br/><span style="height:20px;">mysql&gt;</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">关闭掉mysql，还原第一，二次的增量备份数据:</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">innobackupex --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf  --apply-log --redo-only --use-memory=<span style="color:rgb(245, 135, 31);">4</span>G /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/base/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_13-<span style="color:rgb(245, 135, 31);">02</span>-<span style="color:rgb(245, 135, 31);">10</span> --incremental-dir=/home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/incremental/one/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_14-<span style="color:rgb(245, 135, 31);">22</span>-<span style="color:rgb(245, 135, 31);">53</span></span><br/><br/><span style="height:20px;">innobackupex --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/my.cnf  --apply-log --redo-only --use-memory=<span style="color:rgb(245, 135, 31);">4</span>G /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/base/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_14-<span style="color:rgb(245, 135, 31);">21</span>-<span style="color:rgb(245, 135, 31);">12</span>/ --incremental-dir=/home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/incremental/two/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_14-<span style="color:rgb(245, 135, 31);">24</span>-<span style="color:rgb(245, 135, 31);">06</span>/</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">注意，这里你按需准备好想要恢复的增量的数据即可。（比如，我只想要恢复<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">base + one</code>的数据）</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后，正式还原：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql@yang:/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data$ innobackupex --defaults-file=/usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>.old/my.cnf   --copy-back /home/mysql/<span style="color:rgb(245, 135, 31);">3306</span>/base/<span style="color:rgb(245, 135, 31);">2015</span>-<span style="color:rgb(245, 135, 31);">09</span>-<span style="color:rgb(245, 135, 31);">01</span>_14-<span style="color:rgb(245, 135, 31);">21</span>-<span style="color:rgb(245, 135, 31);">12</span>/</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">还原时，只需要指定基础备份的目录即可</span></span></span></p><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">参考资料</span></h3><ol><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><a href="http://www.drupal001.com/2014/02/percona-xtrabackup-mysql/" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">drupal001</a></span></span></li><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><a href="http://www.zhengdazhi.com/archives/1281" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">zhengdazhi</a></span></span></li><li><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><a href="https://www.percona.com/doc/percona-xtrabackup/" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">offical</a></span></span></li></ol><h2 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:24px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">mysqldump</span></h2><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">备份</span></h3><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysqldump -S /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">3306</span>.socket --single-transaction --skip-opt -q --routines --triggers --create-options --no-autocommit -B <span style="color:rgb(245, 135, 31);">test</span> | gzip &gt; /tmp/test.sql.gz</span><br/></pre></td></tr></tbody></table></div><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">还原</span></h3><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">先删除<span style="color:rgb(245, 135, 31);">test</span>数据库，再还原：</span><br/><span style="height:20px;">mysql&gt;drop database <span style="color:rgb(245, 135, 31);">test</span>;</span><br/><br/><span style="height:20px;">shell:</span><br/><span style="height:20px;">gunzip &lt; /tmp/test.sql.gz |  mysql -S /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">3306</span>.socket -h localhost -u root -p</span><br/></pre></td></tr></tbody></table></div><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">参考资料</span></h3><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><a href="http://codelg.cn/?p=310" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">mysqldump</a></span></span></p><h2 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:24px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">主从复制(master/slave)</span></h2><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">主配置</span></h3><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/><span style="height:20px;">16</span><br/><span style="height:20px;">17</span><br/><span style="height:20px;">18</span><br/><span style="height:20px;">19</span><br/><span style="height:20px;">20</span><br/><span style="height:20px;">21</span><br/><span style="height:20px;">22</span><br/><span style="height:20px;">23</span><br/><span style="height:20px;">24</span><br/><span style="height:20px;">25</span><br/><span style="height:20px;">26</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">[mysqld]</span><br/><span style="height:20px;">port       = <span style="color:rgb(245, 135, 31);">3306</span></span><br/><span style="height:20px;">socket     = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">3306</span>.socket</span><br/><span style="height:20px;">datadir    = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span></span><br/><span style="height:20px;">pid-file   = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">3306</span>.pid</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">log</span>-error    = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">3306</span>.err</span><br/><span style="height:20px;">slow_query_<span style="color:rgb(245, 135, 31);">log</span> = <span style="color:rgb(245, 135, 31);">1</span></span><br/><span style="height:20px;">long_query_time = <span style="color:rgb(245, 135, 31);">0.3</span></span><br/><span style="height:20px;">slow_query_<span style="color:rgb(245, 135, 31);">log</span>_file = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/query-slow.log</span><br/><span style="height:20px;">general_<span style="color:rgb(245, 135, 31);">log</span> = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/general-log.log</span><br/><span style="height:20px;">language    = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-<span style="color:rgb(245, 135, 31);">5.6</span>/share/english</span><br/><span style="height:20px;">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br/><br/><span style="height:20px;"><span style="color:rgb(142, 144, 140);"># replication</span></span><br/><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">log</span>-bin = mysql-bin</span><br/><span style="height:20px;">server-id = <span style="color:rgb(245, 135, 31);">1</span></span><br/><br/><span style="height:20px;">enforce-gtid-consistency</span><br/><span style="height:20px;">gtid-mode=ON</span><br/><br/><span style="height:20px;"><span style="color:rgb(142, 144, 140);">#replication the db</span></span><br/><span style="height:20px;">replicate-do-db=<span style="color:rgb(245, 135, 31);">test</span></span><br/><br/><span style="height:20px;"><span style="color:rgb(142, 144, 140);">#must</span></span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">log</span>-slave-updates</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后重启master服务器</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后创建一个用于复制的用户</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">CREATE USER <span style="color:rgb(113, 140, 0);">'repl-user'</span>@<span style="color:rgb(113, 140, 0);">'%'</span> IDENTIFIED BY <span style="color:rgb(113, 140, 0);">'slavepass'</span>;</span><br/><span style="height:20px;">GRANT REPLICATION SLAVE ON *.* TO <span style="color:rgb(113, 140, 0);">'repl-user'</span>@<span style="color:rgb(113, 140, 0);">'%'</span>;</span><br/><span style="height:20px;">flush privileges;</span><br/></pre></td></tr></tbody></table></div><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">从配置</span></h3><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:475px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:7.368421052631578%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/><span style="height:20px;">16</span><br/><span style="height:20px;">17</span><br/><span style="height:20px;">18</span><br/><span style="height:20px;">19</span><br/><span style="height:20px;">20</span><br/><span style="height:20px;">21</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:93.00402067777141%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">[mysqld]</span><br/><span style="height:20px;">port       = <span style="color:rgb(245, 135, 31);">3307</span></span><br/><span style="height:20px;">socket     = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3307</span>/<span style="color:rgb(245, 135, 31);">3307</span>.socket</span><br/><span style="height:20px;">datadir    = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3307</span></span><br/><span style="height:20px;">pid-file   = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3307</span>/<span style="color:rgb(245, 135, 31);">3307</span>.pid</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">log</span>-error    = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3307</span>/<span style="color:rgb(245, 135, 31);">3307</span>.err</span><br/><span style="height:20px;">slow_query_<span style="color:rgb(245, 135, 31);">log</span> = <span style="color:rgb(245, 135, 31);">1</span></span><br/><span style="height:20px;">long_query_time = <span style="color:rgb(245, 135, 31);">0.3</span></span><br/><span style="height:20px;">slow_query_<span style="color:rgb(245, 135, 31);">log</span>_file = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3307</span>/query-slow.log</span><br/><span style="height:20px;">general_<span style="color:rgb(245, 135, 31);">log</span> = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3307</span>/general-log.log</span><br/><span style="height:20px;">language    = /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-<span style="color:rgb(245, 135, 31);">5.6</span>/share/english</span><br/><span style="height:20px;">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br/><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">log</span>-bin = mysql-bin</span><br/><span style="height:20px;">server-id = <span style="color:rgb(245, 135, 31);">2</span></span><br/><span style="height:20px;">relay-log = relay-log-slave</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">read</span>-only = ON</span><br/><br/><span style="height:20px;">gtid-mode =ON</span><br/><span style="height:20px;">enforce-gtid-consistency</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">log</span>-slave-updates</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后重启slave服务器</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">然后在slave里执行以下命令：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">CHANGE MASTER TO \</span><br/><span style="height:20px;">MASTER_HOST = <span style="color:rgb(113, 140, 0);">'10.0.0.81'</span>, \</span><br/><span style="height:20px;">MASTER_PORT = <span style="color:rgb(245, 135, 31);">3306</span>, \</span><br/><span style="height:20px;">MASTER_USER = <span style="color:rgb(113, 140, 0);">'repl-user'</span>, \</span><br/><span style="height:20px;">MASTER_PASSWORD = <span style="color:rgb(113, 140, 0);">'slavepass'</span>, \</span><br/><span style="height:20px;">MASTER_AUTO_POSITION = <span style="color:rgb(245, 135, 31);">1</span>;</span><br/><br/><span style="height:20px;">然后正式开始：</span><br/><span style="height:20px;">mysql&gt;START SLAVE;</span><br/></pre></td></tr></tbody></table></div><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">检查复制状态</span></h3><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">SHOW SLAVE STATUS;</span><br/></pre></td></tr></tbody></table></div><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">Slave_SQL_Running 为No</span></h3><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin:0px;width:468px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:7.478632478632479%;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/><span style="height:20px;">16</span><br/><span style="height:20px;">17</span><br/><span style="height:20px;">18</span><br/><span style="height:20px;">19</span><br/><span style="height:20px;">20</span><br/><span style="height:20px;">21</span><br/><span style="height:20px;">22</span><br/><span style="height:20px;">23</span><br/><span style="height:20px;">24</span><br/><span style="height:20px;">25</span><br/><span style="height:20px;">26</span><br/><span style="height:20px;">27</span><br/><span style="height:20px;">28</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;width:93.00522973477774%;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">到slave执行以下命令：</span><br/><br/><span style="height:20px;">mysql&gt; stop slave;</span><br/><br/><span style="height:20px;">到master执行以下命令：</span><br/><span style="height:20px;">mysql&gt; show master status \G</span><br/><span style="height:20px;">*************************** <span style="color:rgb(245, 135, 31);">1</span>. row ***************************</span><br/><span style="height:20px;">             File: mysql-bin.<span style="color:rgb(245, 135, 31);">000001</span></span><br/><span style="height:20px;">         Position: <span style="color:rgb(245, 135, 31);">1790</span></span><br/><span style="height:20px;">     Binlog_Do_DB:</span><br/><span style="height:20px;"> Binlog_Ignore_DB:</span><br/><span style="height:20px;">Executed_Gtid_Set: <span style="color:rgb(245, 135, 31);">3</span>bf331ce-<span style="color:rgb(245, 135, 31);">5074</span>-<span style="color:rgb(245, 135, 31);">11</span>e5-<span style="color:rgb(245, 135, 31);">9</span>a27-<span style="color:rgb(245, 135, 31);">7824</span>af3fdd83:<span style="color:rgb(245, 135, 31);">1</span>-<span style="color:rgb(245, 135, 31);">7</span></span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">1</span> row <span style="color:rgb(137, 89, 168);">in</span> <span style="color:rgb(245, 135, 31);">set</span> (<span style="color:rgb(245, 135, 31);">0.00</span> sec)</span><br/><br/><br/><span style="height:20px;">到slave执行以下命令：</span><br/><br/><span style="height:20px;">mysql&gt;CHANGE MASTER TO \</span><br/><span style="height:20px;">MASTER_HOST = <span style="color:rgb(113, 140, 0);">'10.0.0.81'</span>, \</span><br/><span style="height:20px;">MASTER_PORT = <span style="color:rgb(245, 135, 31);">3306</span>, \</span><br/><span style="height:20px;">MASTER_USER = <span style="color:rgb(113, 140, 0);">'repl-user'</span>, \</span><br/><span style="height:20px;">MASTER_PASSWORD = <span style="color:rgb(113, 140, 0);">'slavepass'</span>, \</span><br/><span style="height:20px;">MASTER_LOG_FILE = <span style="color:rgb(113, 140, 0);">'mysql-bin.000001'</span>, \</span><br/><span style="height:20px;">MASTER_AUTO_POSITION = <span style="color:rgb(245, 135, 31);">0</span>, \</span><br/><span style="height:20px;">MASTER_LOG_POS = <span style="color:rgb(245, 135, 31);">1790</span>;</span><br/><br/><span style="height:20px;">到slave执行以下命令启动slave</span><br/><span style="height:20px;">mysql&gt; start slave;</span><br/></pre></td></tr></tbody></table></div><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">从库延后的解决</span></h3><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">不知道为什么，做好复制好，发现从库没有更上主库，如下：</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">主库：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql&gt; select * from <span style="color:rgb(245, 135, 31);">test</span>_slave;</span><br/><span style="height:20px;">+----+---------+</span><br/><span style="height:20px;">| id | name    |</span><br/><span style="height:20px;">+----+---------+</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">1</span> | aa      |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">2</span> | aa      |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">3</span> | aa      |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">4</span> | a32323a |</span><br/><span style="height:20px;">+----+---------+</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">4</span> rows <span style="color:rgb(137, 89, 168);">in</span> <span style="color:rgb(245, 135, 31);">set</span> (<span style="color:rgb(245, 135, 31);">0.00</span> sec)</span><br/><br/><span style="height:20px;">mysql&gt;</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">从库:</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">mysql&gt; select * from <span style="color:rgb(245, 135, 31);">test</span>_slave;</span><br/><span style="height:20px;">+----+---------+</span><br/><span style="height:20px;">| id | name    |</span><br/><span style="height:20px;">+----+---------+</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">3</span> | aa      |</span><br/><span style="height:20px;">|  <span style="color:rgb(245, 135, 31);">4</span> | a32323a |</span><br/><span style="height:20px;">+----+---------+</span><br/><span style="height:20px;"><span style="color:rgb(245, 135, 31);">2</span> rows <span style="color:rgb(137, 89, 168);">in</span> <span style="color:rgb(245, 135, 31);">set</span> (<span style="color:rgb(245, 135, 31);">0.00</span> sec)</span><br/><br/><span style="height:20px;">mysql&gt;</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">解决：</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><em>在master上执行以下命令</em></span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><br/><span style="height:20px;">RESET MASTER;</span><br/><span style="height:20px;">FLUSH TABLES WITH READ LOCK;</span><br/><span style="height:20px;">SHOW MASTER STATUS;</span><br/><br/><span style="height:20px;">mysqldump -uroot -p -S /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3306</span>/<span style="color:rgb(245, 135, 31);">3306</span>.socket --master-data=<span style="color:rgb(245, 135, 31);">2</span> --all-databases &gt; /tmp/<span style="color:rgb(245, 135, 31);">3306</span>.all.sql</span><br/><br/><span style="height:20px;">UNLOCK TABLES;</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><em>在slave上执行以下命令</em></span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/><span style="height:20px;">3</span><br/><span style="height:20px;">4</span><br/><span style="height:20px;">5</span><br/><span style="height:20px;">6</span><br/><span style="height:20px;">7</span><br/><span style="height:20px;">8</span><br/><span style="height:20px;">9</span><br/><span style="height:20px;">10</span><br/><span style="height:20px;">11</span><br/><span style="height:20px;">12</span><br/><span style="height:20px;">13</span><br/><span style="height:20px;">14</span><br/><span style="height:20px;">15</span><br/><span style="height:20px;">16</span><br/><span style="height:20px;">17</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">STOP SLAVE;</span><br/><span style="height:20px;">RESET MASTER;</span><br/><br/><span style="height:20px;">mysql -S /usr/<span style="color:rgb(245, 135, 31);">local</span>/mysql-data/<span style="color:rgb(245, 135, 31);">3307</span>/<span style="color:rgb(245, 135, 31);">3307</span>.socket -u root -p -h localhost -P <span style="color:rgb(245, 135, 31);">3307</span> &lt; /tmp/<span style="color:rgb(245, 135, 31);">3306</span>.all.sql</span><br/><br/><span style="height:20px;">RESET SLAVE;</span><br/><br/><span style="height:20px;">CHANGE MASTER TO \</span><br/><span style="height:20px;">MASTER_HOST = <span style="color:rgb(113, 140, 0);">'10.0.0.81'</span>, \</span><br/><span style="height:20px;">MASTER_PORT = <span style="color:rgb(245, 135, 31);">3306</span>, \</span><br/><span style="height:20px;">MASTER_USER = <span style="color:rgb(113, 140, 0);">'repl-user'</span>, \</span><br/><span style="height:20px;">MASTER_PASSWORD = <span style="color:rgb(113, 140, 0);">'slavepass'</span>, \</span><br/><span style="height:20px;">MASTER_LOG_FILE = <span style="color:rgb(113, 140, 0);">'mysql-bin.000001'</span>, \</span><br/><span style="height:20px;">MASTER_AUTO_POSITION = <span style="color:rgb(245, 135, 31);">0</span>, \</span><br/><span style="height:20px;">MASTER_LOG_POS = <span style="color:rgb(245, 135, 31);">151</span>;</span><br/><br/><span style="height:20px;">START SLAVE;</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">执行完，记得再次检查slave状态：</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">show slave status;</span><br/></pre></td></tr></tbody></table></div><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">看看两个线程是不是都是<code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">Yes</code>:</span></span></span></p><div style="display:block;margin:20px 0px;padding:15px;overflow:auto;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;width:auto;margin:0px;"><tbody><tr><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="color:rgb(102, 102, 102);overflow:auto;font-size:13px;background:rgb(247, 247, 247);font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;padding:0px;margin:0px;border:none;text-align:right;padding-right:20px;"><span style="height:20px;">1</span><br/><span style="height:20px;">2</span><br/></pre></td><td style="text-align:left;vertical-align:middle;font-weight:normal;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(221, 221, 221);padding:0px;border:none;"><pre style="overflow:auto;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:13px;color:rgb(77, 77, 76);background:rgb(247, 247, 247);margin:0px;padding:0px;border:none;"><span style="height:20px;">Slave_IO_Running: Yes</span><br/><span style="height:20px;">Slave_SQL_Running: Yes</span><br/></pre></td></tr></tbody></table></div><h3 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:22px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">参考资料</span></h3><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><a href="http://blog.csdn.net/magerguo/article/details/9145329" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">CSND</a><span style="color: rgb(85, 85, 85);"><br/></span><a href="http://stackoverflow.com/questions/2366018/how-to-re-sync-the-mysql-db-if-master-and-slave-have-different-database-incase-o" rel="external" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);" target="_blank">Stackoverflow</a></span></span></p><h2 style="margin:60px 0px 15px;padding:0px;font-weight:bold;font-family:Cambria, Georgia, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', 'Times New Roman', serif;font-size:24px;padding-top:10px;"><span style="color: rgb(85, 85, 85);">文件同步方式（冷备）</span></h2><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">这个方式最好就是停掉服务器，然后进行文件同步.</span></span></span></p><p style="margin:20px 0px;"><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);"><code style="font-size:1em;font-family:'PT Mono', Consolas, Monaco, Menlo, monospace;text-shadow:rgb(255, 255, 255) 0px 1px;padding:0px 0.3em;background:rgb(238, 238, 238);">rsync -avh --delete /usr/local/mysql-data/3306 /home/mysql/3306/backup</code></span></span></span></p></div><div><br/></div><div style="text-align:justify;"><div style="margin:20px 0px;"><div><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><span style="color: rgb(85, 85, 85);">rsync是个神器！它可以增量同步文件。这个没有什么特别的了。</span></span></span><span style="font-size: 16px;"><span style="font-family: Lato, 'Microsoft Jhenghei', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;"><a href="http://emacsist.github.io/tags/dba/" style="background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:rgb(153, 153, 153);display:inline-block;margin-right:10px;font-size:13px;"> </a></span></span></div></div></div></div></div></span>
</div></body></html> 