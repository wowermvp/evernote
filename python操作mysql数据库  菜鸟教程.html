<html>
<head>
  <title>python操作mysql数据库 | 菜鸟教程</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1745"/>
<h1>python操作mysql数据库 | 菜鸟教程</h1>

<div><span><br/><div style="font-size: 16px"><div style="overflow-y:scroll;"><div style="font-size:12px;color:rgb(0, 0, 0);background-color:rgb(246, 244, 240);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><div><div style="background-color:rgb(255, 255, 255);"><div style="overflow:hidden;background-color:rgb(255, 255, 255);"><div> <h1 style="font-size:210%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:0px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">python操作mysql数据库</h1> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">Python 标准数据库接口为 Python DB-API，Python DB-API为开发人员提供了数据库应用编程接口。</p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">Python 数据库接口支持非常多的数据库，你可以选择适合你项目的数据库：</p> <ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;">GadFly</li> <li style="padding:2px 0px;">mSQL</li> <li style="padding:2px 0px;">MySQL</li> <li style="padding:2px 0px;">PostgreSQL</li> <li style="padding:2px 0px;">Microsoft SQL Server 2000</li> <li style="padding:2px 0px;">Informix</li> <li style="padding:2px 0px;">Interbase</li> <li style="padding:2px 0px;">Oracle</li> <li style="padding:2px 0px;">Sybase</li> </ul> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">你可以访问<a href="https://wiki.python.org/moin/DatabaseInterfaces" style="color:rgb(0, 0, 0);background-color:transparent;" target="_blank">Python数据库接口及API</a>查看详细的支持数据库列表。</p><p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> 不同的数据库你需要下载不同的DB API模块，例如你需要访问Oracle数据库和Mysql数据，你需要下载Oracle和MySQL数据库模块。</p><p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> DB-API 是一个规范. 它定义了一系列必须的对象和数据库存取方式, 以便为各种各样的底层数据库系统和多种多样的数据库接口程序提供一致的访问接口 。</p><p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> Python的DB-API，为大多数的数据库实现了接口，使用它连接各数据库后，就可以用相同的方式操作各数据库。 </p><p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> Python DB-API使用流程：</p> <ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;">引入 API 模块。</li> <li style="padding:2px 0px;">获取与数据库的连接。</li> <li style="padding:2px 0px;">执行SQL语句和存储过程。</li> <li style="padding:2px 0px;">关闭数据库连接。</li> </ul> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">什么是MySQLdb?</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">MySQLdb 是用于Python链接Mysql数据库的接口，它实现了 Python 数据库 API 规范 V2.0，基于 MySQL C API 上建立的。</p> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">如何安装MySQLdb?</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">为了用DB-API编写MySQL脚本，必须确保已经安装了MySQL。复制以下代码，并执行：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);"># encoding: utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">如果执行后的输出结果如下所示，意味着你没有安装 MySQLdb 模块：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(102, 0, 102);">Traceback</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">most recent call </span><span style="color:rgb(0, 0, 136);">last</span><span style="color:rgb(102, 102, 0);">):</span><span style="color:rgb(0, 0, 0);">
  </span><span style="color:rgb(102, 0, 102);">File</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;test.py&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> line </span><span style="color:rgb(0, 102, 102);">3</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">in</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&lt;module&gt;</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 0, 102);">ImportError</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">No</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">module</span><span style="color:rgb(0, 0, 0);"> named </span><span style="color:rgb(102, 0, 102);">MySQLdb</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">安装MySQLdb，请访问 <a href="http://sourceforge.net/projects/mysql-python" style="color:rgb(0, 0, 0);background-color:transparent;" target="_blank">http://sourceforge.net/projects/mysql-python</a> ，(Linux平台可以访问：<a href="https://pypi.python.org/pypi/MySQL-python" style="color:rgb(0, 0, 0);background-color:transparent;" target="_blank">https://pypi.python.org/pypi/MySQL-python</a>)从这里可选择适合您的平台的安装包，分为预编译的二进制文件和源代码安装包。</p><p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">如果您选择二进制文件发行版本的话，安装过程基本安装提示即可完成。如果从源代码进行安装的话，则需要切换到MySQLdb发行版本的顶级目录，并键入下列命令: </p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(0, 0, 0);">$ gunzip </span><span style="color:rgb(102, 0, 102);">MySQL</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 0, 0);">python</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1.2</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 102, 102);">2.tar</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">gz
$ tar </span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 0, 0);">xvf </span><span style="color:rgb(102, 0, 102);">MySQL</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 0, 0);">python</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1.2</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 102, 102);">2.tar</span><span style="color:rgb(0, 0, 0);">
$ cd </span><span style="color:rgb(102, 0, 102);">MySQL</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 0, 0);">python</span><span style="color:rgb(102, 102, 0);">-</span><span style="color:rgb(0, 102, 102);">1.2</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(0, 0, 0);">
$ python setup</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">py build
$ python setup</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">py install</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><strong>注意：</strong>请确保您有root权限来安装上述模块。</p> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">数据库连接</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">连接数据库前，请先确认以下事项：</p> <ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;">您已经创建了数据库 TESTDB.</li> <li style="padding:2px 0px;">在TESTDB数据库中您已经创建了表 EMPLOYEE</li> <li style="padding:2px 0px;">EMPLOYEE表字段为 FIRST_NAME, LAST_NAME, AGE, SEX 和 INCOME。</li> <li style="padding:2px 0px;">连接数据库TESTDB使用的用户名为 &quot;testuser&quot; ，密码为 &quot;test123&quot;,你可以可以自己设定或者直接使用root用户名及其密码，Mysql数据库用户授权请使用Grant命令。</li> <li style="padding:2px 0px;">在你的机子上已经安装了 Python MySQLdb 模块。</li> <li style="padding:2px 0px;">如果您对sql语句不熟悉，可以访问我们的 <a href="http://www.runoob.com/sql/sql-tutorial.html" style="color:rgb(0, 0, 0);background-color:transparent;">SQL基础教程</a> </li> </ul> <h3 style="font-size:120%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">实例：</h3> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">以下实例链接Mysql的TESTDB数据库：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);"># encoding: utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 打开数据库连接</span><span style="color:rgb(0, 0, 0);">
db </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">connect</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;localhost&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;testuser&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;test123&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;TESTDB&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 使用cursor()方法获取操作游标 </span><span style="color:rgb(0, 0, 0);">
cursor </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">cursor</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 使用execute方法执行SQL语句</span><span style="color:rgb(0, 0, 0);">
cursor</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">execute</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;SELECT VERSION()&quot;</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 使用 fetchone() 方法获取一条数据库。</span><span style="color:rgb(0, 0, 0);">
data </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> cursor</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">fetchone</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Database version : %s &quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> data

</span><span style="color:rgb(136, 0, 0);"># 关闭数据库连接</span><span style="color:rgb(0, 0, 0);">
db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">close</span><span style="color:rgb(102, 102, 0);">()</span></pre> 执行以上脚本输出结果如下： <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(102, 0, 102);">Database</span><span style="color:rgb(0, 0, 0);"> version </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">5.0</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 102, 102);">45</span></pre> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">创建数据库表</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">如果数据库连接存在我们可以使用execute()方法来为数据库创建表，如下所示创建表EMPLOYEE：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);"># encoding: utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 打开数据库连接</span><span style="color:rgb(0, 0, 0);">
db </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">connect</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;localhost&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;testuser&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;test123&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;TESTDB&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 使用cursor()方法获取操作游标 </span><span style="color:rgb(0, 0, 0);">
cursor </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">cursor</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 如果数据表已经存在使用 execute() 方法删除表。</span><span style="color:rgb(0, 0, 0);">
cursor</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">execute</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;DROP TABLE IF EXISTS EMPLOYEE&quot;</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 创建数据表SQL语句</span><span style="color:rgb(0, 0, 0);">
sql </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;&quot;&quot;CREATE TABLE EMPLOYEE (
         FIRST_NAME  CHAR(20) NOT NULL,
         LAST_NAME  CHAR(20),
         AGE INT,  
         SEX CHAR(1),
         INCOME FLOAT )&quot;&quot;&quot;</span><span style="color:rgb(0, 0, 0);">

cursor</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">execute</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">sql</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 关闭数据库连接</span><span style="color:rgb(0, 0, 0);">
db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">close</span><span style="color:rgb(102, 102, 0);">()</span></pre> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">数据库插入操作</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">以下实例使用执行 SQL INSERT 语句向表 EMPLOYEE 插入记录：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);"># encoding: utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 打开数据库连接</span><span style="color:rgb(0, 0, 0);">
db </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">connect</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;localhost&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;testuser&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;test123&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;TESTDB&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 使用cursor()方法获取操作游标 </span><span style="color:rgb(0, 0, 0);">
cursor </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">cursor</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># SQL 插入语句</span><span style="color:rgb(0, 0, 0);">
sql </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;&quot;&quot;INSERT INTO EMPLOYEE(FIRST_NAME,
         LAST_NAME, AGE, SEX, INCOME)
         VALUES ('Mac', 'Mohan', 20, 'M', 2000)&quot;&quot;&quot;</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">try</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 执行sql语句</span><span style="color:rgb(0, 0, 0);">
   cursor</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">execute</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">sql</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 提交到数据库执行</span><span style="color:rgb(0, 0, 0);">
   db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">commit</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">except</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># Rollback in case there is any error</span><span style="color:rgb(0, 0, 0);">
   db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">rollback</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 关闭数据库连接</span><span style="color:rgb(0, 0, 0);">
db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">close</span><span style="color:rgb(102, 102, 0);">()</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">以上例子也可以写成如下形式：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);"># encoding: utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 打开数据库连接</span><span style="color:rgb(0, 0, 0);">
db </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">connect</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;localhost&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;testuser&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;test123&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;TESTDB&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 使用cursor()方法获取操作游标 </span><span style="color:rgb(0, 0, 0);">
cursor </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">cursor</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># SQL 插入语句</span><span style="color:rgb(0, 0, 0);">
sql </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;INSERT INTO EMPLOYEE(FIRST_NAME, \
       LAST_NAME, AGE, SEX, INCOME) \
       VALUES ('%s', '%s', '%d', '%c', '%d' )&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> \
       </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">'Mac'</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">'Mohan'</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">20</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">'M'</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 102, 102);">2000</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">try</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 执行sql语句</span><span style="color:rgb(0, 0, 0);">
   cursor</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">execute</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">sql</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 提交到数据库执行</span><span style="color:rgb(0, 0, 0);">
   db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">commit</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">except</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 发生错误时回滚</span><span style="color:rgb(0, 0, 0);">
   db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">rollback</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 关闭数据库连接</span><span style="color:rgb(0, 0, 0);">
db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">close</span><span style="color:rgb(102, 102, 0);">()</span></pre> <h3 style="font-size:120%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">实例：</h3> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">以下代码使用变量向SQL语句中传递参数:</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(102, 102, 0);">..................................</span><span style="color:rgb(0, 0, 0);">
user_id </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;test123&quot;</span><span style="color:rgb(0, 0, 0);">
password </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;password&quot;</span><span style="color:rgb(0, 0, 0);">

con</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">execute</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">'insert into Login values(&quot;%s&quot;, &quot;%s&quot;)'</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> \
             </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">user_id</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> password</span><span style="color:rgb(102, 102, 0);">))</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 102, 0);">..................................</span></pre> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">数据库查询操作</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">Python查询Mysql使用 fetchone() 方法获取单条数据, 使用fetchall() 方法获取多条数据。</p> <ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;"><b>fetchone():</b> 该方法获取下一个查询结果集。结果集是一个对象</li> <li style="padding:2px 0px;"><b>fetchall():</b>接收全部的返回结果行.</li> <li style="padding:2px 0px;"><b>rowcount:</b> 这是一个只读属性，并返回执行execute()方法后影响的行数。</li> </ul> <h3 style="font-size:120%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">实例：</h3> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">查询EMPLOYEE表中salary（工资）字段大于1000的所有数据：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);"># encoding: utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 打开数据库连接</span><span style="color:rgb(0, 0, 0);">
db </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">connect</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;localhost&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;testuser&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;test123&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;TESTDB&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 使用cursor()方法获取操作游标 </span><span style="color:rgb(0, 0, 0);">
cursor </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">cursor</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># SQL 查询语句</span><span style="color:rgb(0, 0, 0);">
sql </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;SELECT * FROM EMPLOYEE \
       WHERE INCOME &gt; '%d'&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 102, 102);">1000</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">try</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 执行SQL语句</span><span style="color:rgb(0, 0, 0);">
   cursor</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">execute</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">sql</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 获取所有记录列表</span><span style="color:rgb(0, 0, 0);">
   results </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> cursor</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">fetchall</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(0, 0, 136);">for</span><span style="color:rgb(0, 0, 0);"> row </span><span style="color:rgb(0, 0, 136);">in</span><span style="color:rgb(0, 0, 0);"> results</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
      fname </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> row</span><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 102, 102);">0</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);">
      lname </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> row</span><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 102, 102);">1</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);">
      age </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> row</span><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 102, 102);">2</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);">
      sex </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> row</span><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 102, 102);">3</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);">
      income </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> row</span><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 102, 102);">4</span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);">
      </span><span style="color:rgb(136, 0, 0);"># 打印结果</span><span style="color:rgb(0, 0, 0);">
      </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;fname=%s,lname=%s,age=%d,sex=%s,income=%d&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> \
             </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">fname</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> lname</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> age</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> sex</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> income </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">except</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(0, 0, 136);">print</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;Error: unable to fecth data&quot;</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 关闭数据库连接</span><span style="color:rgb(0, 0, 0);">
db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">close</span><span style="color:rgb(102, 102, 0);">()</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">以上脚本执行结果如下：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(0, 0, 0);">fname</span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(102, 0, 102);">Mac</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> lname</span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(102, 0, 102);">Mohan</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> age</span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 102, 102);">20</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> sex</span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);">M</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> income</span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 102, 102);">2000</span></pre> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/> <h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">数据库更新操作</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">更新操作用于更新数据表的的数据，以下实例将 TESTDB表中的 SEX 字段全部修改为 'M'，AGE 字段递增1：</p> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);"># encoding: utf-8</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(136, 0, 0);">#!/usr/bin/python</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(0, 0, 136);">import</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 打开数据库连接</span><span style="color:rgb(0, 0, 0);">
db </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">MySQLdb</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">connect</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;localhost&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;testuser&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;test123&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 136, 0);">&quot;TESTDB&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 使用cursor()方法获取操作游标 </span><span style="color:rgb(0, 0, 0);">
cursor </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">cursor</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># SQL 更新语句</span><span style="color:rgb(0, 0, 0);">
sql </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;UPDATE EMPLOYEE SET AGE = AGE + 1
                          WHERE SEX = '%c'&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">'M'</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">try</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 执行SQL语句</span><span style="color:rgb(0, 0, 0);">
   cursor</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">execute</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">sql</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 提交到数据库执行</span><span style="color:rgb(0, 0, 0);">
   db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">commit</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">except</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 发生错误时回滚</span><span style="color:rgb(0, 0, 0);">
   db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">rollback</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">

</span><span style="color:rgb(136, 0, 0);"># 关闭数据库连接</span><span style="color:rgb(0, 0, 0);">
db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">close</span><span style="color:rgb(102, 102, 0);">()</span></pre> <h3 style="font-size:120%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">执行事务</h3> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">事务机制可以确保数据一致性。</p> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">事务应该具有4个属性：原子性、一致性、隔离性、持久性。这四个属性通常称为ACID特性。</p> <ul style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;"> <li style="padding:2px 0px;">原子性（atomicity）。一个事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做。</li><li style="padding:2px 0px;"> 一致性（consistency）。事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。</li><li style="padding:2px 0px;"> 隔离性（isolation）。一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</li><li style="padding:2px 0px;"> 持久性（durability）。持续性也称永久性（permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。 </li></ul> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">Python DB API 2.0 的事务提供了两个方法 commit 或 rollback。</p> <h3 style="font-size:120%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">实例：</h3> <pre style="font-family:'courier new';margin:15px auto;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:20px;font-style:normal;word-break:break-all;word-wrap:break-word;border-width:1px 1px 1px 4px;border-style:solid;border-color:rgb(221, 221, 221);background:url(http://www.runoob.com/images/codecolorer_bg.gif) 50% 0% rgb(251, 251, 251);padding:10px 15px;"><span style="color:rgb(136, 0, 0);"># SQL删除记录语句</span><span style="color:rgb(0, 0, 0);">
sql </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;DELETE FROM EMPLOYEE WHERE AGE &gt; '%d'&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">%</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 102, 102);">20</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">try</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 执行SQL语句</span><span style="color:rgb(0, 0, 0);">
   cursor</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">execute</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">sql</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 向数据库提交</span><span style="color:rgb(0, 0, 0);">
   db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">commit</span><span style="color:rgb(102, 102, 0);">()</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(0, 0, 136);">except</span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
   </span><span style="color:rgb(136, 0, 0);"># 发生错误时回滚</span><span style="color:rgb(0, 0, 0);">
   db</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">rollback</span><span style="color:rgb(102, 102, 0);">()</span></pre> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">对于支持事务的数据库， 在Python数据库编程中，当游标建立之时，就自动开始了一个隐形的数据库事务。 </p><p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">commit()方法游标的所有更新操作，rollback（）方法回滚当前游标的所有操作。每一个方法都开始了一个新的事务。</p> <hr style="color:rgb(212, 212, 212);height:1px;border:0px;clear:both;background-color:rgb(212, 212, 212);"/><h2 style="font-size:180%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;margin-top:10px;margin-bottom:10px;font-weight:bold;color:rgb(0, 0, 0);background-color:transparent;">错误处理</h2> <p style="line-height:140%;font-size:12px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;">DB API中定义了一些数据库操作的错误及异常，下表列出了这些错误和异常:</p> <table style="font-weight:inherit;font-style:inherit;font-variant:inherit;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border-collapse:collapse;width:100%;"> <tbody><tr style="background-color:rgb(246, 244, 240);"> <th style="font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:12px;color:rgb(255, 255, 255);border:1px solid rgb(85, 85, 85);padding:3px;vertical-align:top;text-align:left;background-color:rgb(85, 85, 85);width:15%;">异常</th><th style="font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:12px;color:rgb(255, 255, 255);border:1px solid rgb(85, 85, 85);padding:3px;vertical-align:top;text-align:left;background-color:rgb(85, 85, 85);">描述</th> </tr> <tr style="background-color:rgb(255, 255, 255);"><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">Warning</td><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">当有严重警告时触发，例如插入数据是被截断等等。必须是 StandardError 的子类。</td></tr> <tr style="background-color:rgb(246, 244, 240);"><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">Error</td><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">警告以外所有其他错误类。必须是 StandardError 的子类。</td></tr> <tr style="background-color:rgb(255, 255, 255);"><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">InterfaceError</td><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">当有数据库接口模块本身的错误（而不是数据库的错误）发生时触发。 必须是Error的子类。</td></tr> <tr style="background-color:rgb(246, 244, 240);"><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">DatabaseError</td><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">和数据库有关的错误发生时触发。 必须是Error的子类。</td></tr> <tr style="background-color:rgb(255, 255, 255);"><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">DataError</td><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">当有数据处理时的错误发生时触发，例如：除零错误，数据超范围等等。 必须是DatabaseError的子类。</td></tr> <tr style="background-color:rgb(246, 244, 240);"><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">OperationalError</td><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">指非用户控制的，而是操作数据库时发生的错误。例如：连接意外断开、 数据库名未找到、事务处理失败、内存分配错误等等操作数据库是发生的错误。 必须是DatabaseError的子类。</td></tr> <tr style="background-color:rgb(255, 255, 255);"><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">IntegrityError</td><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">完整性相关的错误，例如外键检查失败等。必须是DatabaseError子类。</td></tr> <tr style="background-color:rgb(246, 244, 240);"><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">InternalError</td><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;"> 数据库的内部错误，例如游标（cursor）失效了、事务同步失败等等。 必须是DatabaseError子类。</td></tr> <tr style="background-color:rgb(255, 255, 255);"><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">ProgrammingError</td><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">程序错误，例如数据表（table）没找到或已存在、SQL语句语法错误、 参数数量错误等等。必须是DatabaseError的子类。</td></tr> <tr style="background-color:rgb(246, 244, 240);"><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">NotSupportedError</td><td style="line-height:140%;font-size:100%;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;border:1px solid rgb(212, 212, 212);padding:7px 5px;vertical-align:top;">不支持错误，指使用了数据库不支持的函数或API等。例如在连接对象上 使用.rollback()函数，然而数据库并不支持事务或者事务已关闭。 必须是DatabaseError的子类。</td></tr> </tbody></table> </div></div></div></div></div></div></div><br/></span>
</div></body></html> 