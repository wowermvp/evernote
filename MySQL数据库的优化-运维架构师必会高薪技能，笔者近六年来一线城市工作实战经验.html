<html>
<head>
  <title>MySQL数据库的优化-运维架构师必会高薪技能，笔者近六年来一线城市工作实战经验</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1342"/>
<h1>MySQL数据库的优化-运维架构师必会高薪技能，笔者近六年来一线城市工作实战经验</h1>

<div>
<span><br/><div style="overflow:hidden;"><div style="background:rgb(255, 255, 255);margin-top:5px;"><div style="margin:0 0 10px;"><div style="font-size:14px;word-wrap:break-word;word-break:normal;"><h1 style="padding:0px;margin:0px;text-indent:13px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;text-indent:7px;font-size:16px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">首先在此感谢下我的老师</span><span style="padding:0px;margin:0px;color:#FF0000;">-</span></strong><strong style="padding:0px;margin:0px;text-indent:7px;font-size:16px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">老男孩专家拥有</span><span style="padding:0px;margin:0px;color:#FF0000;">16</span></strong><strong style="padding:0px;margin:0px;text-indent:7px;font-size:16px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">年一线实战经验，我当然不能和我的老师平起平坐，得到老师三分之一的真传</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span></strong><strong style="padding:0px;margin:0px;text-indent:7px;font-size:16px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">所以只有</span><span style="padding:0px;margin:0px;color:#FF0000;">6</span></strong><strong style="padding:0px;margin:0px;text-indent:7px;font-size:16px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">年</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span></strong><strong style="padding:0px;margin:0px;text-indent:7px;font-size:16px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">嘿</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span></strong><strong style="padding:0px;margin:0px;text-indent:7px;font-size:16px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">废话不多说，下面开启</span><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;text-indent:7px;font-size:16px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">优化之旅！</span></strong></span></span></h1><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">我们究竟应该如何对</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">数据库进行优化？下面我就从</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">对硬件的选择、</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">的安装、</span>my.cnf<span style="padding:0px;margin:0px;font-family:'宋体';">的优化、</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">如何进行架构设计及数据切分等方面来说明这个问题。</span></span></span></p><h2 style="padding:0px;margin:0px;text-indent:12px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">服务器物理硬件的优化</span></span></span></h2><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">在挑选硬件服务器时，我们应该从下面几个方面着重对</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">服务器的硬件配置进行优化，也就是说将项目中的资金着重投入到如下几处：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">1<span style="padding:0px;margin:0px;font-family:'宋体';">、<span style="padding:0px;margin:0px;color:#FF0000;">磁盘寻道能力</span>（磁盘</span>I/O<span style="padding:0px;margin:0px;font-family:'宋体';">），我们现在用的都是</span>SAS15000<span style="padding:0px;margin:0px;font-family:'宋体';">转的硬盘，用</span>6<span style="padding:0px;margin:0px;font-family:'宋体';">快这样的硬盘作</span>RAID1+0<span style="padding:0px;margin:0px;font-family:'宋体';">。</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">每一秒钟都在进行大量、复杂的查询操作，对磁盘的读写量可想而知，所以，通常认为磁盘</span>I/O<span style="padding:0px;margin:0px;font-family:'宋体';">是约制</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">性能的最大因素之一。对于日均访问量在</span>100<span style="padding:0px;margin:0px;font-family:'宋体';">万</span>PV<span style="padding:0px;margin:0px;font-family:'宋体';">以上的论坛（</span>Discuz<span style="padding:0px;margin:0px;font-family:'宋体';">）、博客（</span>Wordpress<span style="padding:0px;margin:0px;font-family:'宋体';">），如果性能不好，造成的直接后果就是</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">的性能会非常低下！解决这一制约因素可以考虑解决访问是：使用</span>RAID1+0<span style="padding:0px;margin:0px;font-family:'宋体';">磁盘阵列，注意不要尝试</span>RAID5<span style="padding:0px;margin:0px;font-family:'宋体';">，</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">在</span>PAID5<span style="padding:0px;margin:0px;font-family:'宋体';">磁盘阵列上的效率不会像你期待的那样快，如果资金允许，<span style="padding:0px;margin:0px;color:#FF0000;">可以选择固态硬盘</span></span></span><span style="padding:0px;margin:0px;color:#FF0000;">SSD</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">来替代</span><span style="padding:0px;margin:0px;color:#FF0000;">SAS</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">硬盘做</span><span style="padding:0px;margin:0px;color:#FF0000;">RAID1+0</span><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">。</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">2<span style="padding:0px;margin:0px;font-family:'宋体';">、</span></span><span style="padding:0px;margin:0px;color:#FF0000;">CPU</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">对于</span><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">的影响也是不容忽视的，建议选择运算能力强悍的</span><span style="padding:0px;margin:0px;color:#FF0000;">CPU</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">推荐使用</span>DELL R710<span style="padding:0px;margin:0px;font-family:'宋体';">（双四核），商家的卖点也是其强大的虚拟化和数据库能力。</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">3<span style="padding:0px;margin:0px;font-family:'宋体';">、对于一台使用</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">的</span>Database Server<span style="padding:0px;margin:0px;font-family:'宋体';">来说，建议服务器的内存不要小于</span>2GB<span style="padding:0px;margin:0px;font-family:'宋体';">，推荐使用</span>4GB<span style="padding:0px;margin:0px;font-family:'宋体';">以上的物理内存，不过内存对于现在的服务器而言可以说是一个可以忽略的问题，如果是高端服务器，基本上内存都超过了</span>32GB<span style="padding:0px;margin:0px;font-family:'宋体';">，我们的数据流服务器都是</span>32GB<span style="padding:0px;margin:0px;font-family:'宋体';">内存。</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">我在工作中用的比较多的数据库服务器是</span>DELL R710/R720<span style="padding:0px;margin:0px;font-family:'宋体';">，其稳定性和性能都不错，同时我也发现许多同行都是采用它作为数据库的服务器，所以在这里也向大家推荐一下。</span></span></span></p><h2 style="padding:0px;margin:0px;text-indent:12px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">应采用编译方式安装</span></span></span></h2><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">关于</span><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">数据库的线上环境安装，我建议采取编译安装的方式，这样性能会有较大的提升。</span><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">服务器系统则建议</span>CentOS6.7 X86_64<span style="padding:0px;margin:0px;font-family:'宋体';">，源码包的编译参数会默认以</span>Debug<span style="padding:0px;margin:0px;font-family:'宋体';">模式生成二进制代码，而</span>Debug<span style="padding:0px;margin:0px;font-family:'宋体';">模式给</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">带来的性能损失是比较大的，所以当我们编译准备安装的产品代码时，一定不要忘记使用</span>--without-debug<span style="padding:0px;margin:0px;font-family:'宋体';">参数禁止</span>Debug<span style="padding:0px;margin:0px;font-family:'宋体';">模式。如果把</span>--with-mysqld-ldflags<span style="padding:0px;margin:0px;font-family:'宋体';">和</span>--with-client-ld-flags<span style="padding:0px;margin:0px;font-family:'宋体';">两个编译参数设置为</span>--all-static<span style="padding:0px;margin:0px;font-family:'宋体';">的话，可以告诉编译器以静态的方式编译，编译结果将得到最高的性能。使用静态编译和使用动态编译的代码相比，性能差距可能会达到</span>5%<span style="padding:0px;margin:0px;font-family:'宋体';">至</span>10%<span style="padding:0px;margin:0px;font-family:'宋体';">之多。在后面我会跟大家分享我们线上</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">数据库的编译参数，大家可以参考下，然后根据自己的线上环境自行修改内容。</span></span></span></p><h2 style="padding:0px;margin:0px;text-indent:12px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">配置文件优化</span></span></span></h2><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">[client]</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">port   = 3306 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">客户端端口号为</span><span style="padding:0px;margin:0px;color:#0432FF;">3306</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">socket  =/data/3306/mysql.sock #</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">default-character-set = utf8 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">客户端字符集</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;color:#FF0000;">(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">控制</span><span style="padding:0px;margin:0px;color:#FF0000;">character_set_client</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">、</span><span style="padding:0px;margin:0px;color:#FF0000;">character_set_connection</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">、</span><span style="padding:0px;margin:0px;color:#FF0000;">character_set_results)</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">[mysql]</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">no-auto-rehash </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">仅仅允许使用键值的</span><span style="padding:0px;margin:0px;color:#0432FF;">updates</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">和</span><span style="padding:0px;margin:0px;color:#0432FF;">deletes</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">[mysqld] </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">组包括了</span><span style="padding:0px;margin:0px;color:#0432FF;">mysqld</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">服务启动的参数，它涉及的方面很多，其中有</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的目录和文件，通信、网络、信息安全，内存管理、优化、查询缓存区，还有</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">日志设置等。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">user    = mysql </span> <span style="padding:0px;margin:0px;color:#0432FF;">#mysql_safe</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">脚本使用</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">运行用户</span><span style="padding:0px;margin:0px;color:#0432FF;">(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">编译时</span><span style="padding:0px;margin:0px;color:#0432FF;">--user=mysql</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">指定</span><span style="padding:0px;margin:0px;color:#0432FF;">),</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">推荐使用</span><span style="padding:0px;margin:0px;color:#FF0000;">mysql</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">用户。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">port    = 3306 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">服务运行时的端口号。</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">建议更改默认端口</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">默认容易遭受攻击。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">socket  =/data/3306/mysql.sock </span> <span style="padding:0px;margin:0px;color:#0432FF;">#socket</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">文件是在</span><span style="padding:0px;margin:0px;color:#0432FF;">Linux/Unix</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">环境下特有的，用户在</span><span style="padding:0px;margin:0px;color:#0432FF;">Linux/Unix</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">环境下客户端连接可以不通过</span><span style="padding:0px;margin:0px;color:#0432FF;">TCP/IP</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">网络而直接使用</span><span style="padding:0px;margin:0px;color:#0432FF;">unix socket</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">连接</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">basedir = /application/mysql </span> <span style="padding:0px;margin:0px;color:#0432FF;">#mysql</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">程序所存放路径</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">常用于存放</span><span style="padding:0px;margin:0px;color:#0432FF;">mysql</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">启动、配置文件、日志等</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">datadir = /data/3306/data </span> <span style="padding:0px;margin:0px;color:#0432FF;">#MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">数据存放文件</span><span style="padding:0px;margin:0px;color:#FF0000;">(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">极其重要</span><span style="padding:0px;margin:0px;color:#FF0000;">)</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">character-set-server = utf8 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">数据库和数据库表的默认字符集。</span><span style="padding:0px;margin:0px;color:#FF0000;">(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">推荐</span><span style="padding:0px;margin:0px;color:#FF0000;">utf8,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">以免导致乱码</span><span style="padding:0px;margin:0px;color:#FF0000;">)</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">log-error=/data/3306/mysql_xuliangwei.err</span> <span style="padding:0px;margin:0px;color:#0432FF;"> #mysql</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">错误日志存放路径及名称</span><span style="padding:0px;margin:0px;color:#FF0000;">(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">启动出现错误一定要看错误日志</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">百分之百都能通过错误日志排插解决。</span><span style="padding:0px;margin:0px;color:#FF0000;">)</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">pid-file=/data/3306/mysql_xuliangwei.pid </span> <span style="padding:0px;margin:0px;color:#0432FF;">#MySQL_pid</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">文件记录的是当前</span><span style="padding:0px;margin:0px;color:#0432FF;">mysqld</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">进程的</span><span style="padding:0px;margin:0px;color:#0432FF;">pid</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，</span><span style="padding:0px;margin:0px;color:#0432FF;">pid</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">亦即</span><span style="padding:0px;margin:0px;color:#0432FF;">ProcessID</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">skip-locking</span> <span style="padding:0px;margin:0px;color:#0432FF;"> #</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">避免</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的外部锁定，减少出错几率，增强稳定性。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">skip-name-resolv</span> <span style="padding:0px;margin:0px;color:#0432FF;"> #</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">禁止</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">对外部连接进行</span><span style="padding:0px;margin:0px;color:#0432FF;">DNS</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">解析，使用这一选项可以消除</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">进行</span><span style="padding:0px;margin:0px;color:#0432FF;">DNS</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">解析的时候。但是需要注意的是，如果开启该选项，则所有远程主机连接授权都要使用</span><span style="padding:0px;margin:0px;color:#0432FF;">IP</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">地址方式了，否则</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">将无法正常处理连接请求！</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">skip-networking </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">开启该选项可以彻底关闭</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的</span><span style="padding:0px;margin:0px;color:#0432FF;">TCP/IP</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">连接方式，如果</span><span style="padding:0px;margin:0px;color:#0432FF;">Web</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">服务器是以远程连接的方式访问</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">数据库服务器的，则不要开启该选项，否则无法正常连接！</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">open_files_limit    = 1024 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#MySQLd</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">能打开文件的最大个数</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">如果出现</span><span style="padding:0px;margin:0px;color:#FF0000;">too many open files</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">之类的就需要调整该值了。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">back_log = 384 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#back_log</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">参数是值指出在</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">暂时停止响应新请求之前，短时间内的多少个请求可以被存在堆栈中。如果系统在短时间内有很多连接，则需要增加该参数的值，该参数值指定到来的</span><span style="padding:0px;margin:0px;color:#0432FF;">TCP/IP</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">连接的监听队列的大小。不同的操作系统在这个队列的大小上有自己的限制。如果试图将</span><span style="padding:0px;margin:0px;color:#0432FF;">back_log</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置得高于操作系统的限制将是无效的，其默认值为</span><span style="padding:0px;margin:0px;color:#0432FF;">50.</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">对于</span><span style="padding:0px;margin:0px;color:#0432FF;">Linux</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">系统而言，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">推荐设置为小于</span><span style="padding:0px;margin:0px;color:#FF0000;">512</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">的整数。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_connections = 800</span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">指定</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">允许的最大连接进程数。</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">如果在访问博客时经常出现</span> <span style="padding:0px;margin:0px;color:#FF0000;">Too Many Connections</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">的错误提示</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，则需要增大该参数值。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_connect_errors = 6000  </span><span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置每个主机的连接请求异常中断的最大次数，当超过该次数，</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">服务器将禁止</span><span style="padding:0px;margin:0px;color:#0432FF;">host</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的连接请求，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">直到</span><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">服务器重启或通过</span><span style="padding:0px;margin:0px;color:#FF0000;">flush hosts</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">命令清空此</span><span style="padding:0px;margin:0px;color:#FF0000;">host</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">的相关信息。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">wait_timeout = 120  </span><span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">指定一个请求的最大连接时间，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">对于</span><span style="padding:0px;margin:0px;color:#FF0000;">4GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">左右内存的服务器来说，可以将其设置为</span><span style="padding:0px;margin:0px;color:#FF0000;">5~10</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">table_open_cache = 614K </span> <span style="padding:0px;margin:0px;color:#0432FF;">#table_cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">指示表高速缓冲区的大小。当</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">访问一个表时，如果在</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">缓冲区还有空间，那么这个表就被打开并放入表缓冲区，这样做的好处是可以更快速地访问表中的内容。一般来说，可以查看数据库运行峰值时间的状态值</span><span style="padding:0px;margin:0px;color:#0432FF;">Open_tables</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">和</span><span style="padding:0px;margin:0px;color:#0432FF;">Opened_tables</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，用以判断是否需要增加</span><span style="padding:0px;margin:0px;color:#0432FF;">table_open_cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的值，即如果</span><span style="padding:0px;margin:0px;color:#0432FF;">Open_tables</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">接近</span><span style="padding:0px;margin:0px;color:#0432FF;">table_open_cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的时候，并且</span><span style="padding:0px;margin:0px;color:#0432FF;">Opened_tables</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">这个值在逐步增加，那就要考虑增加这个值的大小了。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">external-locking = FALSE</span> <span style="padding:0px;margin:0px;color:#0432FF;"> #MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">选项可以避免外部锁定。</span><span style="padding:0px;margin:0px;color:#FF0000;">True</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">为开启。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_allowed_packet =16M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">服务器一次能处理最大的查询包的值，也是服务器程序能够处理的最大查询</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">sort_buffer_size = 1M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置查询排序时所能使用的缓冲区大小，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">系统默认大小为</span><span style="padding:0px;margin:0px;color:#FF0000;">2MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">注意：该参数对应的分配内存是每个连接独占的，如果有</span><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;">100</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">个连接，那么实际分配的总排序缓冲区大小为</span><span style="padding:0px;margin:0px;color:#0432FF;">100 x6=600MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">。所以，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">对于内存在</span><span style="padding:0px;margin:0px;color:#FF0000;">4GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">左右的服务器来说，推荐将其设置为</span><span style="padding:0px;margin:0px;color:#FF0000;">6MB~8MB</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">join_buffer_size = 8M</span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">联合查询操作所能使用的缓冲区大小，和</span><span style="padding:0px;margin:0px;color:#0432FF;">sort_buffer_size</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">一样，该参数对应的分配内存也是每个连接独享。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">thread_cache_size = 64</span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置</span><span style="padding:0px;margin:0px;color:#0432FF;">Thread Cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">池中可以缓存的连接线程最大数量，可设置为</span><span style="padding:0px;margin:0px;color:#0432FF;">0~16384</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，默认为</span><span style="padding:0px;margin:0px;color:#0432FF;">0.</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">这个值表示可以重新利用保存在缓存中线程的数量，当断开连接时如果缓存中还有空间，那么客户端的线程将被放到缓存中</span><span style="padding:0px;margin:0px;color:#0432FF;">;</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">如果线程重新被请求，那么请求将从缓存中读取</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">如果缓存中是空的或者是新的请求，那么这个线程将被重新创建，如果有很多线程，增加这个值可以改善系统性能。通过比较</span><span style="padding:0px;margin:0px;color:#0432FF;">Connections</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">和</span><span style="padding:0px;margin:0px;color:#0432FF;">Threads_created</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">状态的变量，可以看到这个变量的作用。我们可以根据物理内存设置规则如下</span><span style="padding:0px;margin:0px;color:#0432FF;">:</span><span style="padding:0px;margin:0px;color:#FF0000;">1GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">内存我们配置为</span><span style="padding:0px;margin:0px;color:#FF0000;">8,2GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">内存我们配置为</span><span style="padding:0px;margin:0px;color:#FF0000;">16,3GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">我们配置为</span><span style="padding:0px;margin:0px;color:#FF0000;">32,4GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">或</span><span style="padding:0px;margin:0px;color:#FF0000;">4GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">以上我们给此值为</span><span style="padding:0px;margin:0px;color:#FF0000;">64</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">或更大的值。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">thread_concurrency = 8 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">该参数取值为服务器逻辑</span><span style="padding:0px;margin:0px;color:#0432FF;">CPU</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">数量</span><span style="padding:0px;margin:0px;color:#0432FF;">x 2</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，在本例中，服务器有两个物理</span><span style="padding:0px;margin:0px;color:#0432FF;">CPU</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，而每个物理</span><span style="padding:0px;margin:0px;color:#0432FF;">CPU</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">又支持</span><span style="padding:0px;margin:0px;color:#0432FF;">H.T</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">超线程，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">所以实际取值为</span><span style="padding:0px;margin:0px;color:#FF0000;">4 x 2 = 8</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。这也是双四核主流服务器的配置。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_size = 64M</span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">指定</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">查询缓冲区的大小。可以通过在</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">控制台观察，如果</span><span style="padding:0px;margin:0px;color:#0432FF;">Qcache_lowmem_prunes</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的值非常大，则表明经常出现缓冲不够的情况</span><span style="padding:0px;margin:0px;color:#0432FF;">;</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">如果</span><span style="padding:0px;margin:0px;color:#0432FF;">Qcache_hits</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的值非常大，则表明查询缓冲使用得非常频繁。另外如果改值较小反而会影响效率，那么可以考虑不用查询缓冲。对于</span><span style="padding:0px;margin:0px;color:#0432FF;">Qcache_free_blocks</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，如果该值非常大，则表明缓冲区中碎片很多。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_limit = 2M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">只有小于此设置值的结果才会被缓存</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_min_res_unit = 2k</span> <span style="padding:0px;margin:0px;color:#0432FF;"> #</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置查询缓存分配内存的最小单位，要适当第设置此参数，可以做到为减少内存快的申请和分配次数，但是设置过大可能导致内存碎片数值上升。默认值为</span><span style="padding:0px;margin:0px;color:#0432FF;">4K</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">建议设置为</span><span style="padding:0px;margin:0px;color:#FF0000;">1K~16K</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">default_table_type = InnoDB </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">默认表的类型为</span><span style="padding:0px;margin:0px;color:#0432FF;">InnoDB</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">thread_stack = 256K </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">每个线程的堆栈大小，默认值足够大，可满足普通操作。</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">可设置范围为</span><span style="padding:0px;margin:0px;color:#FF0000;">128KB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">至</span><span style="padding:0px;margin:0px;color:#FF0000;">4GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，默认为</span><span style="padding:0px;margin:0px;color:#FF0000;">192KB</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">#transaction_isolation = Level</span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">数据库隔离级别</span> <span style="padding:0px;margin:0px;color:#FF0000;">(READ UNCOMMITTED(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">读取未提交内容</span><span style="padding:0px;margin:0px;color:#FF0000;">) READ COMMITTED(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">读取提交内容</span><span style="padding:0px;margin:0px;color:#FF0000;">) REPEATABLE READ(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">可重读</span><span style="padding:0px;margin:0px;color:#FF0000;">) SERIALIZABLE(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">可串行化</span><span style="padding:0px;margin:0px;color:#FF0000;">))</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">tmp_table_size = 64M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置内存临时表最大值。如果超过该值，则会将临时表写入磁盘，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">其范围</span><span style="padding:0px;margin:0px;color:#FF0000;">1KB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">到</span><span style="padding:0px;margin:0px;color:#FF0000;">4GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_heap_table_size = 64M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">独立的内存表所允许的最大容量。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">table_cache = 614</span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">给经常访问的表分配的内存，物理内存越大，设置就越大。调大这个值，一般情况下可以降低磁盘</span><span style="padding:0px;margin:0px;color:#0432FF;">IO</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，但相应的会占用更多的内存</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">这里设置为</span><span style="padding:0px;margin:0px;color:#FF0000;">614</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">table_open_cache = 512</span> <span style="padding:0px;margin:0px;color:#0432FF;"> #</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置表高速缓存的数目。每个连接进来，都会至少打开一个表缓存。因此，</span> <span style="padding:0px;margin:0px;color:#0432FF;">table_cache</span> <span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的大小应与</span> <span style="padding:0px;margin:0px;color:#0432FF;">max_connections</span> <span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的设置有关。例如，对于</span><span style="padding:0px;margin:0px;color:#0432FF;">200</span> <span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">个并行运行的连接，应该让表的缓存至少有</span> <span style="padding:0px;margin:0px;color:#0432FF;">200</span> <span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">×</span> <span style="padding:0px;margin:0px;color:#0432FF;">N</span> <span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，这里</span> <span style="padding:0px;margin:0px;color:#0432FF;">N</span> <span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">是应用可以执行的查询的一个联接中表的最大数量。此外，还需要为临时表和文件保留一些额外的文件描述符。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">long_query_time = 1 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">慢查询的执行用时上限</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">默认设置是</span><span style="padding:0px;margin:0px;color:#0432FF;">10s,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">推荐</span><span style="padding:0px;margin:0px;color:#FF0000;">(1s~2s)</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">log_long_format </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">没有使用索引的查询也会被记录。</span><span style="padding:0px;margin:0px;color:#FF0000;">(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">推荐</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">根据业务来调整</span><span style="padding:0px;margin:0px;color:#FF0000;">)</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">log-slow-queries = /data/3306/slow.log </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">慢查询日志文件路径</span><span style="padding:0px;margin:0px;color:#FF0000;">(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">如果开启慢查询</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">建议打开此日志</span><span style="padding:0px;margin:0px;color:#FF0000;">)</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">log-bin = /data/3306/mysql-bin </span><span style="padding:0px;margin:0px;color:#0432FF;">#logbin</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">数据库的操作日志</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">例如</span><span style="padding:0px;margin:0px;color:#0432FF;">update</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">、</span><span style="padding:0px;margin:0px;color:#0432FF;">delete</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">、</span><span style="padding:0px;margin:0px;color:#0432FF;">create</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">等都会存储到</span><span style="padding:0px;margin:0px;color:#0432FF;">binlog</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">日志</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">通过</span><span style="padding:0px;margin:0px;color:#0432FF;">logbin</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">可以实现增量恢复</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">relay-log = /data/3306/relay-bin </span><span style="padding:0px;margin:0px;color:#0432FF;">#relay-log</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">日志记录的是从服务器</span><span style="padding:0px;margin:0px;color:#0432FF;">I/O</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">线程将主服务器的二进制日志读取过来记录到从服务器本地文件</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">然后</span><span style="padding:0px;margin:0px;color:#0432FF;">SQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">线程会读取</span><span style="padding:0px;margin:0px;color:#0432FF;">relay-log</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">日志的内容并应用到从服务器</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">relay-log-info-file = /data/3306/relay-log.info </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">从服务器用于记录中继日志相关信息的文件</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">默认名为数据目录中的</span><span style="padding:0px;margin:0px;color:#0432FF;">relay-log.info</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">binlog_cache_size = 4M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">在一个事务中</span><span style="padding:0px;margin:0px;color:#0432FF;">binlog</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">为了记录</span><span style="padding:0px;margin:0px;color:#0432FF;">sql</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">状态所持有的</span><span style="padding:0px;margin:0px;color:#0432FF;">cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">大小，如果你经常使用大的，多声明的事务，可以增加此值来获取更大的性能，所有从事务来的状态都被缓冲在</span><span style="padding:0px;margin:0px;color:#0432FF;">binlog</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">缓冲中，然后再提交后一次性写入到</span><span style="padding:0px;margin:0px;color:#0432FF;">binlog</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">中，如果事务比此值大，会使用磁盘上的临时文件来替代，此缓冲在每个链接的事务第一次更新状态时被创建。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_binlog_cache_size = 8M</span> <span style="padding:0px;margin:0px;color:#0432FF;"> #</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">最大的二进制</span><span style="padding:0px;margin:0px;color:#0432FF;">Cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">日志缓冲尺寸。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_binlog_size = 1G</span> <span style="padding:0px;margin:0px;color:#0432FF;"> #</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">二进制日志文件的最大长度</span><span style="padding:0px;margin:0px;color:#0432FF;">(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">默认设置</span><span style="padding:0px;margin:0px;color:#0432FF;">1GB)</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">一个二进制文件信息超过了这个最大长度之前</span><span style="padding:0px;margin:0px;color:#0432FF;">,MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">服务器会自动提供一个新的二进制日志文件接续上。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">expire_logs_days = 7 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">超过</span><span style="padding:0px;margin:0px;color:#0432FF;">7</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">天的</span><span style="padding:0px;margin:0px;color:#0432FF;">binlog,mysql</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">程序自动删除</span><span style="padding:0px;margin:0px;color:#FF0000;">(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">如果数据重要</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">建议不要开启该选项</span><span style="padding:0px;margin:0px;color:#FF0000;">)</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">key_buffer_size = 256M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">指定用于索引的缓冲区大小，增加它可得到更好的索引处理性能。对于内存在</span><span style="padding:0px;margin:0px;color:#0432FF;">4GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">左右的服务器来说，该参数可设置为</span><span style="padding:0px;margin:0px;color:#0432FF;">256MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">或</span><span style="padding:0px;margin:0px;color:#0432FF;">384MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">注意：如果该参数值设置得过大反而会使服务器的整体效率降低！</span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">read_buffer_size = 4M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">读查询操作所能使用的缓冲区大小。和</span><span style="padding:0px;margin:0px;color:#0432FF;">sort_buffer_size</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">一样，该参数对应的分配内存也是每个连接独享。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">read_rnd_buffer_size = 16M</span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置进行随机读的时候所使用的缓冲区。此参数和</span><span style="padding:0px;margin:0px;color:#0432FF;">read_buffer_size</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">所设置的</span><span style="padding:0px;margin:0px;color:#0432FF;">Buffer</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">相反，一个是顺序读的时候使用，一个是随机读的时候使用。但是两者都是针对与线程的设置，每个线程都可以产生两种</span><span style="padding:0px;margin:0px;color:#0432FF;">Buffer</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">中的任何一个。</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">默认值</span><span style="padding:0px;margin:0px;color:#FF0000;">256KB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，最大值</span><span style="padding:0px;margin:0px;color:#FF0000;">4GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">bulk_insert_buffer_size = 8M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">如果经常性的需要使用批量插入的特殊语句来插入数据</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">可以适当调整参数至</span><span style="padding:0px;margin:0px;color:#FF0000;">16MB~32MB,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">建议</span><span style="padding:0px;margin:0px;color:#FF0000;">8MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">#myisam_sort_buffer_size = 8M</span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置在</span><span style="padding:0px;margin:0px;color:#0432FF;">REPAIR Table</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">或用</span><span style="padding:0px;margin:0px;color:#0432FF;">Create index</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">创建索引或</span> <span style="padding:0px;margin:0px;color:#0432FF;">Alter table</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的过程中排序索引所分配的缓冲区大小，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">可设置范围</span><span style="padding:0px;margin:0px;color:#FF0000;">4Bytes</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">至</span><span style="padding:0px;margin:0px;color:#FF0000;">4GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，默认为</span><span style="padding:0px;margin:0px;color:#FF0000;">8MB</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">lower_case_table_names = 1 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">实现</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">不区分大小。</span><span style="padding:0px;margin:0px;color:#FF0000;">(</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">发开需求</span><span style="padding:0px;margin:0px;color:#FF0000;">-</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">建议开启</span><span style="padding:0px;margin:0px;color:#FF0000;">)</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">slave-skip-errors = 1032,1062 </span><span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">从库可以跳过的错误数字值</span><span style="padding:0px;margin:0px;color:#FF0000;">(mysql</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">错误以数字代码反馈</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">全的</span><span style="padding:0px;margin:0px;color:#FF0000;">mysql</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">错误代码大全</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">以后会发布至博客</span><span style="padding:0px;margin:0px;color:#FF0000;">)</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">replicate-ignore-db=mysql </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">在做主从的情况下</span><span style="padding:0px;margin:0px;color:#0432FF;">,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置不需要同步的库。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">server-id = 1 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">表示本机的序列号为</span><span style="padding:0px;margin:0px;color:#0432FF;">1,</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">如果做主从，或者多实例</span><span style="padding:0px;margin:0px;color:#0432FF;">,serverid</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">一定不能相同。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">myisam_sort_buffer_size = 128M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">当需要对于执行</span><span style="padding:0px;margin:0px;color:#0432FF;">REPAIR, OPTIMIZE, ALTER </span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">语句重建索引时，</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">会分配这个缓存，以及</span><span style="padding:0px;margin:0px;color:#0432FF;">LOAD DATA INFILE</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">会加载到一个新表，它会根据最大的配置认真的分配的每个线程。</span><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">myisam_max_sort_file_size = 10G </span><span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">当重新建索引（</span><span style="padding:0px;margin:0px;color:#0432FF;">REPAIR</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，</span><span style="padding:0px;margin:0px;color:#0432FF;">ALTER</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，</span><span style="padding:0px;margin:0px;color:#0432FF;">TABLE</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，或者</span><span style="padding:0px;margin:0px;color:#0432FF;">LOAD</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，</span><span style="padding:0px;margin:0px;color:#0432FF;">DATA</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，</span><span style="padding:0px;margin:0px;color:#0432FF;">TNFILE</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">）时，</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">被允许使用临时文件的最大值。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">myisam_repair_threads = 1 </span><span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">如果一个表拥有超过一个索引</span><span style="padding:0px;margin:0px;color:#0432FF;">, MyISAM </span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">可以通过并行排序使用超过一个线程去修复他们</span><span style="padding:0px;margin:0px;color:#0432FF;">.</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">myisam_recover </span><span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">自动检查和修复没有适当关闭的</span><span style="padding:0px;margin:0px;color:#0432FF;"> MyISAM </span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">表</span><span style="padding:0px;margin:0px;color:#0432FF;">.</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_additional_mem_pool_size = 4M </span><span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">用来设置</span><span style="padding:0px;margin:0px;color:#0432FF;">InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">存储的数据目录信息和其他内部数据结构的内存池大小。应用程序里的表越多，你需要在这里面分配越多的内存。对于一个相对稳定的应用，这个参数的大小也是相对稳定的，也没有必要预留非常大的值。如果</span><span style="padding:0px;margin:0px;color:#0432FF;">InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">用广了这个池内的内存，</span><span style="padding:0px;margin:0px;color:#0432FF;">InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">开始从操作系统分配内存，并且往</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">错误日志写警告信息。</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">默认为</span><span style="padding:0px;margin:0px;color:#FF0000;">1MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，当发现错误日志中已经有相关的警告信息时，就应该适当的增加该参数的大小。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_buffer_pool_size = 64M </span><span style="padding:0px;margin:0px;color:#0432FF;">#InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">使用一个缓冲池来保存索引和原始数据，设置越大，在存取表里面数据时所需要的磁盘</span><span style="padding:0px;margin:0px;color:#0432FF;">I/O</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">越少。</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">强烈建议不要武断地将</span><span style="padding:0px;margin:0px;color:#FF0000;">InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">的</span><span style="padding:0px;margin:0px;color:#FF0000;">Buffer Pool</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">值配置为物理内存的</span><span style="padding:0px;margin:0px;color:#FF0000;">50%~80%</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，应根据具体环境而定。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_data_file_path = ibdata1:128M:autoextend </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置配置一个可扩展大小的尺寸为</span><span style="padding:0px;margin:0px;color:#0432FF;">128MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的单独文件，名为</span><span style="padding:0px;margin:0px;color:#0432FF;">ibdata1.</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">没有给出文件的位置，所以默认的是在</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的数据目录内。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_file_io_threads = 4 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">中的文件</span><span style="padding:0px;margin:0px;color:#0432FF;">I/O</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">线程。</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">通常设置为</span><span style="padding:0px;margin:0px;color:#FF0000;">4</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，如果是</span><span style="padding:0px;margin:0px;color:#0432FF;">windows</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">可以设置更大的值以提高磁盘</span><span style="padding:0px;margin:0px;color:#0432FF;">I/O</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_thread_concurrency = 8 </span><span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">你的服务器有几个</span><span style="padding:0px;margin:0px;color:#0432FF;">CPU</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">就设置为几，建议用默认设置，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">一般设为</span><span style="padding:0px;margin:0px;color:#FF0000;">8</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_flush_log_at_trx_commit = 1 </span><span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设置为</span><span style="padding:0px;margin:0px;color:#0432FF;">0</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">就等于</span><span style="padding:0px;margin:0px;color:#0432FF;">innodb_log_buffer_size</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">队列满后在统一存储，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">默认为</span><span style="padding:0px;margin:0px;color:#FF0000;">1</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，也是最安全的设置。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_log_buffer_size = 2M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">默认为</span><span style="padding:0px;margin:0px;color:#0432FF;">1MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">通常设置为</span><span style="padding:0px;margin:0px;color:#FF0000;">8~16MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">就足够了。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_log_file_size = 32M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">确定日志文件的大小，更大的设置可以提高性能，但也会增加恢复数据库的时间。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_log_files_in_group = 3 </span><span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">为提高性能</span><span style="padding:0px;margin:0px;color:#0432FF;">,MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">可以以循环方式将日志文件写到多个文件。</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">推荐设置为</span><span style="padding:0px;margin:0px;color:#FF0000;">3</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_max_dirty_pages_pct = 90 </span><span style="padding:0px;margin:0px;color:#0432FF;">#InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">主线程刷新缓存池中的数据。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_lock_wait_timeout = 120 </span><span style="padding:0px;margin:0px;color:#0432FF;">#InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">事务被回滚之前可以等待一个锁定的超时秒数。</span><span style="padding:0px;margin:0px;color:#0432FF;">InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">在它自己的锁定表中自动检测事务死锁并且回滚事务。</span><span style="padding:0px;margin:0px;color:#FF0000;">InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">用</span><span style="padding:0px;margin:0px;color:#FF0000;">locak tables</span> <span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">语句注意到锁定设置。默认值是</span><span style="padding:0px;margin:0px;color:#FF0000;">50</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">秒。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_file_per_table = 0 </span> <span style="padding:0px;margin:0px;color:#0432FF;">#InnoDB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">为独立表空间模式，每个数据库的每个表都会生成一个数据空间。</span><span style="padding:0px;margin:0px;color:#FF0000;">0</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">关闭，</span><span style="padding:0px;margin:0px;color:#FF0000;">1</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">开启。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">独立表空间优点：</span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#FF0000;">1</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">、每个表都有自己独立的表空间。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#FF0000;">2</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">、每个表的数据和索引都会存在自己的表空间中。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#FF0000;">3</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">、可以实现单表在不同的数据库中移动。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#FF0000;">4</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">、空间可以回收（除</span><span style="padding:0px;margin:0px;color:#FF0000;">drop table</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">操作处，表空不能自己回收。）</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">[mysqldump]</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">quick</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_allowed_packet = 2M </span> <span style="padding:0px;margin:0px;color:#0432FF;">#</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">设定在网络传输中一次消息传输量的最大值。系统默认值为</span><span style="padding:0px;margin:0px;color:#0432FF;">1MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，最大值是</span><span style="padding:0px;margin:0px;color:#0432FF;">1GB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，必须设置为</span><span style="padding:0px;margin:0px;color:#0432FF;">1024</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的倍数。单位为字节。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">[mysqld_safe]</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">值得注意：</span></span></span></p><ul style="padding:0px;list-style:none;margin:0px;padding-left:20px;list-style-type:disc;"><li style="padding:0px;margin:0px;margin-left:20px;list-style-type:disc;"><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:visible;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">强烈建议不要武断地将</span>InnoDB<span style="padding:0px;margin:0px;font-family:'宋体';">的</span>Buffer Pool<span style="padding:0px;margin:0px;font-family:'宋体';">值配置为物理内存的</span>50%~80%<span style="padding:0px;margin:0px;font-family:'宋体';">，应根据具体环境而定。</span></span></span></p></li><li style="padding:0px;margin:0px;margin-left:20px;list-style-type:disc;"><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:visible;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">如果</span>key_reads<span style="padding:0px;margin:0px;font-family:'宋体';">太大，则应该把</span>my.cnf<span style="padding:0px;margin:0px;font-family:'宋体';">中的</span>key_buffer_size<span style="padding:0px;margin:0px;font-family:'宋体';">变大，保持</span>key_reads/key_read_re-quests<span style="padding:0px;margin:0px;font-family:'宋体';">至少在</span>1/100<span style="padding:0px;margin:0px;font-family:'宋体';">以上，越小越好。</span></span></span></p></li><li style="padding:0px;margin:0px;margin-left:20px;list-style-type:disc;"><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:visible;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">如果</span>qcache_lowmem_prunes<span style="padding:0px;margin:0px;font-family:'宋体';">很大，就要增加</span>query_cache_size<span style="padding:0px;margin:0px;font-family:'宋体';">的值。</span></span></span></p></li></ul><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">不过很多时候需要具体情况具体分析，其他参数的变更我们可以等</span><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">上线稳定一段时间后在根据</span><span style="padding:0px;margin:0px;color:#0432FF;">status</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">值进行调整。</span></strong></span></span></p><h2 style="padding:0px;margin:0px;text-indent:12px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">电商</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">数据库配置文件</span></span></span></h2><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">这是一份电子商务网站</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">数据库调整后所运行的配置文件</span>/etc/my.cnf(<span style="padding:0px;margin:0px;font-family:'宋体';">服务器为</span>DELL R710<span style="padding:0px;margin:0px;font-family:'宋体';">、</span>16GB<span style="padding:0px;margin:0px;font-family:'宋体';">内存、</span>RAID10)<span style="padding:0px;margin:0px;font-family:'宋体';">，大家可以根据实际的</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">数据库硬件情况进行调整配置文件如下：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">[client]</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">port            = 3306</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">socket          =/data/3306/mysql.sock</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">default-character-set = utf8</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">[mysqld]</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">user    = mysql</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">port    = 3306</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">character-set-server = utf8</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">socket  =/data/3306/mysql.sock</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">basedir = /application/mysql</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">datadir = /data/3306/data</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">log-error=/data/3306/mysql_err.log</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">pid-file=/data/3306/mysql.pid</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">log_slave_updates = 1</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">log-bin = /data/3306/mysql-bin</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">binlog_format = mixed</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">binlog_cache_size = 4M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_binlog_cache_size = 8M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_binlog_size = 1G</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">expire_logs_days = 90</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">binlog-ignore - db = mysql</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">binlog-ignore - db = information_schema</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">key_buffer_size = 384M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">sort_buffer_size = 2M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">read_buffer_size = 2M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">read_rnd_buffer_size = 16M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">join_buffer_size = 2M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">thread_cache_size = 8</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_size = 32M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_limit = 2M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_min_res_unit = 2k</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">thread_concurrency = 32</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">table_cache = 614</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">table_open_cache = 512</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">open_files_limit    = 10240</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">back_log = 600</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_connections = 5000</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_connect_errors = 6000</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">external-locking = FALSE</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_allowed_packet =16M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">thread_stack = 192K</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">transaction_isolation = READ-COMMITTED</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">tmp_table_size = 256M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_heap_table_size = 512M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">bulk_insert_buffer_size = 64M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">myisam_sort_buffer_size = 64M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">myisam_max_sort_file_size = 10G</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">myisam_repair_threads = 1</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">myisam_recover</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">long_query_time = 2</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">slow_query_log</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">slow_query_log_file = /data/3306/slow.log</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">skip-name-resolv</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">skip-locking</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">skip-networking</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">server-id = 1</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_additional_mem_pool_size = 16M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_buffer_pool_size = 512M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_data_file_path = ibdata1:256M:autoextend</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_file_io_threads = 4</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_thread_concurrency = 8</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_flush_log_at_trx_commit = 2</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_log_buffer_size = 16M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_log_file_size = 128M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_log_files_in_group = 3</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_max_dirty_pages_pct = 90</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_lock_wait_timeout = 120</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">innodb_file_per_table = 0</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">[mysqldump]</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">quick</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">max_allowed_packet = 64M</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">[mysql]</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">no – auto - rehash</span></span></p><h2 style="padding:0px;margin:0px;text-indent:12px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">上线后根据</span>status<span style="padding:0px;margin:0px;font-family:'宋体';">状态进行优化</span></span></span></h2><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">数据库上线后，可以等其稳定运行一段时间后再根据服务器的</span>status<span style="padding:0px;margin:0px;font-family:'宋体';">状态进行适当优化，我们可以用如下命令列出</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">服务器运行的各种状态值：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#FF0000;">mysql &gt; show global status;</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">我个人比较喜欢的用法是</span> show status like '<span style="padding:0px;margin:0px;font-family:'宋体';">查询</span>%';</span></span></p><h3 style="padding:0px;margin:0px;text-indent:11px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">1.<span style="padding:0px;margin:0px;font-family:'宋体';">慢查询</span></span></span></h3><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">有时我们为了定位系统中效率比较低下的</span>Query<span style="padding:0px;margin:0px;font-family:'宋体';">语法，需要打开慢查询日志，也就是</span>Slow Que-ry log<span style="padding:0px;margin:0px;font-family:'宋体';">。打开慢查询日志的相关命令如下：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt;</span> <span style="padding:0px;margin:0px;color:#FF0000;">show variableslike '%slow%';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------------+-----------------------------------------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name       |Value                                   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------------+-----------------------------------------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| log_slow_queries    | ON                                     |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| slow_launch_time    | 2                                       |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------------+-----------------------------------------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt;</span> <span style="padding:0px;margin:0px;color:#FF0000;">show globalstatus like '%slow%';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name       | Value|</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Slow_launch_threads | 0    |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Slow_queries        | 2128   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">打开慢查询日志可能会对系统性能有一点点影响，如果你的</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">是主从结构，可以考虑打开其中一台从服务器的慢查询日志，这样既可以监控慢查询，对系统性能影响也会很小。另外，可以用</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">自带的命令</span>mysqldumpslow<span style="padding:0px;margin:0px;font-family:'宋体';">进行查询。比如：下面的命令可以查出访问次数最多的</span>20<span style="padding:0px;margin:0px;font-family:'宋体';">个</span>SQL<span style="padding:0px;margin:0px;font-family:'宋体';">语句：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">mysqldumpslow-s c -t 20 host-slow.log</span></strong></span></span></p><h3 style="padding:0px;margin:0px;text-indent:11px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">2.<span style="padding:0px;margin:0px;font-family:'宋体';">连接数</span></span></span></h3><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">我们如果经常遇见</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">：</span>ERROR1040<span style="padding:0px;margin:0px;font-family:'宋体';">：</span>Too manyconnections<span style="padding:0px;margin:0px;font-family:'宋体';">的情况，一种情况是访问量确实很高，</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">服务器扛不住了，这个时候就要考虑增加从服务器分散读压力。另外一种情况是</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">配置文件中</span>max_connections<span style="padding:0px;margin:0px;font-family:'宋体';">的值过小。来看一个例子。</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt;show variables like'max_connections';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-----------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name   | Value |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-----------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| max_connections | 800   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-----------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">这台服务器最大连接数是</span><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;">256</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，然后查询一下该服务器响应的最大连接数；</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show global status like 'Max_used_connections';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+----------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name        | Value|</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+----------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Max_used_connections | 245   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+----------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;">MySQL</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">服务器过去的最大连接数是</span><span style="padding:0px;margin:0px;color:#0432FF;">245</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，没有达到服务器连接数的上线</span><span style="padding:0px;margin:0px;color:#0432FF;">800</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，不会出现</span><span style="padding:0px;margin:0px;color:#0432FF;">1040</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">错误。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">Max_used_connections/max_connections * 100% = 85%</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">最大连接数占上限连接数的</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">85%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">左右</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">,</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">如果发现比例在</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">10%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">以下，则说明</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">服务器连接数的上限设置得过高了。</span></strong></span></span></p><h3 style="padding:0px;margin:0px;text-indent:11px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">3.key_buffer_size</span></span></h3><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">key_buffer_size<span style="padding:0px;margin:0px;font-family:'宋体';">是设置</span>MyISAM<span style="padding:0px;margin:0px;font-family:'宋体';">表索引缓存空间的大小，此参数对</span>MyISAM<span style="padding:0px;margin:0px;font-family:'宋体';">表性能影响最大。下面是一台</span>MyISAM<span style="padding:0px;margin:0px;font-family:'宋体';">为主要存储引擎服务器的配置：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show variables like 'key_buffer_size';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-----------------+-----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name   | Value   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-----------------+-----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| key_buffer_size | 536870912 |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-----------------+-----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">从上面可以看出，分配了</span><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;">512MB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">内存给</span><span style="padding:0px;margin:0px;color:#0432FF;">key_buffer_size</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">。再来看</span><span style="padding:0px;margin:0px;color:#0432FF;">key_buffer_size</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的使用情况：</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show global status like 'key_read%';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+--------------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name     | Value |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Key_read_requests | 27813678766 |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Key_reads          |  6798830      |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+--------------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">一共有</span><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;">27813678766</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">个索引读取请求，有</span><span style="padding:0px;margin:0px;color:#0432FF;">6798830</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">个请求在内存中没有找到，直接从硬盘读取索引。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#FF0000;">key_cache_miss_rate = key_reads /key_read_requests * 100%</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">比如上面的数据，</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">key_cache_miss_rate</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">为</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">0.0244%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">4000%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">个索引读取请求才有一个直接读硬盘，效果已经很好了，</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">key_cache_miss_rate</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">在</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">0.1%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">以下都很好，如果</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">key_cache_miss_rate</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">在</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">0.01%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">以下的话，则说明</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">key_buffer_size</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">分配得过多，可以适当减少。</span></strong></span></span></p><h3 style="padding:0px;margin:0px;text-indent:11px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">4.<span style="padding:0px;margin:0px;font-family:'宋体';">临时表</span></span></span></h3><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">当执行语句时，关于已经被创建了隐含临时表的数量，我们可以用如下命令查询其具体情况：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show global status like 'created_tmp%';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------------+----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name           |Value |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------------+----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Created_tmp_disk_tables | 21119   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Created_tmp_files       |6     |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Created_tmp_tables      |17715532  |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------------+----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">每次创建临时表时，</span>Created_tmp_table<span style="padding:0px;margin:0px;font-family:'宋体';">都会增加，如果磁盘上创建临时表，</span>Created_tmp_disk_tables<span style="padding:0px;margin:0px;font-family:'宋体';">也会增加。</span>Created_tmp_files<span style="padding:0px;margin:0px;font-family:'宋体';">表示</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">服务创建的临时文件数，比较理想的配置是：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">Created_tmp_disk_tables/ Created_tmp_files * 100% &lt;= 25%</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">比如上面的服务器</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">Created_tmp_disk_tables/ Created_tmp_files * 100% =1.20%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，就相当不错。我们在看一下</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">服务器对临时表的配置：</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show variables where Variable_name in('tmp_table_size','max_heap_table_size');</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------------+---------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name       |Value   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------------+---------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| max_heap_table_size | 2097152 |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| tmp_table_size      |2097152 |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------------+---------+</span></span></p><h3 style="padding:0px;margin:0px;text-indent:11px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">5.<span style="padding:0px;margin:0px;font-family:'宋体';">打开表的情况</span></span></span></h3><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">Open_tables<span style="padding:0px;margin:0px;font-family:'宋体';">表示打开表的数量，</span>Opened_tables<span style="padding:0px;margin:0px;font-family:'宋体';">表示打开过的表数量，我们可以用如下命令查看其具体情况：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show global status like 'open%tables%';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name | Value |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Open_tables   | 351   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Opened_tables | 1455 |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">如果</span><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;">Opened_tables</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">数量过大，说明配置中</span><span style="padding:0px;margin:0px;color:#0432FF;">table_open_cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的值可能太小。我们查询下服务器</span><span style="padding:0px;margin:0px;color:#0432FF;">table_open_cache;</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show variables like 'table_open_cache'; </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name    | Value |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| table_open_cache | 2048  |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">比较合适的值为：</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">open_tables/ opened_tables* 100% &gt; = 85%</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">open_tables/ table_open_cache* 100% &lt; = 95%</span></strong></span></span></p><h3 style="padding:0px;margin:0px;text-indent:11px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">6.<span style="padding:0px;margin:0px;font-family:'宋体';">进程使用情况</span></span></span></h3><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">如果我们在</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">服务器的配置文件中设置了</span>thread_cache_size<span style="padding:0px;margin:0px;font-family:'宋体';">，当客户端断开时，服务器处理此客户请求的线程将会缓存起来以响应一下客户而不是销毁</span>(<span style="padding:0px;margin:0px;font-family:'宋体';">前提是缓存数未达上线</span>)Thread_created<span style="padding:0px;margin:0px;font-family:'宋体';">表示创建过的线程数，我们可以用如下命令查看：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show global status like 'thread%';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name     | Value |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Threads_cached    | 40    |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Threads_connected | 1     |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Threads_created   | 330   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Threads_running   | 1     |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">如果发现</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">Threads_created</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">的值过大的话，表明</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">服务器一直在创建线程，这也是比较耗费资源的，可以适当增大配置文件中</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">thread_cache_size</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">的值</span></strong><span style="padding:0px;margin:0px;font-family:'宋体';">。查询服务器</span>thread_cache_size<span style="padding:0px;margin:0px;font-family:'宋体';">配置如下：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show variables like 'thread_cache_size';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name     | Value |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| thread_cache_size | 100   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">示例中的</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">服务器还是挺健康的。</span></span></span></p><h3 style="padding:0px;margin:0px;text-indent:11px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">7.<span style="padding:0px;margin:0px;font-family:'宋体';">查询缓存</span>(querycache)</span></span></h3><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">它主要涉及两个参数，</span>query_cache_size<span style="padding:0px;margin:0px;font-family:'宋体';">是设置</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">的</span>Query Cache<span style="padding:0px;margin:0px;font-family:'宋体';">大小，</span>query_cache_type<span style="padding:0px;margin:0px;font-family:'宋体';">是设置使用查询缓存的类型，我们可以用如下命令查看其具体情况：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show global status like 'qcache%';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------------+-----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name           |Value  |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------------+-----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Qcache_free_blocks      |22756     |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Qcache_free_memory      |76764704  |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Qcache_hits             | 213028692   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Qcache_inserts          |208894227   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Qcache_lowmem_prunes    |4010916    |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Qcache_not_cached       |13385031    |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Qcache_queries_in_cache | 43560    |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Qcache_total_blocks     |111212    |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------------+-----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;">MySQL</strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';">查询缓存变量的相关解释如下：</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">Qcache_free_blocks<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span> <span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">缓存中相领内存快的个数。数目大说明可能有碎片。</span><span style="padding:0px;margin:0px;color:#0432FF;">flush query cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">会对缓存中的碎片进行整理，从而得到一个空间块。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">Qcache_free_memory<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">缓存中的空闲空间。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">Qcache_hits<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">多少次命中。通过这个参数可以查看到</span><span style="padding:0px;margin:0px;color:#0432FF;">Query Cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的基本效果。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">Qcache_inserts<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">插入次数，没插入一次查询时就增加</span><span style="padding:0px;margin:0px;color:#0432FF;">1</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">。命中次数除以插入次数就是命中比率。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">Qcache_lowmem_prunes<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">多少条</span><span style="padding:0px;margin:0px;color:#0432FF;">Query</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">因为内存不足而被清楚出</span><span style="padding:0px;margin:0px;color:#0432FF;">Query Cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">。通过</span><span style="padding:0px;margin:0px;color:#0432FF;">Qcache_lowmem_prunes</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">和</span><span style="padding:0px;margin:0px;color:#0432FF;">Query_free_memory</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">相互结合，能够更清楚地了解到系统中</span><span style="padding:0px;margin:0px;color:#0432FF;">Query Cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的内存大小是否真的足够，是否非常频繁地出现因为内存不足而有</span><span style="padding:0px;margin:0px;color:#0432FF;">Query</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">被换出的情况。</span><span style="padding:0px;margin:0px;color:#0432FF;">   </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">Qcache_not_cached<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">不适合进行缓存的查询数量，通常是由于这些查询不是</span><span style="padding:0px;margin:0px;color:#0432FF;">select</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">语句或用了</span><span style="padding:0px;margin:0px;color:#0432FF;">now()</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">之类的函数。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">Qcache_queries_in_cache<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">当前缓存的查询和响应数量。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">Qcache_total_blocks<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">缓存中块的数量。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">我们在查询一下服务器上关于</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">query_cache</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">的配置命令：</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show variables like 'query_cache%';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+------------------------------+---------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name               | Value   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+------------------------------+---------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| query_cache_limit           | 1048576 |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| query_cache_min_res_unit    | 2048    |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| query_cache_size            | 2097152 |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| query_cache_type            | ON      |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| query_cache_wlock_invalidate | OFF     |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+------------------------------+---------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';">字段解释如下：</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_limit<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">超过此大小的查询将不缓存。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_min_res_unit<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">缓存块的最小值。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_size<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">查询缓存大小。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_type<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">缓存类型，决定缓存什么样的查询，示例中表示不缓存</span><span style="padding:0px;margin:0px;color:#0432FF;">select sql_no_cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">查询。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">query_cache_wlock_invalidat<span style="padding:0px;margin:0px;font-family:'宋体';">：</span></span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">表示当有其他客户端正在对</span><span style="padding:0px;margin:0px;color:#0432FF;">MyISAM</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">表进行写操作，读请求是要等</span><span style="padding:0px;margin:0px;color:#0432FF;">WRITELOCK</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">释放资源后再查询还是允许直接从</span><span style="padding:0px;margin:0px;color:#0432FF;">Query Cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">中读取结果，默认为</span><span style="padding:0px;margin:0px;color:#0432FF;">OFF</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">（可以直接从</span><span style="padding:0px;margin:0px;color:#0432FF;">Query Cache</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">中取得结果。）</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;">query_cache_min_res_unit</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">的配置是一柄双刃剑，默认是</span><span style="padding:0px;margin:0px;color:#0432FF;">4KB</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">，设置值大对大数据查询有好处，但如果你的查询都是小数据查询，就容易造成内存碎片和浪费。</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">查询缓存碎片率</span></strong> <strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">=Qcache_free_blocks /Qcache_total_blocks * 100%</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">如果查询碎片率超过</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">20%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，可以用</span></strong> <strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">flushquery cache</span></strong> <strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">整理缓存碎片，或者试试减少</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">query_cache_min_res_unit</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，如果你查询都是小数据库的话。</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;"> </span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">查询缓存利用率</span></strong> <strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">=(Qcache_free_size – Qcache_free_memory)/query_cache_size * 100%</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">查询缓存利用率在</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">25%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">一下的话说明</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">query_cache_size</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">设置得过大，可适当减少</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">;</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">查询缓存利用率在</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">80%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">以上而且</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">Qcache_lowmem_prunes&gt; 50</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">的话则说明</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">query_cache_size</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">可能有点小，不然就是碎片太多。</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">查询命中率</span></strong> <strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">= (Qcache_hits- Qcache_insert)/Qcache)hits * 100%</span></strong></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">示例服务器中的查询缓存碎片率等于</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">20%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">左右，查询缓存利用率在</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">50%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，查询命中率在</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">2%</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">，说明命中率很差，可能写操作比较频繁，而且可能有些碎片。</span></strong></span></span></p><h3 style="padding:0px;margin:0px;text-indent:11px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">8.<span style="padding:0px;margin:0px;font-family:'宋体';">排序使用情况</span></span></span></h3><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">它表示系统中对数据进行排序时所用的</span>Buffer<span style="padding:0px;margin:0px;font-family:'宋体';">，我们可以用如下命令查看：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show global status like 'sort%';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name     | Value |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Sort_merge_passes | 10        |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Sort_range        | 37431240   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Sort_rows         | 6738691532|</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Sort_scan         | 1823485     |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+-------------------+----------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">Sort_merge_passes</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">包括如下步骤：</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">首先会尝试在内存中做排序，使用的内存大小由系统变量</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">sort_buffer_size</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">来决定，如果它不够大则把所有的记录都读在内存中，而</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">则会把每次在内存中排序的结果存到临时文件中，等</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">找到所有记录之后，再把临时文件中的记录做一次排序。这次再排序就会增加</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">sort_merge_passes</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">。实际上，</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">会用另外一个临时文件来存储再次排序的结果，所以我们通常会看到</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">sort_merge_passes</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">增加的数值是建临时文件数的两倍。因为用到了临时文件，所以速度可能会比较慢，增大</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">sort_buffer_size</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">会减少</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">sort_merge_passes</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">和创建临时文件的次数，但盲目地增大</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">sort_buffer_size</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">并不一定能提高速度。</span></strong></span></span></p><h3 style="padding:0px;margin:0px;text-indent:11px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">9.<span style="padding:0px;margin:0px;font-family:'宋体';">文件打开数</span>(open_files)</span></span></h3><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">我们现在处理</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">故障时，发现当</span>Open_files<span style="padding:0px;margin:0px;font-family:'宋体';">大于</span>open_files_limit<span style="padding:0px;margin:0px;font-family:'宋体';">值时，</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">数据库就会发生卡住的现象，导致</span>Nginx<span style="padding:0px;margin:0px;font-family:'宋体';">服务器打不开相应页面。这个问题大家在工作中应注意，我们可以用如下命令查看其具体情况：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">show global status like 'open_files';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name | Value |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Open_files    | 1481   |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+---------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">mysql&gt; show global status like 'open_files_limit';</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+------------------+-------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Variable_name    | Value |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+------------------+--------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">| Open_files_limit | 4509 |</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">+------------------+--------+</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;margin-bottom:0;text-indent:14px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">比较合适的设置是：</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">Open_files/ Open_files_limit * 100% &lt; = 75%</span></strong></span></span></p><h3 style="padding:0px;margin:0px;text-indent:11px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">10.InnoDB_buffer_pool_cache<span style="padding:0px;margin:0px;font-family:'宋体';">合理设置</span></span></span></h3><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">InnoDB<span style="padding:0px;margin:0px;font-family:'宋体';">存储引擎的缓存机制和</span>MyISAM<span style="padding:0px;margin:0px;font-family:'宋体';">的最大区别就在于，</span>InnoDB<span style="padding:0px;margin:0px;font-family:'宋体';">不仅仅缓存索引，同时还会缓存实际的数据。此参数用来设置</span>InnoDB<span style="padding:0px;margin:0px;font-family:'宋体';">最主要的</span>Buffer<span style="padding:0px;margin:0px;font-family:'宋体';">的大小，也就是缓存用户表及索引数据的最主要缓存空间，对</span>InnoDB<span style="padding:0px;margin:0px;font-family:'宋体';">整体性能影响也最大。</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">无论是</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">官方手册还是网络上许多人分享的</span>InnoDB<span style="padding:0px;margin:0px;font-family:'宋体';">优化建议，都是简单地建议将此值设置为整个系统物理内存的</span>50%~80%<span style="padding:0px;margin:0px;font-family:'宋体';">。这种做法其实不妥，<strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;color:#FF0000;">我们应根据实际的运行场景来正确设置此项参数。</span></strong></span></span></span></p><h2 style="padding:0px;margin:0px;text-indent:12px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">优化小思想</span></span></span></h2><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">很多时候我们会发现，通过参数设置进行性能优化所带来的性能提升，并不如许多人想象的那样会产生质的飞跃，除非是之前的设置存在严重不合理的情况。我们不能将性能调优完全依托与通过</span><span style="padding:0px;margin:0px;color:#0432FF;">DBA</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">在数据库上线后进行参数调整，而应该在系统设计和开发阶段就尽可能减少性能问题。</span><span style="padding:0px;margin:0px;color:#FF0000;">(</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">重点在于前期架构合理的设计及开发的程序合理</span><span style="padding:0px;margin:0px;color:#FF0000;">)</span></strong></span></span></p><h2 style="padding:0px;margin:0px;text-indent:12px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);">MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">数据库的可扩展架构方案</span></span></span></h2><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">如果凭借</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">的优化任无法顶住压力，这个时候我们就必须考虑</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">的可扩展性架构了</span>(<span style="padding:0px;margin:0px;font-family:'宋体';">有人称为</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">集群</span>)<span style="padding:0px;margin:0px;font-family:'宋体';">它有以下明显的优势：</span></span></span></p><ul style="padding:0px;list-style:none;margin:0px;padding-left:20px;list-style-type:disc;"><li style="padding:0px;margin:0px;margin-left:20px;list-style-type:disc;"><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:visible;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">成本低，很容易通过价格低廉</span><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="padding:0px;margin:0px;color:#0432FF;">Pc server</span><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">搭建出一个处理能力非常强大的计算机集群。</span></span></p></li><li style="padding:0px;margin:0px;margin-left:20px;list-style-type:disc;"><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:visible;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">不太容易遇到瓶颈，因为很容易通过添加主机来增加处理能力。</span></p></li><li style="padding:0px;margin:0px;margin-left:20px;list-style-type:disc;"><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:visible;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#0432FF;">单节点故障对系统的整体影响较小。</span></p></li></ul><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">目前可行的方案如下：</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">（</span>1<span style="padding:0px;margin:0px;font-family:'宋体';">）</span>MySQL Cluter</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">其特点为可用性非常高，性能非常好。每份数据至少可在不同主机上存一份副本，且冗余数据拷贝实时同步。但它的维护非常复杂，存在部分</span>Bug<span style="padding:0px;margin:0px;font-family:'宋体';">，目前还不适合比较核心的线上系统，所以暂时不推荐。</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">（</span>2<span style="padding:0px;margin:0px;font-family:'宋体';">）</span>DRBD<span style="padding:0px;margin:0px;font-family:'宋体';">磁盘网络镜像方案</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">其特点为软件功能强大，数据可在底层快设备级别跨物理主机镜像，且可根据性能可靠性要求配置不同级别的同步。</span>I/O<span style="padding:0px;margin:0px;font-family:'宋体';">操作会保持顺序，可满足数据库对数据一致性的苛刻要求。但非分布式文件系统环境无法支持镜像数据同时可见，性能和可靠性两者互相矛盾，无法适用于性能和可靠性要求都比较苛刻的环境，维护成本高于</span>MySQL Replication<span style="padding:0px;margin:0px;font-family:'宋体';">。另外，</span>DRBD<span style="padding:0px;margin:0px;font-family:'宋体';">是官方推荐的可用于</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">的搞可用方案之一，大家可根据实际环境来考虑是否部署。</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">（</span>3<span style="padding:0px;margin:0px;font-family:'宋体';">）</span>MySQL Replication</span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><span style="padding:0px;margin:0px;font-family:'宋体';">在工作中，此种</span>MySQL<span style="padding:0px;margin:0px;font-family:'宋体';">搞可用、高扩展性架构也是用得最多的，我也推荐此方案，一主多从、双主多从是生产环境常见的高可用架构方案。</span></span></span></p><p style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"> </span></span></p><div style="padding:0px;margin:0px;padding-bottom:0px;clear:both;height:auto;overflow:hidden;text-indent:7px;"><div><span style="font-family: 宋体, 'Arial Narrow', arial, serif;"><span style="color: rgb(44, 44, 44);"><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">高可用架构：</span><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">一主多从、</span><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">双主多从、</span><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">读写分离、</span><span style="padding:0px;margin:0px;color:#FF0000;">MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">分布式集群、</span><span style="padding:0px;margin:0px;color:#FF0000;">DRBD+Heartbeat+MySQL</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">、等各种集群架构</span><span style="padding:0px;margin:0px;color:#FF0000;">,</span></strong><strong style="padding:0px;margin:0px;"><span style="padding:0px;margin:0px;font-family:'宋体';color:#FF0000;">尽情关注</span><span style="padding:0px;margin:0px;color:#FF0000;">http://xuliangwei.com</span></strong></span></span></div></div></div></div></div></div><br/></span>
</div></body></html> 