<html>
<head>
  <title>高级文件系统管理</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1850"/>
<h1>高级文件系统管理</h1>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
一、磁盘配额
<div>     1、磁盘配额概念</div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">磁盘配额就是</span>管理员<span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">可以为用户所能使用的磁盘空间进行配额限制，每一用户只能使用最大配额范围内的磁盘空间。</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     2、磁盘配额条件</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     内核必须支持磁盘配额</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">[root@localhost ~]#grep CONFIG_QUOTA /boot/config-2.6.32-279.el6.i686</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">CONFIG_QUOTA=y</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">CONFIG_QUOTA_NETLINK_INTERFACE=y</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">#CONFIG_QUOTA_DEBUG is not set</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">CONFIG_QUOTA_TREE=y</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">CONFIG_QUOTACTL=y</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     系统中必须安装了quota工具，查看命令如下：</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">[root@localhost ~]#rpm -q quota</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">quota-3.17-16.el6.i686</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     要支持磁盘配额的分区必须开启磁盘配额功能，这个功能需要手工开启，不再是默认就开启的</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     3、概念</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     1）用户配额和组配额</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     2）磁盘容量限制和文件个数限制</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     3）软限制和硬限制</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     4）宽限时间</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     如果用户占用的空间处于软限制与硬限制之间，系统会在用户登陆时警告用户磁盘将满，这个时间就是宽限时间 ，默认是7天。如果到了宽限时间，用户的磁盘占用量还超过软件软件限制，那么软限制就会升级为硬限制。</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     4、磁盘配额规划</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     磁盘配额是限制普通用户在分区上使用磁盘空间和文件个数，所以我们需要指定一个分区。手工建立一个5GB的/dev/sdb1分区，把它挂载到/disk目录当中。</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     建立被限制的用户和用户组。假设需要限制lamp1、lamp2、lamp3，这三个用户属于brother用户组。</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     其中brother组磁盘容量硬限制为500MB，软件限制450MB，文件个数不做限制。lamp1用户，磁盘容量硬限制为50MB，软件限制为40MB，文件个数硬限制为10个，软限制为8个。lamp2和lamp3用户磁盘容量硬限制为250MB，软限制为200MB，文件个数不做限制。</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     大家发现lamp1、lamp2、lamp3用户加起来的磁盘容量限制550MB，超过了brother组的磁盘容量限制500MB。这样，某个用户可能达不到自己的用户限制，而达到组限制时就不能再写入数据了。如果用户限制和组限制同时存在，那么哪个限制更小，哪个限制优先生效。</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     将系统宽限时间改为8天。</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     5、磁盘配额步骤</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     1）建立500MB的/dev/sdb1分区，并将它挂载于/disk目录当中</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     2）建立需要做限制的用户和用户组</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#groupadd brother</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#useradd -G brother lamp1</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#useradd -G brother lamp2</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#useradd -G brother lamp3</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#passwd lamp1</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#passwd lamp2</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     [root@localhost ~]#passwd lamp3</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     3）在分区上开启磁盘配额功能</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#mount -o remount,usrquota,grpquota /disk</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     <i>#重新挂载/disk分区，并加入用户和用户组的磁盘配额功能</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     要想永久生效，则需修改/etc/fstab文件：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#vi /etc/fstab</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     /dev/sdb1     /disk     ext4     defaults,usrquota,grpquota     0 0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#mount -o remount /disk</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     <i>#修改配置文件如果想要生效，必须重启系统，否则也需要把分区重新挂载一遍</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     4）建立磁盘配额的配置文件</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#quotacheck     [选项]     [分区名]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -a:  扫描/etc/mtab文件中所有启用磁盘配额功能的分区。如果加入此参数，命令后面就不需要加入分区名了</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -c:  不管原有的配置文件，重新扫描并建立新的配置文件</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -u:  建立用户配额的配置文件，也就是生成aquota.user文件</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -g:  建立组配额的配置文件，会生成aquota.group文件</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -v:  显示扫描过程</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -m: 强制以读写的方式扫描文件系统，和-M类似。一般扫描根分区时使用。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -f:  强制扫描文件系统，并写入新的配置文件。一般扫描添加的硬盘分区时使用。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">注意：建立磁盘配额的配置文件之前须先关闭SELinux，否则会报错。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#quotacheck -avug                                   <i>#建立用户配额和组配额</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#ll /disk/                                                   <i>#查看/disk目录中两个配置文件是否被建立</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -rw-------  1  root  root   6144  4月    17  01:08  aquota.group</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">-rw-------  1  root  root   6144  4月    17  01:08  aquota.user</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     如果需要给根分区开启配额功能，需要</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#vi /etc/fstab</span></div><div>     UUID=e0e4ad96-855a-434c-8df0-d6c776708779 /       ext4    defaults,<b>usrquota,grpquota</b>        1 1</div><div>    <i> #开启磁盘配额功能</i></div><div>     <span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#mount -o remount  /                              <i>#重新挂载&quot;/&quot;分区</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#quotacheck -avugm</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     自动扫描/分区建立配额配置文件时，因为/分区已经挂载成读写系统，而quotacheck需要把分区挂载成只读分区，然后建立配置文件，最后再挂载回来，所以不能直接在/分区建立配置文件。这时需要使用-m强制以读写方式扫描文件系统</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     5）设置用户和组的配额限制</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#edquota [选项] [用户名或组名]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -u 用户名:     设定用户配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -g 组名:         设定组配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -t:                 设定宽限时间</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -p:                复制配额限制。如果已经设定好某个用户的配额限制，其他用户的配额限制如果和这个用户相同，那么可以直接复制配额限制，而不用都手工指定</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#edquota -u lamp1                                     <i>#edquota命令进入后，就是标准的vi操作</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Disk quotas for user lamp1 (uid 500):</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     <i>#磁盘配额是设定用户lamp1（uid 500）</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Filesystem     blocks     soft     hard     inodes     soft     hard</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     /dev/sdb1     0           40000   50000       0          8          10</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">    <i> #分区名    已占用容量  软限制    硬限制  已占用文件数  软限制  硬限制</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#edquota -u lamp2</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Disk quotas for user lamp2 (uid 501):</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     <i>#磁盘配额是设定用户lamp1（uid 501）</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Filesystem     blocks     soft     hard     inodes     soft     hard</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     /dev/sdb1     0         250000   300000       0         0       0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#edquota -g brother</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">Disk quotas for group brother (gid 500):</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     <i>#磁盘配额是设定组borther（gid 500）</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Filesystem     blocks     soft     hard     inodes     soft     hard</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     /dev/sdb1     0         450000   500000       0        0          0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     6）配额复制</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     lamp3用户的配额值和lamp2用户完全一样，可以使用lamp2用户作为模板进行复制。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#edquota -p lamp2 -u lamp3</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">                                  <i>#命令 -p     源用户     -u     目标用户</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     7）修改宽限时间</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     将宽限时间改为8天，修改命令如下：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#edquota -t</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Grace period before enforcing soft limits for users:</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Time units may be: days, hours, minutes, or seconds</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">          Filesystem          Block grace period          Inode grace period</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">           /dev/sdb1               8days                              8days</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">          <i>#分区名                    容量的宽限时间               个数的宽限时间</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     8）启动和关闭配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     配额的配置完成，接下来只需要启动配额，启动命令如下：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#quota [选项] [分区名]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -a:     依据/etc/mtab文件启动所有的配额分区。如果不加-a，后面一定要指定分区名</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -u:     启动用户配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -g:     启动组配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -v:     显示启动过程的信息</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#quotaon -vug /disk/</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     /dev/sdb1 [/disk]:  group quotas turned on</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     /dev/sdb1 [/disk]:  users quotas turned on</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     <i>#启动/disk分区的配额</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     或者写这条命令也可以：quotaon -avug</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     关闭配额的命令如下：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#quotaoff [选项] [分区名]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -a:     依据/etc/mtab文件关闭所有的配额分区。如果不加-a，后面就一定要指定分区名</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -u:     关闭用户配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -g:     关闭组配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#quotaoff -a                             <i> #依据/etc/mtab文件关闭配额分区</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     6、磁盘配额查询</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">          quota查询用户或用户组配额：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#quota [选项] [用户名或组名]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -u:  用户名：     查询用户配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -g:  组名：        查询组配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -v:                    显示详细信息</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -s:                    以习惯单位显示容量大小，如M，G</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#quota -uvs     lamp1               <i>#显示lamp1用户的配额</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">          requota查询文件系统配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#requota [选项] [分区名]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -a:     依据/etc/mtab文件查询配额。如不加-a选项，就一定要指定分区名</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -u:     查询用户配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -g:     查询组配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -v:     显示详细信息</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -s:     以习惯单位显示容量大小</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#requota  -avugs                    <i>#查询用户和组的所有配额</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     7、测试</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     8、非交互设定用户磁盘配额</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#setquota -u 用户名 容量软件限制 容量硬限制 个数软限制 个数硬限制 分区名</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     例：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#setquota -u lamp4 10000 20000 5 8 /disk</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">    <i> #设定用户在/disk分区的容量软件限制为10MB，硬限制20MB。文件个数软限制5个，硬限制8个。</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><i><br/></i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><i><br/></i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">二、LVM逻辑卷管理</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     1、简介</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     LVM是Logical Volume Manager的简称，中文就是逻辑卷管理</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">                              </span><img src="高级文件系统管理_files/Image.png" type="image/png" data-filename="Image.png" style="cursor: default;cursor: default;"/></div><div>     物理卷（PV,physical Volume）: 就是真正的物理硬盘或分区。</div><div>     卷组（VG，Volume Group）: 将多个物理卷合起来就组成了卷组，组成同一个卷组的物理卷可以是同一个硬盘的不同分区，也可以是不同硬盘上的不同分区。我们可以把卷组想像为一个逻辑硬盘。</div><div>     逻辑卷（LV，Logical Volume）: 卷组是一个逻辑硬盘，硬盘必须分区之后才能使用，这个分区我们称作逻辑卷。逻辑卷可以格式化和写入数据。我们可以把逻辑卷想象成分区。</div><div>     物理扩展（PE，Physical Extend）: PE 是用来保存数据的最小单元，我们数据实际上都是写入PE当中，PE的大小是可以配置的，默认是4MB。PE和基本文件系统中的block数据块非常类似。</div><div>     2、建立LVM的步骤：</div><div>     首先需要把物理硬盘分区，当然可以是整块物理硬盘。</div><div>     然后把物理分区建立成物理卷（PV），也可以把整块硬盘都建立为物理卷。</div><div>     接下来把物理卷合成为卷组（VG）。卷组就已经可以动态的调整大小了，可以把物理分区加入卷组，也可以把物理分区从卷组中删除。</div><div>     最后就是把卷组再划分成为逻辑卷（LV），当然逻辑卷也是可以直接调整大小的。我们可以把逻辑卷想像成分区，所以也需要格式化和挂载。</div><div>     3、建立物理卷</div><div>     1）硬盘分区</div><div>     创建方式就是使用fdisk交互命令，不过需要注意的是分区的系统ID不再是Linux默认的分区ID号83了，而要改成LVM的ID号8e。</div><div>     2）建立物理卷</div><div>     <span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#pvcreate [设备文件名]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     建立物理卷时，既可以把整块硬盘都建立成物理卷，也可以把某个分区建立成物理卷。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#pvcreate /dev/sdb                                             <i>#将/dev/sdb整块硬盘建立成物理卷</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#pvcreate /dev/sdb5                                           <i>#将/dev/sdb5分区建立成物理卷</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     3）查看物理卷</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#pvscan</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     PV /dev/sdb5                                        lvm2  [1.01GiB</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     PV /dev/sdb6                                        lvm2  [1.01GiB</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     PV /dev/sdb7                                        lvm2  [1.01GiB</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Total: 3 [3.03GB</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">]  /  in  use:  0 [0      ]  /  in no VG: 3  [3.03 GiB]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     #总计：3个物理卷[大小]  /  使用了0个卷[大小]  /  空闲3个卷[大小]。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#pvdisplay                                                         <i>#查看物理卷的详细信息</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     &quot;/dev/sdb5&quot; is a new physical volume of &quot;1.01GB&quot;</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     ---NEW Physical volume---</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     PV Name                         /dev/sdb5     <i>#PV名</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     VG Name                                             <i>#属于的VG名，还没有分配，所以空白</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     PV  Size                           1.01GiB         <i>#PV的大小</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Allocatable                         NO             <i>#是否已经分配</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     PE size                                 0               <i>#PE大小，因为还没有分配，所以PE大小也没有指定</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Total PE                               0               <i>#PE总数</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Free PE                                0               <i>#空闲的PE数</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Allocated PE                        0               <i>#可分配的PE数</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     PV UUID                              CEsVz3-f0sD-elw0-wkHZ-iaLq-06aV-xtQNTB     #PV的UUID</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     4）删除物理卷</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#pvremove /dev/sdb7                                   <i>#删除/dev/sdb7这个物理卷</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     4卷组管理</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     1）建立卷组</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#vgcreate [选项] 卷组名  物理卷名</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -s PE 大小:     指定PE大小，单位可以是MB，GB，TB等。如果不写默认是4MB。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#vgcreate -s 8MB scvg /dev/sdb5 /dev/sdb6</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     #将/dev/sdb5、/dev/sdb6加入卷组scvg</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     2）查看卷组</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     查看卷组的命令同样是两个，vgscan主要是查看系统中是否有卷组，而vgdisplay则是查看卷组的详细状态。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     3）增加卷组容量</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#vgextend scvg /dev/sdb7                         <i>#把/dev/sdb7物理卷也加入scvb卷组</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     4）减小卷组容量</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#vgreduce scvg /dev/sdb7                         <i>#在卷组中删除/dev/sdb7物理卷</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#vgreduce -a                                             <i>#删除所有的未使用物理卷</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     5）删除卷组</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#vgremove scvg</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     卷组删除之后才能删除物理卷。如果卷组中已经分配了逻辑卷，必须先删除逻辑卷之后，才能删除卷组。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     5、逻辑卷管理</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     1）建立逻辑卷</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[root@localhost ~]#lvcreate [选项] [-n 逻辑卷名] 卷组名</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -L 容量：     指定逻辑卷大小，单位MB，GB，TB等</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -l  个数：     按照PE个数指定逻辑卷大小，这个参数需要换算容量，太麻烦</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -n  逻辑卷名：     指定逻辑卷名</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     [</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#lvcreate -L 1.5G -n lamplv scvg               <i>#在scvg卷组中建立1.5GB的lamplv逻辑卷</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Logical volume &quot;lamplv&quot; created</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     建立逻辑卷之后，还要格式化和挂载之后逻辑卷才能使用。格式化和挂载操作与普通分区一样。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     [</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#mkfs -t ext4 /dev/scvg/lamplv               <i>#格式化</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#mkdir /disklvm                                       <i>#建立挂载点</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#mount /dev/scvg/lamplv /disklvm         <i>#挂载分区</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#mount                                                   <i>#查看已经挂载的分区</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     ......省略部分内容......</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     /dev/mapper/scvg-lamplv on /disklvm type ext4 (rw)</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     如果需要开机自动挂载，需要写入/dev/fstab文件。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     2）查看逻辑卷</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#lvscan                                                     <i>#查看系统中是否有逻辑卷</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#lvdisplay                                                 <i>#查看系统中逻辑卷详细信息</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     3）调整逻辑卷大小</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#lvresize [选项] 逻辑卷设备文件名</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -L 容量：     安装容量调整大小，单位KB，GB，TB等。使用+代表增加空间，-号代表减少空间。如果直接写容量，代表设定逻辑卷大小为指定大小</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -l  个数：     按照PE个数调整逻辑卷大小</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#lvresize -L 2.5G /dev/scvg/lamplv          <i>#增加lamplv逻辑卷的大小到2.5GB</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Extending logical volume lamplv to 2.50GiB</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Logical volume lamplv successfully resized</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">也可以这样写</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#lvresize -L +1G /dev/scvg/lamplv</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">此时逻辑卷的大小已经改变，但是分区的大小还未变</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#df -h /disklvm/</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     /dev/mapper/scvg-lamplv 1.5G     35M     1.4G     3%  /disklvm</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">如果需要让分区使用这个新的逻辑卷，还要使用resize2fs命令来调整分区的大小。LVM不需要卸载分区，直接就可以调整分区大小。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#resize2fs     [选项]     [设备文件名]     [调整的大小]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -f：     强制调整</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     设备文件名：     指定调整哪个分区的大小</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     调整的大小：     指定把分区调整到多大，要加M，G等单位。如果不加大小，会使用整个分区</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#resize2fs /dev/scvg/lamplv                            <i>#将调整过大小的逻辑卷赋予分区</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">df -h /disklvm/</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">/dev/mapper/scvg-lamplv 2.5G     35M     2.4G     2%  /disklvm</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     4）删除逻辑卷</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#lvremove 逻辑卷设备文件名</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     删除lamplv逻辑卷，先卸载后删除</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# umonut /dev/scvg/lamplv</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#lvremove /dev/scvg/lamplv</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><br/></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><br/></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><br/></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">三、RAID磁盘阵列</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     1、简介</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     1）RAID 0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     RAID 0也叫Stripe或Striping（带区卷）</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     2）RAID 1</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     RAID 1也叫Mirror或Mirroring（镜像卷），由两块硬盘组成</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     3）RAID 10或RAID 01</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     如果先用两块硬盘组成RAID 1，再用两块硬盘组成另一个RAID 1，最后把这两个RAID 1组成RAID 0，这种方法我们称作RAID 10。如果先组成RAID 0，再组成RAID 1，就是RAID 01。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     4）RAID 5</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     RAID 5最少需要三块以上的硬盘组成，当然硬盘大小也应当一致。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     命令模式设置RAID 5</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     1）建立三个2GB的分区和一个2GB的备份分区</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     2）建立RAID5</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm     [模式]     [RAID设备文件名]     [选项]</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     模式：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Assemble:     加入一个已经存在的阵列</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Build:     创建一个没有超级块的阵列</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Create:     创建一个阵列，每个设备具有超级块</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Manage:     管理阵列，如添加设备和删除损坏设备</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Misc:     允许单独对阵列中的设备进行操作，如停止阵列</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Follow or Monitor:     监控RAID状态</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Grow:     改变RAID的容量或阵列中的数目</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     选项：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -s,  --scan:     扫描配置文件或/proc/mdstat文件，发现丢失信息</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -D,  --detail:     查看磁盘阵列详细信息</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -C,  --create:     建立新的磁盘阵列，就是调用Create模式</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -a,  --auto=yes:     采用标准格式建立磁盘阵列</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -n,  --raid-devices=数字:     使用几个硬盘或分区组成RAID</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -l,  --level=级别:     创建RAID的级别，可以是0，1，5</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -x,  --spare-devices=数字:     使用几个硬盘和分区组成备份设备</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -a,  --add 设备文件名:     在已经存在的RAID中加入设备</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -r,  --remove 设备文件名:     在已经存在的RAID中移除设备</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -f,  --fail 设备文件名:     把某个组成RAID的设备置为错误状态</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -S,  --stop:     停止RAID设备</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     -A,  --assemble:     按照配置文件加载RAID</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm --create --auto=yes /dev/md0 --level=5 --raid-devices=3 \</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">--spare-devices=1 /dev/sdb5 /dev/sdb6 /dev/sdb7 /dev/sdb8</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">查看新建立的/dev/md0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm --detail /dev/md0                              <i>#查看/dev/md0详细信息</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">/dev/md0:                                                                                      <i>#设备文件名</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">               Version :  1.2</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Creation Time :  Tue Apr 23 23:13:48 2013                               <i>#创建时间</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">           Raid Level :  raid5                                                                <i>#RAID级别</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">           Array Size :  4206592（4.01 GiB 4.31 GB）                         <i>#RAID总容量</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Used Dev Size :  2103296（2.01 GiB 2.15 GB）                         <i>#每个分区的容量</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">       Raid Devices :  3                                                                      <i>#组成RAID的设备数</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">      Total Devices :  4                                                                      <i>#总设备数</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">           Peristance :  Superblock is persistent</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><br/></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">       Update Time :  Tue Apr 23 23:14:52 2013</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">                   State :  clean</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Active Devices :  3                                                                      <i>#激活的设备数</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"> Working Devices :  4                                                                      <i>#可用的设备数</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Failed Devices :  0                                                                      <i>#错误的设备数</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     Spare Devices :  1                                                                      <i>#备份的设备数</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">......省略部分内容......     </span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">查看RAID设备除了使用mdadm -D或mdadm --detail之外，也可以查看/proc/mdstat文件，这个文件中也保存了RAID相关信息</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]#cat /proc/mdstat</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     3）格式化与挂载RAID</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mkfs -t ext4 /dev/md0                                   <i>#格式化</i></span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1;">挂载命令如下：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mkdir /raid                                                     <i>#建立挂载点</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mount /dev/md0 /raid/                                 <i>#挂载/dev/md0</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mount</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">......省略部分内容......</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">/dev/md0 on /raid type ext4 (rw)</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     4）生成mdadm配置文件</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     在CentOS 6.x中，mdadm的配置文件并不存在，需要手工建立，这时我们使用以下命令建立/etc/mdadm.conf配置文件：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# echo Devices /dev/sdb[5-8] &gt;&gt; /etc/mdadm.conf</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><i>#建立/ect/mdadm.conf配置文件名，并把组成RAID的分区的设备文件名写入</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><i>#注意如果有多个RAID，要把所有组成Raid的设备都放入配置文件，否则Raid设备重启后会丢失</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><i>#比如组成raid 10，就既要把分区设备文件名放入此文件，也要把组成Raid 0的Raid 1设备文件名放入</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm -Ds &gt;&gt; /etc/mdadm.conf</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><i>#查询和扫描RAID信息，并追加进/etc/mdadm.conf文件</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# cat /etc/mdadm.conf</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">Devices /dev/sdb5 /dev/sdb6 /dev/sdb7 /dev/sdb8</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">ARRAY     /dev/md0     metadata=1.2     spares=1     name=localhost.localdomain:0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">UUID=dd821fe5:8597b126:460a3afd:857c7989</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     5）设置开机自动挂载</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     自动挂载需要修改/etc/fstab配置文件：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# vi /etc/fstab</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">/dev/md0     /raid                                   ext4     defaults          1   2</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><i>#往/etc/fstab文件中加入此行</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">重新启动需要在这一步完成之后进行，否则会报错。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     6）启动或停止RAID</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     RAID设备生效后，不用手工启动或停止。但是如果需要卸载RAID设备，必须手工停止RAID设备，命令如下： </span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm -S /dev/md0                                                  <i>#停止/dev/md0设备</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     如果是要删除RAID设备，则要把所有和RAID相关的内容全部删除，才能保证系统不报错，步骤如下：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# umount /dev/md0                                                     <i> #卸载/dev/md0设备</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# vi /etc/fstab</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">/dev/md0     /raid                                   ext4     defaults          1   2</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);"><i>#在/etc/fstab文件中删除此行</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm -S /dev/md0                                                  <i>#停止/dev/md0设备</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">mdadm:     stopped /dev/md0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# vi /etc/mdadm.conf</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">ARRAY          /dev/md0          metadata=1.2         spares=1          name=localhost.localdomain:0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">UUID=dd821fe5:8597b126:460a3afd:857c7989</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><i>#删除或者注释此行</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     如果仅仅是停止设备，只要先卸载，再停止即可，停止完成后，再启动RAID命令如下：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm -As /dev/md0                                             <i>#启动RAID /dev/md0</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">mdadm:     /dev/md0 has been started with 3 drives and 1 spare.</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mount /dev/md0 /raid/                                           <i>#挂载/dev/md0</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     7）模拟分区出现故障</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     我们模拟磁盘报错，看看备份分区是否会自动顶替错误分区。mdadm有一个选项-f，这个选项的作用就是把一个硬盘或分区变成错误状态，用来模拟RAID报错。命令如下：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm /dev/md0 -f /dev/sdb7</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">mdadm:     set /dev/sdb7 faulty in /dev/md0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm -D /dev/md0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">/dev/md0:</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">......省略部分输出.......</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">Active Devices  :   2</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">Working Devices  :   3</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">Failed Devices  :   1</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">Spare Devices  :   1</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">......省略部分输出......</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">Number     Major     Minor     RaidDevice     State</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     0               8            21               0           active sync     /dev/sdb5</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">1               8            22               1           active sync     /dev/sdb6</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">3               8            24               2           active sync     /dev/sdb8</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><br/></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">4               8            23               -           faulty spare     /dev/sdb7</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">备份分区/dev/sdb8已经激活，但是/dev/sdb7是失效了。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     8）移除错误分区</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     既然已经报错了，把/dev/sdb7从RAID中删除，如果这是硬盘，就可以进行换硬盘处理了移除命令如下：</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm /dev/md0 --remove /dev/sdb7</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">mdadm:     hot removed /dev/sdb7 from /dev/md0</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     9）添加新的备份分区</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     既然已经移除，那么需要再加入一个新的备份分区，以备下次硬盘或分区出现问题。</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm /dev/md0 --add /dev/sdb9                             <i> #把/dev/sdb9加入/dev/md0</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">mdadm:     added /dev/sdb9</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">[</span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">root@localhost ~]# mdadm -D /dev/md0                                                   <i>#查询RAID /dev/md0详细信息</i></span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">......省略部分内容......</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">Number     Major     Minor     RaidDevice     State</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     0               8            21               0           active sync     /dev/sdb5</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">1               8            22               1           active sync     /dev/sdb6</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">     </span><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;">3               8            24               2           active sync     /dev/sdb8</span></div><div><span style="background-color: rgb(255, 255, 255); line-height: 24px; text-indent: 28px; widows: 1;"><br/></span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);">     4               8            25               -           spare     /dev/sdb9</span></div><div><span style="line-height: 24px; text-indent: 28px; widows: 1; background-color: rgb(255, 255, 255);"><br/></span></div></span>
</div></body></html> 