<html>
<head>
  <title>Docker 简介</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="671"/>
<h1>Docker 简介</h1>

<div>
<span><div><br/></div><div align="justify"><h1 align="justify"><font color="#010101" face="Calibri" size="5"><span style="font-size:22pt"><b>Docker</b></span></font> <font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>简介</b></span></font></h1><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Docker</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>的特性主要包括以下几点：</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">速度飞快以及优雅的隔离框架</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">物美价廉</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">CPU/</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">内存的低消耗</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">跨云计算基础构架</span></font></div><div align="justify" style="min-height: 165pt;"><img src="Docker 简介_files/Image.png" type="image/png" data-filename="Image.png" alt="dockerʵ�ֿ���" border="0" height="276" style="height: auto;" width="352"/></div><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Docker</b></span></font> <font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>组件与元素</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker Client </span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">是用户界面，它支持用户与</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker Daemon</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">之间通信。</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker Daemon</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">运行于主机上，处理服务请求。</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker Index</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">是中央</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">registry</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">，支持拥有公有与私有访问权限的</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">容器</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">三个基本要素分别是：</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docke</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">模块</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">DockeFile</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker registry</span></font></div><div align="justify" style="min-height: 234pt;"><img src="Docker 简介_files/Image [1].png" type="image/png" data-filename="Image.png" alt="http://wenku.baidu.com/content/d817967416fc700abb68fca1?m=53edf76e3be441c342485c83deb30a3d&type=pic&src=95dc35180a7ee48febb2f596b485370b.png" border="0" height="390" style="height: auto;" width="692"/></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Namespaces </span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">充当隔离的第一级。确保一个容器中运行一个进程而且不能看到或影响容器外的其它进程。</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Control Groups</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">是</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">LXC</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">的重要组成部分，具有资源核算与限制的关键功能。</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">UnionFS</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">（文件系统）作为容器的构建块。为了支持</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">的轻量级以及速度快的特性，它创建了用户层</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">容器的规划（</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">设计者极力推崇“一个容器一个进程的方式”）</span></font></div><ol style="margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Calibri; font-size: 22pt; font-weight: Bold; color: #010101;"><div style="margin-top: 0pt; margin-bottom: 4pt;"><h1 align="justify"><font color="#010101" face="Calibri" size="5"><span style="font-size:22pt; font-family:Calibri; color:#010101; font-weight:Bold; font-style:Normal; font-decoration:Normal"><b>Docker</b></span></font><font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>启用计划</b></span></font></h1></div></li></ol><h2 align="justify"></h2><p align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.57mm; margin-bottom:4.57mm;"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt">安装</span></font><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt">Docker</span></font></p><h3 align="justify"><font color="#010101" face="Calibri" size="4"><span style="font-size:16pt"><b>Centos 6.5-6.7</b></span></font></h3><ul style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: disc;"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><br/></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">升级</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Kernel</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">cd /etc/yum.repos.d</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">wget</span></font> <a href="http://www.hop5.in/yum/el6/hop5.repo"><font color="#0563C1" face="Calibri" size="2"><span style="font-size:10pt"><u>http://www.hop5.in/yum/el6/hop5.repo</u></span></font></a></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">yum install kernel-ml-aufs kernel-ml-aufs-devel</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">sed -i '/default=1/default=0/g' /etc/grub.conf</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">reboot</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">重启服务器</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">验证内核</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">uname -r</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">3.10.5-3.el6.x86_64</span></font></div></li></ul><ul style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: disc;"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">安装</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">主程序：</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">rpm -ivh</span></font> <a href="http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm"><font color="#0563C1" face="Calibri" size="2"><span style="font-size:10pt"><u>http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</u></span></font></a></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">sed -i 's/^mirrorlist=https/mirrorlist=http/' /etc/yum.repos.d/epel.repo</span></font></div><ul><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">yum -y install docker-io</span></font></div></li></ul></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">yum –y upgrade device-mapper-libs</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><br/></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">配置支持容器上网</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">setenforce 0</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">sed -i '/^SELINUX=/c\SELINUX=disabled' /etc/selinux/config</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">sed -i 's/ net.ipv4.ip_forward = 0/ net.ipv4.ip_forward = 1/g' /etc/sysctl.conf</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">sysctl –p</span></font></div></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><br/></li><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">初始优化</span></font></div></li></ul><h3 align="justify"></h3><p align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.57mm; margin-bottom:4.57mm;"><font color="#010101" face="Calibri" size="4"><span style="font-size:16pt"><b>Cetnos 7</b></span></font></p><div align="justify" style="min-height: 15pt;"><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">systemctl disable firewalld.service</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">  #</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">停止</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">firewall</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">systemctl disable firewalld.service</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">  #</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">禁止</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">firewall</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">开机启动</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">yum install iptables iptables-* -y</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">systemctl start iptables</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">systemctl enable iptables.service</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">setenforce 0</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">sed -i '/^SELINUX=/c\SELINUX=disabled' /etc/selinux/config</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip_forward #</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">打开包转发功能</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">echo &quot;net.ipv4.ip_forward = 1&quot;  &gt;&gt; /usr/lib/sysctl.d/00-system.conf</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">#</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">修改</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">sysctl –p</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">文件，让包转发功能在系统启动时自动生效</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">:</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Yum install docker  #</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">执行</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">docker</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">安装脚本</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">systemctl  enable docker.service #Docker</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">开机自启动</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">systemctl start docker  #</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">启动</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">服务</span></font></div><h3 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>变更</b></span></font><font color="#010101" face="Calibri" size="4"><span style="font-size:16pt"><b>docker</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>镜像目录位置</b></span></font></h3><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="微软雅黑" size="1"><span style="font-size:9pt">第一种：</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="微软雅黑" size="1"><span style="font-size:9pt">（1）首先，备份fstab文件</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�" size="1"><span style="font-size:9pt">cp /etc/fstab /etc/fstab.$(date +%Y-%m-%d)</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="微软雅黑" size="1"><span style="font-size:9pt">（2）service docker stop</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�" size="1"><span style="font-size:9pt">rsync -aXS /var/lib/docker/.  /data/docker/</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="微软雅黑" size="1"><span style="font-size:9pt">（3）修改fstab在该文件中把下面一行添加到fstab里，将新位置挂载到 /var/lib/docker</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�" size="1"><span style="font-size:9pt">/data/docker /var/lib/docker  none bind 0 0</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="微软雅黑" size="1"><span style="font-size:9pt">文件的内如如下：</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�" size="1"><span style="font-size:9pt">[root@10-10-63-106 docker]# cat /etc/fstab</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�" size="1"><span style="font-size:9pt">/data/docker /var/lib/docker  none bind 0 0</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="微软雅黑" size="1"><span style="font-size:9pt">（4）重新挂载</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="Microsoft YaHei" size="1"><span style="font-size:9pt">mount –a</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="微软雅黑" size="1"><span style="font-size:9pt">第二种：</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�" size="1"><span style="font-size:9pt">centos 7</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�" size="1"><span style="font-size:9pt">vim /etc/sysconfig/docker 修改或添加 OPTIONS=--graph=</span></font><font color="#010101" face="Microsoft YaHei" size="1"><span style="font-size:9pt">”</span></font><font color="#010101" face="΢���ź�" size="1"><span style="font-size:9pt">/home/docker_data</span></font><font color="#010101" face="Microsoft YaHei" size="1"><span style="font-size:9pt">”</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�" size="1"><span style="font-size:9pt">centos 6</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�" size="1"><span style="font-size:9pt">vim /etc/sysconfig/docker 修改或添加 other_args=--graph=&quot;/home/docker_data&quot;</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="Microsoft YaHei" size="1"><span style="font-size:9pt">service docker start</span></font></div><h3 align="justify"><font color="#010101" face="Calibri" size="4"><span style="font-size:16pt"><b>Docker</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>调整容器空间默认</b></span></font><font color="#010101" face="Calibri" size="4"><span style="font-size:16pt"><b>20G</b></span></font></h3><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">修改</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">docker</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">数据存储目录</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�"><span style="font-size:7pt">sed -i &quot;/DOCKER_CERT_PATH/i\\OPTIONS=--graph=\&quot;/home/docker_data\&quot;&quot; /etc/sysconfig/docker</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">改容器存储默认大小</span></font> <font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">50G  1000G</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="΢���ź�"><span style="font-size:7pt">echo &quot;DOCKER_STORAGE_OPTIONS=\&quot;--storage-opt dm.basesize=50G --storage-opt dm.loopdatasize=1000G --storage-opt dm.loopmetadatasize=4G\&quot;&quot; &gt; /etc/sysconfig/docker-storage</span></font></div><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>常用</b></span></font><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Docker</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>命令</b></span></font></h2><h3 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>镜像类</b></span></font></h3><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker build --rm=true .</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">构建镜像<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker pull ${IMAGE}</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">安装镜像<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker images</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">显示已经安装的镜像<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker images --no-trunc</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">显示已经安装镜像的详细内容<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker rmi ${IMAGE_ID}</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">删除指定镜像<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker rmi $(docker</span></font> <font color="#C7254E" face="Microsoft YaHei" size="1"><span style="font-size:8pt; background:#f9f2f4">images | grep “^” | awk “{print $3}”)</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">删除所有没有标签的镜像<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker rm $(docker ps -aq)</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">删除所有的镜像<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker rmi $(docker images --quiet --filter &amp;quot;dangling=true&amp;quot;)</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">删除未使用的镜像</span></font><h3 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>容器类</b></span></font></h3><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker run</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">运行容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker ps</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">显示正在运行的容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker ps -a</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">显示所有的容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker stop ${CID}</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">停止指定容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker stop docker ps -q</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">停止所有正在运行的容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker ps -a --filter &amp;quot;exited=1&amp;quot;</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">显示所有退出状态为1的容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker rm ${CID}</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">删除指定容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker ps -a | grep wildfly | awk '{print $1}' | xargs docker rm -f</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">使用正则表达式删除容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker rm -f $(docker ps -a | grep Exit | awk '{ print $1 }')</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">删除所有退出的容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker rm $(docker ps -aq)</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">删除所有的容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker inspect --format '{{ .NetworkSettings.IPAddress }}' ${CID}</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">显示指定容器的IP<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker attach ${CID}</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">进入容器<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker exec -it ${CID} bash</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">进入容器打开一个shell<br/></span></font><font color="#C7254E" face="΢���ź�" size="1"><span style="font-size:8pt; background:#f9f2f4">docker ps | grep wildfly | awk '{print $1}'</span></font><font color="#777777" face="Microsoft YaHei" size="1"><span style="font-size:8pt"> </span></font><font color="#777777" face="微软雅黑" size="1"><span style="font-size:8pt">通过正则表达式查找容器的镜像ID</span></font><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>需注意的问题</b></span></font></h2><h3 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>镜像需要考虑的问题：</b></span></font></h3><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Arial; font-size: 10pt; color: #333333;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt; font-family:Arial; color:#333333; font-weight:Normal; font-style:Normal; font-decoration:Normal">Base Image</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">的选择</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">,</span></font> <font color="#333333" face="宋体" size="2"><span style="font-size:10pt">比如</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">phusion-baseimage</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">（初始镜像）</span></font></li></ol><p style="margin-left:6mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 21pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">Base Image</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">包括了操作系统命令行和类库的最小集合，一旦启用，所有应用都需要以它为基础创建应用镜像。</span></font></p><p style="margin-top:0; margin-bottom:0; min-height: 21pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">2</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">）配置管理</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">Docker</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">镜像的工具的选择，比如</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">Ansible</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">Chef</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">Puppet</span></font></p><p style="margin-top:0; margin-bottom:0; min-height: 21pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">3</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">）</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">Host</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">主机系统的选择，比如</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">CoreOS</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">Atomic</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">Ubuntu</span></font></p><p style="margin-top:0; margin-bottom:0; min-height: 21pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">4</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">）在创建每一个容器时需确定端口的映射情况，因为</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">Docker</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">容器本身不支持动态扩展所以可以使用</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">iptables</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">，但在重启会导致丢失。</span></font></p><h3 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>容器需要考虑的问题：</b></span></font></h3><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">应用目录映射，如果目录存在更新最好是映射到本地</span></font></div></li><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">Log</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">文件目录映射</span></font></div></li><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">配置文件目录映射</span></font></div></li><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">时区问题</span></font></div></li><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: ����; font-size: 10pt; color: #2c2c2c;"><font color="#2C2C2C" face="����" size="2"><span style="font-size:10pt; font-family:����; color:#2c2c2c; font-weight:Normal; font-style:Normal; font-decoration:Normal">docker容器默认的空间是10G,如果想指定默认容器的大小（在启动容器的时候指定），可以在docker配置文件里通过dm.basesize参数指定，比如</span></font></li></ol><table cellpadding="0" cellspacing="0" style="border-collapse: collapse; border: none;width:692px;" width="692"><colgroup><col width="8"></col><col width="684"></col></colgroup><tbody><tr><td align="left" height="33" style="border: solid #010101 0px;width:5.057803468208093%;" valign="middle" width="8"><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:2.64mm;min-height: 15pt;"><font color="#010101" face="����" size="1"><span style="font-size:9pt">1</span></font></div></td><td align="left" height="33" style="border: solid #010101 0px;width:94.99822946175637%;" valign="middle" width="684"><div align="left" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:2.64mm;min-height: 15pt;"><font color="#010101" face="����"><span style="font-size:12pt">docker -d --storage-opt dm.basesize=20G</span></font></div></td></tr></tbody></table><h1 align="justify"><font color="#010101" face="Calibri" size="5"><span style="font-size:22pt"><b>2.</b></span></font><font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>问题处理：</b></span></font></h1><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>*rootfs </b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>空间动态调整</b></span></font></h2><font color="#FF0000" face="微软雅黑" size="1"><span style="font-size:9pt"><b>初始创建时 容器默认空间为10G，一旦占用100%会影响到TCP连接等。所以此项非常重要需谨慎。</b></span></font><p style="margin-top:0; margin-bottom:0; min-height: 12pt;"><font color="#2C2C2C" face="宋体"><span style="font-size:7pt">创建脚本</span></font> <font color="#008200" face="Consolas" size="1"><span style="font-size:9pt">dynamic_modify_docker_disk.sh</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">#!/bin/bash</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">#This script is dynamic modify docker container disk</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">#Author Deng Lei</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">if [ -z $1 ] || [ -z $2 ]; then</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">    echo &quot;Usage: container_name increase_capacity&quot;</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">    echo &quot;Example: I want increase 11G to test&quot;</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">    echo &quot;The command is:   sh `basename $0` test 11&quot;</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">    exit 1</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">                                                                                                                                                        fi</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">if [ `docker inspect $1 &amp;&gt;&gt;/dev/null &amp;&amp;  echo 0 || echo 1` -eq 1 ];then</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">    echo &quot;The container $1 is no exist!&quot;</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">    exit 1</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">fi</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">container_id=`docker inspect -f '{{ .Id }}' $1`</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">now_disk=`dmsetup table /dev/mapper/docker-*-$container_id|awk '{print $2}'`</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">disk=$(($2*1024*1024*1024/512))</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">if [ $disk -lt $now_disk ];then</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">    echo &quot;I can't shink container $1 from $(($now_disk*512/1024/1024/1024))G to ${2}G!I only modify contanier increase disk!&quot;</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">    exit 1</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">fi</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">dmsetup table /dev/mapper/docker-*-$container_id|sed &quot;s/0 [0-9]* thin/0 $disk thin/&quot;|dmsetup load /dev/mapper/docker-*-$container_id</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">dmsetup resume /dev/mapper/docker-*-$container_id</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">resize2fs /dev/mapper/docker-*-$container_id</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">if [ $? -eq 0 ];then</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">    echo &quot;dynamic container $1 disk to ${2}G is success!&quot;</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">else</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">    echo &quot;dynamic container $1 disk to ${2}G is fail!&quot;</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><font color="#2C2C2C" face="Calibri"><span style="font-size:7pt">fi</span></font></p><div align="justify" style="min-height: 15pt;"><font color="#2C2C2C" face="宋体" size="2"><span style="font-size:10pt">目前给</span></font><font color="#2C2C2C" face="Calibri" size="2"><span style="font-size:10pt">test</span></font><font color="#2C2C2C" face="宋体" size="2"><span style="font-size:10pt">容器进行动态增加</span></font><font color="#2C2C2C" face="Calibri" size="2"><span style="font-size:10pt">20G</span></font><font color="#2C2C2C" face="宋体" size="2"><span style="font-size:10pt">空间</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#008200" face="Consolas" size="1"><span style="font-size:9pt">sh dynamic_modify_docker_disk.sh test 20</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#2C2C2C" face="宋体" size="2"><span style="font-size:10pt">仅能支持</span></font><font color="#2C2C2C" face="Calibri" size="2"><span style="font-size:10pt">ext2</span></font><font color="#2C2C2C" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#2C2C2C" face="Calibri" size="2"><span style="font-size:10pt">ext3</span></font><font color="#2C2C2C" face="宋体" size="2"><span style="font-size:10pt">、</span></font><font color="#2C2C2C" face="Calibri" size="2"><span style="font-size:10pt">ext4</span></font><font color="#2C2C2C" face="宋体" size="2"><span style="font-size:10pt">，不支持</span></font><font color="#2C2C2C" face="Calibri" size="2"><span style="font-size:10pt">xfs</span></font></div><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>容器时区</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">1:</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">TZ='Asia/Shanghai'; export TZ</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">sed -i 's/UTC/Asia\/Shanghai/g' /etc/sysconfig/clock</span></font></div><div align="justify" style="min-height: 15pt;"><font face="Consolas" size="1"><span style="font-size:9pt">-v /etc/localtime:/etc/localtime:ro</span></font></div><div align="justify" style="min-height: 15pt;"><font face="Consolas" size="1"><span style="font-size:9pt">2:</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#666666" face="微软雅黑" size="2"><span style="font-size:10pt">把/usr/share/zoneinfo/Asia/Shanghai 覆盖到/etc/localtime</span></font></div><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Iptables</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>端口动态扩容</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#444444" face="Arial"><span style="font-size:7pt">iptables -t nat –nvL</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#444444" face="Arial"><span style="font-size:7pt">1</span></font><font color="#444444" face="宋体"><span style="font-size:7pt">，添加一条映射</span></font> <font color="#444444" face="Arial"><span style="font-size:7pt">172.17.17.2:8080</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#444444" face="Arial"><span style="font-size:7pt">iptables -t nat -A DOCKER ! -i docker0 -p tcp -m tcp --dport 8080 -j DNAT --to-destination  172.17.17.2:8080</span></font></div><div align="justify" style="min-height: 52pt;"><img src="Docker 简介_files/Image [2].png" type="image/png" data-filename="Image.png" alt="graphic" border="0" height="86" style="height: auto;" width="688"/><font color="#444444" face="Arial"><span style="font-size:7pt"> </span></font></div><div align="justify" style="min-height: 15pt;"><font color="#444444" face="Arial"><span style="font-size:7pt">iptables -L -n</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri"><span style="font-size:7pt">2</span></font><font color="#010101" face="宋体"><span style="font-size:7pt">，在添加一次</span></font><font color="#010101" face="Calibri"><span style="font-size:7pt">docker</span></font><font color="#010101" face="宋体"><span style="font-size:7pt">端口开放</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri"><span style="font-size:7pt">iptables -A DOCKER -d 172.17.17.2/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 8080 -j ACCEPT</span></font></div><div align="justify" style="min-height: 259pt;"><img src="Docker 简介_files/Image [3].png" type="image/png" data-filename="Image.png" alt="graphic" border="0" height="432" style="height: auto;" width="690"/></div><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Iptables</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>关闭的灾难</b></span></font></h2><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">（网卡模式在默认的模式中）</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">容器不能上网</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">端口无法映射</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">出现以下报错</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Error response from daemon: Cannot start container: iptables failed: iptables -t nat -A DOCKER -p tcp -d 0/0 --dport 3306 -j DNAT --to-destination 172.17.0.16:3306 ! -i docker0: iptables: No chain/target/match by that name.</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">解决办法：重启服务器或者</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">docker</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">整个服务</span></font></div><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>容器导入导出</b></span></font></h2><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="1"><span style="font-size:9pt">找到你想移动的</span></font> <font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">Docker</span></font> <font color="#010101" face="宋体" size="1"><span style="font-size:9pt">容器的</span></font> <font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">ID</span></font><font color="#010101" face="宋体" size="1"><span style="font-size:9pt">。</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 70pt;"><img src="Docker 简介_files/Image [4].png" type="image/png" data-filename="Image.png" alt="graphic" border="0" height="118" style="height: auto;" width="689"/></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="1"><span style="font-size:9pt">我将使用</span></font> <font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">0dd0483dbf97</span></font><font color="#010101" face="宋体" size="1"><span style="font-size:9pt">这个</span></font> <font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">ID</span></font> <font color="#010101" face="宋体" size="1"><span style="font-size:9pt">作为示例演示。</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="1"><span style="font-size:9pt">提交你的变更，并且把容器保存成镜像，命名为</span></font> <font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">cec/tomcat_8009_8080</span></font><font color="#010101" face="宋体" size="1"><span style="font-size:9pt">。</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">$ docker commit 0dd0483dbf97 cec/tomcat_8009_8080</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="1"><span style="font-size:9pt">导出</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">$ docker save cec/tomcat_8009_8080&gt; /tmp/ tomcat_8009_8080.tar</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="1"><span style="font-size:9pt">把</span></font> <font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">tomcat_8009_8080.tar</span></font> <font color="#010101" face="宋体" size="1"><span style="font-size:9pt">拷贝到新的</span></font> <font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">Docker</span></font> <font color="#010101" face="宋体" size="1"><span style="font-size:9pt">实例中</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="1"><span style="font-size:9pt">导入</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">$ docker load &lt; /tmp/ tomcat_8009_8080.tar</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="1"><span style="font-size:9pt">最后，运行</span></font> <font color="#010101" face="Calibri" size="1"><span style="font-size:9pt">docker images</span></font> <font color="#010101" face="宋体" size="1"><span style="font-size:9pt">命令检查镜像现在是否可用。</span></font></div><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Docker</b></span></font> <font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>无法启动的问题解决</b></span></font></h2><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">由于我这次docker挂掉起不来是因为docker容器目录磁盘空间爆满后的一些操作造成的，所以我还是优先考虑空间不足的问题：</span></font><p style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 16pt;"><font color="#333333" face="����" size="2"><span style="font-size:10pt">docker ps  #查看容器ID</span></font></p><p style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 16pt;"><font color="#333333" face="����" size="2"><span style="font-size:10pt">docker stop id  #停止容器</span></font></p><p style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 16pt;"><font color="#333333" face="����" size="2"><span style="font-size:10pt">docker rm id    #删除容器</span></font></p><p style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 16pt;"><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">然后就卡死了，系统重启后，docker无法启动</span></font></p><p style="margin-top:0; margin-bottom:0; min-height: 16pt;"><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">解决方法：</span></font></p><table cellpadding="0" cellspacing="0" style="border-collapse: collapse; border: none;width:859px;" width="859"><tbody><tr><td align="left" style="border: solid #010101 0px;width:4.190919674039581%;" valign="middle" width="36"><div><br/></div></td><td align="left" style="border: solid #010101 0px;width:95.80908032596042%;" valign="middle" width="823"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="����"><span style="font-size:12pt">rm</span></font><font color="#010101" face="����" size="2"><span style="font-size:10pt"> </span></font><font color="#010101" face="����"><span style="font-size:12pt">-rf /var/lib/docker/* #(记得备份重要数据 &lt;会清除所有容器和镜像&gt;)</span></font></div></td></tr></tbody></table><p style="margin-left:0mm; margin-right:0mm; text-indent:8mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 16pt;"><font color="#333333" face="����" size="2"><span style="font-size:10pt">cat xxx.tar.gz | docker import - name:tag</span></font></p><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>容器</b></span></font><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Dead</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>状态</b></span></font></h2><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">docker rm -f  ID</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">号</span></font></div><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Docker</b></span></font> <font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>僵尸进程问题</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">         </span></font><font face="����" size="2"><span style="font-size:10pt">kill -HUP `ps -A -ostat,ppid | grep -e '^[Zz]' | awk '{print $2}'`</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">         </span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">以上处理僵尸进程会导致</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">DOCKER</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">主程序关闭。</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">         </span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">目前没有好办法，只有重启服务器才能处理。</span></font></div><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>双网卡无法互通问题</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">1</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">是</span></font><font color="#CC0000" face="宋体" size="2"><span style="font-size:10pt"><i>关闭</i></span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">反向路径过滤功能</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">2</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">是添加一条满足反向路径过滤的路由。</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">echo 0 &gt; /proc/sys/net/ipv4/conf/all/rp_filter</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">echo 0 &gt; /proc/sys/net/ipv4/conf/em1/rp_filter</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">echo 0 &gt; /proc/sys/net/ipv4/conf/em2/rp_filter</span></font></div><h1 align="justify"><font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>环境部署</b></span></font></h1><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>*</b></span></font> <font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>容器</b></span></font><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>-</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>创建声明</b></span></font></h2><div align="justify" style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">docker run -t -i</span></font></div><div align="justify" style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">-p iptables</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">端口</span></font><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">:</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">容器启用端口（</span></font><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">80:8080</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">）</span></font></div><div align="justify" style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font face="Consolas" size="1"><span style="font-size:9pt">-v /etc/localtime:/etc/localtime:ro</span></font><font face="宋体" size="1"><span style="font-size:9pt">（时间与宿主机同步）</span></font></div><div align="justify" style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font face="Consolas" size="1"><span style="font-size:9pt">-v /opt:/mnt (</span></font><font face="宋体" size="1"><span style="font-size:9pt">宿主机目录</span></font><font face="Consolas" size="1"><span style="font-size:9pt">:</span></font> <font face="宋体" size="1"><span style="font-size:9pt">容器目录</span></font><font face="Consolas" size="1"><span style="font-size:9pt">)</span></font></div><div align="justify" style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font face="Consolas" size="1"><span style="font-size:9pt">--memory 10g</span></font> <font face="宋体" size="1"><span style="font-size:9pt">限制内存</span></font></div><div align="justify" style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font face="Consolas" size="1"><span style="font-size:9pt">--cpuset-cpus=&quot;0,1,2,3&quot; CPU</span></font><font face="宋体" size="1"><span style="font-size:9pt">限制</span></font></div><div align="justify" style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">--</span></font><font color="#CC0000" face="Arial" size="2"><span style="font-size:10pt"><i>restart</i></span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">= on-failure:5</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">（注意</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">--link</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">和</span></font><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">--restart=always</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">不能一起使用）</span></font></div><div align="justify" style="margin-left:26mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">Redis</span></font> <font color="#333333" face="宋体" size="2"><span style="font-size:10pt">将在容器退出时自动重启</span></font></div><div align="justify" style="margin-left:26mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">docker run --restart=always redis</span></font></div><div align="justify" style="margin-left:26mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">如果</span></font> <font color="#333333" face="Arial" size="2"><span style="font-size:10pt">redis</span></font> <font color="#333333" face="宋体" size="2"><span style="font-size:10pt">以非</span></font> <font color="#333333" face="Arial" size="2"><span style="font-size:10pt">0</span></font> <font color="#333333" face="宋体" size="2"><span style="font-size:10pt">退出时，尝试重启</span></font> <font color="#333333" face="Arial" size="2"><span style="font-size:10pt">5</span></font> <font color="#333333" face="宋体" size="2"><span style="font-size:10pt">次</span></font></div><div align="justify" style="margin-left:26mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">docker run --restart=on-failure:5 redis</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">         --cap-add=NET_ADMIN</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">         --</span></font><font color="#FF0000" face="Arial" size="2"><span style="font-size:10pt">privileged</span></font> <font color="#333333" face="宋体" size="2"><span style="font-size:10pt">真正的</span></font><font color="#333333" face="Helvetica" size="2"><span style="font-size:10pt">root</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">权限</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#FF0000" face="宋体"><span style="font-size:12pt"><b>完整示例：</b></span></font></div><div align="justify" style="min-height: 15pt;"><font color="#FF0000" face="Arial"><span style="font-size:12pt"><b>docker run -d -i -h $NAME -v $PH -v /etc/localtime:/etc/localtime:ro --name ${NAME}${C} --restart=on-failure:5 --privileged --cap-add=NET_ADMIN -p $PORT:22 $IMAGE</b></span></font></div><div align="justify" style="min-height: 15pt;"><font color="#333333" face="Arial" size="2"><span style="font-size:10pt">docker run -d -i -h taijiu_yun_hbase_140 --name taijiu_yun_hbase_140 --net=br0 --ip=172.16.10.140 --restart=on-failure:5</span></font> <font color="#010101" face="Arial" size="2"><span style="font-size:10pt">--memory 10g</span></font> <font color="#333333" face="Arial" size="2"><span style="font-size:10pt">--privileged --cap-add=NET_ADMIN taijiu_yun_hbase03</span></font></div><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:15pt">部署实例</span></font></h2><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 57pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">下载需要的镜像：</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">docker pull centos:centos6</span></font></div></li></ol><div align="justify" style="margin-left:6mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 103pt;"><img src="Docker 简介_files/Image [5].png" type="image/png" data-filename="Image.png" alt="graphic" border="0" height="173" style="height: auto;" width="688"/></div><ol start="2" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 57pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">创建容器：</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">docker run -i -t centos:centos6 /bin/bash</span></font></div></li></ol><div align="justify" style="margin-left:6mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 51pt;"><img src="Docker 简介_files/Image [6].png" type="image/png" data-filename="Image.png" alt="graphic" border="0" height="85" style="height: auto;" width="692"/></div><ol start="3" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 57pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">容器打包</span></font> <font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">(</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">按</span></font> <font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">Ctrl + d</span></font> <font color="#333333" face="宋体" size="2"><span style="font-size:10pt">来退出容器的命令行，然后执行命令：</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">)</span></font></div></li></ol><div align="justify" style="margin-left:13mm; margin-right:0mm; text-indent:9mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#FF0000" face="Verdana" size="2"><span style="font-size:10pt"><b>docker commit da90 custom/base</b></span></font></div><div align="justify" style="margin-left:13mm; margin-right:0mm; text-indent:21mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">docker run -t -i custom/base /bin/bash</span></font></div><div align="justify" style="margin-left:21mm; margin-right:0mm; text-indent:12mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">在容器中</span></font><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">yum install httpd</span></font></div><div align="justify" style="margin-left:21mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 112pt;"><img src="Docker 简介_files/Image [7].png" type="image/png" data-filename="Image.png" alt="graphic" border="0" height="187" style="height: auto;" width="687"/></div><div align="justify" style="margin-left:13mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">可以根据这种思想，为自己所需的每个组件都创建一个容器，然后把这些容器复用于开发环境或者生产环境。</span></font></div><div align="justify" style="margin-left:13mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">docker run -t -i -p 80:80 -v /vagrant/htdocs:/var/www/html custom/httpd /bin/bash</span></font></div><div align="justify" style="margin-left:13mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">-p 80:80 </span></font> <font color="#333333" face="宋体" size="2"><span style="font-size:10pt">（</span></font><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">80</span></font> <font color="#333333" face="宋体" size="2"><span style="font-size:10pt">端口的映射）</span></font></div><div align="justify" style="margin-left:13mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">-v /vagrant/htdocs:/var/www/html</span></font> <font color="#333333" face="宋体" size="2"><span style="font-size:10pt">（定义在宿主机文件存储位置</span></font><font color="#333333" face="Verdana" size="2"><span style="font-size:10pt">:</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt">容器文件的存储位置）</span></font></div><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>*Dockerfile</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">注：此脚本是在制作</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">image</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">中必不可少部分。</span></font></div><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>部署实例资源隔离</b></span></font></h2><font face="Helvetica"><span style="font-size:7pt">Docker</span></font><font face="宋体"><span style="font-size:7pt">使用</span></font><font face="Helvetica"><span style="font-size:7pt">cgroup</span></font><font face="宋体"><span style="font-size:7pt">实现</span></font><font face="Helvetica"><span style="font-size:7pt">CPU</span></font><font face="宋体"><span style="font-size:7pt">，内存和磁盘</span></font><font face="Helvetica"><span style="font-size:7pt">IO</span></font><font face="宋体"><span style="font-size:7pt">等系统资源的限制。</span></font><h3 align="justify"><font color="#010101" face="Calibri" size="4"><span style="font-size:16pt"><b>CPU</b></span></font></h3><font face="Verdana"><span style="font-size:7pt">Docker</span></font><font face="宋体"><span style="font-size:7pt">现在有</span></font><font face="Verdana"><span style="font-size:7pt">2</span></font><font face="宋体"><span style="font-size:7pt">个与</span></font><font face="Verdana"><span style="font-size:7pt">CPU</span></font><font face="宋体"><span style="font-size:7pt">资源相关的参数，</span></font><font face="Verdana"><span style="font-size:7pt">-c</span></font><font face="宋体"><span style="font-size:7pt">可以指定</span></font><font face="Verdana"><span style="font-size:7pt">CPU</span></font><font face="宋体"><span style="font-size:7pt">的占比，</span></font><font face="Verdana"><span style="font-size:7pt">--cpuset</span></font><font face="宋体"><span style="font-size:7pt">可以绑定</span></font><font face="Verdana"><span style="font-size:7pt">CPU</span></font><font face="宋体"><span style="font-size:7pt">。例如，指定容器在</span></font><font face="Verdana"><span style="font-size:7pt">CPU 0,1</span></font><font face="宋体"><span style="font-size:7pt">运行：</span></font><div align="left" style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt">#</span></font><font color="#FF0000" face="Verdana"><span style="font-size:7pt"> docker run -it --rm -c 1024 --cpuset=0,1 dbyin/stress --cpu 2 </span></font></div><div align="left" style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt">stress: info: [1] dispatching hogs: 2 cpu, 0 io, 0 vm, 0 hdd</span></font></div><div align="left" style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 126pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt"> </span></font><img src="Docker 简介_files/Image [8].png" type="image/png" data-filename="Image.png" alt="NewImage" border="0" height="208" style="height: auto;" width="458"/></div><div align="left" style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt"> </span></font></div><div align="left" style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt; background: #f5fafe;"><font face="宋体"><span style="font-size:7pt">然后再启动一个容器，同样绑定在</span></font><font face="Verdana"><span style="font-size:7pt">CPU0,1</span></font><font face="宋体"><span style="font-size:7pt">，</span></font><font face="Verdana"><span style="font-size:7pt">-c</span></font><font face="宋体"><span style="font-size:7pt">为</span></font><font face="Verdana"><span style="font-size:7pt">512</span></font><font face="宋体"><span style="font-size:7pt">：</span></font></div><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt"># </span></font><font color="#FF0000" face="Verdana"><span style="font-size:7pt">docker run -it --rm -c 512 --cpuset=0,1 dbyin/stress --cpu 2</span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt">stress: info: [1] dispatching hogs: 2 cpu, 0 io, 0 vm, 0 hdd</span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 169pt; background: #f5fafe;"><img src="Docker 简介_files/Image [9].png" type="image/png" data-filename="Image.png" alt="NewImage" border="0" height="283" style="height: auto;" width="428"/></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="宋体"><span style="font-size:7pt">可以看到</span></font><font face="Verdana"><span style="font-size:7pt">container1</span></font><font face="宋体"><span style="font-size:7pt">的</span></font><font face="Verdana"><span style="font-size:7pt">CPU</span></font><font face="宋体"><span style="font-size:7pt">占比为</span></font><font face="Verdana"><span style="font-size:7pt">1024/(1024+512)=2/3</span></font><font face="宋体"><span style="font-size:7pt">，</span></font><font face="Verdana"><span style="font-size:7pt">container2</span></font><font face="宋体"><span style="font-size:7pt">的</span></font><font face="Verdana"><span style="font-size:7pt">CPU</span></font><font face="宋体"><span style="font-size:7pt">占比为</span></font><font face="Verdana"><span style="font-size:7pt">512/(1024+512)=1/3</span></font><font face="宋体"><span style="font-size:7pt">。</span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt"> </span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="宋体"><span style="font-size:7pt">将</span></font><font face="Verdana"><span style="font-size:7pt">container1</span></font><font face="宋体"><span style="font-size:7pt">的</span></font><font face="Verdana"><span style="font-size:7pt">cpu.shares</span></font><font face="宋体"><span style="font-size:7pt">改为</span></font><font face="Verdana"><span style="font-size:7pt">512</span></font><font face="宋体"><span style="font-size:7pt">，</span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt">#echo “512” &gt; /cgroup/cpu/docker/$CONTAINER_ID/cpu.shares</span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 50pt; background: #f5fafe;"><img src="Docker 简介_files/Image [10].png" type="image/png" data-filename="Image.png" alt="NewImage" border="0" height="81" style="height: auto;" width="518"/><font face="Verdana"><span style="font-size:7pt"> </span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="宋体"><span style="font-size:7pt">可以看到两个容器的</span></font><font face="Verdana"><span style="font-size:7pt">CPU</span></font><font face="宋体"><span style="font-size:7pt">占比趋于平均。</span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:2.64mm; margin-bottom:2.64mm;min-height: 6pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt"> </span></font></p><h3 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>内存</b></span></font></h3><font face="Verdana"><span style="font-size:7pt">Docker</span></font><font face="宋体"><span style="font-size:7pt">提供参数</span></font><font face="Verdana"><span style="font-size:7pt">-m, --memory=&quot;&quot;</span></font><font face="宋体"><span style="font-size:7pt">限制容器的内存使用量。例如，</span></font><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="宋体"><span style="font-size:7pt">允许容器使用的内存上限为</span></font><font face="Verdana"><span style="font-size:7pt">128M</span></font><font face="宋体"><span style="font-size:7pt">：</span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt"># </span></font><font color="#FF0000" face="Verdana"><span style="font-size:7pt">docker run -it --rm -m 128m dbyin/stress --vm 1 --vm-bytes 128M --vm-hang 0</span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt">stress: info: [1] dispatching hogs: 0 cpu, 0 io, 1 vm, 0 hdd</span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 31pt; background: #f5fafe;"><img src="Docker 简介_files/Image [11].png" type="image/png" data-filename="Image.png" alt="NewImage" border="0" height="52" style="height: auto;" width="593"/></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="宋体"><span style="font-size:7pt">实际上，</span></font><font face="Cambria"><span style="font-size:7pt">docker</span></font><font face="宋体"><span style="font-size:7pt">还会允许容器使用</span></font><font face="Cambria"><span style="font-size:7pt">-m</span></font><font face="宋体"><span style="font-size:7pt">指定的同样大小的</span></font><font face="Cambria"><span style="font-size:7pt">swap</span></font><font face="宋体"><span style="font-size:7pt">内存：</span></font></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 27pt; background: #f5fafe;"><img src="Docker 简介_files/Image [12].png" type="image/png" data-filename="Image.png" alt="NewImage" border="0" height="45" style="height: auto;" width="623"/></p><p style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="宋体"><span style="font-size:7pt">可以看到，容器可以正常启动。</span></font></p><p><font face="Verdana"><span style="font-size:7pt"> </span></font><img src="Docker 简介_files/Image [13].png" type="image/png" data-filename="Image.png" alt="NewImage" border="0" height="83" style="height: auto;" width="630"/></p><p style="margin-left:15mm; margin-right:0mm; text-indent:0mm; margin-top:2.64mm; margin-bottom:2.64mm;min-height: 6pt; background: #f5fafe;"><font face="宋体"><span style="font-size:7pt">可以看到，容器由于</span></font><font face="Verdana"><span style="font-size:7pt">out of memory</span></font><font face="宋体"><span style="font-size:7pt">被</span></font><font face="Verdana"><span style="font-size:7pt">kill</span></font><font face="宋体"><span style="font-size:7pt">掉。</span></font></p><p style="margin-left:15mm; margin-right:0mm; text-indent:0mm; margin-top:2.64mm; margin-bottom:2.64mm;min-height: 6pt; background: #f5fafe;"><font face="Verdana"><span style="font-size:7pt"> </span></font></p><h3 align="justify"><font color="#010101" face="Calibri" size="4"><span style="font-size:16pt"><b>I/O</b></span></font></h3><font face="Helvetica"><span style="font-size:7pt"># docker run -it --rm dbyin/tlinux:1.2 /bin/bash</span></font><p style="margin-left:15mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">bash-4.1# time $(dd if=/dev/zero of=f1.txt bs=1024 count=500000 &amp;&amp; sync)</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">500000+0 records in</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">500000+0 records out</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">512000000 bytes (512 MB) copied, 1.28334 s, 399 MB/s</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt"> </span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">real    0m12.091s</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">user    0m0.056s</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">sys     0m1.237s</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="宋体"><span style="font-size:7pt">可以看到，写</span></font><font face="Helvetica"><span style="font-size:7pt">512M</span></font><font face="宋体"><span style="font-size:7pt">数据，共用</span></font><font face="Helvetica"><span style="font-size:7pt">12s</span></font><font face="宋体"><span style="font-size:7pt">，平均</span></font><font face="Helvetica"><span style="font-size:7pt">42M/s</span></font><font face="宋体"><span style="font-size:7pt">。</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt"> </span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="宋体"><span style="font-size:7pt">将</span></font><font face="Helvetica"><span style="font-size:7pt">IO</span></font><font face="宋体"><span style="font-size:7pt">带宽限制为</span></font><font face="Helvetica"><span style="font-size:7pt">10M/s</span></font><font face="宋体"><span style="font-size:7pt">：</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt"># echo &quot;253:1 10485760&quot; &gt; /cgroup/blkio/docker/$CONTAINER_ID/ blkio.throttle.write_bps_device</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt"> </span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">bash-4.1# time $(dd if=/dev/zero of=f1.txt bs=1024 count=500000 &amp;&amp; sync)</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">500000+0 records in</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">500000+0 records out</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">512000000 bytes (512 MB) copied, 1.41813 s, 361 MB/s</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt"> </span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">real    0m50.348s</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">user    0m0.071s</span></font></p><p style="margin-left:11mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 13pt; background: #f5fafe;"><font face="Helvetica"><span style="font-size:7pt">sys     0m1.473s</span></font></p><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:15pt">自动化部署（开源工具）</span></font></h2><h3 align="justify"><font color="#010101" face="Calibri" size="4"><span style="font-size:16pt; background:#f8f8f8"><b>Kubernetes</b></span></font></h3><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">常用命令集合：</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><a href="https://cloud.google.com/container-engine/docs/kubectl/get"><font color="#0563C1" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8"><u>https://cloud.google.com/container-engine/docs/kubectl/get</u></span></font></a></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><a href="http://kubernetes.io/v1.0/docs/user-guide/kubectl/kubectl_delete.html"><font color="#0563C1" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8"><u>http://kubernetes.io/v1.0/docs/user-guide/kubectl/kubectl_delete.html</u></span></font></a></div><div align="justify" style="min-height: 15pt;"><font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt; background:#f5f5f9"># kubectl get minions    #</span></font><font color="#444444" face="宋体" size="1"><span style="font-size:9pt; background:#f5f5f9">查查看</span></font><font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt; background:#f5f5f9">minion</span></font><font color="#444444" face="宋体" size="1"><span style="font-size:9pt; background:#f5f5f9">主机</span></font><font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt"><br/></span><span style="font-size:9pt; background:#f5f5f9"># kubectl get pods    #</span></font><font color="#444444" face="宋体" size="1"><span style="font-size:9pt; background:#f5f5f9">查看</span></font><font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt; background:#f5f5f9">pods</span></font><font color="#444444" face="宋体" size="1"><span style="font-size:9pt; background:#f5f5f9">清单</span></font><font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt"><br/></span><span style="font-size:9pt; background:#f5f5f9"># kubectl get services</span></font> <font color="#444444" face="宋体" size="1"><span style="font-size:9pt; background:#f5f5f9">或</span></font> <font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt; background:#f5f5f9">kubectl get services -o json    #</span></font><font color="#444444" face="宋体" size="1"><span style="font-size:9pt; background:#f5f5f9">查看</span></font><font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt; background:#f5f5f9">service</span></font><font color="#444444" face="宋体" size="1"><span style="font-size:9pt; background:#f5f5f9">清单</span></font><font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt"><br/></span><span style="font-size:9pt; background:#f5f5f9"># kubectl get replicationControllers    #</span></font><font color="#444444" face="宋体" size="1"><span style="font-size:9pt; background:#f5f5f9">查看</span></font><font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt; background:#f5f5f9">replicationControllers</span></font><font color="#444444" face="宋体" size="1"><span style="font-size:9pt; background:#f5f5f9">清单</span></font><font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt"><br/></span><span style="font-size:9pt; background:#f5f5f9"># for i in `kubectl get pod|tail -n +2|awk '{print $1}'`; do kubectl delete pod $i; done    #</span></font><font color="#444444" face="宋体" size="1"><span style="font-size:9pt; background:#f5f5f9">删除所有</span></font><font color="#444444" face="Tahoma" size="1"><span style="font-size:9pt; background:#f5f5f9">pods</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">安装部署：</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">开源</span></font><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">Docker</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">管理工具，用于跨计算机集群部署容器。</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">GitHub</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">：</span></font><a href="https://github.com/GoogleCloudPlatform/kubernetes"><font color="#0563C1" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8"><u>https://github.com/GoogleCloudPlatform/kubernetes</u></span></font></a></div><h3 align="justify"><font color="#010101" face="Calibri" size="4"><span style="font-size:16pt; background:#f8f8f8"><b>Shipyard</b></span></font></h3><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">Shipyard</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">使用</span></font><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">Citadel</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">集群管理工具包，简化对横跨多个主机的</span></font><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">Docker</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">容器集群进行管理。通过</span></font><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">Web</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">用户界面，你可以大致浏览相关信息，比如你的容器在使用多少处理器和内存资源、在运行哪些容器，还可以检查所有集群上的事件日志</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">GitHub</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">：</span></font><a href="https://github.com/Yelp/dockersh"><font color="#0563C1" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8"><u>https://github.com/Yelp/dockersh</u></span></font></a></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">安装部署：</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#C45911" face="Helvetica"><span style="font-size:7pt">docker run -it -d --name shipyard-rethinkdb-data --entrypoint /bin/bash shipyard/rethinkdb –l</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#C45911" face="Helvetica"><span style="font-size:7pt">docker run -it -P -d --name shipyard-rethinkdb --volumes-from shipyard-rethinkdb-data shipyard/rethinkdb</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#C45911" face="Helvetica"><span style="font-size:7pt">docker run -it -p 8080:8080 -d --name shipyard --link shipyard-rethinkdb:rethinkdb shipyard/shipyard:2.0.8(</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">注意这里需要换个版本号，默认为最新版本</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">)</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#C45911" face="Calibri"><span style="font-size:7pt">1.</span></font> <font color="#C45911" face="宋体"><span style="font-size:7pt">登录</span></font><font color="#C45911" face="Calibri"><span style="font-size:7pt">shipyard</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">界面</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#C45911" face="宋体"><span style="font-size:7pt">现在可以访问</span></font><font color="#C45911" face="Calibri"><span style="font-size:7pt">http://&lt;your-host-ip&gt;:8080</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">来登录</span></font><font color="#C45911" face="Calibri"><span style="font-size:7pt">shipyard</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">了，默认用户名</span></font><font color="#C45911" face="Calibri"><span style="font-size:7pt">/</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">密码是：</span></font><font color="#C45911" face="Calibri"><span style="font-size:7pt">admin/shipyard</span></font><font color="#C45911" face="宋体" size="2"><span style="font-size:10pt">。</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#C45911" face="Calibri"><span style="font-size:7pt">2.</span></font> <font color="#C45911" face="宋体"><span style="font-size:7pt">开放</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">docker daemon</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">端口</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#C45911" face="宋体"><span style="font-size:7pt">默认情况下，</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">docker daemon</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">启动（</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">service docker start</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">）的时候，是不会开放一个</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">TCP</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">端口对外访问的，</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">client</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">只能从本机访问，因此需要开发一个端口供</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">shipyard</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">连接。</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#C45911" face="宋体"><span style="font-size:7pt">修改</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">/etc/sysconfig/docker</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">，将</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">other_args</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">添加如下参数：</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">&quot;-H tcp://0.0.0.0:4243 -H unix:///var/run/docker.sock&quot;</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">，变成：</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">other_args=&quot;-H tcp://0.0.0.0:4243 -H unix:///var/run/docker.sock&quot;</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#C45911" face="宋体"><span style="font-size:7pt">然后重启</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">docker deamon</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">：</span></font><font color="#C45911" face="Helvetica"><span style="font-size:7pt">service docker restart</span></font><font color="#C45911" face="宋体"><span style="font-size:7pt">。</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#C45911" face="宋体"><span style="font-size:7pt">教程：</span></font><font color="#C45911" face="Calibri"><span style="font-size:7pt">http://www.07net01.com/2015/05/853882.html</span></font></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Kitematic</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">许多项目旨在让</span></font><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">Docker</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">成为基于</span></font><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">OS X</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">的编程员们手里一款实用的桌面环境开发工具，而</span></font><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">Kitematic</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">正是其中之一。</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">GitHub</span></font><font color="#333333" face="宋体" size="2"><span style="font-size:10pt; background:#f8f8f8">：</span></font><font color="#333333" face="Calibri" size="2"><span style="font-size:10pt; background:#f8f8f8">https://github.com/kitematic/kitematic</span></font></div><h1 align="justify"><font color="#010101" face="Calibri" size="5"><span style="font-size:22pt"><b>QA&amp;RD</b></span></font><font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>环境配置及使用</b></span></font></h1><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: lower-alpha;" type="a"><li style="list-style-type: none;"><br/><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: lower-alpha;" type="a"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 3pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">QA</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">或者研发环境迁移。</span></font></div><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: -3pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">需要了解</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">QA</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">与研发中的测试环境。</span></font></div></li><li style="margin-left: -3pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">主要针对测试及生产环境中各个环境模块进行打包工作。</span></font></div></li></ol></li></ol></li></ol><h2 align="justify"></h2><p align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:4.57mm; margin-bottom:4.57mm;"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>实例</b></span></font><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>keepalived</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>部署</b></span></font></p><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">tar -zxf keepalived-1.2.8.tar.gz</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">./configure --prefix=/usr/local/keepalived</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">make &amp;&amp; make install</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">cp /usr/local/keepalived/sbin/keepalived /usr/sbin/</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">cp /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">cp /usr/local/keepalived/etc/rc.d/init.d/keepalived /etc/init.d/</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">mkdir -p /etc/keepalived/</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">chmod +x /etc/init.d/keepalived</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">测试是否能加增加</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">VIP</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">：</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#333333" face="宋体"><span style="font-size:7pt">网卡上增加一个</span></font><font color="#333333" face="Arial"><span style="font-size:7pt">IP</span></font><font color="#333333" face="宋体"><span style="font-size:7pt">：</span></font> <font color="#333333" face="Arial"><span style="font-size:7pt">ifconfig eth0:1 192.168.0.1 netmask 255.255.255.0<br/></span></font><font color="#333333" face="宋体"><span style="font-size:7pt">删除网卡的第二个</span></font><font color="#333333" face="Arial"><span style="font-size:7pt">IP</span></font><font color="#333333" face="宋体"><span style="font-size:7pt">地址</span></font><font color="#333333" face="Arial"><span style="font-size:7pt">: ip addr del 192.168.0.1 dev eth0</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">新增容器：</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">docker run -i -t -d --cap-add=NET_ADMIN taijiu/centos6.7_redis_01 /bin/bash</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">--cap-add=NET_ADMIN</span></font> <font color="#010101" face="宋体" size="2"><span style="font-size:10pt">此参数在容器中添加虚拟网卡是必须加上</span></font></div><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>实例</b></span></font><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Tomcat</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>部署</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">docker run -itd --name Tomcat –p 8081:8080 –p 8009:8009 –v /home/cec/tomcat/data:/mnt eedad67113bb /bin/bash</span></font></div><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>实例</b></span></font><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Mysql</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>部署</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">source /etc/profile</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">（必须初始化环境变量）</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">以下操作在导入了镜像的情况中</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">其中定义的数据库文件存储位置，如果映射原数据将丢失，需要重新初始化。</span></font></div><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 1pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt; font-family:Calibri; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">docker run -itd -p 3306:3306 --name mysql_3306 -v /home/cec/mysql/3306:/mysql/3306  365a4bdf5702 /bin/bash</span></font></div></li></ol><ol start="2" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 1pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">初始化数据库：</span></font></div></li></ol><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">/usr/local/mysql/scripts/mysql_install_db --user=mysql --basedir=/usr/local/mysql --datadir=/mysql/3306</span></font></div><ol start="3" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 1pt; text-indent:0pt; font-family: Calibri; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">启动数据库</span></font></div></li></ol><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">/etc/init.d/mysqld start 1</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">create database cec</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">use mysql;</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">update user set password=password(&quot;111&quot;) where user=&quot;root&quot;;</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">update user set host = '%' where user = 'root';</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">select host,user,password from user;</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">flush privileges;</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">mysql -S /mysql/3306/mysql.sock -h127.0.0.1 -uroot -p cec&lt;init.sql</span></font></div><h2 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>实例</b></span></font><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Redis</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>部署</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">docker run -itd --name redis -v /home/docker_data:/mnt centos:centos6 /bin/bash</span></font></div><h1 align="justify"><font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>网络结构部署</b></span></font></h1><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">腾讯</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Docker</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">的网络结构</span></font></div><div align="justify" style="min-height: 378pt;"><img src="Docker 简介_files/Image [14].png" type="image/png" data-filename="Image.png" alt="http://cdn2.infoqstatic.com/statics_s1_20151020-0055-2/resource/articles/how-tencent-game-use-docker/zh/resources/0813002.png" border="0" height="631" style="height: auto;" width="464"/></div><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>*</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>桥接网络配置</b></span></font></h2><div align="justify" style="min-height: 15pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">升级</span></font><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">iproute</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#010101" face="Calibri" size="2"><span style="font-size:10pt">Wget</span></font> <a href="https://repos.fedorapeople.org/openstack/EOL/openstack-grizzly/epel-6/iproute-2.6.32-130.el6ost.netns.2.x86_64.rpm"><font color="#0563C1" face="Calibri" size="2"><span style="font-size:10pt"><u>https://repos.fedorapeople.org/openstack/EOL/openstack-grizzly/epel-6/iproute-2.6.32-130.el6ost.netns.2.x86_64.rpm</u></span></font></a></div><div align="justify" style="min-height: 15pt;"><font color="#FF0000" face="宋体" size="2"><span style="font-size:10pt"><b>固定添加：</b></span></font></div><div align="justify" style="min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt"># vim ifcfg-br0</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">       DEVICE=br0</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">TYPE=Bridge</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">ONBOOT=yes</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">BOOTPROTO=static</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">IPADDR=192.168.20.89</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">NETMASK=255.255.255.0</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">GATEWAY=192.168.20.254</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">#vim ifcfg-enp0s3</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">TYPE=Ethernet</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">NAME=enp0s3</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">DEVICE=enp0s3</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">ONBOOT=yes</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">BOOTPROTO=none</span></font></div><div align="justify" style="margin-left:7mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">BRIDGE=br0</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#FF0000" face="宋体" size="2"><span style="font-size:10pt"><b>临时添加：</b></span></font></div><div align="justify" style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt"># brctl addbr br0               #新建一个虚拟网桥br0</span></font></div><div align="justify" style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt"># brctl addif br0 eth0     #eth0为宿主机网卡，这个一步把br0 和 eth0 连接起来(这一步可能会断网络)</span></font></div><div align="justify" style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt"># ip addr add 191.168.115.35/24 dev br0         #把宿主机35的ip绑定在br0上</span></font></div><div align="justify" style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt"># ip link set dev br0 up                        #启动br0</span></font></div><div align="justify" style="margin-left:4mm; margin-right:0mm; text-indent:0mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt"># route add default gw 192.168.115.1 br0        #添加默认路由 115.1为网关地址</span></font></div><div align="justify" style="min-height: 15pt;"><font color="#FF0000" face="宋体" size="2"><span style="font-size:10pt"><b>创建虚拟网络：</b></span></font></div><div align="left" style="min-height: 15pt;"><font color="#010101" face="����"><span style="font-size:12pt">docker network create --subnet=172.16.10.0/24 --gateway=172.16.10.28 --ip-range=172.16.10.0/24 -o com.docker.network.bridge.name=br0 --aux-address=DefaultGatewayIPv4=&quot;172.16.10.254&quot; br0</span></font></div><div align="left" style="min-height: 15pt;"><font color="#666666" face="Microsoft YaHei" size="2"><span style="font-size:10pt">docker run -it --net=zum --ip=192.168.20.201 custom/base</span></font></div><h1 align="justify"><font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>敏捷开发部署</b></span></font></h1><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:4mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 15pt;"><font color="#666666" face="微软雅黑" size="2"><span style="font-size:10pt">敏捷实践方法提出了一个可以持续交付的概念 DeploymentPipeline（管道部署）。</span></font></div><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: lower-alpha;" type="a"><li style="margin-left: 36pt; margin-right: 0pt; padding-left: 0pt; text-indent:0pt; font-family: ΢���ź�; font-size: 10pt; color: #666666;"><div align="justify" style="min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt; font-family:΢���ź�; color:#666666; font-weight:Normal; font-style:Normal; font-decoration:Normal">Jenkins的部署工作。</span></font></div></li></ol><h1 align="justify"></h1><p align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:0mm; margin-top:5.98mm; margin-bottom:5.80mm;"><font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>线上小流量业务测试</b></span></font></p><ol start="2" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: lower-alpha;" type="a"><li style="list-style-type: none;"><br/><ol start="2" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: lower-alpha;" type="a"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 3pt; text-indent:0pt; font-family: ΢���ź�; font-size: 10pt; color: #666666;"><div align="justify" style="min-height: 16pt;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">经</span></font><font color="#666666" face="微软雅黑" size="2"><span style="font-size:10pt">过上面的测试，如没有问题可进行部门小流量业务的合并</span></font></div></li></ol></li></ol><h1 align="justify"><font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>新项目的私有云部署</b></span></font></h1><ol start="3" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: lower-alpha;" type="a"><li style="list-style-type: none;"><br/><ol start="3" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: lower-alpha;" type="a"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 3pt; text-indent:0pt; font-family: ΢���ź�; font-size: 10pt; color: #666666;"><div align="justify" style="min-height: 15pt;"><font color="#666666" face="微软雅黑" size="2"><span style="font-size:10pt; font-family:΢���ź�; color:#666666; font-weight:Normal; font-style:Normal; font-decoration:Normal">在小流量的测试后如没有问题，可对新接入项目进行一个私有云的部署。</span></font></div></li></ol></li></ol><h2 align="justify"><font color="#010101" face="Calibri Light" size="4"><span style="font-size:16pt"><b>Docker</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>部署页面</b></span></font></h2><font color="#666666" face="微软雅黑" size="2"><span style="font-size:10pt">接近成熟后可以出一个自动化部署页面。</span></font><h1 align="justify"><font color="#010101" face="Calibri" size="5"><span style="font-size:22pt"><b>Docker</b></span></font><font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>的劣势</b></span></font></h1><font color="#666666" face="微软雅黑" size="2"><span style="font-size:10pt">前面的内容主要论述docker相对于虚拟机的优势，但docker也不是完美的系统。相对于虚拟机，docker还存在着以下几个缺点：</span></font><font color="#666666" face="����" size="2"><span style="font-size:10pt"> </span></font><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt"><br/>
1.资源隔离方面不如虚拟机，docker是利用cgroup实现资源限制的，只能限制资源消耗的最大值，而不能隔绝其他程序占用自己的资源。</span></font><font color="#666666" face="����" size="2"><span style="font-size:10pt"> </span></font><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt"><br/>
2.安全性问题。docker目前并不能分辨具体执行指令的用户，只要一个用户拥有执行docker的权限，那么他就可以对docker的容器进行所有操作，不管该容器是否是由该用户创建。比如A和B都拥有执行docker的权限，由于docker的server端并不会具体判断docker cline是由哪个用户发起的，A可以删除B创建的容器，存在一定的安全风险。</span></font><font color="#666666" face="����" size="2"><span style="font-size:10pt"> </span></font><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt"><br/>
3.docker目前还在版本的快速更新中，细节功能调整比较大。一些核心模块依赖于高版本内核，存在版本兼容问题</span></font><h1 align="justify"><font color="#010101" face="Calibri" size="5"><span style="font-size:22pt"><b>Docker</b></span></font><font color="#010101" face="宋体" size="5"><span style="font-size:22pt"><b>一些插件了解方向</b></span></font></h1><div align="justify" style="min-height: 15pt;"><font color="#666666" face="΢���ź�" size="2"><span style="font-size:10pt">Docker Compose是Docker编排服务的最后一块，前面提到的</span></font><a href="http://dockerone.com/article/27"><font color="#155FAA" face="΢���ź�" size="2"><span style="font-size:10pt"><u>Machine</u></span></font></a><font color="#666666" face="微软雅黑" size="2"><span style="font-size:10pt">可以让用户在其它平台快速安装Docker，</span></font><a href="http://dockerone.com/article/28"><font color="#155FAA" face="΢���ź�" size="2"><span style="font-size:10pt"><u>Swarm</u></span></font></a><font color="#666666" face="微软雅黑" size="2"><span style="font-size:10pt">可以让Docker容器在集群中高效运转，而Compose可以让用户在集群中部署分布式应用。简单的说，Docker Compose属于一个“应用层”的服务，用户可以定义哪个容器组运行哪个应用，它支持动态改变应用，并在需要时扩展。</span></font></div><div align="justify" style="min-height: 15pt;"><div><a href="http://dockone.io/article/34"><font color="#0563C1" face="Calibri" size="2"><span style="font-size:10pt"><u>http://dockone.io/article/34</u></span></font></a></div></div></div></span>
</div></body></html> 