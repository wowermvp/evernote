<html>
<head>
  <title>visudo精确用户赋权（sudo)</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1855"/>
<h1>visudo精确用户赋权（sudo)</h1>

<div><span><br/><div style="position: relative; max-width: 700px;"><div style="font-size: 16px"><div style="font-size:100%;background:transparent;"><div style="font-size:12px;background:rgb(242, 242, 242);font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:normal;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;color:rgb(0, 0, 0);"><div style="font-size:100%;background:transparent;line-height:22px;"><div style="font-size:100%;background:transparent;overflow:hidden;"><div style="font-size:100%;background:rgb(255, 255, 255);"><div style="font-size:100%;background:transparent;overflow:hidden;"><div style="font-size:13px;background:transparent;line-height:185%;"><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">之前也写有一篇关于 sudo配置的文章，参考<a href="http://www.toxingwang.com/server/119.html" style="text-decoration:none;color:rgb(1, 150, 227);">sudo授权</a>，后来又博友留言提醒了我，直接编辑sudoers文件对新接触linux的人来说还是有风险的，比较直接使用vi编辑该文件无法实现语法检查，而且还需要修改默认文件的权限，非常麻烦，下面再转载一篇51CTO博友的文章，讲述了使用visudo配饰sudo权限，该命令的好处在于可以实现语言的检查，不过最终的目的还是一样的，都是实现修改sudoers文件。</p><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">sudo是Unix/Linux平台上的一个非常有用的工具，允许为非根用户赋予一些合理的权利，让他们执行一些只有根用户或特许用户才能完成的任务，从而减少根用户的登陆次数和管理时间同时也提高了系统安全性。</p><ul style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;list-style:none;"><li style="list-style:square inside;line-height:24px;text-indent:2em;">sudo的目的：为非根用户授予根用户的权限；</li><li style="list-style:square inside;line-height:24px;text-indent:2em;">配置文件：/etc/sudoers</li><li style="list-style:square inside;line-height:24px;text-indent:2em;">visudo命令编辑修改/etc/sudoers配置文件</li></ul><h2 style="margin:0px;padding:0px;border:0px;font-size:16px;background:transparent;line-height:185%;">1、一般用户赋权设置：</h2><blockquote style="color:rgb(255, 255, 255);margin:0px 0px 1.6em 0.8em;padding:1.4em 1em 0.1em;border-style:dotted dotted dotted solid;border-width:1px 1px 1px 5px;border-color:rgb(91, 188, 221);background:rgb(0, 0, 0);width:660px;border-left-width:5px;border-left-style:solid;border-left-color:rgb(127, 19, 21);clear:both;"><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">[root@localhost ~]# visudo<br/>……前面省略<br/>## Syntax:<br/>##<br/>##      user    MACHINE=COMMANDS<br/>##<br/>## The COMMANDS section may have other options added to it.<br/>##<br/>## Allow root to run any commands anywhere<br/>root    ALL=(ALL)       ALL<br/>test   ALL=(root)    /usr/sbin/useradd         ##新增加用户行<br/>……后面省略</p></blockquote><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">说明：<br/>第一个字段：root为能使用sudo命令的用户；<br/>第二个字段：第一个ALL为允许使用sudo的主机，第二个括号里的ALL为使用sudo后以什么身份(目的用户身份）来执行命令；<br/>第三个字：ALL为以sudo命令允许执行的命令；<br/>上列解释： test   ALL=(root) /usr/sbin/useradd<br/>表示允许test用户从任何主机登录，以root的身份执行/usr/sbin/useradd命令。<br/>用户执行命令效果：</p><blockquote style="color:rgb(255, 255, 255);margin:0px 0px 1.6em 0.8em;padding:1.4em 1em 0.1em;border-style:dotted dotted dotted solid;border-width:1px 1px 1px 5px;border-color:rgb(91, 188, 221);background:rgb(0, 0, 0);width:660px;border-left-width:5px;border-left-style:solid;border-left-color:rgb(127, 19, 21);clear:both;"><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">[root@server ~]# su - barlow<br/>[redhat@server ~]$ sudo /usr/sbin/useradd test<br/>##命令最好输入完整的路径<br/>口令：<br/>##这里输入用户barlow自己的密码<br/>[redhat@server ~]$ cat /etc/passwd |tail -5<br/>xfs:x:43:43:X Font Server:/etc/X11/fs:/sbin/nologin<br/>gdm:x:42:42::/var/gdm:/sbin/nologin<br/>sabayon:x:86:86:Sabayon user:/home/sabayon:/sbin/nologin<br/>redhat:x:500:500::/home/redhat:/bin/bash<br/>test:x:501:501::/home/test:/bin/bash    ##新增加的用户</p></blockquote><h2 style="margin:0px;padding:0px;border:0px;font-size:16px;background:transparent;line-height:185%;">2、sudo配置深入：</h2><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">1）多个用户的设置（非同一群组用户）：<br/>对于不同需求的用户：可以按照上面的方法依次增加多行，每行对应一个用户。<br/>对于相同需求的多个用户<br/>User_Alias UUU=user1,user2…… 定义用户别名；</p><blockquote style="color:rgb(255, 255, 255);margin:0px 0px 1.6em 0.8em;padding:1.4em 1em 0.1em;border-style:dotted dotted dotted solid;border-width:1px 1px 1px 5px;border-color:rgb(91, 188, 221);background:rgb(0, 0, 0);width:660px;border-left-width:5px;border-left-style:solid;border-left-color:rgb(127, 19, 21);clear:both;"><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">[root@localhost ~]# visudo<br/>……前面省略<br/>## User Aliases<br/>## These aren't often necessary, as you can use regular groups<br/>## (ie, from files, LDAP, NIS, etc) in this file - just use %groupname<br/>## rather than USERALIAS<br/>User_Alias ADMINS = jsmith, mikem      ##这个就是一个实例行，按照这个写自己的<br/>User_Alisa sudouser=user1,user2,user3,user4    ##第一个别名suduouser<br/>……后面省略<br/>## Syntax:<br/>##<br/>##      user    MACHINE=COMMANDS<br/>##<br/>## The COMMANDS section may have other options added to it.<br/>##<br/>## Allow root to run any commands anywhere<br/>root    ALL=(ALL)       ALL77 sudouser   ALL=(root)    /usr/sbin/useradd  ##命令行书写格式，用户列用别名<br/>……后面省略</p></blockquote><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">对于多个命令的设置：<br/>Cmnd_Alias CCC=command1,command2……        定义命令别名；</p><blockquote style="color:rgb(255, 255, 255);margin:0px 0px 1.6em 0.8em;padding:1.4em 1em 0.1em;border-style:dotted dotted dotted solid;border-width:1px 1px 1px 5px;border-color:rgb(91, 188, 221);background:rgb(0, 0, 0);width:660px;border-left-width:5px;border-left-style:solid;border-left-color:rgb(127, 19, 21);clear:both;"><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">[root@localhost ~]# visudo<br/>……前面省略<br/>## Command Aliases<br/>## These are groups of related commands...<br/>## Networking<br/>Cmnd_Alias NETWORKING = /sbin/route, /sbin/ifconfig, /bin/ping, /sbin/dh        client, /usr/bin/net, /sbin/iptables, /usr/bin/rfcomm, /usr/bin/wvdial,         /sbin/iwconfig, /sbin/mii-tool                          ##多个命令定义一个命令别名；<br/>……后面省略<br/>## Syntax:<br/>##<br/>##      user    MACHINE=COMMANDS<br/>##<br/>## The COMMANDS section may have other options added to it.<br/>##<br/>## Allow root to run any commands anywhere<br/>root    ALL=(ALL)       ALL77 sudouser   ALL=(root)    NETWORKING  ##命令行书写格式，命令列用别名<br/>……后面省略</p></blockquote><h2 style="margin:0px;padding:0px;border:0px;font-size:16px;background:transparent;line-height:185%;">3、对于多主机的设置和多登陆角色的设置：</h2><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">1)修改 Host_Alias HHH=host1,host2……   定义主机别名；<br/>修改后对应的命令行主机列位置也是用别名</p><blockquote style="color:rgb(255, 255, 255);margin:0px 0px 1.6em 0.8em;padding:1.4em 1em 0.1em;border-style:dotted dotted dotted solid;border-width:1px 1px 1px 5px;border-color:rgb(91, 188, 221);background:rgb(0, 0, 0);width:660px;border-left-width:5px;border-left-style:solid;border-left-color:rgb(127, 19, 21);clear:both;"><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">Runas_Alias   RRR=role1,role2……  ##定义runas别名，指定的是“目的用户”，即sudo 允许转换至的用户；</p></blockquote><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">建立相关别明后，相关命令行相应的列也是用我们定义的别名。<br/>2）多个用户的设置（同一群组用户）：</p><blockquote style="color:rgb(255, 255, 255);margin:0px 0px 1.6em 0.8em;padding:1.4em 1em 0.1em;border-style:dotted dotted dotted solid;border-width:1px 1px 1px 5px;border-color:rgb(91, 188, 221);background:rgb(0, 0, 0);width:660px;border-left-width:5px;border-left-style:solid;border-left-color:rgb(127, 19, 21);clear:both;"><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">[root@localhost ~]# visudo<br/>……前面省略<br/>## Allows people in group wheel to run all commands<br/># %wheel        ALL=(ALL)       ALL        ##用户列+群组名<br/>……后面省略</p></blockquote><p style="margin:0px 0px 10px;padding:0px;border:0px;font-size:100%;background:transparent;">最后,希望大家能够合理为个用户账号授权。</p><div style="margin:0px;padding:0px;border:0px;font-size:100%;background:transparent;clear:both;"></div></div></div></div></div></div></div></div></div></div><br/></span>
</div></body></html> 