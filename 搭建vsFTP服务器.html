<html>
<head>
  <title>搭建vsFTP服务器</title>
  <basefont face="宋体" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 宋体;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1409"/>
<h1>搭建vsFTP服务器</h1>

<div>
<span style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
一、简介
<div>     FTP：File Transfer Protocol（文件传输协议）的英文简称，而中文简称为“文件传输协议”。用于Ineternet上的控制文件的双向传输。同时，它也是一个应用程序（Application）。基于不同的操作系统有不同的FTP应用程序，而所有这些应用程序都遵守同一种协议传输文件。在FTP的使用当中，用户经常遇到两个概念：“下载”（Download）和“上传”（Upload）。</div><div>“下载”文件就是从远程主机拷贝文件至自己的计算机上。</div><div>“上传”文件就是将文件从自己计算机中拷贝至远程主机上。</div><div>支持FTP协议的服务器就是FTP服务器。</div><div>二、工作模式</div><div>     FTP连接及传输模式</div><div>控制连接：TCP 21，用于发送FTP命令信息</div><div>数据连接：TCP 20，用于上传、下载数据</div><div>     数据连接的建立类型：</div><div>主动模式：服务端从20端口主动向客户端发起连接</div><div>被动模式：服务端在指定范围内某个端口被动等待客户端连接</div><div><img src="搭建vsFTP服务器_files/Image.png" type="image/png" data-filename="Image.png" style="cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div><img src="搭建vsFTP服务器_files/Image [1].png" type="image/png" data-filename="Image.png" style="cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div>三、服务端和客户端程序</div><div>     1）FTP用户的类型：</div><div>匿名用户：anonymous或ftp</div><div>本地用户：系统的账户（账户名称、密码等信息保存在passwd、shadow文件中）</div><div>     2）常见的FTP服务器程序：</div><div>IIS、Serv-U、wu-ftpd、Proftpd、vsftpd（Very Secure FTP Daemon）</div><div>     3）常见的FTP客户端程序：</div><div>CutelFTP、FlashFXP、LeapFTP、Filezilla、gftp、kuftp、FTP</div><div>四、相关配置</div><div>     <font color="#DE5700">1）vsftpd软件包</font></div><div>官方站点：http://vsftpd.beasts.org/</div><div>主程序：/usr/sbin/vsftpd</div><div>服务名：vsftpd</div><div>用户控制列表文件：</div><div>     /etc/vsftpd/ftpusers</div><div>     /etc/vsftpd/user_list</div><div>主配置文件：</div><div>     /etc/vsftpd/vsftpd.conf</div><div>     <font color="#DE5700">2）匿名权限控制：</font></div><div>anonymous_enable=YES：启用匿名访问</div><div>anon_umask=022：匿名用户所上传文件的权限掩码</div><div>anon_root=/var/ftp：匿名用户的FTP根目录</div><div><font color="#E30000">anon_upload_enable=YES：允许上传文件</font></div><div><font color="#E30000">anon_mkdir_write_enable=YES：允许创建目录</font></div><div><font color="#E30000">anon_other_write_enable=YES：开放其他写入权</font></div><div>anon_max_rate=0：限制最大传输速率（字节/秒）</div><div>     <font color="#DE5700">3）本地用户权限控制：</font></div><div>local_enable=YES：是否启用本地系统用户</div><div>local_umask=022：本地用户所上传文件的权限掩码</div><div>local_root=/var/ftp：设置本地用户的FTP根目录</div><div>chroot_local_user=YES：是否将用户禁锢在主目录</div><div>local_max_rate=0：限制最大传输速率（字节/秒）</div><div>     <font color="#DE5700">4）常用的全局配置项：</font></div><div>listen_address=192.168.4.1：设置监听的IP地址</div><div>listen_port=21：设置监听FTP服务的端口号</div><div>write_enable=YES：是否启用写入权限</div><div>download_enable=YES：是否允许下载文件</div><div>max_clients=0：限制并发客户端连接数</div><div>max_per_ip=0：限制同一IP地址的并发连接数</div><div>pasv_min_port=50000</div><div>pasv_max_port=60000：将客户端的数据连接端口改在（50000-60000之间）</div><div>     <font color="#DE5700">5）访问限制：</font></div><div><font color="#E30000">userlist_enable=YES：是否启用</font><span style="color: rgb(227, 0, 0);">/etc/vsftpd/user_list</span><span style="color: rgb(227, 0, 0);">列表文件</span></div><div><font color="#E30000">userlist_deny=YES：禁用/etc/vsftpd/user_list中的用户</font></div><div><font color="#E30000">userlist_deny=NO：非</font><span style="color: rgb(227, 0, 0);">/etc/vsftpd/user_list</span><span style="color: rgb(227, 0, 0);">中的用户禁用</span></div><div>     <font color="#DE5700">6）其他安全项：</font></div><div>connect_timeout=60</div><div>accept_timeout=60</div><div>data_connection_timeout=300</div><div>idle_session_timeout=300</div><div>ftpd_banner=xxx和banner_file=/path/file</div><div>tcp_wrappers=YES</div><div>     <font color="#DE5700">7）匿名和本地验证</font></div><div>     设置全局配置</div><div>[root@localhost ~]# <font color="#2D4FC9">vi /etc/vsftpd/vsftpd.conf</font></div><div>listen_address=192.168.216.234                         <i><font color="#328712">#设置监听的IP地址</font></i></div><div>listen_port=21                                                    <i><font color="#328712">#设置监听FTP服务的端口号</font></i></div><div>write_enable=YES                                               <i><font color="#328712">#是否启用写入权限</font></i></div><div>download_enable=YES                                       <i><font color="#328712">#是否允许下载文件</font></i></div><div>max_clients=0                                                   <i><font color="#328712">#限制并发客户端连接数</font></i></div><div>max_per_ip=0                                                    <i><font color="#328712">#限制同一IP地址的并发连接数</font></i></div><div>     <font color="#DE5700">a、匿名用户</font></div><div><font color="#E30000">准备匿名FTP访问的目录/var/ftp/pub，使匿名用户FTP对该目录有写入权限：chown ftp /var/ftp/pub</font></div><div>开放匿名用户配置，并启动vsftpd服务</div><div>[root@localhost ~]# vi /etc/vsftpd/vsftpd.conf</div><div>anonymous_enable=YES <font color="#2D4FC9">                             </font><i><font color="#328712">#启用匿名用户</font></i></div><div>write_enable=YES <font color="#2D4FC9">                                       </font><i><font color="#328712">#所有用户中可以写入文件</font></i></div><div>anon_umask=022 <font color="#2D4FC9">                                     </font> <i><font color="#328712">#匿名用户上传文件的权限的默认掩码</font></i></div><div>anon_upload_enable=YES                           <i><font color="#328712">#匿名用户可以上传文件</font></i></div><div>anon_mkdir_write_enable=YES                    <i><font color="#328712">#匿名用户可以在服务器端创建目录</font></i></div><div>anon_other_write_enable=YES                    <i><font color="#328712">#开放其他写入权（比如删除目录）</font></i></div><div>anon_root=/var/ftp                                    <i><font color="#328712">#匿名用户的FTP根目录</font></i></div><div>[root@localhost ~]# service vsftpd start     <i><font color="#328712">#启用vsftpd服务</font></i></div><div>为vsftpd启动vsftpd：               [确定]</div><div><font color="#DE5700">使用ftp客户端程序访问测试：</font></div><div>[root@localhost ~]# <font color="#2D4FC9">ftp 192.168.216.234</font><br/>
Connected to 192.168.216.234 (192.168.216.234).<br/>
220 (vsFTPd 2.2.2)<br/>
Name (192.168.216.234:root): <font color="#2D4FC9">ftp</font>                <i><font color="#328712">#输入匿名用户</font></i><br/>
331 Please specify the password.<br/>
Password:                                                     <i><font color="#328712">#匿名用户登陆无需密码</font></i><br/>
230 Login successful.                                   <i><font color="#328712">#见到这一行才算登陆成功</font></i><br/>
Remote system type is UNIX.<br/>
Using binary mode to transfer files.<br/>
ftp&gt; </div><div>     <font color="#DE5700">b、本地用户</font></div><div>[root@localhost ~]# vi /etc/vsftpd/vsftpd.conf</div><div>local_enable=YES                                        <i><font color="#328712">#启用本地用户</font></i></div><div>write_enable=YES                                       <i><font color="#328712">#所有用户可以写入</font></i></div><div>local_umask=022                                       <i><font color="#328712">#本地用户所上传文件的权限掩码</font></i></div><div>local_root=/var/ftp                                    <i><font color="#328712">#设置本地用户的FTP根目录</font></i></div><div>chroot_local_user=YES                               <i><font color="#328712">#是否将用户禁锢在主目录</font></i></div><div>     <font color="#DE5700">c、允许用FTP服务器的被动模式</font></div><div>[root@localhost ~]# vi /etc/vsftpd/vsftpd.conf</div><div>pasv_enable=YES                                        <i><font color="#328712">#开启被动模式</font></i></div><div>pasv_min_port=24500                                <i><font color="#328712">#设置客户端数据接口范围</font></i></div><div>pasv_max_port=24600                               <i><font color="#328712">#设置客户端数据接口范围</font></i></div><div>     <font color="#DE5700">d、虚拟用户</font></div><div>启动服务并测试</div><div>步骤如下：</div><div>创建账号数据</div><div>     <font color="#DE5700">1.建立虚拟FTP用户的账号数据库文件</font></div><div>[root@localhost ~]# vi /etc/vsftpd/vusers.list</div><div>zhangsan</div><div>123456</div><div>lisi</div><div>123456</div><div>wangwu</div><div>123456</div><div>[root@localhost ~]# cd /etc/vsftpd/</div><div>[root@localhost vsftpd]# db_load -T -t hash -f vusers.list vusers.db</div><div>[root@localhost vsftpd]# chmod 600 /etc/vsftpd/vusers.*</div><div>     <font color="#DE5700">2.创建FTP根目录及虚拟用户映射的系统用户</font></div><div>[root@localhost ~]# useradd -d /var/ftproot -s /sbin/nologin virtual</div><div>[root@localhost ~]# chmod 755 /var/ftproot/</div><div>     <font color="#DE5700">3.建立支持虚拟用户的PAM认证文件</font></div><div>[root@localhost ~]# vi /etc/pam.d/vsftpd.vu     <i><font color="#328712">#创建虚拟用户认证文件</font></i></div><div>#%PAM-1.0</div><div>auth          required     pam_userdb.so db=/etc/vsftpd/vusers</div><div>account    required     pam_userdb.so db=/etc/vsftpd/vusers</div><div>     <font color="#DE5700">4.在vsftpd.conf文件中添加支持配置</font></div><div>[root@localhost ~]# vi /etc/vsftpd/vsftpd.conf</div><div>write_enable=YES</div><div>guest_enable=YES <font color="#2D4FC9"> </font>                                           <i><font color="#328712">#启用虚拟用户</font></i></div><div>guest_username=virtual                                    <i><font color="#328712">#虚拟用户映射的本地用户</font></i></div><div>pam_service_name=vsftpd.vu                             <i><font color="#328712">#虚拟用户认证文件</font></i></div><div>     <font color="#DE5700">5.为个别虚拟用户建立独立的配置文件</font></div><div>在vsftpd.conf文件中添加用户配置目录支持</div><div>user_config_dir=/etc/vsftpd/vusers_dir</div><div>为用户zhangsan、lisi建立独立的配置目录及文件（配置文件名与用户名相同）</div><div>[root@localhost ~]# mkdir /etc/vsftpd/vusers_dir/</div><div>[root@localhost ~]# cd /etc/vsftpd/vusers_dir/</div><div>[root@localhost vusers_dir]# vi zhangsan</div><div>anon_upload_enable=YES</div><div>anon_mkdir_write_enable=YES</div><div>[root@localhost vusers_dir]# touch lisi</div><div>[root@localhost ~]# service vsftpd reload          <i><font color="#328712">#重新载入配置文件</font></i></div><div><font color="#E30000">注意：虚拟用户建立独立的配置文件与vsftpd.conf中原有配置是叠加效果，虚拟用户生效本地用户将不能登录</font></div></span>
</div></body></html> 